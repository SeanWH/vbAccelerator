<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="Author" content="Steve McMahon">
<meta name="KeyWords"
content="VB, VB6, Visual Basic, Visual Basic 5, Visual Basic 6, Dynamic HTML, DHTML, IE4, Internet Explorer, Internet Explorer 4, Active X, Active X Controls, Visual Basic Controls">
<meta name="GENERATOR" content="vbAccelerator Site Robot v0.5.1">
<title>vbAccelerator Tips - Create a VB Picture from an API Icon Handle</title>
</head>

<body bgcolor="#FFFFFF" topmargin="0" leftmargin="0" link="#660000" vlink="#999966" LEFTMARGIN="0" TOPMARGIN="0" MARGINHEIGHT="0" MARGINWIDTH="0">

<!-- AD:START -->
<table bgcolor="#336699" border="0" cellpadding="0" cellspacing="0" width="100%" >
<tr>
<td width="468">
<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<a href="..\home\index.html"><img src="..\home\res\vbaccelad.png" width="468" height="60" 
border="0" alt="vbAccelerator - Faster VB and .NET Code" /></a>
</noscript>
</td>
<td>
<a href="..\home\index.html"><img src="..\home\res\vbaccelnew.png" width="125" height="60" 
border="0" alt="The new vbAccelerator Site - more VB and .NET Code and Controls" /></a>
</td>
</tr>
</table>
<!-- AD:END -->



<a name="sectop"></a>

<table border="0" width="100%" cellspacing="0" cellpadding="0" height="25">
<tr bgcolor="#663333" height="25">
	<td>
	<img src="..\images\vbatips.gif" width="368" height="12" border="0">
	</font>
	</td>
</tr>
</table>

<table border="0" width="100%" cellspacing="0" cellpadding="4">
<tr bgcolor="#FFFFFF">
	<td width="72" rowspan="5" valign="top"><img src="..\images\vbatipim.gif" height="64" width="64" border="0" hspace="6" halign="center"></td>
	<td colspan="3">
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	<br>
	<p><b>Create a VB Picture from an API Icon Handle</b></p>
	</font>
	</td>
</tr>
<tr>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\vbatipbt.gif" height="8" width="8" border="0" hspace="4" halign="center">Author: 
	</td>
	<td valign="top" width="100%">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<!-- AUTHORS: Begin -->
	<p>Steve McMahon(<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>)</p>
	<!-- AUTHORS: End -->
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\pixel.gif" height="1" width="8" border="0" hspace="4" halign="center">Keywords: 
	</td>
	<td valign="top">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p><a href="index9.htm">API</a>,<a href="index3.htm">GDI</a>,<a href="index10.htm">Graphics</a></p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td  valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\pixel.gif" height="1" width="8" border="0" hspace="4" halign="center">Updated:
	</td>
	<td  valign="top">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p>12/10/98</p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td colspan=3 bgcolor="#663333">
	<!-- <img src="../images/bpixel.gif" width="100%" height="1" border="0"> -->
	</td>
	<td></td>
</tr>
<tr>
	<td valign="top">
	<font face="verdana,arial,helvetica" size="1">
	<p>
	Other Tips<br>
	<a href="index.htm">All Tips</a><br>
	<a href="indexd.htm">By Date</a><br>
	<a href="indext.htm">By Subject</a><br>
	<br><br>
	<a href="index9.htm">API (33)</a><br>
<a href="index21.htm">Bit<br>Manipulation (3)</a><br>
<a href="index11.htm">Clipboard (3)</a><br>
<a href="index18.htm">Combo<br>Box (5)</a><br>
<a href="index1.htm">Desktop (3)</a><br>
<a href="index3.htm">GDI (13)</a><br>
<a href="index10.htm">Graphics (13)</a><br>
<a href="index22.htm">Internet (2)</a><br>
<a href="index8.htm">Interprocess<br>Comms (3)</a><br>
<a href="index6.htm">Keyboard (2)</a><br>
<a href="index2.htm">Mouse (1)</a><br>
<a href="index4.htm">Shell (1)</a><br>
<a href="index14.htm">Sprites (1)</a><br>
<a href="index12.htm">Subclassing (3)</a><br>
<a href="index20.htm">Text<br>Box (2)</a><br>
<a href="index17.htm">Windows (11)</a><br>
<a href="index15.htm">Windows<br>Controls (10)</a><br>
	<br><br>
	<a href="submitt.htm">Submit</a><br>
	</p>
	</font>
	</td>
	<td colspan=3>
	<br>
	<!-- TIPHTML: Begin -->
	<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>
	This tip shows you how create a VB Picture object from an API icon handle.  This
	is useful if you are dealing with real API icons.
	<br><br>
	Start a new project and add a module.  Then add the following code to the module:
</p>
</font>
<p>
<font color="#000000" face="Lucida Console,courier new" size="1">
Option Explicit <br>
 <br>
Private Type PictDesc <br>
&nbsp &nbsp cbSizeofStruct As Long <br>
&nbsp &nbsp picType As Long <br>
&nbsp &nbsp hImage As Long <br>
&nbsp &nbsp xExt As Long <br>
&nbsp &nbsp yExt As Long <br>
End Type <br>
Private Type Guid <br>
&nbsp &nbsp Data1 As Long <br>
&nbsp &nbsp Data2 As Integer <br>
&nbsp &nbsp Data3 As Integer <br>
&nbsp &nbsp Data4(0 To 7) As Byte <br>
End Type <br>
Private Declare Function OleCreatePictureIndirect Lib "olepro32.dll" (lpPictDesc As PictDesc, riid As Guid, ByVal fPictureOwnsHandle As Long, ipic As IPicture) As Long <br>
 <br>
Public Function IconToPicture(ByVal hIcon As Long) As IPicture <br>
&nbsp &nbsp  <br>
&nbsp &nbsp If hIcon = 0 Then Exit Function <br>
&nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp  <br>
&nbsp &nbsp Dim oNewPic As Picture <br>
&nbsp &nbsp Dim tPicConv As PictDesc <br>
&nbsp &nbsp Dim IGuid As Guid <br>
&nbsp &nbsp  <br>
&nbsp &nbsp With tPicConv <br>
&nbsp &nbsp   .cbSizeofStruct = Len(tPicConv) <br>
&nbsp &nbsp   .picType = vbPicTypeIcon <br>
&nbsp &nbsp   .hImage = hIcon <br>
&nbsp &nbsp End With <br>
&nbsp &nbsp  <br>
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Fill in magic IPicture GUID {7BF80980-BF32-101A-8BBB-00AA00300CAB} <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp With IGuid <br>
&nbsp &nbsp &nbsp &nbsp .Data1 = &H7BF80980 <br>
&nbsp &nbsp &nbsp &nbsp .Data2 = &HBF32 <br>
&nbsp &nbsp &nbsp &nbsp .Data3 = &H101A <br>
&nbsp &nbsp &nbsp &nbsp .Data4(0) = &H8B <br>
&nbsp &nbsp &nbsp &nbsp .Data4(1) = &HBB <br>
&nbsp &nbsp &nbsp &nbsp .Data4(2) = &H0 <br>
&nbsp &nbsp &nbsp &nbsp .Data4(3) = &HAA <br>
&nbsp &nbsp &nbsp &nbsp .Data4(4) = &H0 <br>
&nbsp &nbsp &nbsp &nbsp .Data4(5) = &H30 <br>
&nbsp &nbsp &nbsp &nbsp .Data4(6) = &HC <br>
&nbsp &nbsp &nbsp &nbsp .Data4(7) = &HAB <br>
&nbsp &nbsp End With <br>
&nbsp &nbsp OleCreatePictureIndirect tPicConv, IGuid, True, oNewPic <br>
&nbsp &nbsp  <br>
&nbsp &nbsp Set IconToPicture = oNewPic <br>
&nbsp &nbsp  <br>
End Function <br>
 <br>
 <br>
</font>
</p>
<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>
	To try out a the function, add a Command Button and a Picture Box to
	your project's form.  Copy an icon to the project's directory, and
	rename it TEST.ICO.<br><br>
	Then add this code to the form:
</p>
<p>
<font color="#000000" face="Lucida Console,courier new" size="1">
Option Explicit <br>
 <br>
Private Declare Function LoadImage Lib "user32" Alias "LoadImageA" _ <br>
&nbsp &nbsp (ByVal hInst As Long, ByVal lpsz As String, _ <br>
&nbsp &nbsp ByVal iType As Long, _ <br>
&nbsp &nbsp ByVal cx As Long, ByVal cy As Long, _ <br>
&nbsp &nbsp ByVal fOptions As Long) As Long <br>
</font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' iType options: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Const IMAGE_BITMAP = 0 <br>
Private Const IMAGE_ICON = 1 <br>
Private Const IMAGE_CURSOR = 2 <br>
</font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' fOptions flags: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Const LR_LOADMAP3DCOLORS = &H1000 <br>
Private Const LR_LOADFROMFILE = &H10 <br>
Private Const LR_LOADTRANSPARENT = &H20 <br>
 <br>
 <br>
Private Sub Command1_Click() <br>
Dim hIcon As Long <br>
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Load an icon called Test.Ico from the directory: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp  <br>
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' If the icon contains more than one size of image, <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' set cx and cy to the width and height to load <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' the appropriate image in: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp hIcon = LoadImage(App.hInstance, App.Path & "\TEST.ICO", IMAGE_ICON, 0, 0, LR_LOADFROMFILE Or LR_LOADMAP3DCOLORS) <br>
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Set the picture to this icon: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp Set Picture1.Picture = IconToPicture(hIcon) <br>
End Sub <br>
 <br>
</font>
</p>
<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>
Start the project.  When you click the button, the icon will be loaded as an API
icon handle, converted to a picture and then shown in the PictureBox.  Whilst this
simple example could be achieved more quickly using the LoadPicture method, the
method shown has several advantages:
<ul>
<li>You are not restricted to 32x32 icons as you normally are with the Picture object.  
The LoadImage function can load icons of any size.
<li>Similarly, you are not restricted to 16 colour icons.  The project will load icons
with 256 and millions of colour depths.  (Note if the icon file contains both a 16 colour
and a higher colour icon of the same size, the icon that is loaded will be the one which
matches your system settings for icon colour depth).
<li>You can specify that Gray (RGB 192,192,192) and Dark Gray (128,128,128) are mapped
to the appropriate system colours (vbButtonFace and vbButtonShadow respectively).
</ul>
</p>
	<!-- TIPHTML: End -->
	<br>
	</td>
</tr>
<tr>
	<td></td>
	<td colspan=3 bgcolor="#663333">
	<!-- <img src="../images/bpixel.gif" width="100%" height="1" border="0"> -->
	</td>
	<td></td>
</tr>
<tr>
	<td>&nbsp</td>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p>Related Tips and Articles:
	</td>
	<td>
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p>
	<!-- RELATEDARTICLES: Begin -->
	<UL><LI><a href="vba0025.htm">Create a VB Picture Object from a GDI Bitmap Handle</a>
</UL>
	<!-- RELATEDARTICLES: End -->
	</p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
	<td>&nbsp</td>
</tr>
</table>	

<!-- BODY:END -->

<!-- FOOTER:START -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 12/10/98</font></p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>
g="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 12/10/98</font></p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>
