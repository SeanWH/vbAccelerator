<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="Author" content="Steve McMahon">
<meta name="KeyWords"
content="VB, VB6, Visual Basic, Visual Basic 5, Visual Basic 6, Dynamic HTML, DHTML, IE4, Internet Explorer, Internet Explorer 4, Active X, Active X Controls, Visual Basic Controls">
<meta name="GENERATOR" content="vbAccelerator Site Robot v0.5.1">
<title>vbAccelerator Tips - Get the state of a key at any time</title>
</head>

<body bgcolor="#FFFFFF" topmargin="0" leftmargin="0" link="#660000" vlink="#999966" LEFTMARGIN="0" TOPMARGIN="0" MARGINHEIGHT="0" MARGINWIDTH="0">

<!-- AD:START -->
<table bgcolor="#336699" border="0" cellpadding="0" cellspacing="0" width="100%" >
<tr>
<td width="468">
<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<a href="..\home\index.html"><img src="..\home\res\vbaccelad.png" width="468" height="60" 
border="0" alt="vbAccelerator - Faster VB and .NET Code" /></a>
</noscript>
</td>
<td>
<a href="..\home\index.html"><img src="..\home\res\vbaccelnew.png" width="125" height="60" 
border="0" alt="The new vbAccelerator Site - more VB and .NET Code and Controls" /></a>
</td>
</tr>
</table>
<!-- AD:END -->



<a name="sectop"></a>

<table border="0" width="100%" cellspacing="0" cellpadding="0" height="25">
<tr bgcolor="#663333" height="25">
	<td>
	<img src="..\images\vbatips.gif" width="368" height="12" border="0">
	</font>
	</td>
</tr>
</table>

<table border="0" width="100%" cellspacing="0" cellpadding="4">
<tr bgcolor="#FFFFFF">
	<td width="72" rowspan="5" valign="top"><img src="..\images\vbatipim.gif" height="64" width="64" border="0" hspace="6" halign="center"></td>
	<td colspan="3">
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	<br>
	<p><b>Get the state of a key at any time</b></p>
	</font>
	</td>
</tr>
<tr>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\vbatipbt.gif" height="8" width="8" border="0" hspace="4" halign="center">Author: 
	</td>
	<td valign="top" width="100%">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<!-- AUTHORS: Begin -->
	<p>Steve McMahon(<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>)</p>
	<!-- AUTHORS: End -->
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\pixel.gif" height="1" width="8" border="0" hspace="4" halign="center">Keywords: 
	</td>
	<td valign="top">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p><a href="index9.htm">API</a>,<a href="index6.htm">Keyboard</a></p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td  valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\pixel.gif" height="1" width="8" border="0" hspace="4" halign="center">Updated:
	</td>
	<td  valign="top">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p>01/08/98</p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td colspan=3 bgcolor="#663333">
	<!-- <img src="../images/bpixel.gif" width="100%" height="1" border="0"> -->
	</td>
	<td></td>
</tr>
<tr>
	<td valign="top">
	<font face="verdana,arial,helvetica" size="1">
	<p>
	Other Tips<br>
	<a href="index.htm">All Tips</a><br>
	<a href="indexd.htm">By Date</a><br>
	<a href="indext.htm">By Subject</a><br>
	<br><br>
	<a href="index9.htm">API (33)</a><br>
<a href="index21.htm">Bit<br>Manipulation (3)</a><br>
<a href="index11.htm">Clipboard (3)</a><br>
<a href="index18.htm">Combo<br>Box (5)</a><br>
<a href="index1.htm">Desktop (3)</a><br>
<a href="index3.htm">GDI (13)</a><br>
<a href="index10.htm">Graphics (13)</a><br>
<a href="index22.htm">Internet (2)</a><br>
<a href="index8.htm">Interprocess<br>Comms (3)</a><br>
<a href="index6.htm">Keyboard (2)</a><br>
<a href="index2.htm">Mouse (1)</a><br>
<a href="index4.htm">Shell (1)</a><br>
<a href="index14.htm">Sprites (1)</a><br>
<a href="index12.htm">Subclassing (3)</a><br>
<a href="index20.htm">Text<br>Box (2)</a><br>
<a href="index17.htm">Windows (11)</a><br>
<a href="index15.htm">Windows<br>Controls (10)</a><br>
	<br><br>
	<a href="submitt.htm">Submit</a><br>
	</p>
	</font>
	</td>
	<td colspan=3>
	<br>
	<!-- TIPHTML: Begin -->
	<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>
	If you're trying to create an interactive app, or a VB game, whether its in DirectX 
	or using GDI calls, then reading a key state asynchronously is considerably faster 
	than waiting for KeyUp, KeyDown	or KeyPress event on a form.  Checking the key state
	this way can also be very useful when trying to check for shift states when responding to a
	WM_KEYDOWN event if you are doing sub-classing.<br><br>
	I used this technique to speed up a DirectX sample at <a href="javascript:window.alert(&quot;http://www.chez.com/scribe/index_us.htm\nThis link was not retrieved.&quot;)">Visual Basic Area 51</a>.  
	Because the original sample only updated the screen in response to form KeyDown events, the result was
	400% quicker!  (In fact, too quick - I had to put a slowdown in the loop to keep up!).
	<br><br>
	Create a new project, and add a Picture Box and a Command Button to the
	form.  Then paste the following code into the form:
</p>

<p>
<font color="#000000" face="Lucida Console,courier new" size="1">
 <br>
Private m_bPlay As Boolean <br>
Private Declare Function GetAsyncKeyState Lib "user32" (ByVal vKey As Long) As Integer <br>
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long) <br>
 <br>
Private Sub cmdPlay_Click() <br>
Dim i As Long <br>
Dim iLast As Long <br>
 <br>
&nbsp &nbsp If cmdPlay.Caption = "&Stop" Then <br>
&nbsp &nbsp &nbsp &nbsp m_bPlay = False <br>
&nbsp &nbsp &nbsp &nbsp cmdPlay.Caption = "&Play" <br>
&nbsp &nbsp Else <br>
&nbsp &nbsp &nbsp &nbsp cmdPlay.Caption = "&Stop" <br>
&nbsp &nbsp &nbsp &nbsp m_bPlay = True <br>
&nbsp &nbsp &nbsp &nbsp i = 1 <br>
&nbsp &nbsp &nbsp &nbsp Do <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Determine if the left or right keys are <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' pressed: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp If (GetAsyncKeyState(vbKeyLeft)) Then <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Diminish the colour <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp i = i - 1 <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp ElseIf (GetAsyncKeyState(vbKeyRight)) Then <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Increase the colour <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp i = i + 1 <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp End If <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Colour within bounds: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp If (i < 1) Then i = 15 <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp If (i > 15) Then i = 1 <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' If colour has changed, change the display: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp If (iLast <> i) Then <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp With Picture1 <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp .Cls <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp .ForeColor = QBColor(i) <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Generate a RGB complement for the background: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp .BackColor = &HFFFFFF And (Not QBColor(i)) <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp .CurrentX = 64 * Screen.TwipsPerPixelX <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp .CurrentY = 64 * Screen.TwipsPerPixelY <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Picture1.Print Hex$(QBColor(i)) <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp End With <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp End If <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp iLast = i <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' This is here to stop the animation <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' getting too fast to see: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp Sleep 25 <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Ensure we can still click buttons etc <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp DoEvents <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp &nbsp &nbsp Loop While m_bPlay <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp End If <br>
&nbsp &nbsp  <br>
End Sub <br>
 <br>
Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer) <br>
&nbsp &nbsp If (cmdPlay.Caption = "&Stop") Then <br>
&nbsp &nbsp &nbsp &nbsp cmdPlay_Click <br>
&nbsp &nbsp End If <br>
End Sub <br>
 <br>
</font>
</p>
<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>
	When you click on the command button, the code starts a DoEvents loop in which it
	checks if the Right Key or Left Key are pressed.  When one is pressed, it changes
	the background and foreground colours of the Picture Box and displays the QBColor
	code.
</p>
	<!-- TIPHTML: End -->
	<br>
	</td>
</tr>
<tr>
	<td></td>
	<td colspan=3 bgcolor="#663333">
	<!-- <img src="../images/bpixel.gif" width="100%" height="1" border="0"> -->
	</td>
	<td></td>
</tr>
<tr>
	<td>&nbsp</td>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p>Related Tips and Articles:
	</td>
	<td>
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p>
	<!-- RELATEDARTICLES: Begin -->
	<UL><LI><a href="vba0007.htm">Read the NumLock and CapsLock key states</a>
</UL>
	<!-- RELATEDARTICLES: End -->
	</p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
	<td>&nbsp</td>
</tr>
</table>	

<!-- BODY:END -->

<!-- FOOTER:START -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 01/08/98</font></p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>
g="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 01/08/98</font></p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>
