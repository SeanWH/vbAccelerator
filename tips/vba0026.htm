<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="Author" content="Steve McMahon">
<meta name="KeyWords"
content="VB, VB6, Visual Basic, Visual Basic 5, Visual Basic 6, Dynamic HTML, DHTML, IE4, Internet Explorer, Internet Explorer 4, Active X, Active X Controls, Visual Basic Controls">
<meta name="GENERATOR" content="vbAccelerator Site Robot v0.5.1">
<title>vbAccelerator Tips - Determine whether a file is in the Internet Explorer cache</title>
</head>

<body bgcolor="#FFFFFF" topmargin="0" leftmargin="0" link="#660000" vlink="#999966" LEFTMARGIN="0" TOPMARGIN="0" MARGINHEIGHT="0" MARGINWIDTH="0">

<!-- AD:START -->
<table bgcolor="#336699" border="0" cellpadding="0" cellspacing="0" width="100%" >
<tr>
<td width="468">
<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<a href="..\home\index.html"><img src="..\home\res\vbaccelad.png" width="468" height="60" 
border="0" alt="vbAccelerator - Faster VB and .NET Code" /></a>
</noscript>
</td>
<td>
<a href="..\home\index.html"><img src="..\home\res\vbaccelnew.png" width="125" height="60" 
border="0" alt="The new vbAccelerator Site - more VB and .NET Code and Controls" /></a>
</td>
</tr>
</table>
<!-- AD:END -->



<a name="sectop"></a>

<table border="0" width="100%" cellspacing="0" cellpadding="0" height="25">
<tr bgcolor="#663333" height="25">
	<td>
	<img src="..\images\vbatips.gif" width="368" height="12" border="0">
	</font>
	</td>
</tr>
</table>

<table border="0" width="100%" cellspacing="0" cellpadding="4">
<tr bgcolor="#FFFFFF">
	<td width="72" rowspan="5" valign="top"><img src="..\images\vbatipim.gif" height="64" width="64" border="0" hspace="6" halign="center"></td>
	<td colspan="3">
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	<br>
	<p><b>Determine whether a file is in the Internet Explorer cache</b></p>
	</font>
	</td>
</tr>
<tr>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\vbatipbt.gif" height="8" width="8" border="0" hspace="4" halign="center">Author: 
	</td>
	<td valign="top" width="100%">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<!-- AUTHORS: Begin -->
	<p>Steve McMahon(<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>)</p>
	<!-- AUTHORS: End -->
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\pixel.gif" height="1" width="8" border="0" hspace="4" halign="center">Keywords: 
	</td>
	<td valign="top">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p><a href="index9.htm">API</a>,<a href="index22.htm">Internet</a>,<a href="index17.htm">Windows</a></p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td  valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\pixel.gif" height="1" width="8" border="0" hspace="4" halign="center">Updated:
	</td>
	<td  valign="top">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p>21/02/99</p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td colspan=3 bgcolor="#663333">
	<!-- <img src="../images/bpixel.gif" width="100%" height="1" border="0"> -->
	</td>
	<td></td>
</tr>
<tr>
	<td valign="top">
	<font face="verdana,arial,helvetica" size="1">
	<p>
	Other Tips<br>
	<a href="index.htm">All Tips</a><br>
	<a href="indexd.htm">By Date</a><br>
	<a href="indext.htm">By Subject</a><br>
	<br><br>
	<a href="index9.htm">API (33)</a><br>
<a href="index21.htm">Bit<br>Manipulation (3)</a><br>
<a href="index11.htm">Clipboard (3)</a><br>
<a href="index18.htm">Combo<br>Box (5)</a><br>
<a href="index1.htm">Desktop (3)</a><br>
<a href="index3.htm">GDI (13)</a><br>
<a href="index10.htm">Graphics (13)</a><br>
<a href="index22.htm">Internet (2)</a><br>
<a href="index8.htm">Interprocess<br>Comms (3)</a><br>
<a href="index6.htm">Keyboard (2)</a><br>
<a href="index2.htm">Mouse (1)</a><br>
<a href="index4.htm">Shell (1)</a><br>
<a href="index14.htm">Sprites (1)</a><br>
<a href="index12.htm">Subclassing (3)</a><br>
<a href="index20.htm">Text<br>Box (2)</a><br>
<a href="index17.htm">Windows (11)</a><br>
<a href="index15.htm">Windows<br>Controls (10)</a><br>
	<br><br>
	<a href="submitt.htm">Submit</a><br>
	</p>
	</font>
	</td>
	<td colspan=3>
	<br>
	<!-- TIPHTML: Begin -->
	<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>
	If you are creating a shortcut to an Internet file, you will want to know
	whether it has been visited or not so you can colour it appropriately.  This tip
	shows you how to determine whether a file is in the cache so you can do this. 
	<br><br>
	Start a new project and add a module.  Then add the following code to the module:
</p>
</font>
<p>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Const ERROR_INSUFFICIENT_BUFFER = 122<br>
Private Const eeErrorBase = 26720<br>
<br>
Private Type FILETIME<br>
&nbsp;&nbsp;&nbsp;dwLowDateTime As Long<br>
&nbsp;&nbsp;&nbsp;dwHighDateTime As Long<br>
End Type<br>
<br>
Private Type INTERNET_CACHE_ENTRY_INFO<br>
&nbsp;&nbsp;&nbsp;dwStructSize As Long<br>
&nbsp;&nbsp;&nbsp;lpszSourceUrlName As String<br>
&nbsp;&nbsp;&nbsp;lpszLocalFileName As String<br>
&nbsp;&nbsp;&nbsp;CacheEntryType As String<br>
&nbsp;&nbsp;&nbsp;dwUseCount As Long<br>
&nbsp;&nbsp;&nbsp;dwHitRate As Long<br>
&nbsp;&nbsp;&nbsp;dwSizeLow As Long<br>
&nbsp;&nbsp;&nbsp;dwSizeHigh As Long<br>
&nbsp;&nbsp;&nbsp;LastModifiedTime As FILETIME<br>
&nbsp;&nbsp;&nbsp;ExpireTIme As FILETIME<br>
&nbsp;&nbsp;&nbsp;LastAccessTime As FILETIME<br>
&nbsp;&nbsp;&nbsp;LastSyncTime As FILETIME<br>
&nbsp;&nbsp;&nbsp;lpHeaderInfo As Long<br>
&nbsp;&nbsp;&nbsp;dwHeaderInfoSize As Long<br>
&nbsp;&nbsp;&nbsp;lpszFileExtension As String<br>
&nbsp;&nbsp;&nbsp;dwReserved As Long<br>
End Type<br>
<br>
Private Declare Function GetUrlCacheEntryInfo Lib "wininet.dll" Alias "GetUrlCacheEntryInfoA" _<br>
&nbsp;&nbsp;&nbsp;(ByVal sUrlName As String, _<br>
&nbsp;&nbsp;&nbsp;lpCacheEntryInfo As Any, _<br>
&nbsp;&nbsp;&nbsp;lpdwCacheEntryInfoBufferSize As Long _<br>
&nbsp;&nbsp;&nbsp;) As Long<br>
</font><font color="#999999" face="Lucida Console,courier new" size="1"><br>
' To Report API errors:<br>
</font><font color="#000000" face="Lucida Console,courier new" size="1">
Private Const FORMAT_MESSAGE_ALLOCATE_BUFFER = &H100<br>
Private Const FORMAT_MESSAGE_ARGUMENT_ARRAY = &H2000<br>
Private Const FORMAT_MESSAGE_FROM_HMODULE = &H800<br>
Private Const FORMAT_MESSAGE_FROM_STRING = &H400<br>
Private Const FORMAT_MESSAGE_FROM_SYSTEM = &H1000<br>
Private Const FORMAT_MESSAGE_IGNORE_INSERTS = &H200<br>
Private Const FORMAT_MESSAGE_MAX_WIDTH_MASK = &HFF<br>
Private Declare Function FormatMessage Lib "kernel32" Alias "FormatMessageA" _<br>
&nbsp;&nbsp;&nbsp;(ByVal dwFlags As Long, lpSource As Any, ByVal dwMessageId As Long, _<br>
&nbsp;&nbsp;&nbsp;ByVal dwLanguageId As Long, ByVal lpBuffer As String, ByVal nSize As Long, Arguments As Long _<br>
&nbsp;&nbsp;&nbsp;) As Long<br>
<br>
Public Function WinAPIError(ByVal lLastDLLError As Long) As String<br>
Dim sBuff As String<br>
Dim lCount As Long<br>
<br></font><font color="#999999" face="Lucida Console,courier new" size="1">
&nbsp;&nbsp;&nbsp;' Return the error message associated with LastDLLError:<br></font><font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp;&nbsp;&nbsp;sBuff = String$(256, 0)<br>
&nbsp;&nbsp;&nbsp;lCount = FormatMessage( _<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FORMAT_MESSAGE_FROM_SYSTEM Or FORMAT_MESSAGE_IGNORE_INSERTS, _<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0, lLastDLLError, 0&, sBuff, Len(sBuff), ByVal 0)<br>
&nbsp;&nbsp;&nbsp;If lCount Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WinAPIError = Left$(sBuff, lCount)<br>
&nbsp;&nbsp;&nbsp;End If<br>
<br>
End Function<br>
<br>
Public Function GetCacheEntryInfo(ByVal hWnd As Long, ByVal lpszUrl As String) As Boolean<br>
Dim dwEntrySize As Long<br>
Dim lpCacheEntry As INTERNET_CACHE_ENTRY_INFO<br>
Dim dwTemp As Long<br>
Dim lErr As Long<br>
<br>
&nbsp;&nbsp;&nbsp;If (GetUrlCacheEntryInfo(lpszUrl, ByVal 0&, dwEntrySize)) = 0 Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lErr = Err.LastDllError<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If (lErr <> ERROR_INSUFFICIENT_BUFFER) Then<br></font><font color="#999999" face="Lucida Console,courier new" size="1">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' Doesn't exist. Raise error containing reason:<br></font><font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Err.Raise eeErrorBase + 1, App.EXEName & ".mCacheEntry", WinAPIError(lErr)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetCacheEntryInfo = False<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit Function<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Else<br></font><font color="#999999" face="Lucida Console,courier new" size="1">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' It exists!<br></font><font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetCacheEntryInfo = True<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If<br>
&nbsp;&nbsp;&nbsp;End If<br>
<br>
End Function<br>
<br>
<br>
</font>
</p>
<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>

	To try out a the function, add a Command Button and a Text Box to
	your project's form. <br><br>
	Then add this code to the form:
</p>
</font>
<p>
<font color="#000000" face="Lucida Console,courier new" size="1">
Option Explicit <br>
 <br>
Private Sub Command1_Click() <br>
On Error Goto ErrorHandler<br></font><font color="#999999" face="Lucida Console,courier new" size="1">
&nbsp;&nbsp;&nbsp;' Check whether the URL in the text box exists in the cache: <br>
</font><font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp;&nbsp;&nbsp;If (GetCacheEntryInfo(Me.hWnd, Text1.Text)) Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox "URL In Cache.", vbInformation<br>
&nbsp;&nbsp;&nbsp;Else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox "URL Not In Cache.", vbInformation<br>
&nbsp;&nbsp;&nbsp;End If<br>
<br>
Exit Sub<br>
<br>
ErrorHandler:<br>
&nbsp;&nbsp;MsgBox "URL Not in Cache [" & Err.Description & "]",vbInformation<br>
<br>
End Sub<br>
<br>
</font>
</p>
<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>

Start the project and type a URL into the text box (for example, http://www.vbaccelerator.com/index.html).  
When you click the button, you will get a message saying if the URL is in the cache or not.  If Windows
gives a reason for the URL not being found, this will be shown in the square brackets after the 
message.
</p>
	<!-- TIPHTML: End -->
	<br>
	</td>
</tr>
<tr>
	<td></td>
	<td colspan=3 bgcolor="#663333">
	<!-- <img src="../images/bpixel.gif" width="100%" height="1" border="0"> -->
	</td>
	<td></td>
</tr>
<tr>
	<td>&nbsp</td>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p>Related Tips and Articles:
	</td>
	<td>
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p>
	<!-- RELATEDARTICLES: Begin -->
	<UL><LI><a href="vba0033.htm">System Internet Connection - Determining  How and If Connected</a>
</UL>
	<!-- RELATEDARTICLES: End -->
	</p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
	<td>&nbsp</td>
</tr>
</table>	

<!-- BODY:END -->

<!-- FOOTER:START -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 21/02/99</font></p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>
g="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 21/02/99</font></p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>
