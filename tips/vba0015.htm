<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="Author" content="Steve McMahon">
<meta name="KeyWords"
content="VB, VB6, Visual Basic, Visual Basic 5, Visual Basic 6, Dynamic HTML, DHTML, IE4, Internet Explorer, Internet Explorer 4, Active X, Active X Controls, Visual Basic Controls">
<meta name="GENERATOR" content="vbAccelerator Site Robot v0.5.1">
<title>vbAccelerator Tips - Create a mask image (all black for the transparent colour otherwise white) from a bitmap</title>
</head>

<body bgcolor="#FFFFFF" topmargin="0" leftmargin="0" link="#660000" vlink="#999966" LEFTMARGIN="0" TOPMARGIN="0" MARGINHEIGHT="0" MARGINWIDTH="0">

<!-- AD:START -->
<table bgcolor="#336699" border="0" cellpadding="0" cellspacing="0" width="100%" >
<tr>
<td width="468">
<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<a href="..\home\index.html"><img src="..\home\res\vbaccelad.png" width="468" height="60" 
border="0" alt="vbAccelerator - Faster VB and .NET Code" /></a>
</noscript>
</td>
<td>
<a href="..\home\index.html"><img src="..\home\res\vbaccelnew.png" width="125" height="60" 
border="0" alt="The new vbAccelerator Site - more VB and .NET Code and Controls" /></a>
</td>
</tr>
</table>
<!-- AD:END -->



<a name="sectop"></a>

<table border="0" width="100%" cellspacing="0" cellpadding="0" height="25">
<tr bgcolor="#663333" height="25">
	<td>
	<img src="..\images\vbatips.gif" width="368" height="12" border="0">
	</font>
	</td>
</tr>
</table>

<table border="0" width="100%" cellspacing="0" cellpadding="4">
<tr bgcolor="#FFFFFF">
	<td width="72" rowspan="5" valign="top"><img src="..\images\vbatipim.gif" height="64" width="64" border="0" hspace="6" halign="center"></td>
	<td colspan="3">
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	<br>
	<p><b>Create a mask image (all black for the transparent colour otherwise white) from a bitmap</b></p>
	</font>
	</td>
</tr>
<tr>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\vbatipbt.gif" height="8" width="8" border="0" hspace="4" halign="center">Author: 
	</td>
	<td valign="top" width="100%">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<!-- AUTHORS: Begin -->
	<p>Steve McMahon(<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>)</p>
	<!-- AUTHORS: End -->
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\pixel.gif" height="1" width="8" border="0" hspace="4" halign="center">Keywords: 
	</td>
	<td valign="top">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p><a href="index9.htm">API</a>,<a href="index3.htm">GDI</a>,<a href="index10.htm">Graphics</a>,<a href="index14.htm">Sprites</a></p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td  valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p><img src="..\images\pixel.gif" height="1" width="8" border="0" hspace="4" halign="center">Updated:
	</td>
	<td  valign="top">
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p>01/08/98</p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
</tr>
<tr>
	<td colspan=3 bgcolor="#663333">
	<!-- <img src="../images/bpixel.gif" width="100%" height="1" border="0"> -->
	</td>
	<td></td>
</tr>
<tr>
	<td valign="top">
	<font face="verdana,arial,helvetica" size="1">
	<p>
	Other Tips<br>
	<a href="index.htm">All Tips</a><br>
	<a href="indexd.htm">By Date</a><br>
	<a href="indext.htm">By Subject</a><br>
	<br><br>
	<a href="index9.htm">API (33)</a><br>
<a href="index21.htm">Bit<br>Manipulation (3)</a><br>
<a href="index11.htm">Clipboard (3)</a><br>
<a href="index18.htm">Combo<br>Box (5)</a><br>
<a href="index1.htm">Desktop (3)</a><br>
<a href="index3.htm">GDI (13)</a><br>
<a href="index10.htm">Graphics (13)</a><br>
<a href="index22.htm">Internet (2)</a><br>
<a href="index8.htm">Interprocess<br>Comms (3)</a><br>
<a href="index6.htm">Keyboard (2)</a><br>
<a href="index2.htm">Mouse (1)</a><br>
<a href="index4.htm">Shell (1)</a><br>
<a href="index14.htm">Sprites (1)</a><br>
<a href="index12.htm">Subclassing (3)</a><br>
<a href="index20.htm">Text<br>Box (2)</a><br>
<a href="index17.htm">Windows (11)</a><br>
<a href="index15.htm">Windows<br>Controls (10)</a><br>
	<br><br>
	<a href="submitt.htm">Submit</a><br>
	</p>
	</font>
	</td>
	<td colspan=3>
	<br>
	<!-- TIPHTML: Begin -->
		<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>
	This tip shows you how to create a mask image from a picture.  Mask images are useful
	for emulating transparency, and for replacing colours in images.  This comes about
	because they are black where you want to leave an image unaffected, and white otherwise.
	Because they are either on or off, you can use boolean operations while copying the
	mask image elsewhere.
	<br><br>
	Start a new project in VB.  Add a new module, then add the following
	code to it:
</p>
</font>
<p>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Creates a memory DC <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Declare Function CreateCompatibleDC Lib "gdi32" ( _ <br>
&nbsp &nbsp ByVal hDC As Long _ <br>
&nbsp &nbsp ) As Long <br>
</font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Creates a bitmap in memory: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Declare Function CreateCompatibleBitmap Lib "gdi32" ( _ <br>
&nbsp &nbsp ByVal hDC As Long, _ <br>
&nbsp &nbsp ByVal nWidth As Long, ByVal nHeight As Long _ <br>
&nbsp &nbsp ) As Long <br>
</font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Places a GDI Object into DC, returning the previous one: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Declare Function SelectObject Lib "gdi32" _ <br>
&nbsp &nbsp (ByVal hDC As Long, ByVal hObject As Long _ <br>
&nbsp &nbsp ) As Long <br>
</font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Deletes a GDI Object: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Declare Function DeleteObject Lib "gdi32" _ <br>
&nbsp &nbsp (ByVal hObject As Long _ <br>
&nbsp &nbsp ) As Long <br>
</font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Copies Bitmaps from one DC to another, can also perform <br>
' raster operations during the transfer: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Declare Function BitBlt Lib "gdi32" ( _ <br>
&nbsp &nbsp ByVal hDestDC As Long, _ <br>
&nbsp &nbsp ByVal X As Long, ByVal Y As Long, _ <br>
&nbsp &nbsp ByVal nWidth As Long, ByVal nHeight As Long, _ <br>
&nbsp &nbsp ByVal hSrcDC As Long, _ <br>
&nbsp &nbsp ByVal xSrc As Long, ByVal ySrc As Long, _ <br>
&nbsp &nbsp ByVal dwRop As Long _ <br>
&nbsp &nbsp ) As Long <br>
Private Const SRCCOPY = &HCC0020 <br>
</font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Sets the backcolour of a device context: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Declare Function SetBkColor Lib "gdi32" (ByVal hDC As Long, ByVal crColor As Long) As Long <br>
 <br>
Public Function CreateMaskImage( _ <br>
&nbsp &nbsp &nbsp &nbsp ByRef picFrom As PictureBox, _ <br>
&nbsp &nbsp &nbsp &nbsp ByRef picTo As PictureBox, _ <br>
&nbsp &nbsp &nbsp &nbsp Optional ByVal lTransparentColor As Long = -1 _ <br>
&nbsp &nbsp ) As Boolean <br>
Dim lhDC As Long <br>
Dim lhBmp As Long <br>
Dim lhBmpOld As Long <br>
 <br>
&nbsp &nbsp  <br>
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Make picTo the same size as picFrom and clear it: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp With picTo <br>
&nbsp &nbsp &nbsp &nbsp .Width = picFrom.Width <br>
&nbsp &nbsp &nbsp &nbsp .Height = picFrom.Height <br>
&nbsp &nbsp &nbsp &nbsp .Cls <br>
&nbsp &nbsp End With <br>
&nbsp &nbsp  <br>
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Create a monochrome DC & Bitmap of the <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' same size as the source picture: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp lhDC = CreateCompatibleDC(0) <br>
&nbsp &nbsp If (lhDC <> 0) Then <br>
&nbsp &nbsp &nbsp &nbsp lhBmp = CreateCompatibleBitmap(lhDC, picFrom.ScaleWidth \ Screen.TwipsPerPixelX, picFrom.ScaleHeight \ Screen.TwipsPerPixelY) <br>
&nbsp &nbsp &nbsp &nbsp If (lhBmp <> 0) Then <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp lhBmpOld = SelectObject(lhDC, lhBmp) <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Set the back 'colour' of the monochrome <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' DC to the colour we wish to be transparent: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp If (lTransparentColor = -1) Then lTransparentColor = picFrom.BackColor <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp SetBkColor lhDC, lTransparentColor <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Copy from the from picture to the monochrome DC <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' to create the mask: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp BitBlt lhDC, 0, 0, picFrom.ScaleWidth \ Screen.TwipsPerPixelX, picFrom.ScaleHeight \ Screen.TwipsPerPixelY, picFrom.hDC, 0, 0, SRCCOPY <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Now put the mask into picTo: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp BitBlt picTo.hDC, 0, 0, picFrom.ScaleWidth \ Screen.TwipsPerPixelX, picFrom.ScaleHeight \ Screen.TwipsPerPixelY, lhDC, 0, 0, SRCCOPY <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp picTo.Refresh <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp  <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Clear up the bitmap we used to create <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' the mask: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp SelectObject lhDC, lhBmpOld <br>
&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp DeleteObject lhBmp <br>
&nbsp &nbsp &nbsp &nbsp End If <br>
&nbsp &nbsp &nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Clear up the monochrome DC: <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp &nbsp &nbsp DeleteObject lhDC <br>
&nbsp &nbsp End If <br>
&nbsp &nbsp  <br>
&nbsp &nbsp  <br>
End Function <br>
 <br>
 <br>
</font>
</p>
<font color="#000000" face="verdana,arial,helvetica" size="2">
<p>
	To test out the function, add a Command button and two Picture Boxes to the project's form.
	Set the Autoredraw property on both Picture boxes to true.<br><br>
	The following code will create a mask image in the second Picture box (Picture2) from the
	image in Picture1 when you click the Command button::
</p>
</font>
<p>
<font color="#000000" face="Lucida Console,courier new" size="1">
Private Sub Command1_Click() <br>
&nbsp &nbsp CreateMaskImage Picture1, Picture2 <br>
End Sub <br>
 <br>
Private Sub Form_Load() <br>
Dim i As Long <br>
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Draw something in the from picture box. <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' Alternatively, you could load a picture <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' into it and set the BackColor to the <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp </font>
<font color="#999999" face="Lucida Console,courier new" size="1">
' colour you want to make transparent. <br>
</font>
<font color="#000000" face="Lucida Console,courier new" size="1">
&nbsp &nbsp Picture1.BackColor = &HFFFF00 <br>
&nbsp &nbsp With Picture1.Font <br>
&nbsp &nbsp &nbsp &nbsp .Name = "Arial" <br>
&nbsp &nbsp &nbsp &nbsp .Bold = True <br>
&nbsp &nbsp &nbsp &nbsp .Italic = True <br>
&nbsp &nbsp &nbsp &nbsp .Size = 12 <br>
&nbsp &nbsp End With <br>
&nbsp &nbsp For i = 1 To 20 <br>
&nbsp &nbsp &nbsp &nbsp Picture1.ForeColor = QBColor(i Mod 15) <br>
&nbsp &nbsp &nbsp &nbsp Picture1.Print "vbAccelerator Mask Demo" <br>
&nbsp &nbsp Next i <br>
End Sub <br>
</font>
</p>
	<!-- TIPHTML: End -->
	<br>
	</td>
</tr>
<tr>
	<td></td>
	<td colspan=3 bgcolor="#663333">
	<!-- <img src="../images/bpixel.gif" width="100%" height="1" border="0"> -->
	</td>
	<td></td>
</tr>
<tr>
	<td>&nbsp</td>
	<td valign="top">
	<font color="#663333" face="verdana,arial,helvetica" size="1">
	<p>Related Tips and Articles:
	</td>
	<td>
	<font color="#000000" face="verdana,arial,helvetica" size="1">
	<p>
	<!-- RELATEDARTICLES: Begin -->
	<UL><LI><a href="vba0017.htm">Replace one Colour with another in a Picture using BitBlt</a>
</UL>
	<!-- RELATEDARTICLES: End -->
	</p>
	</font>
	</td>
	<td><img src="..\images\pixel.gif" width="256" height="1" border="0"></td>
	<td>&nbsp</td>
</tr>
</table>	

<!-- BODY:END -->

<!-- FOOTER:START -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 01/08/98</font></p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>
g="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 01/08/98</font></p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>
