<html lang="en" >
<head>

<title>vbAccelerator - SysTray from .NET</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="The .NET Framework includes a NotifyIcon component but this 
unfortunately doesn't support InfoTip (balloon) notification; at least, not
in v1.0 of the Framework.  This sample provides an equivalent class which
uses the Shell code directly to allow all the tooltip facilities to be
used." /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">NET</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Shell Projects</a>&#160;.&#160;SysTray from .NET</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="systray_code.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />SysTray Code</a> (54K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:4304</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=4304&type=article&title=systray_20from_20_2enet.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;C#</p><p class="nav">&#160;&#160;.NET</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 0 / 0</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 0 / 0</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 1 / 1</a></p><p class="nav">Updated:18 November 2003</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />1 Nov 2003<br /><p class="update">The previous version could leave an orphan icon in the SysTray if you changed
a property which caused the Window handle to be recreated (for example, the 
<span class="code">ShowInTaskBar</span> property. This is now fixed and the 
demonstration code shows how to ensure you stay in the SysTray in such a
case by overriding <span class="code">OnHandleChanged</span>.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\windows_messages\subclassing_in__net\article.html">Subclassing In .NET</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\windows\enumerating_windows\article.html">Enumerating Windows</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>SysTray from .NET</h1><p class="splash">Add your application to the SysTray and use InfoTips for user 
    notification</p><img src="systray.png" width="429" height="360" alt="SysTray Demonstration &#xD;&#xA;            Application" /><p /><p>The .NET Framework includes a <span class="code">NotifyIcon</span> component but this 
unfortunately doesn't support InfoTip (balloon) notification; at least, not
in v1.0 of the Framework.  This sample provides an equivalent class which
uses the Shell code directly to allow all the tooltip facilities to be
used.</p><h2>Implementing SysTray Notifications</h2><p>The SysTray is accessed through a single Shell API function, 
<span class="code">Shell_NotifyIcon</span> which is well documented in the Platform SDK.  This
function is used to add and remove your application to the SysTray area and to
set the icon, tooltip or balloon tip.  Notifications of any events occuring
in the SysTray icon are sent to your application's Window through a message
you specify, where the <span class="code">LParam</span> value of the message specifies which
type of notification</p><p>Therefore to actually create an item in the SysTray you always need a
Window to base it around.  In this code, I've assume that you can use a
Window that's part of your application to send the messages to, and then 
this is <a href="..\..\windows_messages\subclassing_in__net\article.html">subclassed using the <span class="code">NativeWindow</span>
object</a>.  Remember you can
always have a hidden form if your application has no other UI that's normally
displayed: have a go with the <a href="..\..\windows\enumerating_windows\article.html">Windows Enumeration
sample</a> and you'll see that there a plenty of other apps that do this!</p><h2>About The Code</h2><p>Using the SysTray class should be self-explanatory - the methods are
all documented.  For icons, you use an <span class="code">ImageList</span> to act as the icon
source and then you specify the <span class="code">IconIndex</span>.  You can optionally
assign any object deriving from <span class="code">ContextMenu</span> to the SysTray class, in
which case the menu is automatically shown when the user right-clicks on the
SysTray icon.  Finally, use one of the <span class="code">ShowBalloonTip</span> methods to
show a pop-up balloon tip over your icon.  There are a number of events
you can respond to: for the tray itself there are mouse and key event
handlers, and for the balloon tip there are Show, Hide, TimeOut and Clicked
events.</p><h2>You Were Only Meant To Blow The Bleedin' Doors Off</h2><p>For your amusement, two classes are provided for some UI fun: the
<span class="code">IconMenuLib</span> file contains extensions to the 
<span class="code">ContextMenu</span> and <span class="code">MainMenu</span> objects 
to make them render in the VS.NET/Office XP style (although in this sample no icons 
are allocated), and the <span class="code">IconListBox</span> file contains an extended 
<span class="code">ListBox</span> which presents a horizontally aligned icon picker for 
any ImageList.</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\vb\code\libraries\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">NET</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Shell Projects</a>&#160;.&#160;SysTray from .NET</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 15 November 2003</p></td><td></td></tr></table>
</body></html>