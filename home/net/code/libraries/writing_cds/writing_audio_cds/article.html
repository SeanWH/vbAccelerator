<html lang="en" >
<head>
<title>vbAccelerator - Writing Audio CDs</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="
This sample demonstrates how to burn audio CDs using the .NET IMAPI Wrapper from
WAV files.  Sample code is provided in both VB and C#.
" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /><link rel="copyright" href="/home/The_Site/Copyright/article.asp" />
<link rel="contents" href="../index.asp" /><link rel="meta" type="application/rdf+xml" href="./article.rdf" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">NET</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Writing CDs</a>&#160;.&#160;Writing Audio CDs</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="audio_cd_writer.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Audio CD Writer</a> (134K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:15412</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=15412&type=article&title=writing_20audio_20cds.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;.NET</p><p class="nav">&#160;&#160;VB.NET</p><p class="nav">&#160;&#160;C#</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />27 Jun 2004<br /></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\media\audio\wavestream\article.html">WaveStreamReader and WaveStreamWriter</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\writing_data_cds\article.html">Writing Data CDs</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\imapi\article.html">Image Mastering API (IMAPI) Wrapper for .NET</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Writing Audio CDs</h1><img src="audiocdcreator.png" width="508" height="472" alt="Audio CD Creator Sample application" /><p /><p>
This sample demonstrates how to burn audio CDs using the .NET IMAPI Wrapper from
WAV files.  Sample code is provided in both VB and C#.
</p><h2>Writing Audio CDs</h2><p>
The <a href="..\imapi\article.html">IMAPI Wrapper</a> exposes both data (Joliet) and
audio (Redbook) CD burning facilities.  The design of IMAPI means that most of
the functions to create a CD are common; the only difference between data and
audio CDs is how you construct the image of the CD to be burnt on disc.
</p><p>
If you have not already, then read the article <a href="..\writing_data_cds\article.html">Writing Data CDs</a>
first, as that describes how to configure the library, respond to the events and
perform an asynchronous burn operation which are all used in this sample.  Rather than
go over them again here, I'll just cover the differences in the image construction.
</p><p>
The Redbook specification defines how an audio CD should be constructed.  Audio CDs 
can have between 1 and 99 tracks, and each track consists of blocks of audio wave
data, arranged as alternate L-R stereo signed 16-bit samples at 44.1kHz sampling
frequency.  The blocks themselves contain 2352 bytes of audio (or 1/75s) as well
as error correction codes to allow CD players to recover from minor scratches. Or
not, as seems to happen to most of mine.  To construct an audio track using the 
IMAPI library, you need to have a source of audio data in this format.  The easiest
to use source of this is a Windows .WAV file at the right frequency.  If you'd
like to burn MP3 or MP4 files directly to disc, then take a look at the 
<a href="..\..\..\..\..\vb\code\vbmedia\audio\index.html">VB Classic Audio samples</a> (these are currently
being converted to .NET).
</p><p>
A Windows .WAV file uses the Resource Interchange File Format (RIFF) structure. This
structure allows information to be tagged and stored in chunks.  A WAV file requires
at least three such tagged chunks: a RIFF header, defining the WAV file type; a
"fmt" header defining the wave format and a "data" format
containing the actual raw wave data, which is what is needed to write an audio CD.
The easiest way to get hold of this information is to use the Windows Multimedia
API.  See the article <a href="..\..\..\media\audio\wavestream\article.html">Reading and Writing Audio Files</a>
for more information on how to do this.
</p><h2>Creating the CD</h2><p>
Once we have the ability to read audio data from a <span class="code">Stream</span>,
creating the audio CD is simple.
Here's the code for creating the CD, in VB.  Tracks are added in order using the
<span class="code">AddFile</span> method, then the <span class="code">CreateCD</span>
transfers the data for each file to the Redbook image, and finally burns the CD:
</p><pre>
''' &lt;summary&gt;
''' Delegate representing the CreateCD method
''' &lt;/summary&gt;
Public Delegate Sub CreateCDDelegate(ByVal simulate As Boolean, ByVal ejectWhenComplete As Boolean)

''' &lt;summary&gt;
''' Simple wrapper to create an Audio CD from a series of tracks.  By
''' wrapping the function in a class we can call the burn method on
''' a background thread using &lt;c&gt;BeginInvoke&lt;/c&gt;.
''' &lt;/summary&gt;
Public Class AudioCDCreator
    Private ReadOnly m_discMaster As DiscMaster
    Private ReadOnly m_redbookDiscMaster As RedbookDiscMaster
    Private ReadOnly m_files As ArrayList

    ''' &lt;summary&gt;
    ''' Constructor.  When this class is constructed redbook should
    ''' have been set as the active disc master format and a disc
    ''' recorder needs to have been made active.      
    ''' &lt;/summary&gt;
    ''' &lt;param name="discMaster"&gt;Disc master object&lt;/param&gt;
    ''' &lt;param name="redbookDiscMaster"&gt;Redbook Disc master object&lt;/param&gt;
    Public Sub New( _
            ByVal discMasterParam As DiscMaster, _
            ByVal redbookDiscMasterParam As RedbookDiscMaster _
        )
        m_discMaster = discMasterParam
        m_redbookDiscMaster = redbookDiscMasterParam
        m_files = New ArrayList()
    End Sub

    ''' &lt;summary&gt;
    ''' Adds a file to record.  Files should be added in track order.
    ''' &lt;/summary&gt;
    ''' &lt;param name="fileName"&gt;File name of the track&lt;/param&gt;
    Public Sub AddFile(ByVal fileName As String)
        m_files.Add(fileName)
    End Sub

    ''' &lt;summary&gt;
    ''' Creates an audio CD from the specified files
    ''' &lt;/summary&gt;
    ''' &lt;param name="simulate"&gt;Simulate CD burning&lt;/param&gt;
    ''' &lt;param name="ejectWhenComplete"&gt;&lt;c&gt;true&lt;/c&gt; to eject the CD
    ''' tray when the burn is complete, &lt;c&gt;false&lt;/c&gt; otherwise&lt;/param&gt;
    Public Sub CreateCD(ByVal simulate As Boolean, ByVal ejectWhenComplete As Boolean)
        '// Ensure we don't have anything in the stage
        m_discMaster.ClearFormatContent()

        '// Stage the content
        Dim file As String
        For Each file In m_files
            Dim waveStream As WaveStreamReader = New WaveStreamReader(file)
            m_redbookDiscMaster.AddAudioTrackFromStream(waveStream)
            waveStream.Dispose()
        Next

        '// burn the disc
        m_discMaster.RecordDisc(simulate, ejectWhenComplete)

        ''' How easy was that?
    End Sub

End Class
</pre><h2>Conclusion</h2><p>
This sample demonstrates how to create audio CDs using VB or C# Managed Code.
Although the UI is rudimentary, it shouldn't be difficult to expand on
to make a fully featured CD creator.
</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">NET</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Writing CDs</a>&#160;.&#160;Writing Audio CDs</p><br /><table style="font-size: 100%;"><tr><td valign="top"><a href="javascript:window.alert(&quot;http://creativecommons.org/licenses/by/1.0/\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\res\cc.png" width="88" height="31" alt="Creative Commons Licence" /></a></td></a></td><td valign="top"><p class="nav" style="padding-bottom: 4px;">All contents of this web site are licensed under a <a href="javascript:window.alert(&quot;http://creativecommons.org/licenses/by/1.0/\nThis link was not retrieved.&quot;)">Creative Commons Licence</a>, except where otherwise noted.</p><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2004 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>, vbAccelerator Ltd.<br />Last Updated: 28 June 2004</p></td></tr></table></td><td></td></tr></table>
</body></html>