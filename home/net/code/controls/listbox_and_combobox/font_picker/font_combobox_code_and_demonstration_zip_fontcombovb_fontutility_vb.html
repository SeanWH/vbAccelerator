<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: FontComboVB_FontUtility.vb</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: FontComboVB_FontUtility.vb" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">NET</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">ListBox and ComboBox</a>&#160;.&#160;<a href="article.html">Font ComboBox</a>&#160;.&#160;<a href="font_combobox_code_and_demonstration.html">Font ComboBox Code and Demonstration</a>&#160;.&#160;FontComboVB_FontUtility.vb</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="font_combobox_code_and_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Font ComboBox Code and Demonstration</a> (75K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:13338</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=13338&type=zip&title=font_20combobox_20code_20and_20demonstration_2ezip_5ffontcombovb_5ffontutili.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;.NET</p><p class="nav">&#160;&#160;VB.NET</p><p class="nav">&#160;&#160;C#</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />2 Nov 2003<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\icon_combobox\article.html">vbAccelerator IconComboBox Control</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: FontComboVB_FontUtility.vb</h1><pre>Namespace FontCombo

    ''' &lt;summary&gt;
    ''' Windows API Logical Font structure to represent information
    ''' about a font.
    ''' &lt;/summary&gt;
    &lt;System.Runtime.InteropServices.StructLayout(System.Runtime.InteropServices.
    LayoutKind.Sequential)&gt; _
    Public Structure LOGFONT
        ''' &lt;summary&gt;
        ''' Height of the font.
        ''' &lt;/summary&gt;
        Public lfHeight As Integer
        Public lfWidth As Integer
        Public lfEscapement As Integer
        Public lfOrientation As Integer
        Public lfWeight As Integer
        Public lfItalic As Byte
        Public lfUnderline As Byte
        Public lfStrikeOut As Byte
        Public lfCharSet As Byte
        Public lfOutPrecision As Byte
        Public lfClipPrecision As Byte
        Public lfQuality As Byte
        Public lfPitchAndFamily As Byte
        &lt;System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServices
        .UnmanagedType.ByValTStr, SizeConst:=32)&gt; _
        Public lfFaceName As String
    End Structure

    ''' &lt;summary&gt;
    ''' Summary description for FontUtility.
    ''' &lt;/summary&gt;
    Public Class FontUtility

        &lt;System.Runtime.InteropServices.StructLayout(System.Runtime.InteropServi
        ces.LayoutKind.Sequential)&gt; _
        Private Structure TEXTMETRIC
            Public tmHeight As Integer
            Public tmAscent As Integer
            Public tmDescent As Integer
            Public tmInternalLeading As Integer
            Public tmExternalLeading As Integer
            Public tmAveCharWidth As Integer
            Public tmMaxCharWidth As Integer
            Public tmWeight As Integer
            Public tmOverhang As Integer
            Public tmDigitizedAspectX As Integer
            Public tmDigitizedAspectY As Integer
            &lt;System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServ
            ices.UnmanagedType.ByValTStr, SizeConst:=1)&gt; _
            Public tmFirstChar As String
            &lt;System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServ
            ices.UnmanagedType.ByValTStr, SizeConst:=1)&gt; _
            Public tmLastChar As String
            &lt;System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServ
            ices.UnmanagedType.ByValTStr, SizeConst:=1)&gt; _
            Public tmDefaultChar As String
            &lt;System.Runtime.InteropServices.MarshalAs(System.Runtime.InteropServ
            ices.UnmanagedType.ByValTStr, SizeConst:=1)&gt; _
            Public tmBreakChar As String
            Public tmItalic As Byte
            Public tmUnderlined As Byte
            Public tmStruckOut As Byte
            Public tmPitchAndFamily As Byte
            Public tmCharSet As Byte
        End Structure


        Private Declare Function GetTextMetrics Lib "gdi32" ( _
            ByVal hdc As IntPtr, _
            ByRef lptm As TEXTMETRIC _
         ) As Integer

        Private Declare Function GetOutlineTextMetricsA Lib "gdi32" ( _
            ByVal hdc As IntPtr, _
            ByVal cbData As Integer, _
            ByVal lpOtm As IntPtr _
         ) As Integer

        Private Declare Function SelectObject Lib "gdi32" ( _
            ByVal hdc As IntPtr, _
            ByVal hObj As IntPtr _
         ) As IntPtr

        ''' &lt;summary&gt;
        ''' Enumeration of Panose Font Family Types.  These can be used for
        ''' determining the similarity of two fonts or for detecting
         non-character
        ''' fonts like WingDings.
        ''' &lt;/summary&gt;
        Public Enum PanoseFontFamilyTypes As Integer
            ''' &lt;summary&gt;
            '''  Any
            ''' &lt;/summary&gt;
            PAN_ANY = 0
            ''' &lt;summary&gt;
            ''' No Fit
            ''' &lt;/summary&gt;
            PAN_NO_FIT = 1
            ''' &lt;summary&gt;
            ''' Text and Display
            ''' &lt;/summary&gt;
            PAN_FAMILY_TEXT_DISPLAY = 2
            ''' &lt;summary&gt;
            ''' Script
            ''' &lt;/summary&gt;
            PAN_FAMILY_SCRIPT = 3
            ''' &lt;summary&gt;
            ''' Decorative
            ''' &lt;/summary&gt;
            PAN_FAMILY_DECORATIVE = 4
            ''' &lt;summary&gt;
            ''' Pictorial                      
            ''' &lt;/summary&gt;
            PAN_FAMILY_PICTORIAL = 5
        End Enum


        ''' &lt;summary&gt;
        ''' Gets the &lt;see cref="PanoseFontFamilyTypes"/&gt; for the specified font.
        ''' &lt;/summary&gt;
        ''' &lt;param name="graphics"&gt;A graphics object to use when detecting the
         Panose
        ''' family.&lt;/param&gt;
        ''' &lt;param name="font"&gt;The font to check.&lt;/param&gt;
        ''' &lt;returns&gt;The Panose font family type.&lt;/returns&gt;
        Public Shared Function PanoseFontFamilyType( _
               ByVal graphics As Graphics, _
                      ByVal font As Font) As PanoseFontFamilyTypes
            Dim bFamilyType As Byte = 0

            Dim hdc As IntPtr = graphics.GetHdc()
            Dim hFontOld As IntPtr = SelectObject(hdc, font.ToHfont())

            Dim bufSize As Integer = GetOutlineTextMetricsA(hdc, 0, IntPtr.Zero)
            Dim lpOtm As IntPtr =
             System.Runtime.InteropServices.Marshal.AllocCoTaskMem(bufSize)
            System.Runtime.InteropServices.Marshal.WriteInt32(lpOtm, bufSize)
            Dim success As Integer = GetOutlineTextMetricsA(hdc, bufSize, lpOtm)
            If Not (success = 0) Then
                Dim offset As Integer = 61
                bFamilyType =
                 System.Runtime.InteropServices.Marshal.ReadByte(lpOtm, offset)

                'byte bSerifStyle = Marshal.ReadByte(lpOtm, offset + 1); 
                'byte bWeight = Marshal.ReadByte(lpOtm, offset + 2); 
                'byte bProportion = Marshal.ReadByte(lpOtm, offset + 3); 
                'byte bContrast = Marshal.ReadByte(lpOtm, offset + 4); 
                'byte bStrokeVariation = Marshal.ReadByte(lpOtm, offset + 5); 
                'byte bArmStyle = Marshal.ReadByte(lpOtm, offset + 6); 
                'byte bLetterform = Marshal.ReadByte(lpOtm, offset + 7); 
                'byte bMidline = Marshal.ReadByte(lpOtm, offset + 8); 
                'byte bXHeight = Marshal.ReadByte(lpOtm, offset + 9); 
            End If

            System.Runtime.InteropServices.Marshal.FreeCoTaskMem(lpOtm)

            SelectObject(hdc, hFontOld)
            graphics.ReleaseHdc(hdc)

            Return bFamilyType

        End Function

        Private Sub New()

        End Sub

    End Class
End Namespace
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="javascript:window.alert(&quot;http://vbaccelerator.com/home/include/adredir.asp?url=http://oneandone.co.uk/xml/init?k_id=5791003&image=http://oneandone.co.uk/xml/banner?size=1&number=2\nThis link was not retrieved.&quot;)" ><IMG SRC="..\..\..\..\..\..\..\oneandone_co_uk\xml\banner\size=1&number=2.html" ALT="1&1 Web Hosting" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">NET</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">ListBox and ComboBox</a>&#160;.&#160;<a href="article.html">Font ComboBox</a>&#160;.&#160;<a href="font_combobox_code_and_demonstration.html">Font ComboBox Code and Demonstration</a>&#160;.&#160;FontComboVB_FontUtility.vb</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 7 November 2003</p></td><td></td></tr></table>
</body></html>