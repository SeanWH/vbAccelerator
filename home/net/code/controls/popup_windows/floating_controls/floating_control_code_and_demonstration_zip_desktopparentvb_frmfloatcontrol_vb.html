<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: DesktopParentVB_frmFloatControl.vb</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: DesktopParentVB_frmFloatControl.vb" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">NET</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Popup Windows</a>&#160;.&#160;<a href="article.html">Floating Controls, Tooltip-style</a>&#160;.&#160;<a href="floating_control_code_and_demonstration.html">Floating Control Code and Demonstration</a>&#160;.&#160;DesktopParentVB_frmFloatControl.vb</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="floating_control_code_and_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Floating Control Code and Demonstration</a> (138K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:13386</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=13386&type=zip&title=floating_20control_20code_20and_20demonstration_2ezip_5fdesktopparentvb_5ffr.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;.NET</p><p class="nav">&#160;&#160;C#</p><p class="nav">&#160;&#160;VB.NET</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />1 Nov 2003<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\listbar\vsnet_style_list_bar\article.html">VS.NET ListBar Control</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: DesktopParentVB_frmFloatControl.vb</h1><pre>Public Class frmFloatControl
    Inherits System.Windows.Forms.Form

    Private sponsorMessage As vbAccelerator.Components.Controls.FloatControl
    Private listBoxHover As vbAccelerator.Components.Controls.FloatControl
    Private lastListItemOver As Integer = -1


#Region " Windows Form Designer generated code "

    Public Sub New()
        MyBase.New()

        'Me call is required by the Windows Form Designer.
        InitializeComponent()

        'Add any initialization after the InitializeComponent() call

        ' 
        ' Set up the floating "SponsorMessage" control
        ' 
        Me.sponsorMessage = New vbAccelerator.Components.Controls.FloatControl()
        Me.sponsorMessage.BackgroundImage = picRes.Image
        Me.sponsorMessage.Name = "sponsorMessage"
        Me.sponsorMessage.TabStop = False
        Me.sponsorMessage.Visible = False
        Me.sponsorMessage.Size = picRes.Image.Size

        ' Add some items to the ListBox which go beyond the visibility of the
         box
        Dim i As Integer
        For i = 0 To 99
            If ((i Mod 2) = 0) Then
                Me.lstLongItemPopup.Items.Add( _
                    String.Format("This is long item {0} which can go beyond
                     the width of the list box.", i))
            Else
                Me.lstLongItemPopup.Items.Add(String.Format("Short Item {0}",
                 i))
            End If
        Next i

        ' Create the control which will show the item the mouse is over in the 
        ' list box:
        Me.listBoxHover = New vbAccelerator.Components.Controls.FloatControl()
        Me.listBoxHover.Name = "listBoxHover"
        Me.listBoxHover.TabStop = False
        Me.listBoxHover.Visible = False
        Me.listBoxHover.BackColor = SystemColors.Info
        Me.listBoxHover.ForeColor = SystemColors.InfoText

    End Sub

    'Form overrides dispose to clean up the component list.
    Protected Overloads Overrides Sub Dispose(ByVal disposing As Boolean)
        If disposing Then
            If Not (components Is Nothing) Then
                components.Dispose()
            End If
        End If
        MyBase.Dispose(disposing)
    End Sub

    'Required by the Windows Form Designer
    Private components As System.ComponentModel.IContainer

    'NOTE: The following procedure is required by the Windows Form Designer
    'It can be modified using the Windows Form Designer.  
    'Do not modify it using the code editor.
    Friend WithEvents lblInfo As System.Windows.Forms.Label
    Friend WithEvents picRes As System.Windows.Forms.PictureBox
    Friend WithEvents lstLongItemPopup As System.Windows.Forms.ListBox
    Friend WithEvents btnHover As System.Windows.Forms.Button
    &lt;System.Diagnostics.DebuggerStepThrough()&gt; Private Sub InitializeComponent()
        Dim resources As System.Resources.ResourceManager = New
         System.Resources.ResourceManager(GetType(frmFloatControl))
        Me.lblInfo = New System.Windows.Forms.Label()
        Me.picRes = New System.Windows.Forms.PictureBox()
        Me.lstLongItemPopup = New System.Windows.Forms.ListBox()
        Me.btnHover = New System.Windows.Forms.Button()
        Me.SuspendLayout()
        '
        'lblInfo
        '
        Me.lblInfo.Location = New System.Drawing.Point(8, 4)
        Me.lblInfo.Name = "lblInfo"
        Me.lblInfo.Size = New System.Drawing.Size(276, 40)
        Me.lblInfo.TabIndex = 8
        Me.lblInfo.Text = "This sample demonstrates how to make a control float
         over other controls and make" &amp; _
        " it transparent to the mouse."
        '
        'picRes
        '
        Me.picRes.Image = CType(resources.GetObject("picRes.Image"),
         System.Drawing.Bitmap)
        Me.picRes.Location = New System.Drawing.Point(164, 200)
        Me.picRes.Name = "picRes"
        Me.picRes.Size = New System.Drawing.Size(92, 48)
        Me.picRes.TabIndex = 7
        Me.picRes.TabStop = False
        Me.picRes.Visible = False
        '
        'lstLongItemPopup
        '
        Me.lstLongItemPopup.Location = New System.Drawing.Point(8, 48)
        Me.lstLongItemPopup.Name = "lstLongItemPopup"
        Me.lstLongItemPopup.Size = New System.Drawing.Size(276, 147)
        Me.lstLongItemPopup.TabIndex = 6
        '
        'btnHover
        '
        Me.btnHover.FlatStyle = System.Windows.Forms.FlatStyle.System
        Me.btnHover.Location = New System.Drawing.Point(8, 200)
        Me.btnHover.Name = "btnHover"
        Me.btnHover.Size = New System.Drawing.Size(100, 40)
        Me.btnHover.TabIndex = 5
        Me.btnHover.Text = "&amp;Visit our Sponsor..."
        '
        'frmFloatControl
        '
        Me.AutoScaleBaseSize = New System.Drawing.Size(5, 14)
        Me.ClientSize = New System.Drawing.Size(292, 266)
        Me.Controls.AddRange(New System.Windows.Forms.Control() {Me.lblInfo,
         Me.picRes, Me.lstLongItemPopup, Me.btnHover})
        Me.Font = New System.Drawing.Font("Tahoma", 8.25!,
         System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point,
         CType(0, Byte))
        Me.Icon = CType(resources.GetObject("$this.Icon"), System.Drawing.Icon)
        Me.Name = "frmFloatControl"
        Me.Text = "vbAccelerator Float Control Demonstration"
        Me.ResumeLayout(False)

    End Sub

#End Region




    Private Sub frmFloatControl_SizeChanged(ByVal sender As Object, ByVal e As
     System.EventArgs) Handles MyBase.SizeChanged
        Try
            Me.SuspendLayout()
            Dim listHeight As Integer = Me.ClientRectangle.Height -
             lstLongItemPopup.Top - btnHover.Height - 4
         lstLongItemPopup.Size = new Size(me.ClientRectangle.Width -
          lstLongItemPopup.Left * 2, _
               listHeight)
            btnHover.Top = lstLongItemPopup.Top + listHeight
            lblInfo.Width = Me.ClientRectangle.Width - lblInfo.Left * 2
            Me.ResumeLayout()
        Catch
        End Try
    End Sub

    Private Sub btnHover_MouseHover(ByVal sender As Object, ByVal e As
     System.EventArgs) Handles btnHover.MouseHover
        If Not (sponsorMessage.Visible) Then
            Dim pt As Point = btnHover.Location
            pt.Offset(0, btnHover.Height / 2)
            pt = Me.PointToScreen(pt)
            sponsorMessage.Location = pt
            sponsorMessage.ShowFloating()
        End If
    End Sub

    Private Sub btnHover_MouseLeave(ByVal sender As Object, ByVal e As
     System.EventArgs) Handles btnHover.MouseLeave
        If (sponsorMessage.Visible) Then
            sponsorMessage.Hide()
        End If
    End Sub

    Private Sub lstLongItemPopup_MouseMove(ByVal sender As Object, ByVal e As
     System.Windows.Forms.MouseEventArgs) Handles lstLongItemPopup.MouseMove
        If (e.Button = 0) Then
            OnListBoxMouseMove()
        Else
            OnListBoxMouseCancel()
        End If
    End Sub

    Private Sub lstLongItemPopup_MouseDown(ByVal sender As Object, ByVal e As
     System.Windows.Forms.MouseEventArgs) Handles lstLongItemPopup.MouseDown
        OnListBoxMouseCancel()
    End Sub

    Private Sub lstLongItemPopup_MouseEnter(ByVal sender As Object, ByVal e As
     System.EventArgs) Handles lstLongItemPopup.MouseEnter
        OnListBoxMouseMove()
    End Sub

    Private Sub lstLongItemPopup_MouseLeave(ByVal sender As Object, ByVal e As
     System.EventArgs) Handles lstLongItemPopup.MouseLeave
        OnListBoxMouseCancel()
    End Sub

    Private Sub OnListBoxMouseCancel()
        If (listBoxHover.Visible) Then
            listBoxHover.Hide()
            lastListItemOver = -1
        End If
    End Sub

    Private Sub OnListBoxMouseMove()
        Dim itemOver As Integer = -1
        Dim newPopupItemOver As Integer = -1

        Dim pt As Point = GetHoverItemLocation(itemOver)
        Dim hoverItemSize As Size = New Size(0, 0)
        If (itemOver &lt;&gt; lastListItemOver) Then
            If (itemOver &gt; -1) Then
                listBoxHover.Font = lstLongItemPopup.Font
                hoverItemSize = GetHoverItemSize(itemOver)
                If (hoverItemSize.Width &gt;
                 lstLongItemPopup.ClientRectangle.Width) Then
                    newPopupItemOver = itemOver
                End If

                If (newPopupItemOver &gt; -1) Then
                    listBoxHover.Location = pt
                    listBoxHover.Size = hoverItemSize
                    If Not (listBoxHover.Visible) Then
                        listBoxHover.ShowFloating()
                    End If
                    listBoxHover.Text =
                     lstLongItemPopup.Items(itemOver).ToString()
                Else
                    OnListBoxMouseCancel()
                End If
            End If
        End If

        lastListItemOver = newPopupItemOver

    End Sub

    Private Function GetHoverItemLocation(ByRef itemOver As Integer) As Point
        itemOver = -1

        Dim cursorPosition As Point = Cursor.Position
        Dim location As Point = New Point(0, 0)

        ' Convert cursor position to ListBox coordinates:
        cursorPosition = lstLongItemPopup.PointToClient(cursorPosition)
        If (lstLongItemPopup.ClientRectangle.Contains(cursorPosition)) Then
            ' Determine which item (if any) we are over:
            Dim height As Integer = lstLongItemPopup.ItemHeight
            Dim y As Integer = 0
            Dim i As Integer
            For i = lstLongItemPopup.TopIndex To lstLongItemPopup.Items.Count -
             1
                If (cursorPosition.Y &gt;= y And cursorPosition.Y &lt;= y + height)
                 Then
                    location = New Point(0, y)
                    itemOver = i
                    Exit For
                End If
                y += height
            Next i
        End If
        Return lstLongItemPopup.PointToScreen(location)
    End Function

    Private Function GetHoverItemSize(ByVal itemOver As Integer) As Size
        Dim graphics As Graphics = graphics.FromHwnd(listBoxHover.Handle)
        Dim size As SizeF =
         graphics.MeasureString(lstLongItemPopup.Items(itemOver).ToString(), _
          lstLongItemPopup.Font)
        graphics.Dispose()
        Return New Size((size.Width + 4), Math.Max(lstLongItemPopup.ItemHeight,
         (size.Height) + 1))
    End Function

End Class
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\vb\code\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">NET</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Popup Windows</a>&#160;.&#160;<a href="article.html">Floating Controls, Tooltip-style</a>&#160;.&#160;<a href="floating_control_code_and_demonstration.html">Floating Control Code and Demonstration</a>&#160;.&#160;DesktopParentVB_frmFloatControl.vb</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 7 November 2003</p></td><td></td></tr></table>
</body></html>