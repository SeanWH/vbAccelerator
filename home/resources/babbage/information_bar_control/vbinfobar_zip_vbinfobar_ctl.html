<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: vbInfoBar.ctl</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: vbInfoBar.ctl" /><link rel="stylesheet" href="..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">Resources</a>&#160;.&#160;<a href="..\index.asp\index.html">Babbage</a>&#160;.&#160;<a href="article.html">(Incomplete) VB Information Bar Control</a>&#160;.&#160;<a href="vbinfobar.html">VBInfoBar</a>&#160;.&#160;vbInfoBar.ctl</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vbinfobar.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VBInfoBar</a> (54K)</p><br /><br /><img src="..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:12379</p><p class="nav">&#160;&#160;<a href="..\..\..\..\linkto_asp\id=12379&type=zip&title=vbinfobar_2ezip_5fvbinfobar.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;Graeme Grant</p><br /><br /><img src="..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\res\update.png" width="8" height="8" alt="Update" />26 Jun 2003<br />First Posted</p><br /><br /><img src="..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\vb\code\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\vb\code\controls\imagelist\vbaccelerator_image_list_control\article.html">vbAccelerator ImageList Control and Class v2.0</a></p><br /><br /><img src="..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\the_site\newsite\article.html"><img src="..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: vbInfoBar.ctl</h1><pre>VERSION 5.00
Begin VB.UserControl vbInfoBar 
   Alignable       =   -1  'True
   Appearance      =   0  'Flat
   BackColor       =   &amp;H80000010&amp;
   ClientHeight    =   660
   ClientLeft      =   0
   ClientTop       =   0
   ClientWidth     =   4800
   ScaleHeight     =   660
   ScaleWidth      =   4800
   Begin VB.PictureBox picImage 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      BorderStyle     =   0  'None
      Height          =   255
      Left            =   1740
      ScaleHeight     =   255
      ScaleWidth      =   315
      TabIndex        =   0
      Top             =   240
      Visible         =   0   'False
      Width           =   315
   End
End
Attribute VB_Name = "vbInfoBar"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = True
Option Explicit

'-- Default Property Values:
Const m_def_Caption = "Information Bar"
Const m_def_IconCaption = ""
Const m_def_ButtonEnabled = True
Const m_def_lIconIndex = 0
Const m_def_bGradient = False

'-- Property Variables:
Private m_Caption       As String
Private m_IconCaption   As String
Private m_ButtonEnabled As Boolean
Private m_bGradient     As Boolean
Private m_bVertGradient As Boolean
Private m_BackColor2    As Long
Private m_bThinButtonEdge As Boolean

'-- Internal Variables
Private Enum epButtonState
    epbsNone = 0
    epbsRaised = 1
    epbsSunken = 2
End Enum

Public Enum eButtonState
    ebsNormal = 0
    ebsStayDown = 1
End Enum

Private m_bBitmap    As Boolean
Private m_hDCSrc     As Long
Private m_lBitmapW   As Long
Private m_lBitmapH   As Long
Private m_bDirty     As Boolean
Private m_hIml       As Long
Private m_lIconSizeX As Long
Private m_lIconSizeY As Long
Private m_lIconIndex As Long
Private m_ButRect    As RECT
Private m_bPressed   As Boolean
Private m_InFocus    As Boolean
Private m_Sticky     As eButtonState
Private m_State      As epButtonState
Private m_cMemDC     As cMemDC
Private m_Font       As IFont
Private m_oBackColor As OLE_COLOR
Private m_oForeColor As OLE_COLOR

Private WithEvents m_cTPM As cMouseTrack
Attribute m_cTPM.VB_VarHelpID = -1

'-- Event Declarations:
Public Event Click()
Public Event Paint()
Public Event ButtonDown(ButtonState As eButtonState)

Public Property Get BackColor() As OLE_COLOR
    BackColor = m_oBackColor
End Property

Public Property Let BackColor(ByVal New_BackColor As OLE_COLOR)
    m_oBackColor = New_BackColor
    PropertyChanged "BackColor"
    Refresh
End Property

Public Property Get BackColor2() As OLE_COLOR
    BackColor2 = m_BackColor2
End Property

Public Property Let BackColor2(ByVal New_BackColor2 As OLE_COLOR)
    m_BackColor2 = New_BackColor2
    PropertyChanged "BackColor2"
    Refresh
End Property

Public Property Get BackgroundPicture() As StdPicture
    Set BackgroundPicture = picImage.Picture
End Property

Public Property Set BackgroundPicture(sPic As StdPicture)

    On Error Resume Next

    Set picImage.Picture = sPic
    picImage.Refresh
    If (Err.Number &lt;&gt; 0) Or (picImage.ScaleWidth = 0) Or (sPic Is Nothing) Then
        m_hDCSrc = 0
        m_bBitmap = False
    Else
        m_bBitmap = True
        m_hDCSrc = picImage.hdc
        m_lBitmapW = picImage.ScaleWidth \ Screen.TwipsPerPixelX
        m_lBitmapH = picImage.ScaleHeight \ Screen.TwipsPerPixelY
    End If
    m_bDirty = True
    Refresh
    PropertyChanged "BackgroundPicture"

End Property

Public Property Get Caption() As String
    Caption = m_Caption
End Property

Public Property Let Caption(ByVal New_Caption As String)
   m_Caption = New_Caption
   PropertyChanged "Caption"
   Refresh
End Property

Public Property Get ButtonEnabled() As Boolean
    ButtonEnabled = m_ButtonEnabled
End Property

Public Property Let ButtonEnabled(ByVal New_ButtonEnabled As Boolean)
    m_ButtonEnabled = New_ButtonEnabled
    PropertyChanged "ButtonEnabled"
End Property

Public Property Get ForeColor() As OLE_COLOR
    ForeColor = m_oForeColor
End Property

Public Property Let ForeColor(ByVal New_ForeColor As OLE_COLOR)
    m_oForeColor = New_ForeColor
    PropertyChanged "ForeColor"
    pDraw
End Property

Public Property Get Font() As IFont
   Set Font = UserControl.Font
End Property

Public Property Let Font(fnt As IFont)
   pSetFont fnt
   PropertyChanged "Font"
   Refresh
End Property

Public Property Set Font(fnt As IFont)
   pSetFont fnt
   PropertyChanged "Font"
   Refresh
End Property

Public Property Let ImageList(vThis As Variant)

    Dim hIml As Long

    If VarType(vThis) = vbObject Then
        On Error Resume Next
        vThis.ListImages(1).Draw 0, 0, 0, 1
        hIml = vThis.hImageList
        If (Err.Number &lt;&gt; 0) Then
            hIml = 0
        End If
        On Error GoTo 0
    ElseIf VarType(vThis) = vbLong Then
        hIml = vThis
    Else
        Err.Raise vbObjectError + 1049, "vbInfoBar." &amp; App.EXEName, "ImageList
         property expects ImageList object or long hImageList handle."
    End If
    If (hIml &lt;&gt; 0) Then
        m_hIml = hIml
        ImageList_GetIconSize m_hIml, m_lIconSizeX, m_lIconSizeY
        pSetHeight
    End If

End Property

Public Sub GetDropDownPosition(Id As Long, X As Long, Y As Long)
    With UserControl.Extender
        X = .Left
        Y = .Top + .Height
    End With
End Sub

Public Property Get Gradient() As Boolean
    Gradient = m_bGradient
End Property

Public Property Let Gradient(ByVal New_Gradient As Boolean)
    m_bGradient = New_Gradient
    PropertyChanged "Gradient"
    m_bDirty = True
    Refresh
End Property

Public Property Get hwnd() As Long
   hwnd = UserControl.hwnd
End Property

Public Property Get IconCaption() As String
    IconCaption = m_IconCaption
End Property

Public Property Let IconCaption(ByVal New_IconCaption As String)
    m_IconCaption = New_IconCaption
    PropertyChanged "IconCaption"
    Refresh
End Property

Public Property Get IconIndex() As Long
   IconIndex = m_lIconIndex
End Property

Public Property Let IconIndex(ByVal lIconIndex As Long)
   m_lIconIndex = lIconIndex
    PropertyChanged "IconIndex"
End Property

Public Sub Refresh()
   pDraw
End Sub

Public Sub ReleaseButton()
    m_bPressed = False
    m_InFocus = False
    m_Sticky = ebsNormal
    m_State = epbsNone
    pDraw
End Sub

Public Property Get VerticalGradient() As Boolean
    VerticalGradient = m_bVertGradient
End Property

Public Property Let VerticalGradient(ByVal New_VertGradient As Boolean)
    m_bVertGradient = New_VertGradient
    PropertyChanged "VerticalGradient"
    m_bDirty = True
    pDraw
End Property

Private Sub m_cTPM_MouseHover(Button As MouseButtonConstants, Shift As
 ShiftConstants, X As Single, Y As Single)
'    Debug.Print "m_cTPM_MouseHover"
   m_cTPM.StartMouseTracking
End Sub

Private Sub m_cTPM_MouseLeave()
    If m_Sticky = ebsNormal And m_bPressed = False Then
        'Debug.Print "vbInfoBar-&gt;m_cTPM::MouseLeave"
        If m_InFocus = True Then
            m_InFocus = False
            m_State = epbsNone
            pDraw
        End If
    End If
End Sub

Private Sub UserControl_MouseDown(Button As Integer, Shift As Integer, X As
 Single, Y As Single)
    pMouseDown Button, Shift, X \ Screen.TwipsPerPixelX, Y \
     Screen.TwipsPerPixelY
End Sub

Private Sub UserControl_MouseMove(Button As Integer, Shift As Integer, X As
 Single, Y As Single)
    If Not m_cTPM.Tracking Then
      If X &gt; 0 And Y &gt; 0 Then
         m_cTPM.StartMouseTracking
      End If
    End If
    pMouseMove Button, Shift, X \ Screen.TwipsPerPixelX, Y \
     Screen.TwipsPerPixelY
End Sub

Private Sub UserControl_MouseUp(Button As Integer, Shift As Integer, X As
 Single, Y As Single)
    pMouseUp Button, Shift, X \ Screen.TwipsPerPixelX, Y \ Screen.TwipsPerPixelY
End Sub

Private Sub UserControl_Paint()
   pDraw
End Sub

Private Sub UserControl_Resize()
   pDraw
End Sub

Private Sub UserControl_AmbientChanged(PropertyName As String)
'    Debug.Print "UserControl_AmbientChanged: "; PropertyName
End Sub

Private Sub UserControl_Initialize()
'    Debug.Print "UserControl_Initialize"
End Sub

'Initialize Properties for User Control
Private Sub UserControl_InitProperties()
    m_ButtonEnabled = m_def_ButtonEnabled
    Set UserControl.Font = Ambient.Font
    m_Caption = m_def_Caption
    m_IconCaption = m_def_IconCaption
    pInitialise
End Sub


'Load property values from storage
Private Sub UserControl_ReadProperties(PropBag As PropertyBag)

    pInitialise

    Dim sFnt As New StdFont
    sFnt.Name = "MS Sans Serif"
    sFnt.Size = 8
    Set Font = PropBag.ReadProperty("Font", sFnt)

    m_ButtonEnabled = PropBag.ReadProperty("ButtonEnabled", m_def_ButtonEnabled)
    BackColor = PropBag.ReadProperty("BackColor", &amp;H80000010)
    m_BackColor2 = PropBag.ReadProperty("BackColor2", &amp;H80000010)
    m_oForeColor = PropBag.ReadProperty("ForeColor", &amp;H80000012)
    Set BackgroundPicture = PropBag.ReadProperty("BackgroundPicture", Nothing)
    m_Caption = PropBag.ReadProperty("Caption", m_def_Caption)
    m_IconCaption = PropBag.ReadProperty("IconCaption", m_def_IconCaption)
    m_lIconIndex = PropBag.ReadProperty("IconIndex", m_def_lIconIndex)
    m_bGradient = PropBag.ReadProperty("Gradient", m_def_bGradient)
    m_bVertGradient = PropBag.ReadProperty("VerticalGradient", m_def_bGradient)

End Sub

Private Sub UserControl_Terminate()
    Set m_cMemDC = Nothing
    Set m_cTPM = Nothing
'    Debug.Print "UserControl_Terminate"
End Sub

'Write property values to storage
Private Sub UserControl_WriteProperties(PropBag As PropertyBag)

    Dim sFnt As New StdFont
    sFnt.Name = "MS Sans Serif"
    sFnt.Size = 8
    PropBag.WriteProperty "Font", Font, sFnt

    PropBag.WriteProperty "ButtonEnabled", m_ButtonEnabled, m_def_ButtonEnabled
    PropBag.WriteProperty "BackColor", m_oBackColor, &amp;H80000010
    PropBag.WriteProperty "BackColor2", m_BackColor2, &amp;H80000010
    PropBag.WriteProperty "ForeColor", m_oForeColor, &amp;H80000012
    PropBag.WriteProperty "BackgroundPicture", BackgroundPicture, Nothing
    PropBag.WriteProperty "Caption", m_Caption, m_def_Caption
    PropBag.WriteProperty "IconCaption", m_IconCaption, m_def_IconCaption
    PropBag.WriteProperty "IconIndex", m_lIconIndex, m_def_lIconIndex
    PropBag.WriteProperty "Gradient", m_bGradient, m_def_bGradient
    PropBag.WriteProperty "VerticalGradient", m_bVertGradient, m_def_bGradient

End Sub

Private Sub pDraw()

    Dim sText     As String
    Dim eFlags    As ECGTextAlignFlags
    Dim PicRect  As RECT
    Dim CaptRect  As RECT
    Dim SubRect   As RECT
    Dim lWidth    As Long
    Dim lIconLeft As Long
    Dim lHDC      As Long
    Dim lhDCU     As Long
    Dim hFontOld  As Long
    Dim bMemDC    As Boolean

    pPrepareMemDC lHDC, lhDCU, bMemDC
    GetClientRect UserControl.hwnd, PicRect
    
    '-- Box text
    CaptRect = PicRect
    CaptRect.Left = CaptRect.Left + 2
    CaptRect.Right = CaptRect.Right - m_lIconSizeX - 5
    pFillBackground lHDC, PicRect, 0, 0
    DrawImage m_hIml, _
              m_lIconIndex, _
              lHDC, _
              CaptRect.Right + 5, _
              PicRect.Top + (PicRect.Bottom - m_lIconSizeY) \ 2, _
              m_lIconSizeX, _
              m_lIconSizeY
    lWidth = UserControl.TextWidth(m_Caption) \ Screen.TwipsPerPixelX + 4
    sText = m_Caption &amp; vbNullChar
    eFlags = DT_WORD_ELLIPSIS Or _
             DT_PATH_ELLIPSIS Or _
             DT_MODIFYSTRING Or _
             DT_END_ELLIPSIS Or _
             DT_VCENTER Or DT_SINGLELINE 'vcenter won't work if multi-line.
    If CaptRect.Right - CaptRect.Left &gt; lWidth Then
        CaptRect.Right = CaptRect.Left + lWidth
    End If
    hFontOld = SelectObject(lHDC, Font.hFont)
    If m_State = epbsSunken Then
      OffsetRect CaptRect, 1, 1
    End If
    DrawText lHDC, sText, -1, CaptRect, eFlags
    If m_State = epbsSunken Then
      OffsetRect CaptRect, 0, 0
    End If
    m_ButRect = CaptRect
    m_ButRect.Left = UserControl.ScaleLeft
    If m_State = epbsRaised Then
      If m_bThinButtonEdge Then
         DrawEdge lHDC, m_ButRect, BDR_RAISEDINNER, BF_RECT
      Else
         DrawEdge lHDC, m_ButRect, EDGE_RAISED, BF_RECT
      End If
    ElseIf m_State = epbsSunken Then
      If m_bThinButtonEdge Then
         m_ButRect.Bottom = m_ButRect.Bottom - 1
         DrawEdge lHDC, m_ButRect, BDR_SUNKENOUTER, BF_RECT
      Else
         DrawEdge lHDC, m_ButRect, EDGE_SUNKEN, BF_RECT
      End If
    End If
    pMemDCToDC lhDCU, lHDC, bMemDC, PicRect

End Sub

Private Sub pFillBackground(ByVal lHDC As Long, _
                            ByRef tR As RECT, _
                            ByVal lOffsetX As Long, _
                            ByVal lOffsetY As Long)

    Dim hBr As Long

    If (m_bBitmap) Then
        TileArea lHDC, _
                 tR.Left, tR.Top, tR.Right - tR.Left, tR.Bottom - tR.Top, _
                 m_hDCSrc, _
                 m_lBitmapW, m_lBitmapH, _
                 lOffsetX, lOffsetY
    ElseIf (m_bGradient) Then
        DrawGraduatedBackdrop lHDC, _
                              tR.Left, tR.Top, tR.Right, tR.Bottom, _
                              TranslateColor(m_oBackColor),
                               TranslateColor(m_BackColor2), _
                              m_bVertGradient
    Else
        hBr = CreateSolidBrush(TranslateColor(m_oBackColor))
        FillRect lHDC, tR, hBr
        DeleteObject hBr
    End If

End Sub

Private Sub pInitialise()
    Set m_cMemDC = New cMemDC
    'Set m_cMemDC2 = New cMemDC
    Set m_cTPM = New cMouseTrack
    m_cTPM.AttachMouseTracking Me
    m_Sticky = ebsNormal
End Sub

Private Sub pMouseDown(ByVal Button As MouseButtonConstants, ByVal Shift As
 ShiftConstants, ByVal X As Long, ByVal Y As Long)
    If m_ButtonEnabled Then
        If PtInRect(m_ButRect, X, Y) Then
            If m_Sticky = ebsNormal Then
                RaiseEvent ButtonDown(m_Sticky)
                pMouseMove Button, Shift, X, Y
                'Debug.Print "vbInfoBar-&gt;pMouseDown"
            End If
        End If
    End If
End Sub

Private Sub pMouseMove(ByVal Button As MouseButtonConstants, ByVal Shift As
 ShiftConstants, ByVal X As Long, ByVal Y As Long)

    Dim lHDC As Long

    If (m_Sticky And m_bPressed) Then Exit Sub
    If m_ButtonEnabled Then
        lHDC = UserControl.hdc
        If PtInRect(m_ButRect, X, Y) Then
            m_InFocus = True
            If Button Then
                m_bPressed = True
            Else
                m_bPressed = False
            End If
            If Not m_bPressed Then
                m_State = epbsRaised
                pDraw
            Else
                m_State = epbsSunken
                pDraw
           End If
        Else
            If m_InFocus Then
                m_State = epbsNone
                pDraw
                m_InFocus = False
            End If
        End If
    End If

End Sub

Private Sub pMouseUp(ByVal Button As MouseButtonConstants, ByVal Shift As
 ShiftConstants, ByVal X As Long, ByVal Y As Long)
    'Debug.Print "Raise Item Click Event!"
    If m_ButtonEnabled Then
        If PtInRect(m_ButRect, X, Y) Then
            RaiseEvent Click
        End If
    End If
End Sub

Private Sub pMemDCToDC(ByVal lhDCU As Long, ByVal lHDC As Long, ByVal bMemDC As
 Boolean, ByRef tR As RECT)
   If bMemDC Then
      With tR
          BitBlt lhDCU, .Left, .Top, .Right - .Left, .Bottom - .Top, lHDC, 0,
           0, vbSrcCopy
      End With
   End If
End Sub

Private Sub pPrepareMemDC(ByRef lHDC As Long, ByRef lhDCU As Long, ByRef bMemDC
 As Boolean)
   
   lhDCU = UserControl.hdc
   If Not m_cMemDC Is Nothing Then
      m_cMemDC.Width = UserControl.ScaleWidth \ Screen.TwipsPerPixelY
      m_cMemDC.Height = UserControl.ScaleHeight \ Screen.TwipsPerPixelX
      lHDC = m_cMemDC.hdc
   End If
   If lHDC = 0 Then
      lHDC = lhDCU
   Else
      bMemDC = True
   End If
   SetBkColor lHDC, TranslateColor(m_oBackColor)
   SetBkMode lHDC, TRANSPARENT
   SetTextColor lHDC, TranslateColor(m_oForeColor)

End Sub

Private Sub pSetFont(fnt As IFont)
   If Not fnt Is Nothing Then
      Set UserControl.Font = fnt
      Set m_Font = fnt
      pSetHeight
      pDraw
   End If
End Sub

Private Sub pSetHeight()

   Dim lHeight As Long

   lHeight = UserControl.TextHeight("Gg") + 4 * Screen.TwipsPerPixelY
   If m_lIconSizeY * Screen.TwipsPerPixelY &gt; lHeight Then
      lHeight = m_lIconSizeY * Screen.TwipsPerPixelY
   End If
   If UserControl.Height &lt;&gt; lHeight Then
      UserControl.Height = lHeight
      m_cMemDC.Height = lHeight \ Screen.TwipsPerPixelY
   End If

End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="javascript:window.alert(&quot;http://vbaccelerator.com/home/include/adredir.asp?url=http://oneandone.co.uk/xml/init?k_id=5791003&image=http://oneandone.co.uk/xml/banner?size=1&number=1\nThis link was not retrieved.&quot;)" ><IMG SRC="..\..\..\..\..\oneandone_co_uk\xml\banner\size=1&number=1.html" ALT="1&1 Web Hosting" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">Resources</a>&#160;.&#160;<a href="..\index.asp\index.html">Babbage</a>&#160;.&#160;<a href="article.html">(Incomplete) VB Information Bar Control</a>&#160;.&#160;<a href="vbinfobar.html">VBInfoBar</a>&#160;.&#160;vbInfoBar.ctl</p><br /><p class="nav"><a href="..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 1 July 2003</p></td><td></td></tr></table>
</body></html>