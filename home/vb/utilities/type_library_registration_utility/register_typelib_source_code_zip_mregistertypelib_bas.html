<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: mRegisterTypeLib.bas</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: mRegisterTypeLib.bas" /><link rel="stylesheet" href="..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">VB Type Library Registration Utility</a>&#160;.&#160;<a href="register_typelib_source_code.html">Register TypeLib Source Code</a>&#160;.&#160;mRegisterTypeLib.bas</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="register_typelib_source_code.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Register TypeLib Source Code</a> (61K)</p><p /><p class="nav"><a href="vb5_register_typelib_utility.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Register TypeLib Utility</a> (29K)</p><p /><p class="nav"><a href="vb6_register_typelib_utility.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Register TypeLib Utility</a> (26K)</p><br /><br /><img src="..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:2129</p><p class="nav">&#160;&#160;<a href="..\..\..\..\linkto_asp\id=2129&type=zip&title=register_20typelib_20source_20code_2ezip_5fmregistertypelib.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\res\update.png" width="8" height="8" alt="Update" />19 Dec 2002<br /><p class="update">More usable UI</p><p class="update">VB6 Version</p><p class="update">Ability to save all registered TypeLibs as XML file</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\type_libraries\ishellfolder\article.html">IShellFolder Extended Type Library Version 1.2 (ISHF_Ex.Tlb)</a></p><br /><br /><img src="..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\the_site\newsite\article.html"><img src="..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: mRegisterTypeLib.bas</h1><pre>Attribute VB_Name = "mRegisterTypeLib"
Option Explicit

Private Type GUID
    Data1 As Long
    Data2 As Integer
    Data3 As Integer
    Data4(0 To 7) As Byte
End Type
Private Enum eSYSKIND
   SYS_WIN16 = 0&amp;
   SYS_WIN32 = 1&amp;
   SYS_MAC = 2&amp;
End Enum

Private Declare Function LoadTypeLib Lib "oleaut32.dll" ( _
    pFileName As Byte, pptlib As Object) As Long
Private Declare Function RegisterTypeLib Lib "oleaut32.dll" ( _
    ByVal ptlib As Object, szFullPath As Byte, _
    szHelpFile As Byte) As Long
Private Declare Function UnRegisterTypeLib Lib "oleaut32.dll" ( _
      libID As GUID, _
      ByVal wVerMajor As Integer, _
      ByVal wVerMinor As Integer, _
      ByVal lCID As Long, _
      ByVal tSysKind As eSYSKIND _
   ) As Long
Private Declare Function CLSIDFromString Lib "ole32.dll" (lpsz As Byte, pclsid
 As GUID) As Long

Public Function RegTypelib(sLib As String, ByVal bState As Boolean) As Long
Dim suLib() As Byte
Dim errOK As Long
Dim tlb As Object
   If bState Then
      ' Basic automatically translates strings to Unicode Byte arrays
      ' but doesn't null-terminate, so you must do it yourself
      suLib = sLib &amp; vbNullChar
      ' Pass first byte of array
      errOK = LoadTypeLib(suLib(0), tlb)
      If errOK = 0 Then
         errOK = RegisterTypeLib(tlb, suLib(0), 0)
      End If
      RegTypelib = errOK
   Else
      Dim cTLI As TypeLibInfo
      Dim tGUID As GUID, sCLSID As String
      Dim iMajor As Integer, iMinor As Integer
      Dim lCID As Long

      Set cTLI = TLI.TypeLibInfoFromFile(sLib)
      sCLSID = cTLI.GUID
      iMajor = cTLI.MajorVersion
      iMinor = cTLI.MinorVersion
      lCID = cTLI.lCID
      Set cTLI = Nothing
      
      suLib = sCLSID &amp; vbNullChar
      errOK = CLSIDFromString(suLib(0), tGUID)
      If errOK = 0 Then
         errOK = UnRegisterTypeLib(tGUID, iMajor, iMinor, lCID, SYS_WIN32)
         RegTypelib = errOK
      End If
      
   End If
   
End Function
Public Function UIRegisterTypeLib(ByVal sLib As String, ByVal bState As
 Boolean, ByVal bShowMessage As Boolean) As Boolean
Dim errNo As Long
Dim sPre As String

   errNo = RegTypelib(sLib, bState)
   If bShowMessage Then
      If bState Then
         sPre = "Register Type Library "
      Else
         sPre = "Unregister Type Library "
      End If
      If errNo = 0 Then
         MsgBox sPre &amp; sLib &amp; " succeeded.", vbInformation
      Else
         MsgBox sPre &amp; sLib &amp; " failed: the error returned was " &amp; Hex$(errNo),
          vbCritical
      End If
   End If
   UIRegisterTypeLib = (errNo = 0)
End Function

Public Sub Main()
Dim sCommand As String
Dim iPos As Long
Dim iNextPos As Long
Dim i As Long
Dim sArgs() As String
Dim cArg As Long
Dim bSilent As Boolean
Dim bShowForm As Boolean
Dim sFileName As String
Dim bState As Boolean
Dim fTI As frmTypeLib
   
   sCommand = UCase$(Command)
   If Len(sCommand) &gt; 0 Then
      
      ' Parse arguments:
      iPos = InStr(sCommand, "/")
      Do While iPos &lt;&gt; 0
         iNextPos = InStr(iPos + 1, sCommand, " ")
         cArg = cArg + 1
         ReDim Preserve sArgs(1 To cArg) As String
         If (iNextPos &lt;&gt; 0) Then
            sArgs(cArg) = Mid$(sCommand, iPos, iNextPos - iPos)
            iPos = InStr(iNextPos, sCommand, "/")
         Else
            sArgs(cArg) = Mid$(sCommand, iPos)
            iPos = 0
         End If
      Loop
      If cArg = 0 Or (iNextPos &lt;&gt; 0 And iNextPos &lt; Len(sCommand) - 1) Then
         cArg = cArg + 1
         ReDim Preserve sArgs(1 To cArg) As String
         If (cArg = 1) Then
            sArgs(cArg) = sCommand
         Else
            sArgs(cArg) = Mid$(sCommand, iNextPos + 1)
         End If
      End If
      
      ' Check options:
      bState = True
      For i = 1 To cArg
         Select Case sArgs(i)
         Case "/S"
            bSilent = True
         Case "/U"
            bState = False
         Case "/UI"
            bShowForm = True
         Case Else
            If InStr(sArgs(i), "/") = 0 Then
               sFileName = sArgs(i)
            End If
         End Select
      Next i
      ' Do registration:
      If bShowForm Then
         Set fTI = New frmTypeLib
         fTI.Show
         fTI.Filename = sFileName
         fTI.Register bState
      Else
         If Len(sFileName) = 0 Then
            CommandHelp "No Type Library name specified."
         Else
            UIRegisterTypeLib sFileName, bState, Not (bSilent)
         End If
      End If
      
   Else
      Set fTI = New frmTypeLib
      fTI.Show
   End If
   
End Sub
Private Sub CommandHelp(ByVal sTopMsg)
Dim sMsg As String
   sMsg = sTopMsg &amp; vbCrLf &amp; vbCrLf &amp; "Usage: vbregtlb [/u] [/s] [/ui] tlbname"
    &amp; vbCrLf
   sMsg = sMsg &amp; "/u -" &amp; vbTab &amp; "Unregister Type library" &amp; vbCrLf
   sMsg = sMsg &amp; "/s -" &amp; vbTab &amp; "Silent; display no message boxes" &amp; vbCrLf
   sMsg = sMsg &amp; "/ui -" &amp; vbTab &amp; "Show User Interface"
   MsgBox sMsg, vbExclamation
   
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\code\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">VB Type Library Registration Utility</a>&#160;.&#160;<a href="register_typelib_source_code.html">Register TypeLib Source Code</a>&#160;.&#160;mRegisterTypeLib.bas</p><br /><p class="nav"><a href="..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>