<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmManageTypeLib.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmManageTypeLib.frm" /><link rel="stylesheet" href="..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">VB Type Library Registration Utility</a>&#160;.&#160;<a href="register_typelib_source_code.html">Register TypeLib Source Code</a>&#160;.&#160;frmManageTypeLib.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="register_typelib_source_code.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Register TypeLib Source Code</a> (61K)</p><p /><p class="nav"><a href="vb5_register_typelib_utility.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Register TypeLib Utility</a> (29K)</p><p /><p class="nav"><a href="vb6_register_typelib_utility.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Register TypeLib Utility</a> (26K)</p><br /><br /><img src="..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:2129</p><p class="nav">&#160;&#160;<a href="..\..\..\..\linkto_asp\id=2129&type=zip&title=register_20typelib_20source_20code_2ezip_5ffrmmanagetypelib.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\res\update.png" width="8" height="8" alt="Update" />19 Dec 2002<br /><p class="update">More usable UI</p><p class="update">VB6 Version</p><p class="update">Ability to save all registered TypeLibs as XML file</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\type_libraries\ishellfolder\article.html">IShellFolder Extended Type Library Version 1.2 (ISHF_Ex.Tlb)</a></p><br /><br /><img src="..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\the_site\newsite\article.html"><img src="..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmManageTypeLib.frm</h1><pre>VERSION 5.00
Begin VB.Form frmManageTypeLib 
   BorderStyle     =   3  'Fixed Dialog
   Caption         =   "Manage Type Libraries"
   ClientHeight    =   6480
   ClientLeft      =   5640
   ClientTop       =   3690
   ClientWidth     =   6360
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   6480
   ScaleWidth      =   6360
   ShowInTaskbar   =   0   'False
   Begin VB.CommandButton cmdCopy 
      Caption         =   "&amp;Save as XML"
      Height          =   435
      Left            =   2160
      TabIndex        =   12
      Top             =   6000
      Width           =   1275
   End
   Begin VB.CommandButton cmdDelete 
      Caption         =   "&amp;Delete"
      Height          =   435
      Left            =   3540
      TabIndex        =   11
      Top             =   6000
      Width           =   1275
   End
   Begin VB.Frame fraSep 
      Height          =   75
      Left            =   -840
      TabIndex        =   10
      Top             =   5880
      Width           =   7335
   End
   Begin VB.CommandButton cmdOK 
      Cancel          =   -1  'True
      Caption         =   "Close"
      Height          =   435
      Left            =   5040
      TabIndex        =   9
      Top             =   6000
      Width           =   1275
   End
   Begin VB.TextBox txtInfo 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Index           =   3
      Left            =   60
      Locked          =   -1  'True
      TabIndex        =   7
      Top             =   5100
      Width           =   4695
   End
   Begin VB.TextBox txtInfo 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Index           =   0
      Left            =   60
      Locked          =   -1  'True
      TabIndex        =   3
      Top             =   3180
      Width           =   4695
   End
   Begin VB.TextBox txtInfo 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Index           =   1
      Left            =   60
      Locked          =   -1  'True
      TabIndex        =   2
      Top             =   3780
      Width           =   4695
   End
   Begin VB.TextBox txtInfo 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Index           =   2
      Left            =   60
      Locked          =   -1  'True
      TabIndex        =   1
      Top             =   4440
      Width           =   4695
   End
   Begin VB.ListBox lstTypeLibs 
      Height          =   2790
      Left            =   60
      Sorted          =   -1  'True
      TabIndex        =   0
      Top             =   60
      Width           =   6255
   End
   Begin VB.Label lblInfo 
      Caption         =   "Path:"
      Height          =   255
      Index           =   3
      Left            =   60
      TabIndex        =   8
      Top             =   4860
      Width           =   1095
   End
   Begin VB.Label lblInfo 
      Caption         =   "Name:"
      Height          =   255
      Index           =   0
      Left            =   60
      TabIndex        =   6
      Top             =   2940
      Width           =   495
   End
   Begin VB.Label lblInfo 
      Caption         =   "GUID:"
      Height          =   255
      Index           =   1
      Left            =   60
      TabIndex        =   5
      Top             =   3540
      Width           =   495
   End
   Begin VB.Label lblInfo 
      Caption         =   "Version:"
      Height          =   255
      Index           =   2
      Left            =   60
      TabIndex        =   4
      Top             =   4200
      Width           =   1095
   End
End
Attribute VB_Name = "frmManageTypeLib"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" ( _
    lpvDest As Any, lpvSource As Any, ByVal cbCopy As Long)

Private m_frmParent As Form

Public Property Let ParentForm(ByRef frmThis As Form)
   Set m_frmParent = frmThis
End Property

Private Property Get ObjectFromPtr(ByVal lPtr As Long) As cTypeLibInfo
Dim objT As cTypeLibInfo
   ' Bruce McKinney's code for getting an Object from the
   ' object pointer:
   CopyMemory objT, lPtr, 4
   Set ObjectFromPtr = objT
   CopyMemory objT, 0&amp;, 4
End Property

Public Sub Populate()
Dim iSectCount As Long, iSect As Long, sSections() As String
Dim iVerCount As Long, iVer As Long, sVersions() As String
Dim iExeSectCount As Long, sExeSect() As String
Dim iExeSect As Long
Dim bFoundExeSect As Boolean
Dim sExists As String
Dim cTLI As cTypeLibInfo
Dim i As IShellFolderEx_TLB.IUnknown

   pClearList
   lstTypeLibs.Clear
   lstTypeLibs.Visible = False

   Dim cR As New cRegistry
   cR.ClassKey = HKEY_CLASSES_ROOT
   cR.ValueType = REG_SZ
   cR.SectionKey = "TypeLib"
   ' Get the registered Type Libs:
   If cR.EnumerateSections(sSections(), iSectCount) Then
      For iSect = 1 To iSectCount
         ' Enumerate the versions for each typelib:
         cR.SectionKey = "TypeLib\" &amp; sSections(iSect)
         If cR.EnumerateSections(sVersions(), iVerCount) Then
            For iVer = 1 To iVerCount
               Set cTLI = New cTypeLibInfo
               cTLI.CLSID = sSections(iSect)
               cTLI.Ver = sVersions(iVer)
               cR.SectionKey = "TypeLib\" &amp; sSections(iSect) &amp; "\" &amp;
                sVersions(iVer)
               cTLI.Name = cR.Value
               cR.EnumerateSections sExeSect(), iExeSectCount
               If iExeSectCount &gt; 0 Then
                  bFoundExeSect = False
                  For iExeSect = 1 To iExeSectCount
                     If IsNumeric(sExeSect(iExeSect)) Then
                        cR.SectionKey = cR.SectionKey &amp; "\" &amp;
                         sExeSect(iExeSect) &amp; "\win32"
                        bFoundExeSect = True
                        Exit For
                     End If
                  Next iExeSect
                  If bFoundExeSect Then
                     cTLI.Path = cR.Value
                     If FileExists(cTLI.Path) Then
                        sExists = "Y"
                     Else
                        sExists = "N"
                     End If
                  Else
                     sExists = "N"
                  End If
               Else
                  sExists = "N"
               End If
               cTLI.Exists = (StrComp(sExists, "Y") = 0)
               If Len(cTLI.Name) &gt; 0 Then
                  lstTypeLibs.AddItem cTLI.Name &amp; vbTab &amp; sExists
               Else
                  lstTypeLibs.AddItem cTLI.CLSID &amp; vbTab &amp; sExists
               End If
               lstTypeLibs.ItemData(lstTypeLibs.NewIndex) = ObjPtr(cTLI)
               Set i = cTLI
               i.AddRef
            Next iVer
         End If
      Next iSect
   End If
   
   lstTypeLibs.Visible = True
   
End Sub

Private Sub pDeleteEntry(ByVal lPtr As Long)
Dim cTLI As cTypeLibInfo
   
   Set cTLI = ObjectFromPtr(lPtr)
   Dim cR As New cRegistry
   cR.ClassKey = HKEY_CLASSES_ROOT
   cR.SectionKey = "TypeLib\" &amp; cTLI.CLSID &amp; "\" &amp; cTLI.Ver
   
   On Error Resume Next
   If cR.DeleteKey Then
      If Err.Number = 0 Then
         MsgBox "Successfully deleted the item " &amp; cTLI.Name &amp; ", version " &amp;
          cTLI.Ver, vbInformation
      End If
   End If
   Err.Clear
   On Error GoTo 0
   
End Sub

Private Sub pClearList()
Dim lI As Long
Dim lPtr As Long
Dim i As IShellFolderEx_TLB.IUnknown
Dim cTLI As cTypeLibInfo

   For lI = 0 To lstTypeLibs.ListCount - 1
      lPtr = lstTypeLibs.ItemData(lI)
      If Not (lPtr = 0) Then
         Set cTLI = ObjectFromPtr(lPtr)
         Set i = cTLI
         i.Release
         Set i = Nothing
         Set cTLI = Nothing
      End If
   Next lI

End Sub

Private Sub cmdCopy_Click()
Dim i As Long
Dim lPtr As Long
Dim sXml As String
Dim cTLI As cTypeLibInfo
Dim sFile As String

   VBGetSaveFileName sFile, , , "XML Files (*.XML)|*.XML|All Files (*.*)|*.*",
    , , , "XML", Me.hWnd
   If (sFile &lt;&gt; "") Then

      sXml = "&lt;?xml version=""1.0"" encoding=""UTF-8""?&gt;"
      sXml = sXml &amp; "&lt;TypeLibs&gt;" &amp; vbCrLf
      For i = 0 To lstTypeLibs.ListCount - 1
         lPtr = lstTypeLibs.ItemData(i)
         If Not lPtr = 0 Then
            Set cTLI = ObjectFromPtr(lPtr)
            sXml = sXml &amp; cTLI.ToXml() &amp; vbCrLf
         End If
      Next i
      sXml = sXml &amp; "&lt;/TypeLibs&gt;" &amp; vbCrLf
      
      On Error Resume Next
      ' try
      Kill sFile
      ' catch
      Err.Clear
      
      Dim iFile As Long
      iFile = FreeFile
      ' try
      Open sFile For Binary Access Write Lock Read As #iFile
      If (Err.Number = 0) Then
         Put #iFile, , sXml
      Else
         ' catch
         MsgBox "Could not open '" &amp; sFile &amp; "' for writing.", vbExclamation
      End If
      ' finally
      Close #iFile
   End If
End Sub

Private Sub cmdDelete_Click()
Dim lPtr As Long
Dim lPtrCurrent As Long
Dim lI As Long
Dim cTLI As cTypeLibInfo
Dim bAlso As Boolean
Dim sPath As String
Dim lOrigIndex As Long

   If lstTypeLibs.ListIndex &gt; 0 Then
      lOrigIndex = lstTypeLibs.ListIndex
      lstTypeLibs_Click
      lPtrCurrent = lstTypeLibs.ItemData(lstTypeLibs.ListIndex)
      If Not lPtrCurrent = 0 Then
         If txtInfo(3).ForeColor = &amp;HC0&amp; Then
            ' typelib not on system, just delete the entry:
            pDeleteEntry lPtrCurrent
         Else
            ' check the same file is not being used elsewhere.
            ' if it is, delete the offending entry &amp; then re-register the
            ' typelib, otherwise just unregister the existing type lib:
            sPath = UCase$(txtInfo(3).Text)
            For lI = 0 To lstTypeLibs.ListCount - 1
               lPtr = lstTypeLibs.ItemData(lI)
               If Not (lPtr = lPtrCurrent) Then
                  If Not lPtr = 0 Then
                     Set cTLI = ObjectFromPtr(lPtr)
                     If StrComp(UCase$(cTLI.Path), sPath) = 0 Then
                        bAlso = True
                        Exit For
                     End If
                  End If
               End If
            Next lI
            
            If bAlso Then
               ' Multi use:
               pDeleteEntry lPtrCurrent
               UIRegisterTypeLib txtInfo(3).Text, True, True
            Else
               ' The only use, unregister it:
               UIRegisterTypeLib txtInfo(3).Text, False, True
            End If
         End If
         
         Populate
         
         If lOrigIndex &lt; lstTypeLibs.ListCount Then
            lstTypeLibs.ListIndex = lOrigIndex
         Else
            lstTypeLibs.ListIndex = lstTypeLibs.ListCount
         End If
         
      End If
   End If
End Sub

Private Sub cmdOK_Click()
   Unload Me
End Sub

Private Sub Form_Load()
   Set Me.Icon = m_frmParent.Icon
   Populate
   ReDim lTabPos(0 To 0) As Long
   lTabPos(0) = (lstTypeLibs.width \ Screen.TwipsPerPixelX) - 32
   TabStop lstTypeLibs.hWnd, lTabPos()
   If lstTypeLibs.ListCount &gt; 0 Then
      lstTypeLibs.ListIndex = 0
   End If
End Sub

Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)
   pClearList
End Sub

Private Sub Form_Resize()
Dim i As Long
   On Error Resume Next
   lstTypeLibs.width = Me.ScaleWidth - lstTypeLibs.left * 2
   For i = txtInfo.LBound To txtInfo.UBound
      txtInfo(i).width = lstTypeLibs.width
   Next i
End Sub

Private Sub lstTypeLibs_Click()
Dim lI As Long
Dim lPtr As Long
Dim cTLI As cTypeLibInfo
      
   lI = lstTypeLibs.ListIndex
   If lI &gt; -1 Then
      lPtr = lstTypeLibs.ItemData(lI)
      If Not (lPtr = 0) Then
         Set cTLI = ObjectFromPtr(lPtr)
         txtInfo(0).Text = cTLI.Name
         txtInfo(1).Text = cTLI.CLSID
         txtInfo(2).Text = cTLI.Ver
         txtInfo(3).Text = cTLI.Path
         If Not cTLI.Exists Then
            txtInfo(3).ForeColor = &amp;HC0&amp;
         Else
            txtInfo(3).ForeColor = vbWindowText
         End If
      End If
   End If
   
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\code\libraries\compression\index.html" ><IMG SRC="..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">VB Type Library Registration Utility</a>&#160;.&#160;<a href="register_typelib_source_code.html">Register TypeLib Source Code</a>&#160;.&#160;frmManageTypeLib.frm</p><br /><p class="nav"><a href="..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>