<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: cMRUFiles.cls</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: cMRUFiles.cls" /><link rel="stylesheet" href="..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">Icon Extractor Utility </a>&#160;.&#160;<a href="vb6_icon_extractor_source_code.html">VB6 Icon Extractor Source Code</a>&#160;.&#160;cMRUFiles.cls</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_icon_extractor_source_code.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Icon Extractor Source Code</a> (101K)</p><p class="nav"><a href="vb5_icon_extractor.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Icon Extractor</a> (48K)</p><p /><p class="nav"><a href="vb6_icon_extractor_source_code.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Icon Extractor Source Code</a> (97K)</p><p class="nav"><a href="vb6_icon_extractor.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Icon Extractor</a> (44K)</p><br /><br /><img src="..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:2109</p><p class="nav">&#160;&#160;<a href="..\..\..\..\linkto_asp\id=2109&type=zip&title=vb6_20icon_20extractor_20source_20code_2ezip_5fcmrufiles.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\res\update.png" width="8" height="8" alt="Update" />19 Dec 2002<br /><p class="update">Icons with Alpha channel (32 bit ARGB) now supported.</p><p class="update">Facility to save all icons from the selected executable or DLL at the same time added.</p><p class="update">XP Visual Styles now supported.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\code\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\type_libraries\ishellfolder\article.html">IShellFolder Extended Type Library Version 1.2 (ISHF_Ex.Tlb)</a></p><br /><br /><img src="..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\the_site\newsite\article.html"><img src="..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: cMRUFiles.cls</h1><pre>VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
  Persistable = 0  'NotPersistable
  DataBindingBehavior = 0  'vbNone
  DataSourceBehavior  = 0  'vbNone
  MTSTransactionMode  = 0  'NotAnMTSObject
END
Attribute VB_Name = "cMRUFiles"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit


Private Declare Function GetFullPathName Lib "kernel32" Alias
 "GetFullPathNameA" (ByVal lpFilename As String, ByVal nBufferLength As Long,
 ByVal lpBuffer As String, ByVal lpFilePart As String) As Long
Private Declare Function GetShortPathName Lib "kernel32" Alias
 "GetShortPathNameA" (ByVal lpszLongPath As String, ByVal lpszShortPath As
 String, ByVal cchBuffer As Long) As Long
Private Const MAX_PATH = 260

Private m_sPath() As String
Private m_iCount As Long
Private m_iMaxCount As Long

Public Function Load(cR As cRegistry) As Boolean
   Load = ReadProperties(cR)
End Function
Public Function Save(cR As cRegistry) As Boolean
   WriteProperties cR
End Function

Public Property Get Count() As Long
   Count = m_iCount
End Property

Public Property Get MaxCount() As Long
   MaxCount = m_iMaxCount
End Property
Public Property Let MaxCount(ByVal lMaxCount As Long)
Dim i As Long
   If lMaxCount = m_iMaxCount Then
      Exit Property
   End If
   If lMaxCount &lt; m_iCount Then
      m_iCount = lMaxCount
   End If
   m_iMaxCount = lMaxCount
   ReDim Preserve m_sPath(1 To m_iMaxCount) As String
   
End Property
Private Sub pGetFile(ByVal nIndex As Long, ByRef sPath As String, ByRef sFile
 As String, ByRef sExt As String)
Dim sJunk As String
Dim iPos As Long
Dim i As Long
Dim iExtPos As Long
   sPath = m_sPath(nIndex)
   iPos = InStr(sPath, vbNullChar)
   If iPos &gt; 1 Then
      sPath = left$(sPath, iPos - 1)
   End If
   For i = Len(sPath) To 1 Step -1
      If sExt = "" Then
         If Mid$(sPath, i, 1) = "." Then
            sExt = right$(sPath, i + 1)
            iExtPos = i
         End If
      End If
      If sFile = "" Then
         If Mid$(sPath, i, 1) = "\" Then
            If iExtPos &gt; 0 Then
               sFile = Mid$(sPath, i + 1, iExtPos - i - 1)
            Else
               sFile = Mid$(sPath, i + 1)
            End If
            sPath = left$(sPath, i - 1)
            Exit For
         End If
      End If
   Next i
End Sub
Public Property Get File(ByVal nIndex As Long) As String
Dim sPath As String
Dim sFile As String
Dim sExt As String
Dim iPos As Long
   pGetFile nIndex, sPath, sFile, sExt
   File = sFile
End Property
Public Property Get Folder(ByVal nIndex As Long) As String
Dim sPath As String
Dim sFile As String
Dim sExt As String
Dim iPos As Long
   pGetFile nIndex, sPath, sFile, sExt
   Folder = sPath
End Property
Public Property Get Extension(ByVal nIndex As Long) As String
Dim sPath As String
Dim sFile As String
Dim sExt As String
Dim iPos As Long
   pGetFile nIndex, sPath, sFile, sExt
   Extension = sExt
End Property
Public Property Get Path(ByVal nIndex As Long) As String
   Path = m_sPath(nIndex)
End Property
Public Sub Delete(ByVal nIndex As Long)
Dim i As Long
   If nIndex &gt; 0 And nIndex &lt;= m_iMaxCount Then
      For i = nIndex To m_iMaxCount - 1
         m_sPath(i) = m_sPath(i + 1)
         If i &gt; m_iCount Then
            m_sPath(i) = ""
         End If
      Next i
      m_sPath(m_iMaxCount) = ""
      m_iCount = m_iCount - 1
   End If
End Sub
Private Function ShortPath(ByVal sPath As String) As String
Dim sShortPath As String
Dim iPos As Long
   sShortPath = String$(MAX_PATH * 2 + 1, 0)
   GetShortPathName sPath, sShortPath, MAX_PATH * 2
   iPos = InStr(sShortPath, vbNullChar)
   If iPos &gt; 1 Then
      ShortPath = left$(sShortPath, iPos - 1)
   Else
      ShortPath = sShortPath
   End If
End Function
Public Function ItemIndex(ByVal sPath As String) As Long
Dim sComp As String
Dim sShortPath As String
Dim iPos As Long
Dim i As Long

   sShortPath = ShortPath(sPath)
   ' Have we already got it?
   For i = 1 To m_iCount
      If UCase(ShortPath(m_sPath(i))) = UCase(sShortPath) Then
         ItemIndex = i
         Exit For
      End If
   Next i
   
End Function
Public Sub Add(ByVal sPath As String)
Dim sComp As String
Dim sShortPath As String
Dim iPos As Long
Dim i As Long
Dim lAlready As Long
   
   sShortPath = ShortPath(sPath)
   lAlready = ItemIndex(sPath)
   If lAlready = 0 Then
      ' Add the item:
      For i = m_iMaxCount - 1 To 1 Step -1
         m_sPath(i + 1) = m_sPath(i)
      Next i
   Else
      ' Swap lAlready to position 1:
      For i = lAlready - 1 To 1 Step -1
         m_sPath(i + 1) = m_sPath(i)
      Next i
   End If
   m_sPath(1) = sPath
   If lAlready = 0 Then
      m_iCount = m_iCount + 1
      If m_iCount &gt; m_iMaxCount Then
         m_iCount = m_iMaxCount
      End If
   End If
End Sub

Private Sub Class_Initialize()
   pInit
End Sub
Private Sub pInit()
   MaxCount = 8
   m_iCount = 0
End Sub

Private Function ReadProperties(cR As cRegistry) As Boolean
Dim i As Long
Dim iCount As Long
   With cR
      .ValueKey = "MaxCount"
      .ValueType = REG_DWORD
      .Default = -1
      ReadProperties = (.KeyExists) And (.Value &gt; 0)
      If .Value &lt; 1 Then
         Exit Function
      End If
      MaxCount = .Value
      If m_iMaxCount &gt; 0 Then
         .ValueKey = "Count"
         m_iCount = .Value
         If m_iCount &gt; m_iMaxCount Then
            m_iCount = m_iMaxCount
         End If
         .ValueType = REG_SZ
         For i = 1 To m_iCount
            .ValueKey = "Path" &amp; i
            m_sPath(i) = .Value
         Next i
      End If
   End With
End Function

Private Sub WriteProperties(cR As cRegistry)
Dim i As Long
Dim iCount As Long
   With cR
      .ValueKey = "MaxCount"
      .ValueType = REG_DWORD
      .Value = MaxCount
      .ValueKey = "Count"
      .Value = Count
      .ValueType = REG_SZ
      For i = 1 To Count
         .ValueKey = "Path" &amp; i
         .Value = m_sPath(i)
      Next i
   End With
End Sub

</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\code\libraries\compression\index.html" ><IMG SRC="..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">Icon Extractor Utility </a>&#160;.&#160;<a href="vb6_icon_extractor_source_code.html">VB6 Icon Extractor Source Code</a>&#160;.&#160;cMRUFiles.cls</p><br /><p class="nav"><a href="..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>