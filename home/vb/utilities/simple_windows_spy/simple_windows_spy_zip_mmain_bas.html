<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: mMain.bas</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: mMain.bas" /><link rel="stylesheet" href="..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">Simple Windows Spy Utility</a>&#160;.&#160;<a href="simple_windows_spy.html">Simple Windows Spy</a>&#160;.&#160;mMain.bas</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="simple_windows_spy.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Simple Windows Spy</a> (13K)</p><br /><br /><img src="..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:2510</p><p class="nav">&#160;&#160;<a href="..\..\..\..\linkto_asp\id=2510&type=zip&title=simple_20windows_20spy_2ezip_5fmmain.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\res\update.png" width="8" height="8" alt="Update" />2 Jan 2003<br />First Posted</p><br /><br /><img src="..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><br /><br /><img src="..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\the_site\newsite\article.html"><img src="..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: mMain.bas</h1><pre>Attribute VB_Name = "mMain"
Option Explicit

Private Type CommonControlsEx
    dwSize As Long
    dwICC As Long
End Type
Private Declare Function InitCommonControlsEx Lib "Comctl32.dll" (iccex As
 CommonControlsEx) As Boolean
Private Const ICC_BAR_CLASSES = &amp;H4
Private Const ICC_COOL_CLASSES = &amp;H400
Private Const ICC_USEREX_CLASSES = &amp;H200&amp; '// comboex
Private Const ICC_WIN95_CLASSES = &amp;HFF&amp;

Public Type RECT
   left As Long
   top As Long
   right As Long
   bottom As Long
End Type

Private Type SIZEAPI
   cx As Long
   cy As Long
End Type

Private Enum EDrawTextFormat
   DT_BOTTOM = &amp;H8
   DT_CALCRECT = &amp;H400
   DT_CENTER = &amp;H1
   DT_EXPANDTABS = &amp;H40
   DT_EXTERNALLEADING = &amp;H200
   DT_INTERNAL = &amp;H1000
   DT_LEFT = &amp;H0
   DT_NOCLIP = &amp;H100
   DT_NOPREFIX = &amp;H800
   DT_RIGHT = &amp;H2
   DT_SINGLELINE = &amp;H20
   DT_TABSTOP = &amp;H80
   DT_TOP = &amp;H0
   DT_VCENTER = &amp;H4
   DT_WORDBREAK = &amp;H10
   DT_EDITCONTROL = &amp;H2000&amp;
   DT_PATH_ELLIPSIS = &amp;H4000&amp;
   DT_END_ELLIPSIS = &amp;H8000&amp;
   DT_MODIFYSTRING = &amp;H10000
   DT_RTLREADING = &amp;H20000
   DT_WORD_ELLIPSIS = &amp;H40000
End Enum

Private Declare Function OpenThemeData Lib "uxtheme.dll" _
   (ByVal hWnd As Long, ByVal pszClassList As Long) As Long
Private Declare Function CloseThemeData Lib "uxtheme.dll" _
   (ByVal hTheme As Long) As Long
Private Declare Function DrawThemeBackground Lib "uxtheme.dll" _
   (ByVal hTheme As Long, ByVal lhdc As Long, _
    ByVal iPartId As Long, ByVal iStateId As Long, _
    pRect As RECT, pClipRect As RECT) As Long
Private Declare Function GetThemeBackgroundContentRect Lib "uxtheme.dll" _
   (ByVal hTheme As Long, ByVal hdc As Long, _
    ByVal iPartId As Long, ByVal iStateId As Long, _
    pBoundingRect As RECT, pContentRect As RECT) As Long
Private Declare Function DrawThemeText Lib "uxtheme.dll" _
   (ByVal hTheme As Long, ByVal hdc As Long, ByVal iPartId As Long, _
    ByVal iStateId As Long, ByVal pszText As Long, _
    ByVal iCharCount As Long, ByVal dwTextFlag As Long, _
    ByVal dwTextFlags2 As Long, pRect As RECT) As Long
Private Declare Function DrawThemeIcon Lib "uxtheme.dll" _
   (ByVal hTheme As Long, ByVal hdc As Long, ByVal iPartId As Long, _
    ByVal iStateId As Long, pRect As RECT, _
    ByVal himl As Long, ByVal iImageIndex As Long) As Long
Private Declare Function DrawThemeEdge Lib "uxtheme.dll" _
   (ByVal hTheme As Long, ByVal hdc As Long, ByVal iPartId As Long, _
   ByVal iStateId As Long, pDestRect As RECT, _
   ByVal uEdge As Long, ByVal uFlags As Long, _
   pContentRect As RECT) As Long
Private Declare Function IsThemePartDefined Lib "uxtheme.dll" _
   (ByVal hTheme As Long, ByVal iPartId As Long, ByVal iStateId As Long) As Long
Private Declare Function GetThemePartSize Lib "uxtheme.dll" _
   (ByVal hTheme As Long, ByVal hdc As Long, ByVal iPartId As Long, _
   ByVal iStateId As Long, prc As RECT, eSize As Long, psz As SIZEAPI) As Long
Private Enum THEMESIZE
    TS_MIN = 0             '// minimum size
    TS_TRUE = 1            '// size without stretching
    TS_DRAW = 2             ' // size that theme mgr will use to draw part
End Enum
Private Declare Function GetThemeInt Lib "uxtheme.dll" _
   (ByVal hTheme As Long, ByVal iPartId As Long, _
    ByVal iStateId As Long, ByVal iPropId As Long, _
    piVal As Long) As Long

Private Const PROGRESSCHUNKSIZE = 2411
Private Const PROGRESSSPACESIZE = 2412

Private Type OSVERSIONINFO
   dwOSVersionInfoSize As Long
   dwMajorVersion As Long
   dwMinorVersion As Long
   dwBuildNumber As Long
   dwPlatformId As Long
   lPtrSzCSDVersion As Long
   szCSDVersion As String * 128      '  Maintenance string for PSS usage
End Type

Private Declare Function GetVersionEx Lib "kernel32" Alias "GetVersionExA" _
   (lpVersionInformation As OSVERSIONINFO) As Long
Private Declare Function GetVersion Lib "kernel32" () As Long



'#define TM_PART(val, prefix, name)          prefix##_##name = val,
'    TM_PART(1, BP, PUSHBUTTON)
'#define BEGIN_TM_CLASS_PARTS(name)
'  enum name##PARTS { name##PartFiller0,
'#define BEGIN_TM_PART_STATES(name)
'  enum name##STATES { name##StateFiller0,
' #define BEGIN_TM_PART_STATES(name)
' {L#name L"STATES", TMT_ENUMDEF, TMT_ENUMDEF},
' #define BEGIN_TM_CLASS_PARTS(name)
' {L#name L"PARTS", TMT_ENUMDEF, TMT_ENUMDEF},
    
'    TM_PROP(2411, TMT, PROGRESSCHUNKSIZE, INT)    // size of progress control
 chunks
'    TM_PROP(2412, TMT, PROGRESSSPACESIZE, INT)    // size of progress control
 spaces


Public Sub Draw(ByVal hWnd As Long, ByVal hdc As Long)
   Dim lR As Long
   lR = GetVersion()
   Debug.Print lR And &amp;HFF&amp;, (lR And &amp;HFF00&amp;) \ &amp;H100, (lR And &amp;HFF0000) \
    &amp;H10000, (lR And &amp;H7F000000) / &amp;H1000000
   
   Dim osVer As OSVERSIONINFO
   osVer.dwOSVersionInfoSize = 24 'Len(osVer)
   lR = GetVersionEx(osVer)
   Debug.Print lR, osVer.dwMajorVersion, osVer.dwMinorVersion
   
   'Exit Sub
   
   Dim hTheme As Long
   hTheme = 0
   hTheme = OpenThemeData(hWnd, StrPtr("Button"))
   'hTheme = OpenThemeData(hWnd, StrPtr("Status"))
   'hTheme = OpenThemeData(hWnd, StrPtr("Window"))
   
   Dim iChunkSize As Long, hR As Long
   hR = GetThemeInt(hTheme, 0, 0, PROGRESSCHUNKSIZE, iChunkSize)
   Debug.Print "Chunk Size: ", hR, iChunkSize
   hR = GetThemeInt(hTheme, 0, 0, PROGRESSSPACESIZE, iChunkSize)
   Debug.Print "Chunk Spacing: ", hR, iChunkSize
   
   Dim iPart As Long, iState As Long
'   For iState = 1 To &amp;HFFF&amp;
'      For iPart = 1 To &amp;HFFF&amp;
'         Debug.Assert (IsThemePartDefined(hTheme, iPart, iState) = 0)
'      Next iPart
'   Next iState
   
   '...
   Dim rc As RECT
   For iState = 1 To 6
      For iPart = 1 To 30
         rc.left = (iState - 1) * 96
         rc.top = (iPart - 1) * 32
         rc.bottom = rc.top + 8 '31
         rc.right = rc.left + 8 '96
         DrawMyControl hdc, hTheme, rc, "Test", iPart, iState
      Next iPart
   Next iState
   '...
   If (hTheme) Then
      CloseThemeData hTheme
   End If

End Sub

Private Sub DrawMyControl( _
   ByVal hdc As Long, _
   ByVal hTheme As Long, _
   rc As RECT, _
   ByVal sText As String, _
   ByVal iPart As Long, _
   ByVal iState As Long _
   )
Dim rcContent As RECT
Dim buttonText As String
Dim hR As Long

   If (hTheme) Then
      'Debug.Print iPart, iState, "Defined:", IsThemePartDefined(hTheme, iPart,
       iState)
      hR = DrawThemeBackground(hTheme, hdc, iPart, _
                iState, rc, rc)
      'Debug.Print hR
      '// Always check your result codes.

      'hR = GetThemeBackgroundContentRect(hTheme, _
      '          hdc, iPart, iState, rc, rcContent)
      'Debug.Print hR
      'hR = DrawThemeText(hTheme, hdc, iPart, iState, _
      '          StrPtr(sText), -1, _
      '          DT_CENTER Or DT_VCENTER Or DT_SINGLELINE, _
      '          0, rcContent)
      'Debug.Print hR
    Else
    End If

End Sub

Public Sub DrawStatusBar( _
   ByVal hWnd As Long, _
   ByVal hdc As Long, _
   rc As RECT _
   )
Dim hTheme As Long
   hTheme = OpenThemeData(hWnd, StrPtr("Status"))
   
Dim hR As Long
   ' Background to status bar:
   hR = DrawThemeBackground(hTheme, hdc, 4, 0, rc, rc)
   
   ' Panels:
Dim lSize As Long
   lSize = (rc.right - rc.left - 64 * 3) - 24
   
Dim sz As SIZEAPI
   'hR = GetThemePartSize(hTheme, hdc, 3, 0, rc, TS_MIN, sz)
   'Debug.Print sz.cx, sz.cy

Dim tR As RECT
Dim rcContent As RECT
   LSet tR = rc
   tR.right = lSize
      
   hR = DrawThemeBackground(hTheme, hdc, 1, _
                0, tR, tR)
   hR = GetThemeBackgroundContentRect(hTheme, _
                hdc, 1, 0, tR, rcContent)

   hR = DrawThemeText(hTheme, hdc, 1, 0, _
                StrPtr("Panel 1"), -1, _
                DT_CENTER Or DT_VCENTER Or DT_SINGLELINE, _
                0, rcContent)
   
   Dim i As Long
   Dim iPart As Long
   iPart = 1
   For i = 1 To 3
      If (i = 3) Then
         iPart = 2
      End If
      tR.left = tR.right
      tR.right = tR.left + 64
      hR = DrawThemeBackground(hTheme, hdc, iPart, _
                   0, tR, tR)
      hR = GetThemeBackgroundContentRect(hTheme, _
                hdc, iPart, 0, tR, rcContent)

      hR = DrawThemeText(hTheme, hdc, 1, 0, _
                StrPtr("Panel " &amp; i + 1), -1, _
                DT_CENTER Or DT_VCENTER Or DT_SINGLELINE, _
                0, rcContent)
   
   Next i
      
   tR.left = tR.right
   tR.right = tR.left + 24
   hR = DrawThemeBackground(hTheme, hdc, 3, _
                   0, tR, tR)
   
   If (hTheme) Then
      CloseThemeData hTheme
   End If
   
End Sub


Public Sub Main()
   On Error Resume Next
   ' Call InitCommonControls:
   Dim tIccex As CommonControlsEx
   With tIccex
       .dwSize = LenB(tIccex)
       .dwICC = ICC_BAR_CLASSES
   End With
   'We need to make this call to make sure the common controls are loaded
   InitCommonControlsEx tIccex
   On Error GoTo 0

   frmDraw.Show
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\code\libraries\compression\index.html" ><IMG SRC="..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">Simple Windows Spy Utility</a>&#160;.&#160;<a href="simple_windows_spy.html">Simple Windows Spy</a>&#160;.&#160;mMain.bas</p><br /><p class="nav"><a href="..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>