<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: cSimpleSheetBar.cls</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: cSimpleSheetBar.cls" /><link rel="stylesheet" href="..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">Visual Basic Project Zip Utility</a>&#160;.&#160;<a href="vbpzip_source_code.html">VBPZip Source Code</a>&#160;.&#160;cSimpleSheetBar.cls</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="info-zip_unzip_dll_(renamed_vbuzip10_dll).html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Info-ZIP Unzip DLL (Renamed vbuzip10.dll)</a> (63K)</p><p /><p class="nav"><a href="vbpzip_source_code.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VBPZip Source Code</a> (152K)</p><p class="nav"><a href="vbpzip_vb5_executable.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VBPZip VB5 Executable</a> (69K)</p><p class="nav"><a href="vbpzip_vb6_executable.html"><img src="..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VBPZip VB6 Executable</a> (62K)</p><br /><br /><img src="..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:2150</p><p class="nav">&#160;&#160;<a href="..\..\..\..\linkto_asp\id=2150&type=zip&title=vbpzip_20source_20code_2ezip_5fcsimplesheetbar.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 1 / 1</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 0 / 0</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:3 July 2003</p>
<br /><br /><img src="..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\res\update.png" width="8" height="8" alt="Update" />3 Mar 2003<br /><p class="update">Previous version failed on Windows 2000 because the
	version check in the NoStatusBar component was incorrect. Now fixed.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\code\libraries\compression\zipping_files\article.html">Zipping files using the free Info-Zip Zip DLL (now with encryption support)</a></p><p class="nav"><img src="..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\code\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\code\libraries\compression\introduction_to_the_info-zip_libraries\article.html">Introduction to the freeware Info-ZIP libraries</a></p><br /><br /><img src="..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\the_site\newsite\article.html"><img src="..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: cSimpleSheetBar.cls</h1><pre>VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "cSimpleSheetBar"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit

' rect
Private Type RECT
   Left As Long
   Top As Long
   Right As Long
   Bottom As Long
End Type


' Text functions:
Private Declare Function DrawText Lib "user32" Alias "DrawTextA" (ByVal hdc As
 Long, ByVal lpStr As String, ByVal nCount As Long, lpRect As RECT, ByVal
 wFormat As Long) As Long
    Private Const DT_BOTTOM = &amp;H8
    Private Const DT_CENTER = &amp;H1
    Private Const DT_LEFT = &amp;H0
    Private Const DT_CALCRECT = &amp;H400
    Private Const DT_WORDBREAK = &amp;H10
    Private Const DT_VCENTER = &amp;H4
    Private Const DT_TOP = &amp;H0
    Private Const DT_TABSTOP = &amp;H80
    Private Const DT_SINGLELINE = &amp;H20
    Private Const DT_RIGHT = &amp;H2
    Private Const DT_NOCLIP = &amp;H100
    Private Const DT_INTERNAL = &amp;H1000
    Private Const DT_EXTERNALLEADING = &amp;H200
    Private Const DT_EXPANDTABS = &amp;H40
    Private Const DT_CHARSTREAM = 4
    Private Const DT_NOPREFIX = &amp;H800
    Private Const DT_EDITCONTROL = &amp;H2000&amp;
    Private Const DT_PATH_ELLIPSIS = &amp;H4000&amp;
    Private Const DT_END_ELLIPSIS = &amp;H8000&amp;
    Private Const DT_MODIFYSTRING = &amp;H10000
    Private Const DT_RTLREADING = &amp;H20000
    Private Const DT_WORD_ELLIPSIS = &amp;H40000
Private Declare Function DrawIconEx Lib "user32" (ByVal hdc As Long, ByVal
 xLeft As Long, ByVal yTop As Long, ByVal hIcon As Long, ByVal cxWidth As Long,
 ByVal cyWidth As Long, ByVal istepIfAniCur As Long, ByVal hbrFlickerFreeDraw
 As Long, ByVal diFlags As Long) As Long

Private WithEvents m_cMT As cMouseTrack
Attribute m_cMT.VB_VarHelpID = -1

Private Type tSheet
   sText As String
   hIcon As Long
   
End Type
Private m_tSheet() As tSheet
Private m_iCount As Long

Private m_iButtonHeight As Long

Private m_picThis As PictureBox

Private m_bButtonDown As Boolean
Private m_iButtonDownOn As Long
Private m_iButtonOver As Long

Public Event Click(ByVal iButton As Long)

Public Sub Create(picThis As PictureBox, ByVal lHeight As Long)
   Set m_cMT = New cMouseTrack
   m_cMT.AttachMouseTracking picThis
   Set m_picThis = picThis
   m_iButtonHeight = lHeight
End Sub
Public Sub Destroy()
   If Not m_cMT Is Nothing Then
      m_cMT.DetachMouseTracking
   End If
   Set m_picThis = Nothing
End Sub

Public Sub Add(ByVal sText As String, ByVal hIcon As Long)
   m_iCount = m_iCount + 1
   ReDim Preserve m_tSheet(1 To m_iCount) As tSheet
   With m_tSheet(m_iCount)
      .sText = sText
      .hIcon = hIcon
   End With
End Sub

Private Sub m_cMT_MouseHover(Button As MouseButtonConstants, Shift As
 ShiftConstants, x As Single, y As Single)
   '
   m_cMT.StartMouseTracking
   '
End Sub

Private Sub m_cMT_MouseLeave()
   
   '
   If m_iButtonOver &gt; -1 Then
      pDrawButtonBorder m_iButtonOver, False, False
      m_iButtonOver = -1
   End If
   
End Sub

Public Sub MouseDown(Button As Integer, Shift As Integer, x As Single, y As
 Single)
   m_bButtonDown = True
   m_iButtonDownOn = pInButton(x, y)
   MouseMove Button, Shift, x, y
   If m_iButtonDownOn &gt; 0 Then
      pDrawButtonBorder m_iButtonDownOn, True, True
   End If
End Sub

Public Sub MouseMove(Button As Integer, Shift As Integer, x As Single, y As
 Single)

Dim iButton As Integer
   '
   If Not m_bButtonDown Then
      
      If Not m_cMT.Tracking Then
         m_cMT.StartMouseTracking
      End If
      iButton = pInButton(x, y)
      
      If iButton &lt;&gt; m_iButtonOver Then
         If m_iButtonOver &gt; 0 Then
            pDrawButtonBorder m_iButtonOver, False, False
         End If
         If iButton &gt; 0 Then
            pDrawButtonBorder iButton, True, False
         End If
         m_iButtonOver = iButton
      End If
      
   Else
      
      iButton = pInButton(x, y)
      If m_iButtonDownOn &lt;&gt; iButton Then
         m_iButtonOver = iButton
         If m_iButtonDownOn = m_iButtonOver Then
            pDrawButtonBorder m_iButtonOver, True, True
         Else
            pDrawButtonBorder m_iButtonOver, False, False
         End If
      End If
   End If

End Sub

Public Sub MouseUp(Button As Integer, Shift As Integer, x As Single, y As
 Single)
Dim iButton As Long
   iButton = pInButton(x, y)
   If iButton = m_iButtonDownOn Then
      RaiseEvent Click(iButton)
   Else
      pDrawButtonBorder m_iButtonDownOn, False, False
   End If
   m_iButtonDownOn = -1
   m_iButtonOver = -1
   m_bButtonDown = False
End Sub

Private Sub pDrawButtonBorder(ByVal iButton As Long, ByVal bState As Boolean,
 ByVal bPressed As Boolean)
Dim lL As Long, lT As Long
Dim lR As Long, lB As Long
   lL = 0
   lT = m_iButtonHeight * (iButton - 1)
   lR = m_picThis.ScaleWidth - Screen.TwipsPerPixelX
   lB = lT + m_iButtonHeight - Screen.TwipsPerPixelY
   
   If bState Then
      If bPressed Then
         m_picThis.Line (lL, lT)-(lR, lT), &amp;H0&amp;
         m_picThis.Line -(lR, lB), vb3DHighlight
         m_picThis.Line -(lL, lB), vb3DHighlight
         m_picThis.Line -(lL, lT), &amp;H0&amp;
      Else
         m_picThis.Line (lL, lT)-(lR, lT), vb3DHighlight
         m_picThis.Line -(lR, lB), &amp;H0&amp;
         m_picThis.Line -(lL, lB), &amp;H0&amp;
         m_picThis.Line -(lL, lT), vb3DHighlight
      End If
   Else
      m_picThis.Line (lL, lT)-(lR, lB), m_picThis.BackColor, B
   End If
End Sub

Private Function pInButton(x As Single, y As Single)
Dim i As Long
Dim lT As Long
   pInButton = -1
   For i = 1 To m_iCount
      If x &gt;= 0 And x &lt;= m_picThis.ScaleWidth Then
         If y &gt;= lT And y &lt; lT + m_iButtonHeight Then
            pInButton = i
            Exit Function
         Else
            lT = lT + m_iButtonHeight
         End If
      End If
   Next i
End Function


Public Sub Paint()
Dim iButton As Long
Dim tR As RECT
Dim lhDC As Long
   lhDC = m_picThis.hdc
   For iButton = 1 To m_iCount
      tR.Left = 0
      tR.Top = (m_iButtonHeight * (iButton - 1)) \ Screen.TwipsPerPixelX
      tR.Right = (m_picThis.ScaleWidth \ Screen.TwipsPerPixelX) - 1
      tR.Bottom = tR.Top + (m_iButtonHeight \ Screen.TwipsPerPixelY) - 1
      DrawIconEx lhDC, tR.Left + (tR.Right - tR.Left - 32) \ 2, tR.Top + 2,
       m_tSheet(iButton).hIcon, 32, 32, 0, 0, &amp;H3&amp;
      tR.Top = tR.Top + 26
      DrawText lhDC, m_tSheet(iButton).sText, -1, tR, DT_CENTER Or DT_VCENTER
       Or DT_SINGLELINE Or DT_END_ELLIPSIS
   Next iButton
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\code\libraries\compression\index.html" ><IMG SRC="..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\index.html"><img width="125" height="25" src="..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\index.html">VB</a>&#160;.&#160;<a href="..\index.html">Utilities</a>&#160;.&#160;<a href="article.html">Visual Basic Project Zip Utility</a>&#160;.&#160;<a href="vbpzip_source_code.html">VBPZip Source Code</a>&#160;.&#160;cSimpleSheetBar.cls</p><br /><p class="nav"><a href="..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>