<html lang="en" >
<head>

<title>vbAccelerator - Totalistic Cellular Automata</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="
Continuing this short series on the use of cellular automata for creation of algorithmic
images, this sample demonstrates using the Totalistic form.  A
Totalistic cellular automata differs from other the other forms of the algorithm by 
summing the contribution from surrounding cells, and using modular arithmetic to
provide the result.
" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">Algorithmic Images</a>&#160;.&#160;Totalistic Cellular Automata</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:13013</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=13013&type=article&title=totalistic_20cellular_20automata.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />23 Oct 2003<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\dib_sections\256_colour_dibsection\article.html">256 Colour DIBSections </a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Totalistic Cellular Automata</h1><p class="splash">Create unique, continually varying tiled images</p><img src="island.png" width="252" height="253" alt="Example Generated Image" /><p /><p>
Continuing this short series on the use of cellular automata for creation of algorithmic
images, this sample demonstrates using the <span class="i">Totalistic</span> form.  A
Totalistic cellular automata differs from other the other forms of the algorithm by 
summing the contribution from surrounding cells, and using modular arithmetic to
provide the result.
</p><h2>About The Totalistic Cellular Automata Algorithm</h2><p>
As described in the article <a href="..\..\..\..\..\..\article_asp\id=12768.html">Crystal Model Cellular Automata</a>
article, a cellular automata is essentially a grid of cells whose state varies with each step
through the automation.  In this case, the rule that is applied to modify the state between
steps is as follows:
</p><ol><li>Average the state of each of the nine neighbouring cells by summing them and then
dividing by 9.</li><li>Add a rate constant between 0 and 1 to the result.</li><li>Discard the whole portion of the result, and then multiply by the total number of states.
</li></ol><p>
As ever, this technique sounds rather simple and it is hard to imagine it producing
particularly complex results.  And in practice, if you start with a grid where all of
the cells have the same state then that is true. However, if the initial state is seeded
with random values then complex and organised results emerge rapidly.   This is associated
with the "magic" step of discarding the whole portion of the result, which
introduces considerable complexity into the mathematics.
</p><p>
One of the effects of taking only the fractional portion of the result is that if the
rate factor is around 0.5 then many cells will undergo a radical change in 
state with each step of the automata.
This differs from the more natural evolution of states which occur in the
<a href="..\hodge_podge\article.html">Catalytic</a> and <a href="..\cellular_automata\article.html">Crystal</a>
model automatas presented elsewhere in the article, and can result in flashing, 
depending upon how the colours in the palette are arranged.
The technique can therefore be better suited for creation of static environments 
rather than evolving or animated ones.
</p><h2>Implementation</h2><p>
As with the other cellular automata samples, the implementation uses a 
<a href="..\..\dib_sections\256_colour_dibsection\article.html">256 Colour DIB Section</a> to store the result.  This is
used both for manipulating the state and rendering at the same time, which means 
animation can be performed in realtime on many systems.
</p><p>
The main part of the implementation makes the DIB Section memory look like a VB
array, then loops through each cell, performing the algorithm given above.
The code for this is as follows:
</p><pre>
Public Sub Step()
Dim x As Long
Dim y As Long
Dim tSALast As SAFEARRAY2D
Dim tSA As SAFEARRAY2D
Dim bDibLast() As Byte
Dim bDibNext() As Byte
Dim lTot As Long
Dim iX As Long
Dim iY As Long
Dim i As Long
Dim j As Long
Dim lMid As Long

   With tSALast
       .cbElements = 1
       .cDims = 2
       .Bounds(0).lLbound = 0
       .Bounds(0).cElements = m_cDibLast.Height
       .Bounds(1).lLbound = 0
       .Bounds(1).cElements = m_cDibLast.BytesPerScanLine()
       .pvData = m_cDibLast.DIBSectionBitsPtr
   End With
   CopyMemory ByVal VarPtrArray(bDibLast()), VarPtr(tSALast), 4

   With tSA
       .cbElements = 1
       .cDims = 2
       .Bounds(0).lLbound = 0
       .Bounds(0).cElements = m_cDib.Height
       .Bounds(1).lLbound = 0
       .Bounds(1).cElements = m_cDib.BytesPerScanLine()
       .pvData = m_cDib.DIBSectionBitsPtr
   End With
   CopyMemory ByVal VarPtrArray(bDibNext()), VarPtr(tSA), 4

   ' Run the cellular automata step:
   lMid = m_lStates \ 2
   For x = 0 To m_cDib.Width - 1
      For y = 0 To m_cDib.Height - 1
               
         lTot = 0
                  
         Dim fTot As Double
         For iX = -1 To 1
            i = x + iX
            If (i &lt; 0) Then i = m_cDib.Width - 1
            If (i &gt;= m_cDib.Width) Then i = 0
            For iY = -1 To 1
               j = y + iY
               If (j &lt; 0) Then j = m_cDib.Height - 1
               If (j &gt;= m_cDib.Height) Then j = 0
               fTot = fTot + bDibLast(i, j)
            Next iY
         Next iX
         
         fTot = fTot / (9# * m_lStates)
         fTot = fTot + m_fRate
         fTot = fTot - Int(fTot)
         
         bDibNext(i, j) = fTot * m_lStates
         
      Next y
   Next x
   
   ' Copy New -&gt; Old
   m_cDib.PaintPicture m_cDibLast.hdc

   ' Clear the temporary array descriptor
   CopyMemory ByVal VarPtrArray(bDibNext), 0&amp;, 4
   CopyMemory ByVal VarPtrArray(bDibLast), 0&amp;, 4

End Sub
</pre><p>
To make the output look interesting, each of the states is assigned a colour from
a gradient palette.  The palette is arranged so that there is a linear gradient
from a dark colour to a light colour and back again over the 256 states:
</p><pre>
Public Property Let States(ByVal lStates As Long)
   
   m_lStates = lStates
   ReDim lColor(0 To m_lStates - 1) As Long
   
   Dim i As Long, j As Long
   Dim rS As Long, gS As Long, bS As Long
   Dim rE As Long, gE As Long, bE As Long
   
   ' Get the RGB components of the dark and light colours:
   rS = m_lColorDark And &amp;HFF&amp;
   gS = (m_lColorDark And &amp;HFF00&amp;) \ &amp;H100&amp;
   bS = (m_lColorDark And &amp;HFF0000) \ &amp;H10000
   rE = m_lColorLight And &amp;HFF&amp;
   gE = (m_lColorLight And &amp;HFF00&amp;) \ &amp;H100&amp;
   bE = (m_lColorLight And &amp;HFF0000) \ &amp;H10000
   
   ' Generate the palette:
   Dim lMid As Long
   lMid = States \ 2
   
   For i = 0 To lMid
      lColor(i) = RGB( _
         rS + (i * (rE - rS)) \ lMid, _
         gS + (i * (gE - gS)) \ lMid, _
         bS + (i * (bE - bS)) \ lMid _
         )
   Next i
   j = i
   For i = lMid + 1 To m_lStates - 1
      lColor(i) = lColor(j)
      j = j - 1
   Next i
   
   ' Set this palette into the DIB Sections:
   m_cDib.SetPalette lColor
   m_cDibLast.SetPalette lColor
   
End Property
</pre><h2>Sample Output</h2><p>
Some images which were generated using this technique are displayed below.  These
effects were generated by varying the rate factor:
</p><img src="totalistic1.png" width="183" height="153" alt="Totalistic Automata sample 1" /><img src="totalistic2.png" width="183" height="153" alt="Totalistic Automata sample 2" /><br /><img src="totalistic3.png" width="183" height="153" alt="Totalistic Automata sample 3" /><img src="totalistic4.png" width="183" height="153" alt="Totalistic Automata sample 4" /><br /><img src="totalistic5.png" width="183" height="153" alt="Totalistic Automata sample 5" /><img src="totalistic6.png" width="183" height="153" alt="Totalistic Automata sample 6" /><h2>Conclusion</h2><p>
This article has demonstrated how to implement a simple Totalistic Cellular Automata
and provided sample code to play with.
</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">Algorithmic Images</a>&#160;.&#160;Totalistic Cellular Automata</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 2 November 2003</p></td><td></td></tr></table>
</body></html>