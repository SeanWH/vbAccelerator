<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: mDIBSectEffects.bas</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: mDIBSectEffects.bas" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">DIB Sections</a>&#160;.&#160;<a href="article.html">True Colour DIBSection</a>&#160;.&#160;<a href="vb6_dibsection_demonstration.html">VB6 DIBSection Demonstration</a>&#160;.&#160;mDIBSectEffects.bas</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_dibsection_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 DIBSection Demonstration</a> (110K)</p><p /><p class="nav"><a href="vb6_dibsection_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 DIBSection Demonstration</a> (106K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:3085</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3085&type=zip&title=vb6_20dibsection_20demonstration_2ezip_5fmdibsecteffects.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />13 Jan 2003<br /><p class="update">Cleaned up the sample and added a VB6 version, plus added a
<i>SavePicture</i> method to natively save to a bitmap.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\alpha_dibsection\article.html">Alpha DIBSections</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\256_colour_dibsection\article.html">256 Colour DIBSections </a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: mDIBSectEffects.bas</h1><pre>Attribute VB_Name = "mDIBSectEffects"
Option Explicit

Public Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" ( _
    lpvDest As Any, lpvSource As Any, ByVal cbCopy As Long)

Public Type SAFEARRAYBOUND
    cElements As Long
    lLbound As Long
End Type
Public Type SAFEARRAY2D
    cDims As Integer
    fFeatures As Integer
    cbElements As Long
    cLocks As Long
    pvData As Long
    Bounds(0 To 1) As SAFEARRAYBOUND
End Type
Public Declare Function VarPtrArray Lib "msvbvm60.dll" Alias "VarPtr" (Ptr() As
 Any) As Long


Public Sub BlowApart(ByRef cDibPic As cDIBSection, ByRef cDibDisp As
 cDIBSection, ByVal lAmount As Long)
Dim tSAPic As SAFEARRAY2D
Dim tSADisp As SAFEARRAY2D
Dim bPic() As Byte
Dim bDisp() As Byte
Dim x As Long, y As Long
Dim xC As Long, yC As Long
Dim xNew As Long, yNew As Long
Dim xEnd As Long, yEnd As Long
Dim bFinish As Boolean
    
    ' Get the bits in the from DIB section:
    With tSAPic
        .cbElements = 1
        .cDims = 2
        .Bounds(0).lLbound = 0
        .Bounds(0).cElements = cDibPic.Height
        .Bounds(1).lLbound = 0
        .Bounds(1).cElements = cDibPic.BytesPerScanLine()
        .pvData = cDibPic.DIBSectionBitsPtr
    End With
    CopyMemory ByVal VarPtrArray(bPic()), VarPtr(tSAPic), 4

    With tSADisp
        .cbElements = 1
        .cDims = 2
        .Bounds(0).lLbound = 0
        .Bounds(0).cElements = cDibDisp.Height
        .Bounds(1).lLbound = 0
        .Bounds(1).cElements = cDibDisp.BytesPerScanLine()
        .pvData = cDibDisp.DIBSectionBitsPtr
    End With
    CopyMemory ByVal VarPtrArray(bDisp()), VarPtr(tSADisp), 4

    ' Copy the display picture to the dib:
    cDibPic.LoadPictureBlt cDibDisp.hdc

    xEnd = (cDibPic.Width - 1) * 3
    yEnd = cDibPic.Height - 1
    xC = xEnd \ 2
    yC = yEnd \ 2
    
    For y = 0 To yEnd
        For x = 0 To xEnd Step 3
            If (bPic(x, y) &lt;&gt; 0) Then
                bFinish = False
               xNew = x + (lAmount \ 2 - (Rnd * lAmount)) * 3
               If (xNew &gt; xEnd) Then
                   bFinish = True
                ElseIf (xNew &lt; 0) Then
                   bFinish = True
                End If
               yNew = y + (lAmount \ 2 - Rnd * lAmount)
               If (yNew &lt; 0) Then
                   bFinish = True
                ElseIf (yNew &gt; yEnd) Then
                   bFinish = True
               End If
               
                If Not (bFinish) Then
                    bDisp(xNew, yNew) = bPic(x, y)
                    bDisp(xNew + 1, yNew) = bPic(x + 1, y)
                    bDisp(xNew + 2, yNew) = bPic(x + 2, y)
                    
                    bPic(xNew, yNew) = bPic(x, y)
                    bPic(xNew + 1, yNew) = bPic(x + 1, y)
                    bPic(xNew + 2, yNew) = bPic(x + 2, y)
                End If
            End If
        Next x
    Next y
    
    ' Clear the temporary array descriptor
    ' (This does not appear to be necessary, but
    ' for safety do it anyway)
    CopyMemory ByVal VarPtrArray(bPic), 0&amp;, 4
    CopyMemory ByVal VarPtrArray(bDisp), 0&amp;, 4


End Sub
Public Sub DoStatic(ByRef cDibPic As cDIBSection, ByRef cDibDisp As
 cDIBSection, ByVal lAmount As Long, ByVal lOffset As Long)
Dim tSAPic As SAFEARRAY2D
Dim tSADisp As SAFEARRAY2D
Dim bPic() As Byte
Dim bDisp() As Byte
Dim x As Long, y As Long
Dim lRnd As Long
Dim xEnd As Long
Dim lR As Long, lG As Long, lB As Long
    
    ' Get the bits in the from DIB section:
    With tSAPic
        .cbElements = 1
        .cDims = 2
        .Bounds(0).lLbound = 0
        .Bounds(0).cElements = cDibPic.Height
        .Bounds(1).lLbound = 0
        .Bounds(1).cElements = cDibPic.BytesPerScanLine()
        .pvData = cDibPic.DIBSectionBitsPtr
    End With
    CopyMemory ByVal VarPtrArray(bPic()), VarPtr(tSAPic), 4

    With tSADisp
        .cbElements = 1
        .cDims = 2
        .Bounds(0).lLbound = 0
        .Bounds(0).cElements = cDibDisp.Height
        .Bounds(1).lLbound = 0
        .Bounds(1).cElements = cDibDisp.BytesPerScanLine()
        .pvData = cDibDisp.DIBSectionBitsPtr
    End With
    CopyMemory ByVal VarPtrArray(bDisp()), VarPtr(tSADisp), 4

    xEnd = (cDibPic.Width - 1) * 3
    For y = 0 To cDibPic.Height - 1
        For x = 0 To xEnd Step 3
            'If (bPic(x, y) &lt;&gt; 0) Or (bPic(x + 1, y) &lt;&gt; 0) Or (bPic(x + 2, y)
             &lt;&gt; 0) Then
                lRnd = Rnd * (lAmount - lOffset)
                lB = (lRnd + lOffset) * bPic(x, y) \ 255
                lG = (lRnd + lOffset) * bPic(x + 1, y) \ 255
                lR = (lRnd + lOffset) * bPic(x + 2, y) \ 255
                bDisp(x, y) = lB
                bDisp(x + 1, y) = lG
                bDisp(x + 2, y) = lR
            'End If
        Next x
    Next y

    ' Clear the temporary array descriptor
    ' (This does not appear to be necessary, but
    ' for safety do it anyway)
    CopyMemory ByVal VarPtrArray(bPic), 0&amp;, 4
    CopyMemory ByVal VarPtrArray(bDisp), 0&amp;, 4

End Sub
Public Sub DoFade(ByRef cDibPic As cDIBSection, ByRef cDibDisp As cDIBSection,
 ByVal lAmount As Long)
Dim tSAPic As SAFEARRAY2D
Dim tSADisp As SAFEARRAY2D
Dim bPic() As Byte
Dim bDisp() As Byte
Dim x As Long, y As Long
Dim lRnd As Long
Dim xEnd As Long
Dim lR As Long, lG As Long, lB As Long
    
    ' Get the bits in the from DIB section:
    With tSAPic
        .cbElements = 1
        .cDims = 2
        .Bounds(0).lLbound = 0
        .Bounds(0).cElements = cDibPic.Height
        .Bounds(1).lLbound = 0
        .Bounds(1).cElements = cDibPic.BytesPerScanLine()
        .pvData = cDibPic.DIBSectionBitsPtr
    End With
    CopyMemory ByVal VarPtrArray(bPic()), VarPtr(tSAPic), 4

    With tSADisp
        .cbElements = 1
        .cDims = 2
        .Bounds(0).lLbound = 0
        .Bounds(0).cElements = cDibDisp.Height
        .Bounds(1).lLbound = 0
        .Bounds(1).cElements = cDibDisp.BytesPerScanLine()
        .pvData = cDibDisp.DIBSectionBitsPtr
    End With
    CopyMemory ByVal VarPtrArray(bDisp()), VarPtr(tSADisp), 4

    xEnd = (cDibPic.Width - 1) * 3
    For y = 0 To cDibPic.Height - 1
        For x = 0 To xEnd Step 3
            lB = lAmount * bPic(x, y) \ 255
            lG = lAmount * bPic(x + 1, y) \ 255
            lR = lAmount * bPic(x + 2, y) \ 255
            bDisp(x, y) = lB
            bDisp(x + 1, y) = lG
            bDisp(x + 2, y) = lR
        Next x
    Next y

    ' Clear the temporary array descriptor
    ' (This does not appear to be necessary, but
    ' for safety do it anyway)
    CopyMemory ByVal VarPtrArray(bPic), 0&amp;, 4
    CopyMemory ByVal VarPtrArray(bDisp), 0&amp;, 4

End Sub


</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">DIB Sections</a>&#160;.&#160;<a href="article.html">True Colour DIBSection</a>&#160;.&#160;<a href="vb6_dibsection_demonstration.html">VB6 DIBSection Demonstration</a>&#160;.&#160;mDIBSectEffects.bas</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>