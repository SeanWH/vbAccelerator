<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmDibSection.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmDibSection.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">DIB Sections</a>&#160;.&#160;<a href="article.html">True Colour DIBSection</a>&#160;.&#160;<a href="vb6_dibsection_demonstration.html">VB6 DIBSection Demonstration</a>&#160;.&#160;frmDibSection.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_dibsection_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 DIBSection Demonstration</a> (110K)</p><p /><p class="nav"><a href="vb6_dibsection_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 DIBSection Demonstration</a> (106K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:3085</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3085&type=zip&title=vb6_20dibsection_20demonstration_2ezip_5ffrmdibsection.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />13 Jan 2003<br /><p class="update">Cleaned up the sample and added a VB6 version, plus added a
<i>SavePicture</i> method to natively save to a bitmap.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\alpha_dibsection\article.html">Alpha DIBSections</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\256_colour_dibsection\article.html">256 Colour DIBSections </a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmDibSection.frm</h1><pre>VERSION 5.00
Begin VB.Form frmDIBSection 
   Caption         =   "cDIBSection Tester"
   ClientHeight    =   7065
   ClientLeft      =   3630
   ClientTop       =   2010
   ClientWidth     =   7395
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmDibSection.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   7065
   ScaleWidth      =   7395
   Begin VB.CommandButton cmdSave 
      Caption         =   "&amp;Save"
      Enabled         =   0   'False
      Height          =   435
      Left            =   180
      TabIndex        =   11
      Top             =   5040
      Width           =   1215
   End
   Begin VB.CheckBox chkUseDrawDIB 
      Caption         =   "Use &amp;Draw DIB"
      Height          =   735
      Left            =   180
      TabIndex        =   10
      Top             =   4260
      Width           =   1275
   End
   Begin VB.OptionButton optSize 
      Caption         =   "512 x 512"
      Height          =   195
      Index           =   1
      Left            =   180
      TabIndex        =   9
      Top             =   4020
      Width           =   1155
   End
   Begin VB.OptionButton optSize 
      Caption         =   "256 x 256"
      Height          =   195
      Index           =   0
      Left            =   180
      TabIndex        =   8
      Top             =   3780
      Value           =   -1  'True
      Width           =   1155
   End
   Begin VB.CommandButton cmdFade 
      Caption         =   "Fade in and ou&amp;t"
      Height          =   675
      Left            =   180
      TabIndex        =   7
      Top             =   3060
      Width           =   1215
   End
   Begin VB.CommandButton cmdEmboss 
      Caption         =   "&amp;Emboss"
      Height          =   375
      Left            =   180
      TabIndex        =   6
      Top             =   5760
      Width           =   1215
   End
   Begin VB.CommandButton cmdStaticFade 
      Caption         =   "&amp;Fade in and out with static"
      Height          =   675
      Left            =   180
      TabIndex        =   4
      Top             =   2340
      Width           =   1215
   End
   Begin VB.CommandButton cmdResample 
      Caption         =   "Resam&amp;ple"
      Enabled         =   0   'False
      Height          =   375
      Left            =   180
      TabIndex        =   3
      Top             =   1740
      Width           =   1215
   End
   Begin VB.CommandButton cmdAudrey 
      Caption         =   "&amp;Load Audrey"
      Height          =   375
      Left            =   180
      TabIndex        =   2
      Top             =   1320
      Width           =   1215
   End
   Begin VB.CommandButton cmdShowStatic 
      Caption         =   "Show &amp;Static"
      Enabled         =   0   'False
      Height          =   375
      Left            =   120
      TabIndex        =   1
      Top             =   540
      Width           =   1275
   End
   Begin VB.CommandButton cmdRandomDib 
      Caption         =   "&amp;Random DIB"
      Height          =   375
      Left            =   120
      TabIndex        =   0
      Top             =   120
      Width           =   1275
   End
   Begin VB.Label Label1 
      Caption         =   "fps"
      Height          =   195
      Left            =   180
      TabIndex        =   5
      Top             =   6360
      Width           =   1515
   End
End
Attribute VB_Name = "frmDIBSection"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private m_cDIB As New cDIBSection
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
Private Declare Function timeGetTime Lib "winmm.dll" () As Long

Private Sub chkUseDrawDIB_Click()
   m_cDIB.UseDrawDib = (chkUseDrawDIB.Value = Checked)
End Sub

Private Sub cmdFade_Click()
Dim cDibDisp As cDIBSection
Dim cDibPic As cDIBSection
Dim cDC As cMemDC
Dim sPic As New StdPicture
Dim lAmount As Long
Dim lTIme As Long
Dim lFrames As Long
Dim lL As Long
Dim lDir As Long
Dim sFile As String
Dim bUseMemDC As Boolean
        
   lL = (cmdRandomDib.Left + cmdRandomDib.Width) \ Screen.TwipsPerPixelX + 16
    
   If (cmdFade.Caption &lt;&gt; "Fade in and ou&amp;t") Then
      cmdFade.Caption = "Fade in and ou&amp;t"
   Else
      cmdFade.Caption = "Stop"
      If (optSize(0).Value) Then
         sFile = App.Path &amp; "\vbaccel.gif"
      Else
         sFile = App.Path &amp; "\vbaccel2.jpg"
      End If
      Set sPic = LoadPicture(sFile)
      Set cDibPic = New cDIBSection
      Set cDibDisp = New cDIBSection
      cDibPic.CreateFromPicture sPic
      cDibDisp.Create cDibPic.Width, cDibPic.Height
        
      lAmount = 255: lDir = -4
      Do While cmdFade.Caption = "Stop"
        
         If (timeGetTime - lTIme) &gt; 1000 Then
             Label1.Caption = cDibPic.Width &amp; "x" &amp; cDibPic.Height &amp; ": " &amp;
              lFrames &amp; "/second"
             lFrames = 0
             lTIme = timeGetTime
         Else
             lFrames = lFrames + 1
         End If
                  
         DoFade cDibPic, cDibDisp, lAmount
         
         cDibDisp.PaintPicture Me.hdc, lL, 8

         lAmount = lAmount + lDir
         If (lAmount &lt; 0) Then
            lDir = 4
            lAmount = 3
         ElseIf (lAmount = 255) Then
            lDir = -4
            lAmount = 255 - 4
         End If
         DoEvents
      Loop
      
   End If

End Sub

Private Sub cmdSave_Click()
Dim sFile As String
   sFile = App.Path &amp; "\testsave.bmp"
   If m_cDIB.SavePicture(sFile) Then
      MsgBox "Saved to " &amp; sFile, vbInformation
   End If
End Sub

Private Sub cmdRandomDib_Click()
Dim lL As Long
    m_cDIB.Create 256, 256
    lL = (cmdRandomDib.Left + cmdRandomDib.Width) \ Screen.TwipsPerPixelX + 16
    m_cDIB.PaintPicture Me.hdc, lL, 8
    m_cDIB.RandomiseBits 'True
    m_cDIB.PaintPicture Me.hdc, lL, m_cDIB.Height + 10
    cmdShowStatic.Enabled = True
    cmdResample.Enabled = True
    cmdSave.Enabled = True
End Sub

Private Sub cmdShowStatic_Click()
Dim lL As Long
   lL = (cmdRandomDib.Left + cmdRandomDib.Width) \ Screen.TwipsPerPixelX + 16
   If (cmdShowStatic.Caption = "Show &amp;Static") Then
      Me.Cls
      cmdShowStatic.Caption = "Stop &amp;Static"
   Else
      cmdShowStatic.Caption = "Show &amp;Static"
   End If
   Do While cmdShowStatic.Caption = "Stop &amp;Static"
      m_cDIB.RandomiseBits True
      m_cDIB.PaintPicture Me.hdc, lL, 8
      DoEvents
   Loop
End Sub

Private Sub cmdAudrey_Click()
Dim sPic As StdPicture
Dim lL As Long
   Me.Cls
   lL = (cmdRandomDib.Left + cmdRandomDib.Width) \ Screen.TwipsPerPixelX + 16
   Set sPic = LoadPicture(App.Path &amp; "\audrey.jpg")
   m_cDIB.CreateFromPicture sPic
   m_cDIB.PaintPicture Me.hdc, lL, 8
   cmdResample.Enabled = True
   cmdShowStatic.Enabled = True
   cmdSave.Enabled = True
End Sub

Private Sub cmdResample_Click()
Dim lL As Long
Dim cDib2 As cDIBSection
    lL = (cmdRandomDib.Left + cmdRandomDib.Width) \ Screen.TwipsPerPixelX + 16
    Set cDib2 = m_cDIB.Resample(m_cDIB.Height * 1.5, m_cDIB.Width * 1.5)
    Me.Cls
    m_cDIB.Create cDib2.Width, cDib2.Height
    cDib2.PaintPicture m_cDIB.hdc
    m_cDIB.PaintPicture Me.hdc, lL, 8
    
End Sub

Private Sub cmdStaticFade_Click()
Dim cDibPic As cDIBSection
Dim cDibDisp As cDIBSection
Dim cDC As cMemDC
Dim lAmount As Long, lAmount2 As Long
Dim lOffset As Long
Dim lRndAmount As Long
Dim lL As Long
Dim sPic As StdPicture
Dim lTIme As Long
Dim lFrames As Long
Dim sFile As String
Dim bUseMemDC As Boolean

    lL = (cmdRandomDib.Left + cmdRandomDib.Width) \ Screen.TwipsPerPixelX + 16
    
    If (cmdStaticFade.Caption &lt;&gt; "&amp;Fade in and out with static") Then
        cmdStaticFade.Caption = "&amp;Fade in and out with static"
    Else
       Me.Cls
      cmdStaticFade.Caption = "Stop"
      If (optSize(0).Value) Then
         sFile = App.Path &amp; "\vbaccel.gif"
      Else
         sFile = App.Path &amp; "\vbaccel2.jpg"
      End If
      Set sPic = LoadPicture(sFile)
      Set cDibPic = New cDIBSection
      Set cDibDisp = New cDIBSection
      cDibPic.CreateFromPicture sPic
      cDibDisp.Create cDibPic.Width, cDibPic.Height
      
    End If
    
    lAmount2 = 255
    Do While cmdStaticFade.Caption = "Stop"
        If (timeGetTime - lTIme) &gt; 1000 Then
            Label1.Caption = cDibPic.Width &amp; "x" &amp; cDibPic.Height &amp; ": " &amp;
             lFrames &amp; "/second"
            lFrames = 0
            lTIme = timeGetTime
        Else
            lFrames = lFrames + 1
        End If
        If (lAmount &lt; 251) Then
            lAmount = lAmount + 4
            DoStatic cDibPic, cDibDisp, lAmount, lOffset
        Else
            lAmount = 255
            If (lOffset &lt; 251) Then
                lOffset = lOffset + 4
                DoStatic cDibPic, cDibDisp, lAmount, lOffset
            Else
                lOffset = 255
                If (lRndAmount &lt; cDibPic.Height \ 6) Then
                    lRndAmount = lRndAmount + 1
                    BlowApart cDibPic, cDibDisp, lRndAmount
                Else
                    If (lAmount2 &gt; 16) Then
                        lAmount2 = lAmount2 - 8
                        DoStatic cDibPic, cDibDisp, lAmount2, 0
                    Else
                        ' start again:
                        lAmount = 0: lOffset = 0: lRndAmount = 0: lAmount2 = 255
                        cDibPic.CreateFromPicture sPic
                    End If
                End If
            End If
        End If
        
      If (bUseMemDC) Then
         cDC.LoadPictureBlt cDibDisp.hdc
         cDC.PaintPicture Me.hdc, lL, 8
      Else
         cDibDisp.PaintPicture Me.hdc, lL, 8
      End If
      DoEvents
   Loop
End Sub

Private Sub cmdEmboss_Click()
Dim sPic As StdPicture
Dim cBuff As New cDIBSection
Dim cIP As New cImageProcessDIB
Dim lL As Long

   Me.Cls
    lL = (cmdRandomDib.Left + cmdRandomDib.Width) \ Screen.TwipsPerPixelX + 16

    Set sPic = LoadPicture(App.Path &amp; "\vbaccel.gif")
    m_cDIB.CreateFromPicture sPic
    cBuff.Create m_cDIB.Width, m_cDIB.Height
    
    cIP.FilterType = eEmboss
    cIP.ProcessImage m_cDIB, cBuff
    m_cDIB.PaintPicture Me.hdc, lL, 8
    
End Sub

Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)
   If (cmdShowStatic.Caption = "Stop &amp;Static") Then
      MsgBox "Must stop Static demonstration first.", vbInformation
      Cancel = True
   End If
   If (cmdStaticFade.Caption = "Stop") Then
      MsgBox "Must stop Fade with Static demonstration first.", vbInformation
      Cancel = True
   End If
   If (cmdFade.Caption = "Stop") Then
      MsgBox "Must stop Fade demonstration first.", vbInformation
      Cancel = True
   End If
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">DIB Sections</a>&#160;.&#160;<a href="article.html">True Colour DIBSection</a>&#160;.&#160;<a href="vb6_dibsection_demonstration.html">VB6 DIBSection Demonstration</a>&#160;.&#160;frmDibSection.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>