<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: Form1.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: Form1.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">DIB Sections</a>&#160;.&#160;<a href="article.html">Alpha DIBSections</a>&#160;.&#160;<a href="simple_alpha_sample.html">Simple Alpha Sample</a>&#160;.&#160;Form1.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="simple_alpha_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Simple Alpha Sample</a> (26K)</p><p /><p class="nav"><a href="vb5_alpha_dib_section_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Alpha DIB Section Demonstration</a> (101K)</p><p /><p class="nav"><a href="vb6_alpha_dib_section_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Alpha DIB Section Demonstration</a> (97K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:3036</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3036&type=zip&title=simple_20alpha_20sample_2ezip_5fform1.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />13 Jan 2003<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\graphics_and_gdi\changing_window_shapes\window_shapes_using_layering\article.html">Window Shapes Using Layering</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\256_colour_dibsection\article.html">256 Colour DIBSections </a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\true_colour_dibsection\article.html">True Colour DIBSection</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\tips\replace_one_colour_with_another_in_a_picture\article.html">Replace one Colour with another in a Picture using BitBlt</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: Form1.frm</h1><pre>VERSION 5.00
Begin VB.Form Form1 
   AutoRedraw      =   -1  'True
   Caption         =   "Alpha Is Simple?"
   ClientHeight    =   6495
   ClientLeft      =   60
   ClientTop       =   450
   ClientWidth     =   10410
   LinkTopic       =   "Form1"
   ScaleHeight     =   6495
   ScaleWidth      =   10410
   StartUpPosition =   3  'Windows Default
   Begin VB.CheckBox chkUseSystem 
      Caption         =   "&amp;Use System AlphaBlend"
      Height          =   255
      Left            =   120
      TabIndex        =   3
      Top             =   3420
      Value           =   1  'Checked
      Width           =   4515
   End
   Begin VB.HScrollBar HScroll1 
      Height          =   255
      LargeChange     =   25
      Left            =   120
      Max             =   255
      TabIndex        =   2
      Top             =   3120
      Value           =   128
      Width           =   4515
   End
   Begin VB.PictureBox Picture2 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   3105
      Left            =   5400
      Picture         =   "Form1.frx":0000
      ScaleHeight     =   3045
      ScaleWidth      =   4500
      TabIndex        =   1
      Top             =   3240
      Width           =   4560
   End
   Begin VB.PictureBox Picture1 
      AutoRedraw      =   -1  'True
      AutoSize        =   -1  'True
      Height          =   3105
      Left            =   5400
      Picture         =   "Form1.frx":2102
      ScaleHeight     =   3045
      ScaleWidth      =   4500
      TabIndex        =   0
      Top             =   120
      Width           =   4560
   End
End
Attribute VB_Name = "Form1"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

' System functions:
Private Type BLENDFUNCTION
  BlendOp As Byte
  BlendFlags As Byte
  sourceConstantAlpha As Byte
  AlphaFormat As Byte
End Type
' BlendOp:
Private Const AC_SRC_OVER = &amp;H0
' AlphaFormat:
Private Const AC_SRC_ALPHA = &amp;H1

Private Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" ( _
    lpvDest As Any, lpvSource As Any, ByVal cbCopy As Long)

Private Declare Function AlphaBlend Lib "MSIMG32.dll" ( _
  ByVal hdcDest As Long, _
  ByVal nXOriginDest As Long, _
  ByVal nYOriginDest As Long, _
  ByVal nWidthDest As Long, _
  ByVal nHeightDest As Long, _
  ByVal hdcSrc As Long, _
  ByVal nXOriginSrc As Long, _
  ByVal nYOriginSrc As Long, _
  ByVal nWidthSrc As Long, _
  ByVal nHeightSrc As Long, _
  ByVal lBlendFunction As Long _
) As Long

' cAlphaDibSection functions:
Private Type SAFEARRAYBOUND
    cElements As Long
    lLbound As Long
End Type
Private Type SAFEARRAY2D
    cDims As Integer
    fFeatures As Integer
    cbElements As Long
    cLocks As Long
    pvData As Long
    Bounds(0 To 1) As SAFEARRAYBOUND
End Type
Private Declare Function VarPtrArray Lib "msvbvm60.dll" Alias "VarPtr" (Ptr()
 As Any) As Long

Private m_cBack As cAlphaDibSection
Private m_cImage As cAlphaDibSection
Private m_cDraw As cAlphaDibSection

Private m_bUseSystem As Boolean

Private Sub Draw()
   If (m_bUseSystem) Then
      Dim lBlend As Long
      Dim bf As BLENDFUNCTION
   
      ' Draw the first picture:
      bf.BlendOp = AC_SRC_OVER
      bf.BlendFlags = 0
      bf.sourceConstantAlpha = 255
      bf.AlphaFormat = 0
      CopyMemory lBlend, bf, 4
      AlphaBlend Me.hdc, HScroll1.Left \ Screen.TwipsPerPixelX, 8, _
         Picture1.ScaleWidth \ Screen.TwipsPerPixelX, _
         Picture1.ScaleHeight \ Screen.TwipsPerPixelY, _
         Picture1.hdc, 0, 0, _
         Picture1.ScaleWidth \ Screen.TwipsPerPixelX, _
         Picture1.ScaleHeight \ Screen.TwipsPerPixelY, _
         lBlend
   
      ' Now draw the second picture with HScroll transparency over the top:
      bf.sourceConstantAlpha = HScroll1.Value
      CopyMemory lBlend, bf, 4
      AlphaBlend Me.hdc, HScroll1.Left \ Screen.TwipsPerPixelX, 8, _
         Picture2.ScaleWidth \ Screen.TwipsPerPixelX, _
         Picture2.ScaleHeight \ Screen.TwipsPerPixelY, _
         Picture2.hdc, 0, 0, _
         Picture2.ScaleWidth \ Screen.TwipsPerPixelX, _
         Picture2.ScaleHeight \ Screen.TwipsPerPixelY, _
         lBlend
      Me.Refresh
   Else
      m_cBack.PaintPicture m_cDraw.hdc
      CodeAlphaBlend m_cDraw, m_cImage, HScroll1.Value
      m_cDraw.PaintPicture Me.hdc, HScroll1.Left \ Screen.TwipsPerPixelX, 8, _
         m_cDraw.Width, _
         m_cDraw.Height
      Me.Refresh
   End If
End Sub

Private Sub CodeAlphaBlend( _
      cDst As cAlphaDibSection, _
      cSrc As cAlphaDibSection, _
      Optional ByVal sourceConstantAlpha As Long _
   )
   Dim tSASrc As SAFEARRAY2D
   Dim bDibSrc() As Byte
    ' Get the bits in the from DIB section:
    With tSASrc
        .cbElements = 1
        .cDims = 2
        .Bounds(0).lLbound = 0
        .Bounds(0).cElements = cSrc.Height
        .Bounds(1).lLbound = 0
        .Bounds(1).cElements = cSrc.BytesPerScanLine()
        .pvData = cSrc.DIBSectionBitsPtr
    End With
    CopyMemory ByVal VarPtrArray(bDibSrc()), VarPtr(tSASrc), 4
      
   Dim tSADst As SAFEARRAY2D
   Dim bDibDst() As Byte
    ' Get the bits in the from DIB section:
    With tSADst
        .cbElements = 1
        .cDims = 2
        .Bounds(0).lLbound = 0
        .Bounds(0).cElements = cDst.Height
        .Bounds(1).lLbound = 0
        .Bounds(1).cElements = cDst.BytesPerScanLine()
        .pvData = cDst.DIBSectionBitsPtr
    End With
    CopyMemory ByVal VarPtrArray(bDibDst()), VarPtr(tSADst), 4
      
   Dim x As Long, y As Long
   For x = 0 To cDst.BytesPerScanLine - 4 Step 4
      For y = 0 To cDst.Height - 1
         bDibDst(x, y) = bDibSrc(x, y) * sourceConstantAlpha / 255 + bDibDst(x,
          y) * (1 - sourceConstantAlpha / 255)
         bDibDst(x + 1, y) = bDibSrc(x + 1, y) * sourceConstantAlpha / 255 +
          bDibDst(x + 1, y) * (1 - sourceConstantAlpha / 255)
         bDibDst(x + 2, y) = bDibSrc(x + 2, y) * sourceConstantAlpha / 255 +
          bDibDst(x + 2, y) * (1 - sourceConstantAlpha / 255)
      Next y
   Next x
      
         
    CopyMemory ByVal VarPtrArray(bDibDst), 0&amp;, 4
    CopyMemory ByVal VarPtrArray(bDibSrc), 0&amp;, 4
      
End Sub

Private Sub chkUseSystem_Click()
   m_bUseSystem = (chkUseSystem.Value = vbChecked)
   Draw
End Sub

Private Sub Form_Load()
   m_bUseSystem = True
   Set m_cBack = New cAlphaDibSection
   Set m_cImage = New cAlphaDibSection
   m_cBack.Create Picture1.ScaleWidth \ Screen.TwipsPerPixelX,
    Picture1.ScaleHeight \ Screen.TwipsPerPixelY
   m_cBack.LoadPictureBlt Picture1.hdc
   m_cImage.Create Picture2.ScaleWidth \ Screen.TwipsPerPixelX,
    Picture2.ScaleHeight \ Screen.TwipsPerPixelY
   m_cImage.LoadPictureBlt Picture2.hdc
   Set m_cDraw = New cAlphaDibSection
   m_cDraw.Create m_cBack.Width, m_cBack.Height
End Sub

Private Sub Form_Resize()
   Draw
End Sub

Private Sub HScroll1_Change()
   Draw
End Sub

Private Sub HScroll1_Scroll()
   Draw
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\libraries\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">DIB Sections</a>&#160;.&#160;<a href="article.html">Alpha DIBSections</a>&#160;.&#160;<a href="simple_alpha_sample.html">Simple Alpha Sample</a>&#160;.&#160;Form1.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>