<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmDib256.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmDib256.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">DIB Sections</a>&#160;.&#160;<a href="article.html">256 Colour DIBSections </a>&#160;.&#160;<a href="vb6_256_colour_dibsection_demonstration.html">VB6 256 Colour DIBSection Demonstration</a>&#160;.&#160;frmDib256.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_256_colour_dibsection_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 256 Colour DIBSection Demonstration</a> (132K)</p><p /><p class="nav"><a href="vb6_256_colour_dibsection_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 256 Colour DIBSection Demonstration</a> (130K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:3027</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3027&type=zip&title=vb6_20256_20colour_20dibsection_20demonstration_2ezip_5ffrmdib256.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />13 Jan 2003<br /><p class="update">Added a VB6 download.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\true_colour_dibsection\article.html">True Colour DIBSection</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\alpha_dibsection\article.html">Alpha DIBSections</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmDib256.frm</h1><pre>VERSION 5.00
Begin VB.Form frmDIBSection 
   Caption         =   "vbAccelerator cDIBSection256 Tester"
   ClientHeight    =   7725
   ClientLeft      =   4545
   ClientTop       =   1950
   ClientWidth     =   8610
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmDib256.frx":0000
   LinkTopic       =   "Form1"
   PaletteMode     =   2  'Custom
   ScaleHeight     =   7725
   ScaleWidth      =   8610
   Begin VB.CommandButton cmdSave 
      Caption         =   "&amp;Save"
      Height          =   435
      Left            =   120
      TabIndex        =   10
      Top             =   5940
      Width           =   1095
   End
   Begin VB.CommandButton cmdCycle 
      Caption         =   "&amp;Cycle"
      Height          =   435
      Left            =   120
      TabIndex        =   9
      Top             =   4080
      Width           =   1095
   End
   Begin VB.CommandButton cmdPixelMelt 
      Caption         =   "Pixel &amp;Melt"
      Height          =   435
      Left            =   120
      TabIndex        =   8
      Top             =   5280
      Width           =   1095
   End
   Begin VB.CommandButton cmdReset 
      Caption         =   "&amp;Reset"
      Height          =   435
      Left            =   120
      TabIndex        =   7
      Top             =   4800
      Width           =   1095
   End
   Begin VB.CommandButton cmdGrayScale 
      Caption         =   "Gray Scale"
      Height          =   495
      Left            =   120
      TabIndex        =   6
      Top             =   3540
      Width           =   1095
   End
   Begin VB.CommandButton cmdDarken 
      Caption         =   "Darken"
      Height          =   495
      Left            =   120
      TabIndex        =   5
      Top             =   3000
      Width           =   1095
   End
   Begin VB.CommandButton cmdBrighten 
      Caption         =   "Brighten"
      Height          =   495
      Left            =   120
      TabIndex        =   4
      Top             =   2460
      Width           =   1095
   End
   Begin VB.CommandButton cmdInvert 
      Caption         =   "&amp;Invert"
      Height          =   495
      Left            =   120
      TabIndex        =   3
      Top             =   1920
      Width           =   1095
   End
   Begin VB.CommandButton cmdChange 
      Caption         =   "Change Colour"
      Height          =   555
      Left            =   120
      TabIndex        =   2
      Top             =   1140
      Width           =   1095
   End
   Begin VB.CommandButton cmdFading 
      Caption         =   "Fade in and ou&amp;t"
      Height          =   555
      Left            =   120
      TabIndex        =   1
      Top             =   540
      Width           =   1095
   End
   Begin VB.Label Label1 
      Caption         =   "fps"
      Height          =   195
      Left            =   180
      TabIndex        =   0
      Top             =   60
      Width           =   3735
   End
End
Attribute VB_Name = "frmDIBSection"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private m_cDibIn As New cDIBSection256
Private m_cDibOut As New cDIBSection256
Private m_pic As StdPicture

Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
Private Declare Function timeGetTime Lib "winmm.dll" () As Long

Private Declare Function GetDIBColorTable Lib "gdi32" (ByVal hdc As Long, ByVal
 un1 As Long, ByVal un2 As Long, pRGBQuad As Any) As Long
Private Declare Function SetDIBColorTable Lib "gdi32" (ByVal hdc As Long, ByVal
 un1 As Long, ByVal un2 As Long, pcRGBQuad As RGBQUAD) As Long
Private Type RGBQUAD
    rgbBlue As Byte
    rgbGreen As Byte
    rgbRed As Byte
    rgbReserved As Byte
End Type

Private Sub cmdBrighten_Click()
   m_cDibIn.AdjustLightness 110
   If (cmdFading.Caption = "Fade in and ou&amp;t") Then
      m_cDibIn.PaintPicture Me.hdc, 96, 32
   End If
End Sub

Private Sub cmdChange_Click()
Static bFlip As Boolean
   If bFlip Then
      m_cDibIn.Color(10) = RGB(4, 4, 4)
   Else
      m_cDibIn.Color(10) = RGB(86, 31, 255)
   End If
   bFlip = Not (bFlip)
   If (cmdFading.Caption = "Fade in and ou&amp;t") Then
      m_cDibIn.PaintPicture Me.hdc, 96, 32
   End If
End Sub

Private Sub cmdCycle_Click()
Static tRGBSwap As RGBQUAD
Static tRGB(0 To 255) As RGBQUAD
Static i As Long
Static lC As Long
Static bGo As Boolean

   If (cmdCycle.Caption = "&amp;Stop") Then
      bGo = False
      cmdCycle.Caption = "&amp;Cycle"
   Else
      cmdCycle.Caption = "&amp;Stop"
      bGo = True
   End If
   
   Do While bGo
      lC = GetDIBColorTable(m_cDibIn.hdc, 0, 256, tRGB(0))
      If lC = 256 Then
         LSet tRGBSwap = tRGB(0)
         For i = 1 To 255
            LSet tRGB(i - 1) = tRGB(i)
         Next i
         tRGB(255) = tRGBSwap
         SetDIBColorTable m_cDibIn.hdc, 0, 256, tRGB(0)
         m_cDibIn.PaintPicture Me.hdc, 96, 32
      End If
      DoEvents
   Loop

End Sub

Private Sub cmdDarken_Click()
   m_cDibIn.AdjustLightness 90
   If (cmdFading.Caption = "Fade in and ou&amp;t") Then
      m_cDibIn.PaintPicture Me.hdc, 96, 32
   End If
End Sub

Private Sub cmdFading_Click()
Static i As Long
Static lTime As Long
Dim lFrames As Long
Dim lAmount As Long, lDir As Long

   If (cmdFading.Caption &lt;&gt; "Fade in and ou&amp;t") Then
      cmdFading.Caption = "Fade in and ou&amp;t"
      m_cDibIn.PaintPicture Me.hdc, 96, 32
   Else
      cmdFading.Caption = "Stop"

      
      lAmount = 255: lDir = -4
      Do While cmdFading.Caption = "Stop"
      
         If (timeGetTime - lTime) &gt; 1000 Then
             Label1.Caption = m_cDibIn.Width &amp; "x" &amp; m_cDibIn.Height &amp; ": " &amp;
              lFrames &amp; "/second"
             lFrames = 0
             lTime = timeGetTime
         Else
             lFrames = lFrames + 1
         End If
      
         ' Ensure palette is restored:
         m_cDibOut.CopyPalette m_cDibIn
         ' Fade the palette appropriately:
         m_cDibOut.Fade lAmount
         ' Show the new version of the picture:
         m_cDibOut.PaintPicture Me.hdc, 96, 32
   
         lAmount = lAmount + lDir
         If (lAmount &lt; 0) Then
            lDir = 4
            lAmount = 3
         ElseIf (lAmount = 255) Then
            lDir = -4
            lAmount = 255 - 4
         End If
         DoEvents
         
      Loop
      
   End If
End Sub

Private Sub cmdGrayScale_Click()
   m_cDibIn.GrayScale
   If (cmdFading.Caption = "Fade in and ou&amp;t") Then
      m_cDibIn.PaintPicture Me.hdc, 96, 32
   End If
End Sub

Private Sub cmdInvert_Click()
   m_cDibIn.Invert
   If (cmdFading.Caption = "Fade in and ou&amp;t") Then
      m_cDibIn.PaintPicture Me.hdc, 96, 32
   End If

End Sub

Private Sub cmdPixelMelt_Click()
Dim cDibOut As cDIBSection256
Dim lTime As Long
Dim lFrames As Long
   If cmdPixelMelt.Caption = "Pixel &amp;Melt" Then
      cmdPixelMelt.Caption = "&amp;Stop"
      Set cDibOut = New cDIBSection256
      cDibOut.Create m_cDibIn.Width, m_cDibIn.Height
      cDibOut.CopyPalette m_cDibIn
   Else
      cmdPixelMelt.Caption = "Pixel &amp;Melt"
   End If
   lTime = timeGetTime
   Do While cmdPixelMelt.Caption = "&amp;Stop"
      If (timeGetTime - lTime) &gt; 1000 Then
         Label1.Caption = m_cDibIn.Width &amp; "x" &amp; m_cDibIn.Height &amp; ": " &amp;
          lFrames &amp; "/second"
         lFrames = 0
         lTime = timeGetTime
      Else
         lFrames = lFrames + 1
      End If
      
      Init
      PixelMelt m_cDibIn, cDibOut
      cDibOut.PaintPicture Me.hdc, 96, 32
      cDibOut.PaintPicture m_cDibIn.hdc
      DoEvents
   Loop
   
End Sub

Private Sub cmdReset_Click()
Dim sFile As String

   If (cmdFading.Caption &lt;&gt; "Fade in and ou&amp;t") Then
      cmdFading_Click
   End If
   Me.Palette = m_pic
   m_cDibIn.CreateFromPicture m_pic
   m_cDibIn.PaintPicture Me.hdc, 96, 32
   
End Sub

Private Sub cmdSave_Click()
Dim sI As String
   sI = InputBox$("Enter the name to save this picture as a Windows 256 colour
    bitmap to", , App.Path &amp; "\temp256.bmp")
   If Not (sI = "") Then
      m_cDibIn.SavePicture sI
   End If
End Sub

Private Sub Form_Load()
Dim sFile As String

   sFile = App.Path &amp; "\vbaccel2.gif"
   Set m_pic = LoadPicture(sFile)
   m_cDibIn.CreateFromPicture m_pic
   Me.Palette = m_pic
         
   ' Make a copy of cDibIn from cDibOut:
   m_cDibOut.Create m_cDibIn.Width, m_cDibIn.Height
   m_cDibOut.LoadPictureBlt m_cDibIn.hdc

   Me.Show
   Me.Refresh
   m_cDibIn.PaintPicture Me.hdc, 96, 32

End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">DIB Sections</a>&#160;.&#160;<a href="article.html">256 Colour DIBSections </a>&#160;.&#160;<a href="vb6_256_colour_dibsection_demonstration.html">VB6 256 Colour DIBSection Demonstration</a>&#160;.&#160;frmDib256.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>