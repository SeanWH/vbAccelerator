<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: cCDDriveInfo.cls</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: cCDDriveInfo.cls" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /><link rel="copyright" href="/home/The_Site/Copyright/article.asp" /><link rel="contents" href="./VB5_CD_Ripper.asp" /><link rel="meta" type="application/rdf+xml" href="./VB5 CD Ripper.rdf" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">Audio</a>&#160;.&#160;<a href="article.html">CD Ripping in VB Part 1</a>&#160;.&#160;<a href="vb5_cd_ripper.html">VB5 CD Ripper</a>&#160;.&#160;cCDDriveInfo.cls</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="cdrip_dll_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />CDRip DLL Source</a> (87K)</p><p class="nav"><a href="cdrip_dll.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />CDRip DLL</a> (84K)</p><p /><p class="nav"><a href="vb5_cd_ripper.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 CD Ripper</a> (103K)</p><p /><p class="nav"><a href="vb6_cd_ripper.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 CD Ripper</a> (99K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:15149</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=15149&type=zip&title=vb5_20cd_20ripper_2ezip_5fccddriveinfo.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />6 May 2004<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\..\resources\links\other\cdex\article.html">CDEx</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\cd_tracklistings\article.html">CD Track Listing Using freedb.org</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: cCDDriveInfo.cls</h1><p>This file is part of the download <a href="vb5_cd_ripper.html">VB5 CD Ripper</a>, which is described in the article <a href="article.html">CD Ripping in VB Part 1</a>.</p><pre>VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "cDrive"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit

' ------------------------------------------------------------
' Name:   cDrive
' Author: Steve McMahon (steve@vbaccelerator.com)
' Date:   2004-05-06
' Description:
' Wrapper around the CDRip.DLL API describing a drive
' capable of playing CDs.
'
' See http://vbaccelerator.com/
' ------------------------------------------------------------

Public Enum ECDRipDriveType
   GENERIC = 0
   TOSHIBA
   TOSHIBANEW
   IBM
   NEC
   DEC
   IMS
   KODAK
   RICOH
   HP
   PHILIPS
   PLASMON
   GRUNDIGCDR100IPW
   MITSUMICDR
   PLEXTOR
   SONY
   YAMAHA
   NRC
   IMSCDD5
   CUSTOMDRIVE
   NUMDRIVETYPES
End Enum

Public Enum ECDRipReadMethod
   READMMC = 0
   READ10
   READNEC
   READSONY
   READMMC2
   READMMC3
   READC1
   READC2
   READC3
   READMMC4
   NUMREADMETHODS
End Enum

Public Enum ECDRipSetSpeed
   SPEEDNONE = 0
   SPEEDMMC
   SPEEDSONY
   SPEEDYAMAHA
   SPEEDTOSHIBA
   SPEEDPHILIPS
   SPEEDNEC
   NUMSPEEDMETHODS
End Enum

Public Enum ECDRipENDIAN
   BIGENDIAN = 0
   LITTLEENDIAN
   NUMENDIAN
End Enum

Public Enum ECDRipENABLEMODE
   ENABLENONE = 0
   ENABLESTD
   NUMENABLEMODES
End Enum

Public Enum ECDRipOUTPUTFORMAT
   STEREO44100 = 0
   MONO44100
   STEREO22050
   MONO22050
   STEREO11025
   MONO11025
   NUMOUTPUTFORMATS
End Enum

Private Type tDRIVETABLE
   DriveType As ECDRipDriveType
   readMethod As ECDRipReadMethod
   setSpeed As ECDRipSetSpeed
   endian As ECDRipENDIAN
   enableMode As ECDRipENABLEMODE
   nDensity As Long
   bAtapi As Long ' BOOL
End Type

Private Const TRANSPLAYER_ASPI = (0)
Private Const TRANSPLAYER_NTSCSI = (1)


Private Const CR_RIPPING_MODE_NORMAL = (0)
Private Const CR_RIPPING_MODE_PARANOIA = (1)

Private Type tSENSKEY
   SK As Byte
   ASC As Byte
   ASCQ As Byte
End Type

' hmmm this looks rather VB-hostile if it is byte aligned
Private Type CDROMPARAMS
   lpszCDROMID As String * 255 '// CD-ROM ID, must be unique to index settings
    in INI file
   
   nNumReadSectors As Long '// Number of sector to read per burst
   nNumOverlapSectors As Long '// Number of overlap sectors for jitter
    correction
   nNumCompareSectors As Long '// Number of sector to compare for jitter
    correction
   nOffsetStart As Long '// Fudge factor at start of ripping in sectors
   nOffsetEnd As Long '// Fudge factor at the end of ripping in sectors
   nSpeed As Long '// CD-ROM speed factor 0 .. 32 x
   nSpinUpTime As Long ' // CD-ROM spin up time in seconds
   bJitterCorrection As Long '// Boolean indicates whether to use Jitter
    Correction
   bSwapLefRightChannel As Long '// Swap left and right channel ?
   driveTable As tDRIVETABLE  '// Drive specific parameters
      
   btTargetID As Byte '// SCSI target ID
   btAdapterID As Byte '// SCSI Adapter ID
   btLunID As Byte '// SCSI LUN ID

   bAspiPosting As Long '// When set ASPI posting is used, otherwhiese ASPI
    polling is used
   nAspiRetries As Integer
   nAspiTimeOut As Integer

   bEnableMultiRead As Long '// Enables Multiple Read Verify Feature
   bMultiReadFirstOnly As Long '// Only do the multiple reads on the first block
   nMultiReadCount As Integer '// Number of times to reread and compare

   bLockDuringRead As Long '// Number of times to reread and compare

   nRippingMode As Integer
   nParanoiaMode As Integer
   
   bJunk(0 To 1024) As Byte
End Type

Private Declare Function CR_SetCDROMParameters Lib "cdrip.dll" (pParam As
 CDROMPARAMS) As Long
Private Declare Function CR_GetCDROMParameters Lib "cdrip.dll" (pParam As
 CDROMPARAMS) As Long
Private Declare Sub CR_SetActiveCDROM Lib "cdrip.dll" (ByVal nActiveDrive As
 Long)
'// Checks if the unit is ready (i.e. is the CD media present)
Private Declare Function CR_IsUnitReady Lib "cdrip.dll" () As Long

'// Eject the CD, bEject=TRUE=&gt; the CD will be ejected, bEject=FALSE=&gt; the CD
 will be loaded
Private Declare Function CR_EjectCD Lib "cdrip.dll" (ByVal bEject As Long) As
 Long

'// Check if the CD is playing
Private Declare Function CR_IsAudioPlaying Lib "cdrip.dll" () As Long

'// Play track
Private Declare Function CR_PlayTrack Lib "cdrip.dll" (ByVal nTrack As Long) As
 Long

'// Stop Play track
Private Declare Function CR_StopPlayTrack Lib "cdrip.dll" ()

'// Pause Play track
Private Declare Function CR_PauseCD Lib "cdrip.dll" (ByVal bPause As Long)


Private m_index As Long
Private m_tP As CDROMPARAMS
Private m_bDirty As Boolean

Friend Property Get fCDIndex() As Long
   fCDIndex = m_index
End Property

Public Property Get IsUnitReady() As Boolean
   CR_SetActiveCDROM m_index
   IsUnitReady = IIf(CR_IsUnitReady() = 0, False, True)
End Property
Public Property Get IsAudioPlaying() As Boolean
   CR_SetActiveCDROM m_index
   IsAudioPlaying = IIf(CR_IsAudioPlaying() = 0, False, True)
End Property
Public Sub EjectCD()
   CR_SetActiveCDROM m_index
   CR_EjectCD 1
End Sub
Public Sub CloseCD()
   CR_SetActiveCDROM m_index
   CR_EjectCD 0
End Sub

Public Sub PlayCDTrack(ByVal nIndex As Long)
   CDRipErrHandler "cDrive.PlayCDTrack", CR_PlayTrack(nIndex - 1), True
End Sub
Public Sub UnpauseCD()
   CDRipErrHandler "cDrive.UnPauseCD", CR_PauseCD(0), True
End Sub
Public Sub PauseCD()
   CDRipErrHandler "cDrive.UnPauseCD", CR_PauseCD(1), True
End Sub
Public Sub StopCD()
   CDRipErrHandler "cDrive.UnPauseCD", CR_StopPlayTrack, True
End Sub

Public Property Get Name() As String
   Name = StripNull(m_tP.lpszCDROMID)
End Property

Public Property Get ReadSectors() As Long
   ReadSectors = m_tP.nNumReadSectors
End Property
Public Property Let ReadSectors(ByVal value As Long)
   If Not (m_tP.nNumReadSectors = value) Then
      m_tP.nNumReadSectors = value
      m_bDirty = True
   End If
End Property
Public Property Get ReadOverlap() As Long
   ReadOverlap = m_tP.nNumOverlapSectors
End Property
Public Property Let ReadOverlap(ByVal value As Long)
   If Not (m_tP.nNumOverlapSectors = value) Then
      m_tP.nNumOverlapSectors = value
      m_bDirty = True
   End If
End Property
Public Property Get BlockCompare() As Long
   BlockCompare = m_tP.nNumCompareSectors
End Property
Public Property Let BlockCompare(ByVal value As Long)
   If Not (m_tP.nNumCompareSectors = value) Then
      m_tP.nNumCompareSectors = value
      m_bDirty = True
   End If
End Property

Public Property Get StartOffset() As Long
   StartOffset = m_tP.nOffsetStart
End Property
Public Property Let StartOffset(ByVal value As Long)
   If Not (m_tP.nOffsetStart = value) Then
      m_tP.nOffsetStart = value
      m_bDirty = True
   End If
End Property
Public Property Get EndOffset() As Long
   EndOffset = m_tP.nOffsetEnd
End Property
Public Property Let EndOffset(ByVal value As Long)
   If Not (m_tP.nOffsetEnd = value) Then
      m_tP.nOffsetEnd = value
      m_bDirty = True
   End If
End Property
Public Property Get CDSpeed() As Long
   CDSpeed = m_tP.nSpeed
End Property
Public Property Let CDSpeed(ByVal value As Long)
   If Not (m_tP.nSpeed = value) Then
      m_tP.nSpeed = value
      m_bDirty = True
   End If
End Property

Public Property Get SpinUpTime() As Long
   SpinUpTime = m_tP.nSpinUpTime
End Property
Public Property Let SpinUpTime(ByVal value As Long)
   If Not (m_tP.nSpinUpTime = value) Then
      m_tP.nSpinUpTime = value
      m_bDirty = True
   End If
End Property

Public Property Get Retries() As Long
   Retries = m_tP.nAspiRetries
End Property
Public Property Let Retries(ByVal value As Long)
   If Not (m_tP.nAspiRetries = value) Then
      m_tP.nAspiRetries = value
      m_bDirty = True
   End If
End Property

Public Property Get DriveType() As ECDRipDriveType
   DriveType = m_tP.driveTable.DriveType
End Property
Public Property Let DriveType(ByVal value As ECDRipDriveType)
   If Not (m_tP.driveTable.DriveType = value) Then
      m_tP.driveTable.DriveType = value
      m_bDirty = True
   End If
End Property

Public Property Get RippingMethod() As ECDRipDriveType
   RippingMethod = m_tP.driveTable.readMethod
End Property
Public Property Let RippingMethod(ByVal value As ECDRipDriveType)
   If Not (m_tP.driveTable.readMethod = value) Then
      m_tP.driveTable.readMethod = value
      m_bDirty = True
   End If
End Property
Public Property Get TOC() As cToc
Dim cToc As New cToc
   CR_SetActiveCDROM m_index
   cToc.fInit m_index
   Set TOC = cToc
End Property

Public Sub Refresh()
   fInit m_index
End Sub

Public Sub Apply()
   If (m_bDirty) Then
      CDRipErrHandler "cCDDriveInfo.Apply", CR_SetCDROMParameters(m_tP), True
      m_bDirty = False
   End If
End Sub

Friend Sub fInit(ByVal index As Long)
   m_bDirty = False
   m_index = index
   CR_SetActiveCDROM m_index
   CDRipErrHandler "cCDDriveInfo.fInit", CR_GetCDROMParameters(m_tP), True
End Sub

Private Function StripNull(ByVal sz As String) As String
Dim i As Long
   i = InStr(sz, vbNullChar)
   If (i &gt; 0) And (i &lt; Len(sz)) Then
      StripNull = left(sz, i - 1)
   Else
      StripNull = sz
   End If
End Function

</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">Audio</a>&#160;.&#160;<a href="article.html">CD Ripping in VB Part 1</a>&#160;.&#160;<a href="vb5_cd_ripper.html">VB5 CD Ripper</a>&#160;.&#160;cCDDriveInfo.cls</p><br /><table style="font-size: 100%;"><tr><td valign="top"><a href="javascript:window.alert(&quot;http://creativecommons.org/licenses/by/1.0/\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\res\cc.png" width="88" height="31" alt="Creative Commons Licence" /></a></td></a></td><td valign="top"><p class="nav" style="padding-bottom: 4px;">All contents of this web site are licensed under a <a href="javascript:window.alert(&quot;http://creativecommons.org/licenses/by/1.0/\nThis link was not retrieved.&quot;)">Creative Commons Licence</a>, except where otherwise noted.</p><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2004 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>, vbAccelerator Ltd.<br />Last Updated: 9 June 2004</p></td></tr></table></td><td></td></tr></table>
</body></html>