<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: cVideoHandlers.cls</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: cVideoHandlers.cls" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">Movies</a>&#160;.&#160;<a href="article.html">AVI Creation</a>&#160;.&#160;<a href="vb6_avi_creator.html">VB6 AVI Creator</a>&#160;.&#160;cVideoHandlers.cls</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_avi_creator.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 AVI Creator</a> (143K)</p><p /><p class="nav"><a href="vb6_avi_creator.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 AVI Creator</a> (139K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:13628</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=13628&type=zip&title=vb6_20avi_20creator_2ezip_5fcvideohandlers.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />23 Nov 2003<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\controls\avi_player\transparent_avi_player\article.html">Transparent AVI Player Control</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\controls\avi_player\comctl32_avi_player\article.html">ComCtl32.DLL Animation Control Class</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\resources\reading_data_from_local_or_external_library_resources\article.html">Reading Data from Local or External Library Resources</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\type_libraries\ishellfolder\article.html">IShellFolder Extended Type Library Version 1.2 (ISHF_Ex.Tlb)</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: cVideoHandlers.cls</h1><pre>VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "cVideoHandlers"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit

Private Type BITMAPINFOHEADER '40 bytes
    biSize As Long
    biWidth As Long
    biHeight As Long
    biPlanes As Integer
    biBitCount As Integer
    biCompression As Long
    biSizeImage As Long
    biXPelsPerMeter As Long
    biYPelsPerMeter As Long
    biClrUsed As Long
    biClrImportant As Long
End Type

Private Declare Function ICLocate Lib "MSVFW32.dll" ( _
    ByVal fccType As Long, _
    ByVal fccHandler As Long, _
    lpbiIn As Any, _
    lpbOut As Any, _
    ByVal wFlags As Long _
    ) As Long

Public Enum EBitmapCompressionTypes
   BI_RGB = 0&amp;
   BI_RLE8 = 1&amp;
End Enum

Private Type TICInfo
    dwSize As Long ';                 // sizeof(ICINFO)
    fccType As Long ';                // compressor type     'vidc' 'audc'
    fccHandler As Long ';             // compressor sub-type 'rle ' 'jpeg' 'pcm
     '
    dwFlags As Long ';                // flags LOWORD is type specific
    dwVersion As Long ';              // version of the driver
    dwVersionICM As Long ';           // version of the ICM used
    '//
    '// under Win32, the driver always returns UNICODE strings.
    '//
    'WCHAR   szName[16];             // short name
    szName(0 To 31) As Byte
    'WCHAR   szDescription[128];     // long name
    szDescription(0 To 255) As Byte
    'WCHAR   szDriver[128];          // driver that contains compressor
    szDriver(0 To 255) As Byte
End Type

Private Declare Function ICInfo Lib "MSVFW32.dll" ( _
    ByVal fccType As Long, _
    ByVal fccHandler As Long, _
    lpicinfo As Any _
    ) As Long

Private Declare Function ICOpen Lib "MSVFW32.dll" ( _
    ByVal fccType As Long, _
    ByVal fccHandler As Long, _
    ByVal wMode As Long _
    ) As Long

Private Declare Function ICClose Lib "MSVFW32.dll" ( _
    ByVal hiC As Long _
    ) As Long

Private Declare Function ICGetInfo Lib "MSVFW32.dll" ( _
    ByVal hiC As Long, _
    picInfo As Any, _
    ByVal cb As Long _
    ) As Long

Private Declare Function ICSendMessage Lib "MSVFW32.dll" ( _
    ByVal hiC As Long, _
    ByVal msg As Long, _
    dw1 As Any, _
    ByVal dw2 As Long _
    ) As Long


Private Const ICMODE_COMPRESS = 1
Private Const ICMODE_DECOMPRESS = 2
Private Const ICMODE_FASTDECOMPRESS = 3
Private Const ICMODE_QUERY = 4
Private Const ICMODE_FASTCOMPRESS = 5
Private Const ICMODE_DRAW = 8

Private Const ICERR_OK = 0
Private Const ICERR_DONTDRAW = 1
Private Const ICERR_NEWPALETTE = 2
Private Const ICERR_GOTOKEYFRAME = 3
Private Const ICERR_STOPDRAWING = 4

Private Const ICERR_UNSUPPORTED = -1&amp;
Private Const ICERR_BADFORMAT = -2&amp;
Private Const ICERR_MEMORY = -3&amp;
Private Const ICERR_INTERNAL = -4&amp;
Private Const ICERR_BADFLAGS = -5&amp;
Private Const ICERR_BADPARAM = -6&amp;
Private Const ICERR_BADSIZE = -7&amp;
Private Const ICERR_BADHANDLE = -8&amp;
Private Const ICERR_CANTUPDATE = -9&amp;
Private Const ICERR_ABORT = -10&amp;
Private Const ICERR_ERROR = -100&amp;
Private Const ICERR_BADBITDEPTH = -200&amp;
Private Const ICERR_BADIMAGESIZE = -201&amp;

Private Const ICERR_CUSTOM = -400&amp;             '// errors less than
 ICERR_CUSTOM...


Private m_colHandlers As Collection


Public Function SuggestedVideoHandlerFourCC( _
      ByVal bitsPerPixel As Long _
   ) As Long
Dim bIh As BITMAPINFOHEADER
Dim hiC As Long
Dim tICI As TICInfo

   '// Initialize the bitmap structure.
   bIh.biSize = LenB(bIh)
   bIh.biPlanes = 1
   bIh.biCompression = BI_RGB      '// standard RGB bitmap
   If (bitsPerPixel = 8) Then
      bIh.biBitCount = 8              '// 8 bits-per-pixel format
      bIh.biClrUsed = 256
      bIh.biClrImportant = 256
   Else
      bIh.biBitCount = 24
   End If
    
   Dim ICTYPE_VIDEO As Long
   ICTYPE_VIDEO = FourCCFromString("vidc")
    
   hiC = ICLocate(ICTYPE_VIDEO, ByVal 0&amp;, bIh, _
       ByVal 0&amp;, ICMODE_COMPRESS)
       
   If Not (hiC = 0) Then
      ICGetInfo hiC, tICI, LenB(tICI)
      SuggestedVideoHandlerFourCC = tICI.fccHandler
   
      ICClose hiC
   End If

End Function

Private Sub getHandlers()
Dim i As Long
Dim iLast As Long
Dim iNext As Long
Dim tICBlank As TICInfo
Dim tIC As TICInfo
Dim tBIH As BITMAPINFOHEADER
Dim fccType As Long
Dim lPtrTic As Long
Dim hiC As Long
Dim sName As String
Dim sDescription As String
Dim lR As Long
Dim cV As cVideoHandler

   Set m_colHandlers = New Collection

   fccType = FourCCFromString("vidc")
   iLast = 0
   Do
      LSet tIC = tICBlank
      iNext = ICInfo(fccType, iLast, tIC)
      If Not (iNext = 0) Then
         hiC = ICOpen(tIC.fccType, tIC.fccHandler, ICMODE_QUERY)
         If Not (hiC = 0) Then
            ICGetInfo hiC, tIC, Len(tIC)
                        
            sName = tIC.szName
            sDescription = tIC.szDescription
            
            Set cV = New cVideoHandler
            cV.fInit sName, sDescription, tIC.fccHandler
            m_colHandlers.Add cV
            
            ICClose hiC
         End If
         iLast = iLast + 1
      Else
      End If
   Loop While (iNext &gt; 0)
End Sub

' Gets long value of FourCC value from string, e.g. 'vids'
Public Function FourCCFromString(ByVal sString As String) As Long
Dim lRet As Long
Dim sChar As String
Dim lChar As Long
   sChar = Mid(sString, 1)
   lRet = lRet Or Asc(sChar)
   sChar = Mid(sString, 2)
   lRet = lRet Or Asc(sChar) * &amp;H100&amp;
   sChar = Mid(sString, 3)
   lRet = lRet Or Asc(sChar) * &amp;H10000
   sChar = Mid(sString, 4)
   lChar = Asc(sChar)
   lRet = lRet Or (lChar And &amp;H7F&amp;) * &amp;H1000000
   If (lChar And &amp;H80&amp;) = &amp;H80&amp; Then
      lRet = lRet Or &amp;H80000000
   End If
   FourCCFromString = lRet
End Function

' Gets the string from a FourCC long value
Public Function FourCCToString(ByVal lFourCC As Long) As String
Dim sRet As String
Dim lUByte As Long
   sRet = Chr(lFourCC And &amp;HFF)
   sRet = sRet &amp; Chr((lFourCC And &amp;HFF00&amp;) \ &amp;H100&amp;)
   sRet = sRet &amp; Chr((lFourCC And &amp;HFF0000) \ &amp;H10000)
   lUByte = (lFourCC And &amp;H7F000000) \ &amp;H1000000
   If (lFourCC And &amp;H80000000) = &amp;H80000000 Then
      lUByte = lUByte Or &amp;H80&amp;
   End If
   sRet = sRet &amp; Chr(lUByte)
   FourCCToString = sRet
End Function

Public Property Get HandlerCount() As Long
   HandlerCount = m_colHandlers.Count
End Property

Public Property Get Handler(ByVal Index As Long) As cVideoHandler
   Set Handler = m_colHandlers(Index)
End Property

Public Function IndexForFourCC(ByVal lFourCC As Long) As Long
Dim cVH As cVideoHandler
Dim i As Long
   For Each cVH In m_colHandlers
      i = i + 1
      If cVH.FourCC = lFourCC Then
         IndexForFourCC = i
      End If
   Next
End Function

Private Sub Class_Initialize()
   
   getHandlers
   
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.html">Movies</a>&#160;.&#160;<a href="article.html">AVI Creation</a>&#160;.&#160;<a href="vb6_avi_creator.html">VB6 AVI Creator</a>&#160;.&#160;cVideoHandlers.cls</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 24 November 2003</p></td><td></td></tr></table>
</body></html>