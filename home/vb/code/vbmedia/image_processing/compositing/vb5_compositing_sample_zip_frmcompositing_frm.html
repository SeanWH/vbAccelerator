<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmCompositing.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmCompositing.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.asp\index.html">Image Processing</a>&#160;.&#160;<a href="article.html">Compositing Operations</a>&#160;.&#160;<a href="vb5_compositing_sample.html">VB5 Compositing Sample</a>&#160;.&#160;frmCompositing.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_compositing_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Compositing Sample</a> (109K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:12834</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=12834&type=zip&title=vb5_20compositing_20sample_2ezip_5ffrmcompositing.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 1 / 1</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 0 / 0</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:7 September 2003</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />5 Sep 2003<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\dib_sections\alpha_dibsection\article.html">Alpha DIBSections</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmCompositing.frm</h1><pre>VERSION 5.00
Begin VB.Form frmCompositing 
   Caption         =   "vbAccelerator Compositing Class Demonstration"
   ClientHeight    =   6285
   ClientLeft      =   2355
   ClientTop       =   2115
   ClientWidth     =   8040
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmCompositing.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   419
   ScaleMode       =   3  'Pixel
   ScaleWidth      =   536
   Begin VB.ComboBox cboCompositing 
      Height          =   315
      Left            =   1860
      Style           =   2  'Dropdown List
      TabIndex        =   2
      Top             =   420
      Width           =   6075
   End
   Begin VB.Label lblInfo 
      BackStyle       =   0  'Transparent
      Caption         =   "Description of the selected compositing technique."
      Height          =   1155
      Left            =   1920
      TabIndex        =   4
      Top             =   780
      Width           =   6015
   End
   Begin VB.Label lblResult 
      BackColor       =   &amp;H80000010&amp;
      Caption         =   " Result"
      ForeColor       =   &amp;H80000014&amp;
      Height          =   255
      Left            =   1860
      TabIndex        =   3
      Top             =   1980
      Width           =   6075
   End
   Begin VB.Label Label1 
      BackColor       =   &amp;H80000010&amp;
      Caption         =   " Compositing Technique"
      ForeColor       =   &amp;H80000014&amp;
      Height          =   255
      Left            =   1860
      TabIndex        =   1
      Top             =   60
      Width           =   6075
   End
   Begin VB.Line Line1 
      BorderColor     =   &amp;H80000010&amp;
      X1              =   120
      X2              =   120
      Y1              =   4
      Y2              =   420
   End
   Begin VB.Label lblSourceImages 
      BackColor       =   &amp;H80000010&amp;
      Caption         =   " Source Images"
      ForeColor       =   &amp;H80000014&amp;
      Height          =   255
      Left            =   60
      TabIndex        =   0
      Top             =   60
      Width           =   1695
   End
End
Attribute VB_Name = "frmCompositing"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private m_cSrc As cAlphaDibSection
Private m_cDst As cAlphaDibSection
Private m_cSrcOutput As cAlphaDibSection
Private m_cResOutput As cAlphaDibSection

Private m_domAPI As DOMDocument

Private Sub Composite(ByVal operation As CompositingOperations)
   
   ' Prepare destination:
   Set m_cResOutput = New cAlphaDibSection
   m_cResOutput.Create m_cSrcOutput.width, m_cSrcOutput.height
   m_cResOutput.Clear
   m_cResOutput.CopyArea m_cDst, , , , , (m_cResOutput.width - m_cDst.width)
   
   ' Perform compositing operation
   Dim cCompositor As New cCompositing
   cCompositor.Src = m_cSrcOutput
   cCompositor.Dst = m_cResOutput
   cCompositor.operation = operation
  
   cCompositor.Composite
   
   Me.Refresh
   
End Sub

Private Sub loadImages()
Dim sPath As String
   
On Error GoTo errorHandler

   Set m_cSrc = New cAlphaDibSection
   sPath = normalizePath(App.Path) &amp; "Images\alphaBlue.bmp"
   m_cSrc.CreateFromPicture LoadPicture(sPath)
   
   Set m_cDst = New cAlphaDibSection
   sPath = normalizePath(App.Path) &amp; "Images\alphaBenediti.bmp"
   m_cDst.CreateFromPicture LoadPicture(sPath)
   
   Set m_cSrcOutput = New cAlphaDibSection
   m_cSrcOutput.Create (m_cSrc.width * 4) \ 3, (m_cSrc.height * 4) \ 3
   m_cSrcOutput.Clear
   m_cSrcOutput.CopyArea m_cSrc, , , , , , (m_cSrcOutput.height - m_cSrc.height)
   
   Exit Sub
   
errorHandler:
   MsgBox "Error loading source images for demonstration: " &amp; Err.Description &amp;
    vbCrLf &amp; vbCrLf &amp; "Please check you've installed all files for this
    demonstration properly.", vbExclamation
   Exit Sub
   
End Sub

Private Sub loadDocumentation()
Dim sPath As String
   
   Set m_domAPI = New DOMDocument
   sPath = normalizePath(App.Path) &amp; "Info\Compositing.xml"
   If Not (m_domAPI.Load(sPath)) Then
      MsgBox "Error loading the compositing API XML document: " &amp;
       m_domAPI.parseError &amp; vbCrLf &amp; vbCrLf &amp; "Please check you've installed
       all files for this demonstration properly.", vbExclamation
      Exit Sub
   End If
   
   ' write the compositing methods into the combo:
Dim xPath As String
Dim nodMethod As IXMLDOMNode
   xPath = "Compositing/Method"
   For Each nodMethod In m_domAPI.selectNodes(xPath)
      cboCompositing.AddItem
       nodMethod.selectSingleNode("Name").firstChild.nodeValue
      cboCompositing.ItemData(cboCompositing.NewIndex) =
       CLng(attributeValue(nodMethod, "value"))
   Next
   
   ' select the first item:
   cboCompositing.ListIndex = 0
   
End Sub

Private Function normalizePath(ByVal sPath As String) As String
   If StrComp(Right(Trim(sPath), 1), "\") = 0 Then
      normalizePath = Trim(sPath)
   Else
      normalizePath = Trim(sPath) &amp; "\"
   End If
End Function

Private Function attributeValue(nod As IXMLDOMNode, ByVal name As String) As
 String
Dim attr As IXMLDOMAttribute
   For Each attr In nod.Attributes
      If StrComp(attr.name, name) = 0 Then
         attributeValue = attr.nodeValue
         Exit For
      End If
   Next
End Function

Private Function replace(ByVal sString As String, ByVal sToReplace As String,
 ByVal sReplaceWith As String) As String
Dim sRet As String
Dim iPos As Long
Dim iNextPos As Long
   iPos = 1
   Do
      iNextPos = InStr(iPos, sString, sToReplace)
      If (iNextPos &gt; 0) Then
         sRet = sRet &amp; Mid(sString, iPos, iNextPos - iPos)
         sRet = sRet &amp; sReplaceWith
         iPos = iNextPos + Len(sToReplace)
      End If
   Loop While (iNextPos &gt; 0)
   sRet = sRet &amp; Mid(sString, iPos)
   replace = sRet
End Function

Private Sub cboCompositing_Click()
   '
   ' show the description:
   Dim xPath As String
   xPath = "Compositing/Method[@value='" &amp; _
      cboCompositing.ItemData(cboCompositing.ListIndex) &amp; _
      "']"
   Dim nodMethod As IXMLDOMNode
   Set nodMethod = m_domAPI.selectSingleNode(xPath)
   Dim sDescription As String
   sDescription = nodMethod.selectSingleNode("Description").firstChild.nodeValue
   lblInfo.Caption = replace(sDescription, vbLf, " ")
   
   ' TODO would also like to show Algorithm here
   
   ' Now perform the algorithm:
   Composite cboCompositing.ItemData(cboCompositing.ListIndex)
   
   
End Sub

Private Sub Form_Load()
   loadImages
   loadDocumentation
End Sub

Private Sub Form_Paint()
   '
   Me.Cls
   
   Dim x As Long
   Dim y As Long
   Dim width As Long
   
   x = lblSourceImages.Left
   y = lblSourceImages.Top + lblSourceImages.height + 2
   width = lblSourceImages.width
   
   m_cSrc.AlphaPaintPicture Me.hdc, x, y, width
   m_cDst.AlphaPaintPicture Me.hdc, x, y + m_cSrc.height + 2, width
   
   If Not (m_cResOutput Is Nothing) Then
      x = lblResult.Left
      y = lblResult.Top + lblResult.height + 2
      width = lblResult.width
   
      m_cResOutput.AlphaPaintPicture Me.hdc, x, y, width
      
   End If
   '
End Sub

</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.asp\index.html">Image Processing</a>&#160;.&#160;<a href="article.html">Compositing Operations</a>&#160;.&#160;<a href="vb5_compositing_sample.html">VB5 Compositing Sample</a>&#160;.&#160;frmCompositing.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 8 September 2003</p></td><td></td></tr></table>
</body></html>