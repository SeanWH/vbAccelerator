<html lang="en" >
<head>

<title>vbAccelerator - Programmatic Creation of Drop-Shadows</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="
This sample demonstrates creating an alpha-blended drop-shadow for a bitmap in
code.  Intensity, colour, offset and blurring of the effect can all be 
easily controlled.  For reasonably sized source bitmaps, the code is efficient
enough to run in real-time on most machines.
" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.asp\index.html">Image Processing</a>&#160;.&#160;Programmatic Creation of Drop-Shadows</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_alpha_shadow_creator.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Alpha Shadow Creator</a> (96K)</p><p /><p class="nav"><a href="vb6_alpha_shadow_creator.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Alpha Shadow Creator</a> (89K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:14454</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=14454&type=article&title=programmatic_20creation_20of_20drop_2dshadows.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />16 Apr 2004<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\dib_sections\resampling_with_alpha\article.html">Resampling with Alpha</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\blurring__sharpening_and_embossing\article.html">Softening, Blurring, Sharpening and Embossing images</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\dib_sections\alpha_dibsection\article.html">Alpha DIBSections</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Programmatic Creation of Drop-Shadows</h1><p class="splash">Create smooth alpha-blended drop-shadows from any bitmap source</p><img src="dropshadows.png" width="226" height="251" alt="Drop Shadow Sample Application" /><p /><p>
This sample demonstrates creating an alpha-blended drop-shadow for a bitmap in
code.  Intensity, colour, offset and blurring of the effect can all be 
easily controlled.  For reasonably sized source bitmaps, the code is efficient
enough to run in real-time on most machines.
</p><h2>Creating a Drop Shadow</h2><p>
To create a shadow for an object, the main thing you need to do is to detect
the boundaries and then draw a version of it with some offset in the horizontal
and vertical directions which give an idea of how far the object is from its
background given the direction of the light source.  The simplest technique
is just to draw the shadow in black where the object is opaque and transparently
otherwise.  However, in life shadows often have less than sharp edges and a more
realistic-looking effect can be achieved by blurring the edges of the shadow.
</p><p>
Blurring or softening an image is a simple image processing technique which is
usually done by averaging the pixels in a given area. Details of applying this technique 
on 24-bit colour images are provided in the article <a href="..\blurring__sharpening_and_embossing\article.html">Softening, 
Blurring, Sharpening and Embossing images</a>.  For a drop-shadow, however, ideally 
you would like to be able to apply the shadow to any background.  The easiest way to
do this is to take advantage of an alpha-channel in the bitmap to define the transparency.
Blurring is then performed in exactly the same way except the alpha channels is also
included in the blur effect, and the alpha is set to zero wherever the source image is
transparent.
</p><p>
The steps to creating a drop shadow are shown in the image below.  The first frame
shows the source image, which uses a cyan colour to represent transparent pixels.
This is then fed into the blur routine: all cyan pixels are interpreted as transparent
and all other pixels are regarded as black.  The resulting image can then be 
painted with the cyan pixels transparent over the alpha shadow, and the resulting image
will work over any background because the alpha combines the shadow pixels naturally
with the underlying image:
</p><img src="shadowcreation.png" width="240" height="50" alt="Creating a Drop Shadow" /><p class="caption">Creating a Drop Shadow</p><h2>Coding It</h2><p>
This sort of code makes my head hurt.  So you find the pixel in the source image, and 
then you add 4 for the shadow offset but subtract 8 for the blur offset and then, oh,
hang on a minute, am I at pixel (x+4, y-3) in the source or the destination and should I
check if this is less than the offset or 0 before I read or write the byte?  Next thing
I'm dreaming and I can't get out of bed until all of the planes are in the exact right 
order and the mugs have the just right amount of liquid in them.  That may just be me though.
</p><img src="perrin.png" width="399" height="366" alt="Perrin Shadow" /><p>
Anyway, the <span class="code">cDIBShadowCreator</span> wraps up the result and provides
an easier to way to take a source bitmap (loaded into a <span class="code">cAlphaDIBSection</span>
class) and to set the shadow's offset (<span class="code">OffsetX, OffsetY</span> properties),
the amount of blur (<span class="code">MatrixSize</span>), shadow colour (<span class="code">ShadowColor</span>)
and translucency (<span class="code">Opacity</span>).  You can optionally also resample
the image with alpha blend using the <span class="code">SourceScale</span> property.
</p><p>
This code demonstrates the using the code with default options:
</p><pre>
Private m_cShadowCreator As cDIBShadowCreator

   ' Load the source image:
   Dim sPic As StdPicture
   sPic = LoadPicture("C:\mypicture.bmp")
   Dim cSource As New cAlphaDibSection
   cSource.CreateFromPicture sPic     
   
   ' Add source image to the shadow creator:
   m_cShadowCreator.DibSource = cSource
   ' Create a shadowed version using the defaults:
   m_cShadowCreator.CreateShadow

   ' Display the shadow on this form:
   m_cShadowCreator.DibResult.AlphaPaintPicture Me.hDC
</pre><p>
This sort of code can be used to dynamically create shadowed buttons from
a source image, and allow them to "pop-up" when the mouse is over
by providing a large shadow offset and then use a smaller shadow offset
when the button is down.
</p><h2>Conclusion</h2><p>
This sample demonstrates how to programmatically create drop-shadows from
any image with nice soft edges and controllable colour, transparency and
fuzziness.  Although the algorithm provided is used against a DIB Section 
it could also be easily applied to any 32bit bitmap source.
</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.asp\index.html">Image Processing</a>&#160;.&#160;Programmatic Creation of Drop-Shadows</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2004 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 17 April 2004</p></td><td></td></tr></table>
</body></html>