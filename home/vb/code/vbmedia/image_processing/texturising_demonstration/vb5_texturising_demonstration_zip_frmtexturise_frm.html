<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmTexturise.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmTexturise.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.asp\index.html">Image Processing</a>&#160;.&#160;<a href="article.html">Texturising Images </a>&#160;.&#160;<a href="vb5_texturising_demonstration.html">VB5 Texturising Demonstration</a>&#160;.&#160;frmTexturise.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_texturising_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Texturising Demonstration</a> (164K)</p><p /><p class="nav"><a href="vb6_texturising_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Texturising Demonstration</a> (161K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:3098</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3098&type=zip&title=vb5_20texturising_20demonstration_2ezip_5ffrmtexturise.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />13 Jan 2003<br />Added VB6 Download</p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\dib_sections\true_colour_dibsection\article.html">True Colour DIBSection</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmTexturise.frm</h1><pre>VERSION 5.00
Begin VB.Form frmTexturise 
   Caption         =   "Texturising Demo"
   ClientHeight    =   5970
   ClientLeft      =   2325
   ClientTop       =   1980
   ClientWidth     =   7845
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmTexturise.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   5970
   ScaleWidth      =   7845
   Begin VB.TextBox txtSaturation 
      Height          =   315
      Left            =   60
      TabIndex        =   13
      Text            =   "100"
      Top             =   4440
      Width           =   1500
   End
   Begin VB.PictureBox picStatus 
      Align           =   2  'Align Bottom
      Height          =   315
      Left            =   0
      ScaleHeight     =   255
      ScaleWidth      =   7785
      TabIndex        =   3
      Top             =   5655
      Width           =   7845
   End
   Begin pTexturiseDIB.cSlider sldTexture 
      Height          =   435
      Left            =   0
      TabIndex        =   11
      Top             =   3720
      Width           =   1635
      _ExtentX        =   2884
      _ExtentY        =   767
      Min             =   0
      Max             =   255
   End
   Begin VB.CommandButton cmdGo 
      Caption         =   "&amp;Go!"
      Height          =   315
      Left            =   60
      TabIndex        =   10
      Top             =   5340
      Width           =   915
   End
   Begin VB.TextBox txtMidValue 
      Height          =   315
      Left            =   60
      TabIndex        =   8
      Text            =   "64"
      Top             =   3360
      Width           =   1500
   End
   Begin VB.TextBox txtIntensity 
      Height          =   315
      Left            =   60
      TabIndex        =   6
      Text            =   "100"
      Top             =   2340
      Width           =   1500
   End
   Begin VB.PictureBox picTexture 
      Height          =   1335
      Left            =   60
      ScaleHeight     =   1275
      ScaleWidth      =   1440
      TabIndex        =   4
      Top             =   720
      Width           =   1500
   End
   Begin VB.ComboBox cboTexture 
      Height          =   315
      Left            =   60
      Sorted          =   -1  'True
      Style           =   2  'Dropdown List
      TabIndex        =   1
      Top             =   300
      Width           =   1500
   End
   Begin VB.PictureBox picImage 
      BeginProperty Font 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   5295
      Left            =   1620
      ScaleHeight     =   5235
      ScaleWidth      =   5775
      TabIndex        =   0
      Top             =   60
      Width           =   5835
   End
   Begin pTexturiseDIB.cSlider sldIntensity 
      Height          =   285
      Left            =   0
      TabIndex        =   12
      Top             =   2700
      Width           =   1635
      _ExtentX        =   2884
      _ExtentY        =   503
      Min             =   0
      Max             =   1000
      Value           =   0
   End
   Begin pTexturiseDIB.cSlider sldSaturation 
      Height          =   300
      Left            =   0
      TabIndex        =   14
      Top             =   4800
      Width           =   1635
      _ExtentX        =   2884
      _ExtentY        =   529
      Min             =   0
      Max             =   500
      Value           =   0
   End
   Begin VB.Label lblSaturation 
      Caption         =   "&amp;Saturation (%)"
      Height          =   195
      Left            =   60
      TabIndex        =   15
      Top             =   4200
      Width           =   1500
   End
   Begin VB.Label lblChosenColour 
      BackColor       =   &amp;H00404040&amp;
      BorderStyle     =   1  'Fixed Single
      Height          =   195
      Left            =   840
      TabIndex        =   9
      Top             =   3120
      Width           =   735
   End
   Begin VB.Label lblMidValue 
      Caption         =   "&amp;Mid Value:"
      Height          =   195
      Left            =   60
      TabIndex        =   7
      Top             =   3120
      Width           =   1500
   End
   Begin VB.Label lblIntensity 
      Caption         =   "&amp;Intensity (%):"
      Height          =   195
      Left            =   60
      TabIndex        =   5
      Top             =   2100
      Width           =   1500
   End
   Begin VB.Label lblTexture 
      Caption         =   "&amp;Texture:"
      Height          =   195
      Left            =   60
      TabIndex        =   2
      Top             =   60
      Width           =   2175
   End
End
Attribute VB_Name = "frmTexturise"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private Declare Function GetWindowLong Lib "user32" Alias "GetWindowLongA"
 (ByVal hwnd As Long, ByVal nIndex As Long) As Long
Private Declare Function SetWindowLong Lib "user32" Alias "SetWindowLongA"
 (ByVal hwnd As Long, ByVal nIndex As Long, ByVal dwNewLong As Long) As Long
Private Declare Function SetWindowPos Lib "user32" (ByVal hwnd As Long, ByVal
 hWndInsertAfter As Long, ByVal x As Long, ByVal y As Long, ByVal cx As Long,
 ByVal cy As Long, ByVal wFlags As Long) As Long
Private Const SWP_FRAMECHANGED = &amp;H20         '  The frame changed: send
 WM_NCCALCSIZE
Private Const SWP_NOACTIVATE = &amp;H10
Private Const SWP_NOMOVE = &amp;H2
Private Const SWP_NOOWNERZORDER = &amp;H200      '  Don't do owner Z ordering
Private Const SWP_NOSIZE = &amp;H1
Private Const SWP_NOZORDER = &amp;H4
Private Const GWL_STYLE = (-16)
Private Const GWL_EXSTYLE = (-20)
Private Const WS_EX_STATICEDGE = &amp;H20000
Private Const WS_EX_CLIENTEDGE = &amp;H200

Private m_cDibOrig As cDIBSection
Private m_cDibWork As cDIBSection
Private WithEvents m_cTexturise As cTexturise
Attribute m_cTexturise.VB_VarHelpID = -1
Private m_sDir As String
Private m_bOrig As Boolean

Private Sub cboTexture_Click()
Dim lIntensity As Long
Dim lMidValue As Long
Dim lSaturation As Long

   If (cboTexture.ListIndex &lt;= 0) Then
      picTexture.Cls
      m_bOrig = True
   Else
      m_bOrig = True
      If m_cTexturise.LoadTexture(m_sDir &amp; "\" &amp; cboTexture.Text &amp; ".bmp") Then
         ' Show texture:
         picTexture.Refresh
         ' do processing:
         lIntensity = CLng(txtIntensity)
         lMidValue = CLng(txtMidValue)
         lSaturation = CLng(txtSaturation)
         m_cTexturise.ApplyTexture m_cDibOrig, m_cDibWork, lIntensity,
          lMidValue, lSaturation
         m_bOrig = False
      Else
         picTexture.Refresh
      End If
   End If
   picImage.Refresh

End Sub

Private Sub cmdGo_Click()
   cboTexture_Click
End Sub

Private Sub Form_Load()
Dim sDir As String
Dim iPos As Long
Dim lStyle As Long

   lStyle = GetWindowLong(picStatus.hwnd, GWL_EXSTYLE)
   lStyle = lStyle And Not WS_EX_CLIENTEDGE Or WS_EX_STATICEDGE
   SetWindowLong picStatus.hwnd, GWL_EXSTYLE, lStyle
   SetWindowPos picStatus.hwnd, 0, 0, 0, 0, 0, SWP_NOMOVE Or SWP_NOSIZE Or
    SWP_NOZORDER Or SWP_NOOWNERZORDER Or SWP_FRAMECHANGED

   Me.Show
   Me.Refresh
   
   sldIntensity.Value = 100
   sldTexture.Value = 64
   sldSaturation.Value = 100
   
   Set m_cTexturise = New cTexturise
   
   Set m_cDibOrig = New cDIBSection
   m_cDibOrig.CreateFromPicture LoadPicture(App.Path &amp; "\demo.gif")
   Set m_cDibWork = New cDIBSection
   m_cDibWork.Create m_cDibOrig.Width, m_cDibOrig.Height
   m_cDibOrig.PaintPicture m_cDibWork.hDC
   
   cboTexture.AddItem "(None)"
   m_sDir = App.Path
   If Right$(m_sDir, 1) &lt;&gt; "\" Then m_sDir = m_sDir &amp; "\"
   m_sDir = m_sDir &amp; "Effects"
   sDir = Dir(m_sDir &amp; "\*.bmp")
   If (sDir = "") Then
      MsgBox "The folder " &amp; m_sDir &amp; " could not be found - no textures will
       be available.", vbInformation
   Else
      Do While sDir &lt;&gt; ""
         iPos = InStr(UCase$(sDir), ".BMP")
         cboTexture.AddItem left$(sDir, iPos - 1)
         sDir = Dir
      Loop
   End If
   cboTexture.ListIndex = 0
      
End Sub


Private Sub Form_Resize()
On Error Resume Next
   picImage.Move picImage.left, picImage.Top, Me.ScaleWidth - picImage.left -
    Screen.TwipsPerPixelX, Me.ScaleHeight - picImage.Top - picStatus.Height - 2
    * Screen.TwipsPerPixelY
End Sub

Private Sub m_cTexturise_Progress(ByVal lValue As Long, ByVal lMax As Long)
   picStatus.Cls
   picStatus.Print "   " &amp; lValue &amp; " of " &amp; lMax
End Sub

Private Sub picImage_Paint()
   If (m_bOrig) Then
      If Not m_cDibOrig Is Nothing Then
         m_cDibOrig.PaintPicture picImage.hDC
      End If
   Else
      If Not m_cDibWork Is Nothing Then
         m_cDibWork.PaintPicture picImage.hDC
      End If
   End If
End Sub

Private Sub picTexture_Paint()
   If Not m_cTexturise Is Nothing Then
      m_cTexturise.PaintTexture picTexture.hDC
   End If
End Sub


Private Sub sldIntensity_Scroll(ByVal lPos As Long)
   txtIntensity.Text = lPos
End Sub

Private Sub sldSaturation_Scroll(ByVal lPos As Long)
   txtSaturation.Text = lPos
End Sub

Private Sub sldTexture_Scroll(ByVal lPos As Long)
   txtMidValue.Text = lPos
End Sub

Private Sub txtIntensity_KeyPress(KeyAscii As Integer)
   If (KeyAscii = 8) Or (KeyAscii = Asc("-")) Or (KeyAscii &gt;= Asc("0") And
    (KeyAscii &lt;= Asc("9"))) Then
   Else
      KeyAscii = 0
   End If
End Sub

Private Sub txtMidValue_Change()
Dim lR As Long
   If IsNumeric(txtMidValue) Then
      lR = CLng(txtMidValue)
      If (lR &gt; 255) Then lR = 255
      If (lR &lt; 0) Then lR = 0
      lblChosenColour.BackColor = RGB(lR, lR, lR)
   End If
End Sub

Private Sub txtMidValue_KeyPress(KeyAscii As Integer)
   If (KeyAscii = 8) Or (KeyAscii &gt;= Asc("0") And (KeyAscii &lt;= Asc("9"))) Then
   Else
      KeyAscii = 0
   End If
End Sub


Private Sub txtSaturation_KeyPress(KeyAscii As Integer)
   If (KeyAscii = 8) Or (KeyAscii = Asc("-")) Or (KeyAscii &gt;= Asc("0") And
    (KeyAscii &lt;= Asc("9"))) Then
   Else
      KeyAscii = 0
   End If
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.html">vbMedia</a>&#160;.&#160;<a href="..\index.asp\index.html">Image Processing</a>&#160;.&#160;<a href="article.html">Texturising Images </a>&#160;.&#160;<a href="vb5_texturising_demonstration.html">VB5 Texturising Demonstration</a>&#160;.&#160;frmTexturise.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>