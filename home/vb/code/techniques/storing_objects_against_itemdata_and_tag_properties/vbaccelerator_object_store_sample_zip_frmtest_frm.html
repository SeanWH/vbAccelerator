<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmTest.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmTest.frm" /><link rel="stylesheet" href="..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\index.html">Code</a>&#160;.&#160;<a href="..\index.html">Techniques</a>&#160;.&#160;<a href="article.html">Storing Objects Against ItemData and Tag properties</a>&#160;.&#160;<a href="vbaccelerator_object_store_sample.html">vbAccelerator Object Store Sample</a>&#160;.&#160;frmTest.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vbaccelerator_object_store_sample.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />vbAccelerator Object Store Sample</a> (25K)</p><br /><br /><img src="..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:2300</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\linkto_asp\id=2300&type=zip&title=vbaccelerator_20object_20store_20sample_2ezip_5ffrmtest.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\res\update.png" width="8" height="8" alt="Update" />15 Aug 1999<br />First Posted</p><br /><br /><img src="..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\type_libraries\ishellfolder\article.html">IShellFolder Extended Type Library Version 1.2 (ISHF_Ex.Tlb)</a></p><br /><br /><img src="..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmTest.frm</h1><pre>VERSION 5.00
Begin VB.Form frmTest 
   Caption         =   "vbAccelerator: Storing Objects in ItemData/Tag
    properties."
   ClientHeight    =   6615
   ClientLeft      =   4335
   ClientTop       =   1740
   ClientWidth     =   6600
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmTest.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   6615
   ScaleWidth      =   6600
   Begin VB.ListBox lstIUnknown 
      Height          =   2790
      Left            =   2280
      TabIndex        =   7
      Top             =   1320
      Width           =   2055
   End
   Begin VB.CommandButton cmdEnum 
      Caption         =   "&amp;Enum Items"
      Height          =   375
      Left            =   120
      TabIndex        =   6
      Top             =   4860
      Width           =   1395
   End
   Begin VB.ListBox lstPerformance 
      Height          =   2010
      Left            =   2940
      TabIndex        =   5
      Top             =   4440
      Width           =   3555
   End
   Begin VB.CommandButton cmdClear 
      Caption         =   "&amp;Clear"
      Height          =   375
      Left            =   120
      TabIndex        =   4
      Top             =   5280
      Width           =   1395
   End
   Begin VB.TextBox txtItems 
      Height          =   315
      Left            =   1620
      TabIndex        =   3
      Text            =   "5000"
      Top             =   4440
      Width           =   1215
   End
   Begin VB.ListBox lstIMalloc 
      Height          =   2790
      Left            =   4440
      TabIndex        =   2
      Top             =   1320
      Width           =   2055
   End
   Begin VB.CommandButton cmdAdd 
      Caption         =   "&amp;Add Items"
      Height          =   375
      Left            =   120
      TabIndex        =   1
      Top             =   4440
      Width           =   1395
   End
   Begin VB.ListBox lstCollection 
      Height          =   2790
      Left            =   120
      TabIndex        =   0
      Top             =   1320
      Width           =   2055
   End
   Begin VB.Image imgIcon 
      Height          =   480
      Left            =   120
      Picture         =   "frmTest.frx":1272
      Top             =   60
      Width           =   480
   End
   Begin VB.Label Label2 
      Caption         =   "Using IMalloc to store and restore data in memory:"
      Height          =   435
      Left            =   4440
      TabIndex        =   11
      Top             =   720
      Width           =   2055
   End
   Begin VB.Label lblCaption 
      Caption         =   "Using ObjPtr and IUnknown to control reference
       count:"
      Height          =   435
      Index           =   1
      Left            =   2280
      TabIndex        =   10
      Top             =   720
      Width           =   2055
   End
   Begin VB.Label lblCaption 
      Caption         =   "The VB Way: Using a Collection"
      Height          =   435
      Index           =   0
      Left            =   120
      TabIndex        =   9
      Top             =   720
      Width           =   2055
   End
   Begin VB.Label lblInfo 
      Caption         =   "This demo program compares three methods of storing
       objects against a ListBox's ItemData property."
      Height          =   495
      Left            =   660
      TabIndex        =   8
      Top             =   60
      Width           =   5655
   End
End
Attribute VB_Name = "frmTest"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

' ==========================================================
' Storing Objects against a controls ItemData or Tag
' property.
'
' This sample demonstrates three different techniques for
' storing an object in a long or string variable.  By
' running the tests at different numbers of items, you
' can determine which is most useful for your app.
'
'
' Copyright  1999 Steve McMahon
' steve@vbaccelerator.com
'
' Uses the ISHF_Ex.tlb from Brad Martinez excellent
' EnumDeskVB sample (version 2). Visit his site at:
' http://www.mvps.org/btmtz/
'
' ----------------------------------------------------------
' vbAccelerator - advanced, free source code:
' http://vbAccelerator.com/
' ==========================================================

Private m_lS As Long
Private Declare Function timeGetTime Lib "winmm.dll" () As Long
Private Declare Function timeBeginPeriod Lib "winmm.dll" (ByVal uPeriod As
 Long) As Long
Private Declare Function timeEndPeriod Lib "winmm.dll" (ByVal uPeriod As Long)
 As Long

Private m_cVB As cListBoxStorageClass
Private m_cIU As cListBoxStorageIUnknown
Private m_cIM As cListBoxStorageIMalloc

Private Sub StartTime()
   timeBeginPeriod 1
   m_lS = timeGetTime()
End Sub
Private Function StopTime(ByVal sMsg As String) As Long
Dim lStopTime As Long
   lStopTime = timeGetTime() - m_lS
   lstPerformance.AddItem sMsg &amp; " : " &amp; lStopTime
   StopTime = lStopTime
   timeEndPeriod 1
End Function
Private Function GetNumber(ByVal sText As String) As Long
Dim l As Long
On Error Resume Next
   l = CStr(sText)
   If Err.Number = 0 Then
      GetNumber = l
   Else
      MsgBox "Error: " &amp; Err.Description
   End If
End Function

Private Sub cmdAdd_Click()
Dim i As Long
Dim lNum As Long
Dim cD As cListBoxItem
   
   lNum = GetNumber(txtItems.Text)
   
   ' Test collection method:
   lstCollection.Visible = False
   StartTime
   For i = 1 To lNum
      lstCollection.AddItem "Test" &amp; i
      Set cD = New cListBoxItem
      cD.ItemData = i * 5
      cD.ItemExtraData = i * 10
      cD.ItemString = i &amp; "Test"
      m_cVB.ItemData(i - 1) = cD
   Next i
   StopTime "VB:Add-" &amp; lNum
   lstCollection.Visible = True
   
   ' Test IUnknown method:
   lstIUnknown.Visible = False
   StartTime
   For i = 1 To lNum
      lstIUnknown.AddItem "Test" &amp; i
      Set cD = New cListBoxItem
      cD.ItemData = i * 5
      cD.ItemExtraData = i * 10
      cD.ItemString = i &amp; "Test"
      m_cIU.ItemData(i - 1) = cD
   Next i
   StopTime "IUnknown:Add-" &amp; lNum
   lstIUnknown.Visible = True
   
   
   ' Test IMalloc method:
   lstIMalloc.Visible = False
   StartTime
   For i = 1 To lNum
      lstIMalloc.AddItem "Test" &amp; i
      cD.ItemData = i * 5
      cD.ItemExtraData = i * 10
      cD.ItemString = i &amp; "Test"
      m_cIM.ItemData(i - 1) = cD
   Next i
   StopTime "IMalloc:Add-" &amp; lNum
   lstIMalloc.Visible = True
   
End Sub

Private Sub cmdClear_Click()
      
   ' To prevent the speed of ListBox redraw
   ' from affecting the results, make the
   ' ListBox invisible whilst modifying the
   ' contents:
   lstIUnknown.Visible = False
   lstIMalloc.Visible = False
   lstCollection.Visible = False
   
   ' Test VB collection clear:
   StartTime
   m_cVB.Clear
   StopTime "VB:Clear"
   
   ' Test IUnknown clear:
   StartTime
   m_cIU.Clear
   StopTime "IUnknown:Clear"
   
   ' Test IMalloc clear:
   StartTime
   m_cIM.Clear
   StopTime "IMalloc:Clear"
   
   
   
   lstIUnknown.Visible = True
   lstIMalloc.Visible = True
   lstCollection.Visible = True
   
End Sub

Private Sub cmdEnum_Click()
Dim cD As cListBoxItem
Dim i As Long
Dim l As Long
   
   StartTime
   For i = 0 To lstCollection.ListCount - 1
      Set cD = m_cVB.ItemData(i)
      l = cD.ItemData
   Next i
   StopTime "VB:Enum-" &amp; i
   
   StartTime
   For i = 0 To lstIUnknown.ListCount - 1
      Set cD = m_cIU.ItemData(i)
      l = cD.ItemData
   Next i
   StopTime "IUnknown:Enum-" &amp; i
   
   StartTime
   For i = 0 To lstIMalloc.ListCount - 1
      Set cD = m_cIM.ItemData(i)
      l = cD.ItemData
   Next i
   StopTime "IMalloc:Enum-" &amp; i
   
   
End Sub

Private Sub Form_Load()
   
   Me.Icon = imgIcon.Picture
   
   ' Prepare the objects:
   Set m_cVB = New cListBoxStorageClass
   Set m_cIM = New cListBoxStorageIMalloc
   Set m_cIU = New cListBoxStorageIUnknown
   
   m_cVB.Initialise lstCollection
   m_cIU.Initialise lstIUnknown
   m_cIM.Initialise lstIMalloc
   
End Sub

Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)
   ' Force a clear on unload; this is
   ' not strictly necessary since the
   ' termination of the objects will
   ' do this:
   cmdClear_Click
   
End Sub

Private Sub lstCollection_DblClick()
   ' Display data associated with an item when
   ' it is double clicked:
   If lstCollection.ListIndex &gt; -1 Then
      With m_cVB.ItemData(lstCollection.ListIndex)
         MsgBox .ItemData &amp; "," &amp; .ItemExtraData &amp; "," &amp; .ItemString,
          vbInformation
      End With
   End If
End Sub

Private Sub lstIMalloc_DblClick()
   ' Display data associated with an item when
   ' it is double clicked:
   If lstIMalloc.ListIndex &gt; -1 Then
      With m_cIM.ItemData(lstIMalloc.ListIndex)
         MsgBox .ItemData &amp; "," &amp; .ItemExtraData &amp; "," &amp; .ItemString,
          vbInformation
      End With
   End If

End Sub

Private Sub lstIUnknown_Click()
   ' Display data associated with an item when
   ' it is double clicked:
   If lstIUnknown.ListIndex &gt; -1 Then
      With m_cIU.ItemData(lstIUnknown.ListIndex)
         MsgBox .ItemData &amp; "," &amp; .ItemExtraData &amp; "," &amp; .ItemString,
          vbInformation
      End With
   End If

End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\libraries\compression\index.html" ><IMG SRC="..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\index.html">Code</a>&#160;.&#160;<a href="..\index.html">Techniques</a>&#160;.&#160;<a href="article.html">Storing Objects Against ItemData and Tag properties</a>&#160;.&#160;<a href="vbaccelerator_object_store_sample.html">vbAccelerator Object Store Sample</a>&#160;.&#160;frmTest.frm</p><br /><p class="nav"><a href="..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>