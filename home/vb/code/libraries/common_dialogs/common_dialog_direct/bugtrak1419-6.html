<html lang="en" >
<head>
<title>vbAccelerator - Making A File Common Dialog Open in Details or Large Icon View</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="
Common Dialog/Direct is a new DLL or class library which shows how to completely replace 
COMDLG32.OCX through Visual Basic code. The main advantage of this is you no longer need 
to put a control on a form to use common dialogs - just declare an instance of the class and 
you have a straight replacement. You can also incorporate the Common Dialog/Direct code 
straight into your own project if you want to reduce dependency files when you 
ship your project.
" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Common Dialogs</a>&#160;.&#160;<a href="article.html">CommonDialog/Direct</a>&#160;.&#160;<a href="bugtrak.html">BugTrak Summary</a>&#160;.&#160;Making A File Common Dialog Open in Details or Large Icon View</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_common_dialog_direct_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Common Dialog Direct Binary</a> (32K)</p><p class="nav"><a href="vb5_common_dialog_direct_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Common Dialog Direct Demonstration</a> (19K)</p><p class="nav"><a href="vb5_common_dialog_direct_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Common Dialog Direct Full Source</a> (73K)</p><p /><p class="nav"><a href="vb6_common_dialog_direct_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Common Dialog Direct Binary</a> (32K)</p><p class="nav"><a href="vb6_common_dialog_direct_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Common Dialog Direct Demonstration</a> (14K)</p><p class="nav"><a href="vb6_common_dialog_direct_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Common Dialog Direct Full Source</a> (70K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:1419</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=1419&type=article&title=commondialog_2fdirect.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 3 / 4</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 2 / 3</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:8 December 2003</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />20 Jun 2003<br /><p class="update">Hook support now enabled for Print Dialogs.  The prior code did not
work as the structure was incorrectly aligned.  The new version fixes this problem.  Many
thanks to Uwe Wiemer and Klaus Probst for identifying the fix.
        </p><p class="update">Added a properties to return the selected Printer device name, driver
name and port.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Making A File Common Dialog Open in Details or Large Icon View</h1><h2>Summary</h2><table class="article"><tr><td>Id:</td><td>1419.6</td></tr><tr><td>Type:</td><td><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issue</td></tr><tr><td>Current Status:</td><td>Open</td></tr></table><h2>Detail</h2><table class="article"><tr class="header"><td>21&#160;Oct&#160;2003</td><td>Open</td><td width="100%">Ken Halter</td></tr><tr><td colspan="3"><p>I've been messing around with your CommonDialog Direct samples. There's a fair number of posts in the newsgroups asking how to open a common dialog in "Details" or "Large Icons" view and no samples in sight. Using your project, I managed to have them open in either of these views (small icons don't seem to work). fwiw, using a Timer and FindWindow, I can get this to work on normal Common Dialogs (VB's ocx) as well (in a compiled app). I'm sure it's possible but I didn't try real hard to get them to work on your non-hooked dialogs (without the timer).</p><p>There are very few changes involved. If interested, here they are....</p><p>The following changes were made to cCommonDialog.</p><pre>Public Enum ViewStyles
   [_NoViewProcess] = 0
   vsLargeIcons = &amp;H7029
   vsSmallIcons = &amp;H702A 'this doesn't seem to work
   vsList = &amp;H702B
   vsDetails = &amp;H702C
End Enum
Private meLocalViewStyle As ViewStyles
 
'Mods. '=========================================================
Private Sub Class_Initialize()
    m_lFilterIndex = 1
    meLocalViewStyle = [_NoViewProcess] 'set default
End Sub
 
Public Sub DialogClose()
    meLocalViewStyle = [_NoViewProcess] 'set default
    RaiseEvent DialogClose
End Sub
 
Public Function FolderChange(ByVal hDlg As Long) As Long
   If meLocalViewStyle &lt;&gt; [_NoViewProcess] Then
      Call SetView(hDlg, meLocalViewStyle)
   End If
   RaiseEvent FolderChange(hDlg)
End Function
'New property
Public Property Get ViewStyle() As ViewStyles
   ViewStyle = meLocalViewStyle
End Property
 
Public Property Let ViewStyle(ByVal Setting As ViewStyles)
   meLocalViewStyle = Setting
End Property '=========================================================
</pre><p>I added an additional module that consists of.... '=================================================================</p><pre>Option Explicit
 
Private Declare Function SendMessage _
   Lib "user32.dll" Alias "SendMessageA" _
   (ByVal hwnd As Long, ByVal wMsg As Long _
   , ByVal wParam As Long, lParam As Any) As Long
Private Declare Function GetClassName _
   Lib "user32.dll" Alias "GetClassNameA" _
   (ByVal hwnd As Long, ByVal lpClassName As String _
   , ByVal nMaxCount As Long) As Long
Private Declare Function EnumChildWindows _
   Lib "user32.dll" (ByVal hWndParent As Long _
   , ByVal lpEnumFunc As Long, ByVal lParam As Long) As Long Private Declare Function GetParent _
   Lib "user32.dll" (ByVal hwnd As Long) As Long
 
Private Const WM_COMMAND As Long = &amp;H111
Private meDesiredView As ViewStyles
 
Public Sub SetView(ByVal DLG As Long _
   , ByVal DesiredView As ViewStyles)
   Dim hwnd As Long
   meDesiredView = DesiredView
   hwnd = GetParent(DLG)
   Call EnumSelected(hwnd)
End Sub
 
Private Sub EnumSelected(hwnd As Long)
   Call EnumChildWindows(hwnd, AddressOf EnumChildProc, &amp;H0) End Sub
 
Public Function EnumChildProc(ByVal hwnd As Long, _
                              ByVal lParam As Long) As Long
 
   Dim lCont As Long
   Dim lRet As Long
   Dim sBuffer As String
 
   lCont = 1
 
   sBuffer = Space$(260)
   lRet = GetClassName(hwnd, sBuffer, Len(sBuffer))
 
   If InStr(1, sBuffer, "SHELLDLL_DefView") &gt; 0 Then
      Call SendMessage(hwnd, WM_COMMAND, meDesiredView, ByVal 0&amp;)
      lCont = 0 'stop looking for windows
   End If
 
   EnumChildProc = lCont
 
End Function '=================================================================
</pre><p>'Sample project mod (a single line of code)</p><pre>Private Sub cmdHookOpen_Click()
On Error GoTo cmdHookError
 
    With m_cHookDlg
        .DialogTitle = "Choose Text FIle"
        .CancelError = True
        .flags = OFN_FILEMUSTEXIST Or OFN_PATHMUSTEXIST
        .InitDir = "C:\STEVEMAC"
        .Filter = "Internet documents (*.HTM)|*.HTM|Text files (*.TXT)|*.TXT|All Files (*.*)|*.*"
        .FilterIndex = 1
        .HookDialog = True
        .ViewStyle = vsLargeIcons '&lt;&lt;&lt;&lt;========================================
        .ShowOpen
 
        txtFileName = .FileName
        txtFilter = .Filter
        txtContents = GetFileText(.FileName)
 
    End With
 
    Exit Sub
 
cmdHookError:
    If (Err.Number &lt;&gt; 20001) Then
        MsgBox "Error: " &amp; Err.Description
    End If
 
End Sub '=================================================================
</pre><p></p><p>I think that's about it. If you have no interest in adding this functionality to your class, I can always post these mods on my site and require people to download your classes first. Either way, I think this will come in handy. I plan on posting the Timer based sample as well in case people want to use VBs common dialog.</p><p></p><p>Ken Halter - MS-MVP-VB</p></td></tr></table><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Common Dialogs</a>&#160;.&#160;<a href="article.html">CommonDialog/Direct</a>&#160;.&#160;<a href="bugtrak.html">BugTrak Summary</a>&#160;.&#160;Making A File Common Dialog Open in Details or Large Icon View</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 21 October 2003</p></td><td></td></tr></table>
</body></html>