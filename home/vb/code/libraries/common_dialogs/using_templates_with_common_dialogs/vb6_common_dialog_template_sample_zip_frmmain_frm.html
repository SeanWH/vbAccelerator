<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmMain.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmMain.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Common Dialogs</a>&#160;.&#160;<a href="article.html">Common Dialog Templates - Create a WinZip Style File Add Dialog</a>&#160;.&#160;<a href="vb6_common_dialog_template_sample.html">VB6 Common Dialog Template Sample</a>&#160;.&#160;frmMain.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_common_dialog_template_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Common Dialog Template Sample</a> (87K)</p><p /><p class="nav"><a href="vb6_common_dialog_template_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Common Dialog Template Sample</a> (80K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:1870</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=1870&type=zip&title=vb6_20common_20dialog_20template_20sample_2ezip_5ffrmmain.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:cayce@fastlane.net">Cayce Cochran</a></p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />19 Dec 2002<br />VB6 Version Added</p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\common_dialog_direct\article.html">CommonDialog/Direct</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmMain.frm</h1><pre>VERSION 5.00
Begin VB.Form frmMain 
   BorderStyle     =   3  'Fixed Dialog
   Caption         =   "Custom Dialog Template Sample"
   ClientHeight    =   2640
   ClientLeft      =   3090
   ClientTop       =   2730
   ClientWidth     =   6525
   Icon            =   "frmMain.frx":0000
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   2640
   ScaleWidth      =   6525
   ShowInTaskbar   =   0   'False
   Begin VB.CheckBox chkFlatTB 
      Caption         =   "&amp;Make Dlg Toolbar Flat"
      Height          =   270
      Left            =   4440
      TabIndex        =   4
      Top             =   1575
      Width           =   1920
   End
   Begin VB.CommandButton cmdClose 
      Cancel          =   -1  'True
      Caption         =   "&amp;Close"
      Height          =   345
      Left            =   4455
      TabIndex        =   3
      Top             =   900
      Width           =   1920
   End
   Begin VB.CommandButton cmdShow 
      Caption         =   "&amp;Show Custom Dialog"
      Default         =   -1  'True
      Height          =   345
      Left            =   4455
      TabIndex        =   2
      Top             =   465
      Width           =   1920
   End
   Begin VB.ListBox List1 
      Height          =   2010
      Left            =   120
      TabIndex        =   1
      Top             =   465
      Width           =   4080
   End
   Begin VB.Label Label1 
      Caption         =   "Custom WM_COMMAND Messages"
      Height          =   345
      Left            =   120
      TabIndex        =   0
      Top             =   105
      Width           =   2805
   End
End
Attribute VB_Name = "frmMain"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private WithEvents m_cHookAddDlg As cCommonDialog
Attribute m_cHookAddDlg.VB_VarHelpID = -1

'Constants for custom dialog template
Private Const DLG_DIALOG = 1900
Private Const IDC_BUTTONPWD = 3010
Private Const IDC_BUTTONWILD = 1901
Private Const IDC_LBLACTION = 508
Private Const IDC_CBOACTION = 502
Private Const IDC_LBLCOMPRESS = 509
Private Const IDC_CBOCOMPRESS = 503
Private Const IDC_LBLSPAN = 511
Private Const IDC_CBOSPAN = 504
Private Const IDC_CHK83 = 3006
Private Const IDC_GRPFOLDERS = 510
Private Const IDC_CHKSUBFLDR = 506
Private Const IDC_CHKEXTRAFLDR = 507
Private Const IDC_GRPATTRS = 203
Private Const IDC_CHKINCARCHSET = 3008
Private Const IDC_CHKRESETARCH = 3009
Private Const IDC_CHKINCHIDSYS = 3007

Private Sub chkFlatTB_Click()
    m_cHookAddDlg.FlatToolBar = CBool(chkFlatTB.Value)
End Sub

Private Sub cmdClose_Click()
    Unload Me
End Sub

Private Sub cmdShow_Click()
On Error GoTo Err_Handler
    Dim sFiles() As String
    Dim lFileCount As Long
    Dim sDir As String
    Dim I As Long
    
    List1.Clear
    
    With m_cHookAddDlg
        .CancelError = True
        .DefaultExt = "cab"
        .DialogTitle = "Add Files"
        .Filter = "All files|*.*"
        .Filename = "*.*"
        .flags = EOpenFile.OFN_ALLOWMULTISELECT Or EOpenFile.OFN_HIDEREADONLY
         Or _
                EOpenFile.OFN_ENABLETEMPLATE Or EOpenFile.OFN_FILEMUSTEXIST Or _
                EOpenFile.OFN_EXPLORER Or EOpenFile.OFN_SHOWHELP
        .hwnd = Me.hwnd
        .HookDialog = True
#If DebugOn Then
        'If we are running from the IDE the dialog resource
        'needs to be loaded from a DLL.
        .cdLoadLibrary App.Path &amp; "\WAdlgres.dll" 'NEW property
#Else
        'If we are running from an EXE the dialog resource
        'can be loaded from the included RES file.
        .hInstance = App.hInstance 'NEW property (I think I added this??)
#End If
        .TemplateName = DLG_DIALOG
    End With
    m_cHookAddDlg.ShowOpen
    
    If m_cHookAddDlg.flags And EOpenFile.OFN_ALLOWMULTISELECT Then
        'Might think about adding a FileNames collection
        m_cHookAddDlg.ParseMultiFileName sDir, sFiles(), lFileCount
        List1.AddItem Format(lFileCount, "###,###") &amp; " files chosen from " &amp;
         sDir &amp; ":"
        For I = 1 To lFileCount
            List1.AddItem "    " &amp; sFiles(I)
        Next
    Else
        List1.AddItem "One file chosen: " &amp; m_cHookAddDlg.Filename
    End If
    
cmdShow_Exit:
#If DebugOn Then
    'If we are running from the IDE the dialog resource
    'was loaded from a DLL, free it.
    If m_cHookAddDlg.hInstance &gt; 0 Then m_cHookAddDlg.cdFreeLibrary 'NEW
     property
#End If
    Exit Sub
    
Err_Handler:
    If (Err.Number &lt;&gt; 20001) Then
        MsgBox "Error: " &amp; Err.Description
    Else
        List1.AddItem "User canceled dialog!"
    End If
    Resume cmdShow_Exit
End Sub

Private Sub Form_Load()
    Set m_cHookAddDlg = New cCommonDialog
    chkFlatTB.Value = vbChecked
End Sub

Private Sub Form_Unload(Cancel As Integer)
    Set frmMain = Nothing
End Sub

Private Sub m_cHookAddDlg_Help(ByVal hDlg As Long)
    List1.AddItem "User requested help!"
End Sub

Private Sub m_cHookAddDlg_InitDialog(ByVal hDlg As Long)
'You can do all kinds of cool things here.  I have only done
'a few but, you can also do things like add a control box icon.
    Dim hParent As Long
    Dim hWndCtrl As Long
    Dim lRet As Long
    Const CB_INSERTSTRING = &amp;H14A
    Const CB_SETITEMDATA = &amp;H151
    Const CB_SETCURSEL = &amp;H14E
    Const BM_SETCHECK = &amp;HF1
    
    hParent = GetParent(hDlg)
    SendMessageStr hParent, CDM_SETCONTROLTEXT, ID_FOLDERLABEL, "Add &amp;from:"
    SendMessageStr hParent, CDM_SETCONTROLTEXT, ID_OPEN, "&amp;Add"
    
    ' Added FlatToolBar property to cCommonDialog class and
    ' the FlatCDTBar procedure to the mDialogHook module.
    ' FlatCDTBar is called from the DialogHook procedure in the
    ' GCommonDialog class.
    'If chkFlatTB.Value = vbChecked Then FlatCDTBar hParent
    
'    lRet = EnableWindow(GetDlgItem(hDlg, IDC_BUTTONPWD), False)
    
    hWndCtrl = GetDlgItem(hDlg, IDC_CBOACTION)
    lRet = SendMessageStr(hWndCtrl, CB_INSERTSTRING, 0&amp;, "Add Files")
    lRet = SendMessageLong(hWndCtrl, CB_SETITEMDATA, 0&amp;, 2&amp;)
    lRet = SendMessageStr(hWndCtrl, CB_INSERTSTRING, 1&amp;, "Move Files")
    lRet = SendMessageLong(hWndCtrl, CB_SETITEMDATA, 1&amp;, -1&amp;)
    lRet = SendMessageLong(hWndCtrl, CB_SETCURSEL, 0&amp;, 0&amp;)

    hWndCtrl = GetDlgItem(hDlg, IDC_CBOCOMPRESS)
    lRet = SendMessageStr(hWndCtrl, CB_INSERTSTRING, 0&amp;, "None")
    lRet = SendMessageLong(hWndCtrl, CB_SETITEMDATA, 0&amp;, 0&amp;)
    lRet = SendMessageStr(hWndCtrl, CB_INSERTSTRING, 1&amp;, "MSZIP")
    lRet = SendMessageLong(hWndCtrl, CB_SETITEMDATA, 1&amp;, 1&amp;)
    lRet = SendMessageStr(hWndCtrl, CB_INSERTSTRING, 2&amp;, "LZX")
    lRet = SendMessageLong(hWndCtrl, CB_SETITEMDATA, 2&amp;, 3&amp;)
    lRet = SendMessageLong(hWndCtrl, CB_SETCURSEL, 1&amp;, 0&amp;)
    
    hWndCtrl = GetDlgItem(hDlg, IDC_CBOSPAN)
    lRet = SendMessageStr(hWndCtrl, CB_INSERTSTRING, 0&amp;, "Not implemented")
    lRet = SendMessageLong(hWndCtrl, CB_SETCURSEL, 0&amp;, 0&amp;)
    lRet = EnableWindow(GetDlgItem(hDlg, IDC_LBLSPAN), False)
    lRet = EnableWindow(GetDlgItem(hDlg, IDC_CBOSPAN), False)

    hWndCtrl = GetDlgItem(hDlg, IDC_CHK83)
    lRet = SendMessageLong(hWndCtrl, BM_SETCHECK, 0&amp;, 0&amp;)

    hWndCtrl = GetDlgItem(hDlg, IDC_CHKSUBFLDR)
    lRet = SendMessageLong(hWndCtrl, BM_SETCHECK, 1&amp;, 0&amp;)

    hWndCtrl = GetDlgItem(hDlg, IDC_CHKEXTRAFLDR)
    lRet = SendMessageLong(hWndCtrl, BM_SETCHECK, 1&amp;, 0&amp;)

    hWndCtrl = GetDlgItem(hDlg, IDC_CHKINCARCHSET)
    lRet = SendMessageLong(hWndCtrl, BM_SETCHECK, 0&amp;, 0&amp;)

    hWndCtrl = GetDlgItem(hDlg, IDC_CHKRESETARCH)
    lRet = SendMessageLong(hWndCtrl, BM_SETCHECK, 0&amp;, 0&amp;)

    hWndCtrl = GetDlgItem(hDlg, IDC_CHKINCHIDSYS)
    lRet = SendMessageLong(hWndCtrl, BM_SETCHECK, 0&amp;, 0&amp;)
End Sub

Private Sub FlatCDTBar(hParent As Long)
    Dim lStyle As Long
    Dim hToolbar As Long
    Dim lRet As Long
    Const TB_SETSTYLE = &amp;H400 + 56
    Const TB_GETSTYLE = &amp;H400 + 57
    Const TBSTYLE_FLAT = &amp;H800

    hToolbar = FindWindowEx(hParent, 0&amp;, _
                "ToolbarWindow32", vbNullString)
    lStyle = SendMessageLong(hToolbar, _
                    TB_GETSTYLE, 0&amp;, 0&amp;)
    If lStyle And TBSTYLE_FLAT Then
        lStyle = lStyle Xor TBSTYLE_FLAT
    Else
        lStyle = lStyle Or TBSTYLE_FLAT
    End If
    lRet = SendMessageLong(hToolbar, TB_SETSTYLE, 0, lStyle)
End Sub


Private Sub m_cHookAddDlg_InitDone(ByVal hDlg As Long)
    m_cHookAddDlg.CentreDialog hDlg, Me
End Sub

Private Sub m_cHookAddDlg_WMCommand(ByVal hDlg As Long, wParam As Long, lParam
 As Long)
 'NEW event!  This is provided so you can respond to users who play
 'with your newly added toys.
    Dim lRet As Long
    Dim lNotify As Long
    Dim lCtrlID As Long
    Dim sCaption As String
    Dim sCaption1 As String
    Const BN_CLICKED = 0
    Const CBN_CLOSEUP = 8
    Const BM_GETCHECK = &amp;HF0
    Const CB_GETCURSEL = &amp;H147
    Const CB_GETITEMDATA = &amp;H150

    lNotify = Get_HiWord(wParam)
    Select Case lNotify
        Case BN_CLICKED
            lCtrlID = Get_LoWord(wParam)
            Select Case lCtrlID
                Case IDC_CHKEXTRAFLDR
                    List1.AddItem "'Save Extra Folder Info' checked = " &amp; _
                        CBool(SendMessageLong(lParam, _
                        BM_GETCHECK, 0&amp;, 0&amp;))
                Case IDC_CHKSUBFLDR
                    List1.AddItem "'Recurse Sub Folders' checked = " &amp; _
                        CBool(SendMessageLong(lParam, _
                        BM_GETCHECK, 0&amp;, 0&amp;))
                Case IDC_CHK83
                    List1.AddItem "'Save Filenames In 8.3 Format' checked = " &amp;
                     _
                        CBool(SendMessageLong(lParam, _
                        BM_GETCHECK, 0&amp;, 0&amp;))
                Case IDC_CHKINCARCHSET
                    List1.AddItem "'Include Only If Archive Bit Set' checked =
                     " &amp; _
                        CBool(SendMessageLong(lParam, _
                        BM_GETCHECK, 0&amp;, 0&amp;))
                Case IDC_CHKRESETARCH
                    List1.AddItem "'Reset Archive Bit' checked = " &amp; _
                        CBool(SendMessageLong(lParam, _
                        BM_GETCHECK, 0&amp;, 0&amp;))
                Case IDC_CHKINCHIDSYS
                    List1.AddItem "'Include Hidden and System Files' checked =
                     " &amp; _
                        CBool(SendMessageLong(lParam, _
                        BM_GETCHECK, 0&amp;, 0&amp;))
                Case IDC_BUTTONPWD
                    List1.AddItem "Password " &amp; frmPassword.Display(False, Me) _
                        &amp; " entered."
                Case IDC_BUTTONWILD
                    List1.AddItem "'Add/Move With Wildcard' clicked"
                    lRet = SendMessageLong(GetParent(hDlg), _
                                        WM_CLOSE, _
                                        0&amp;, _
                                        0&amp;)
            End Select
        Case CBN_CLOSEUP
            lCtrlID = Get_LoWord(wParam)
            Select Case lCtrlID
                Case IDC_CBOACTION
                    lRet = SendMessageLong(lParam, CB_GETCURSEL, 0&amp;, 0&amp;)
                    Select Case lRet
                        Case 0
                            sCaption = "&amp;Add"
                            sCaption1 = "Add With &amp;Wildcards"
                            List1.AddItem "Action 'Add Files' chosen"
                            SendMessageStr GetParent(hDlg), CDM_SETCONTROLTEXT,
                             _
                                ID_FOLDERLABEL, "Add &amp;from:"
                        Case 1
                            sCaption = "&amp;Move"
                            sCaption1 = "Move With &amp;Wildcards"
                            List1.AddItem "Action 'Move Files' chosen"
                            SendMessageStr GetParent(hDlg), CDM_SETCONTROLTEXT,
                             _
                                ID_FOLDERLABEL, "Move &amp;from:"
                    End Select
                    SendMessageStr GetParent(hDlg), _
                            CDM_SETCONTROLTEXT, ID_OPEN, sCaption
                    SetDlgItemText GetParent(lParam), _
                            IDC_BUTTONWILD, sCaption1
                    List1.AddItem "Action item data = " &amp;
                     SendMessageLong(lParam, _
                        CB_GETITEMDATA, lRet, 0&amp;)
                Case IDC_CBOCOMPRESS
                    lRet = SendMessageLong(lParam, CB_GETCURSEL, 0&amp;, 0&amp;)
                    Select Case lRet
                        Case 0
                            List1.AddItem "Compression 'None' chosen"
                        Case 1
                            List1.AddItem "Compression 'MSZip' chosen"
                        Case 2
                            List1.AddItem "Compression 'LZX' chosen"
                    End Select
                    List1.AddItem "Compression item data = " &amp;
                     SendMessageLong(lParam, _
                        CB_GETITEMDATA, lRet, 0&amp;)
            End Select
    End Select
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Common Dialogs</a>&#160;.&#160;<a href="article.html">Common Dialog Templates - Create a WinZip Style File Add Dialog</a>&#160;.&#160;<a href="vb6_common_dialog_template_sample.html">VB6 Common Dialog Template Sample</a>&#160;.&#160;frmMain.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>