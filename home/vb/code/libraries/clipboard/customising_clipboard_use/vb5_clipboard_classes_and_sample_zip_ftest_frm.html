<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: fTest.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: fTest.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Clipboard</a>&#160;.&#160;<a href="article.html">Customising Clipboard Use </a>&#160;.&#160;<a href="vb5_clipboard_classes_and_sample.html">VB5 Clipboard Classes and Sample</a>&#160;.&#160;fTest.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="rtf_format_copy_and_paste_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />RTF Format Copy and Paste Sample</a> (25K)</p><p /><p class="nav"><a href="vb5_clipboard_classes_and_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Clipboard Classes and Sample</a> (22K)</p><p /><p class="nav"><a href="vb6_clipboard_classes_and_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Clipboard Classes and Sample</a> (19K)</p><p class="nav"><a href="vb6_clipoard_classes_and_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Clipoard Classes and Sample</a> (23K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:3689</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3689&type=zip&title=vb5_20clipboard_20classes_20and_20sample_2ezip_5fftest.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />23 Aug 2003<br /><p class="update">Modified the clipboard viewer task to ensure it removes itself from the
clipboard chain at the right point.  Previously the class could attempt to remove itself
from the chain after the owning Window was destroyed, which would not work.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\utilities\goldfish\article.html">Goldfish</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: fTest.frm</h1><pre>VERSION 5.00
Begin VB.Form fTest 
   Caption         =   "Simple Clipboard 'Viewer'"
   ClientHeight    =   3495
   ClientLeft      =   3975
   ClientTop       =   2250
   ClientWidth     =   5190
   Icon            =   "fTest.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   3495
   ScaleWidth      =   5190
   Begin VB.CheckBox chkHex 
      Caption         =   "Show Hex"
      Height          =   255
      Left            =   2460
      TabIndex        =   5
      Top             =   300
      Width           =   2535
   End
   Begin VB.TextBox txtView 
      Height          =   2775
      Left            =   2460
      MultiLine       =   -1  'True
      ScrollBars      =   2  'Vertical
      TabIndex        =   1
      Top             =   600
      Width           =   2655
   End
   Begin VB.ListBox lstFormats 
      Height          =   2595
      Left            =   60
      TabIndex        =   0
      Top             =   300
      Width           =   2295
   End
   Begin VB.PictureBox picView 
      AutoRedraw      =   -1  'True
      Height          =   2775
      Left            =   2460
      ScaleHeight     =   2715
      ScaleWidth      =   2595
      TabIndex        =   4
      Top             =   600
      Width           =   2655
   End
   Begin VB.Label lblView 
      Caption         =   "Text/Picture View:"
      Height          =   255
      Left            =   2400
      TabIndex        =   3
      Top             =   60
      Width           =   2655
   End
   Begin VB.Label lblFormats 
      Caption         =   "Clipboard Formats"
      Height          =   195
      Left            =   60
      TabIndex        =   2
      Top             =   60
      Width           =   2295
   End
End
Attribute VB_Name = "fTest"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

' Class provides clipboard viewer properties and methods:
Private WithEvents m_cCV As cClipboardViewer
Attribute m_cCV.VB_VarHelpID = -1
' Class to access the clipboard without restriction:
Private m_cClip As New cCustomClipboard

Private Sub chkHex_Click()
   ' Requery the clipboard:
   lstFormats_Click
End Sub

Private Sub Form_Load()
   
   ' Here we initialise the clipboard viewer class.
   ' This makes the application part of the clipboard
   ' chain, so that whenever the clipboard contents
   ' change, the class will raise a ClipboardChanged
   ' event:
   Set m_cCV = New cClipboardViewer
   m_cCV.InitClipboardChangeNotification Me.hWnd
   
End Sub

Private Sub lstFormats_Click()
Dim lID As Long
Dim sText As String
Dim hBmp As Long
Dim sOut As String
Dim sHex As String
Dim bData() As Byte
Dim sFiles() As String
Dim iFileCount As Long
Dim i As Long, l As Long

    Screen.MousePointer = vbHourglass
    txtView.Text = ""
    If (lstFormats.ListCount &gt; 0) Then
      lID = lstFormats.ItemData(lstFormats.ListIndex)
      Select Case lID
      Case CF_BITMAP
          ' Here is the simple way!
          Set picView = Clipboard.GetData(CF_BITMAP)
          picView.ZOrder
          
          ' As an example, here is the hard way to do it
          ' - the clipboard contains a bitmap handle:
          'picView.Cls
          'If (m_cClip.ClipboardOpen(Me.hWnd)) Then
          '   dim hBmp as long, hBmpOld as long, hDC as long, tBM as BITMAP
          '    hBmp = m_cClip.GetClipboardMemoryHandle(CF_BITMAP)
          '    hDC = CreateCompatibleDC(picView.hDC)
          '    hBmpOld = SelectObject(hDC, hBmp)
          '    GetObjectAPI pic.Handle, Len(tBM), tBM
          '    BitBlt picView.hDC,0,0, tBM.bmWidth,tBM.bmHeight, hDC,0,0,SRCCOPY
          '    SelectObject hDC,hBmpOld
          '    DeleteObject hDC
          '    m_cClip.ClipboardClose
          'End If
          
      Case CF_DIB
           ' The simple way!
          Set picView = Clipboard.GetData(CF_DIB)
          picView.ZOrder
          
          ' Actually, the clipboard handle points to a BITMAPINFO
          ' structure followed by the bitmap bits.  Left as an
          ' exercise...  See my Image Processing sample for details
          ' of DIB Sections to find out a bit more.
          
      Case CF_ENHMETAFILE
          ' The simple way!
          Set picView = Clipboard.GetData(CF_ENHMETAFILE)
          picView.ZOrder
          
         ' The clipboard handle is a handle to an Enhanced Metafile:
         ' Left as an exercise.
          
      Case CF_HDROP
          ' the clipboard handle can be passed to the DragQueryFile
          ' function to get the information:
          txtView.ZOrder
          If m_cClip.ClipboardOpen(Me.hWnd) Then
              m_cClip.GetFileList sFiles(), iFileCount
              For i = 1 To iFileCount
                 txtView.Text = txtView.Text &amp; sFiles(i) &amp; vbCrLf
              Next i
          End If
          
      Case CF_METAFILEPICT
          ' The clipboard handle is a handle to an old style Metafile:
          Set picView = Clipboard.GetData(CF_ENHMETAFILE)
          
      Case Else
          ' Assume Text
          If (m_cClip.ClipboardOpen(Me.hWnd)) Then
              If chkHex.Value = 1 Then
                  ' Do Hex - get a byte array of clipboard
                  ' data and show that:
                  m_cClip.GetBinaryData lID, bData()
                  For l = LBound(bData) To UBound(bData)
                      sHex = Hex$(bData(l))
                      If (Len(sHex) &lt; 2) Then sHex = "0" &amp; sHex
                      sOut = sOut &amp; sHex
                      If ((l + 1) Mod 8) = 0 Then
                          sOut = sOut &amp; vbCrLf
                      Else
                          sOut = sOut &amp; "  "
                      End If
                  Next l
                  txtView = sOut
              Else
                  ' Get a string and show that:
                  If (m_cClip.GetTextData(lID, sText)) Then
                      txtView.Text = sText
                  End If
              End If
              m_cClip.ClipboardClose
          End If
          txtView.ZOrder
      End Select
    End If
    Screen.MousePointer = vbNormal
End Sub

Private Sub m_cCV_ClipboardChanged()
Dim lCount As Long
Dim lFormat As Long
Dim lID As Long
   
   ' To cope with an problems caused by clipboard applications
   ' that don't behave correctly.  VB Add-ins are the only
   ' example I've found of this because they have to use the
   ' ridiculous PasteFace method to set up a picture on the
   ' button.
   On Error Resume Next
   
   DoEvents ' you may wish to disable form here
   
   
   ' Show the new clipboard contents:
   Debug.Print "Clipboard changed"
   With m_cClip
      lCount = .GetCurrentFormats(Me.hWnd)
      lstFormats.Clear
      For lFormat = 1 To lCount
         lID = .GetCurrentFormatID(lFormat)
         lstFormats.AddItem CStr(lID) &amp; vbTab &amp; .GetCurrentFormatName(lFormat)
         lstFormats.ItemData(lstFormats.NewIndex) = lID
         If (lID = 1) Then ' Text
            lstFormats.ListIndex = lstFormats.NewIndex
         End If
      Next lFormat
      
   End With
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Clipboard</a>&#160;.&#160;<a href="article.html">Customising Clipboard Use </a>&#160;.&#160;<a href="vb5_clipboard_classes_and_sample.html">VB5 Clipboard Classes and Sample</a>&#160;.&#160;fTest.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 8 September 2003</p></td><td></td></tr></table>
</body></html>