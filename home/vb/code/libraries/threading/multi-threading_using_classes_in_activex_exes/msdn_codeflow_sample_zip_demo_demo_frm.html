<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: DEMO_Demo.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: DEMO_Demo.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Threading</a>&#160;.&#160;<a href="article.html">Multi-Threaded VB Using ActiveX EXEs</a>&#160;.&#160;<a href="msdn_codeflow_sample.html">MSDN CodeFlow Sample</a>&#160;.&#160;DEMO_Demo.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="msdn_codeflow_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />MSDN CodeFlow Sample</a> (38K)</p><p /><p class="nav"><a href="multi-threaded_exe_project.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Multi-Threaded EXE Project</a> (18K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:3705</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3705&type=zip&title=msdn_20codeflow_20sample_2ezip_5fdemo_5fdemo.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />1 Jan 2000<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\type_libraries\runnable\article.html">IShellFolder Extended Type Library Version 1.2 (ISHF_Ex.Tlb)</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\techniques\finding_which_dll_contains_an_api_call\article.html">Finding Which DLL Contains an API Call</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: DEMO_Demo.frm</h1><pre>VERSION 5.00
Object = "{6B7E6392-850A-101B-AFC0-4210102A8DA7}#1.3#0"; "COMCTL32.OCX"
Begin VB.Form frmMain 
   BorderStyle     =   3  'Fixed Dialog
   Caption         =   "CodeFlow Demo"
   ClientHeight    =   3255
   ClientLeft      =   3840
   ClientTop       =   2085
   ClientWidth     =   6495
   Icon            =   "Demo.frx":0000
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   3255
   ScaleWidth      =   6495
   Begin VB.PictureBox picFrame 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &amp;H80000008&amp;
      Height          =   1935
      Index           =   7
      Left            =   6480
      ScaleHeight     =   1935
      ScaleWidth      =   5775
      TabIndex        =   43
      Top             =   6240
      Width           =   5775
      Begin VB.CommandButton cmdStateMachineBack 
         Caption         =   "&amp;&lt;&lt; Back"
         Enabled         =   0   'False
         Height          =   375
         Left            =   840
         TabIndex        =   46
         Top             =   1560
         Width           =   1575
      End
      Begin VB.CommandButton cmdStateMachineNext 
         Caption         =   "Next &gt;&amp;&gt;"
         Enabled         =   0   'False
         Height          =   375
         Left            =   2520
         TabIndex        =   45
         Top             =   1560
         Width           =   1575
      End
      Begin VB.CommandButton cmdStateMachineFinish 
         Caption         =   "Finish"
         Height          =   375
         Left            =   4200
         TabIndex        =   44
         Top             =   1560
         Width           =   1575
      End
      Begin VB.Label lblStateMachineStatus 
         Height          =   255
         Left            =   0
         TabIndex        =   47
         Top             =   0
         Width           =   5775
      End
   End
   Begin VB.PictureBox picFrame 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &amp;H80000008&amp;
      Height          =   1935
      Index           =   6
      Left            =   6480
      ScaleHeight     =   1935
      ScaleWidth      =   5775
      TabIndex        =   31
      Top             =   4200
      Width           =   5775
      Begin VB.TextBox txtSleepTime 
         Height          =   285
         Left            =   3240
         TabIndex        =   35
         Text            =   "100"
         Top             =   360
         Width           =   795
      End
      Begin VB.TextBox txtSleepLoopIterations 
         Height          =   285
         Left            =   3240
         TabIndex        =   33
         Text            =   "10"
         Top             =   0
         Width           =   795
      End
      Begin VB.CommandButton cmdSleep 
         Caption         =   "Start Sleep Loop"
         Height          =   375
         Left            =   3600
         TabIndex        =   32
         Top             =   1560
         Width           =   2175
      End
      Begin VB.Image imgSleeper 
         Height          =   240
         Left            =   240
         Picture         =   "Demo.frx":0442
         Top             =   960
         Visible         =   0   'False
         Width           =   240
      End
      Begin VB.Label lblSleepTime 
         Caption         =   "Sleep time per loop (milliseconds):"
         Height          =   255
         Left            =   0
         TabIndex        =   36
         Top             =   360
         Width           =   3255
      End
      Begin VB.Label lblSleepLoopIterations 
         Caption         =   "Loop iterations:"
         Height          =   255
         Left            =   0
         TabIndex        =   34
         Top             =   0
         Width           =   3255
      End
   End
   Begin VB.PictureBox picFrame 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &amp;H80000008&amp;
      Height          =   1935
      Index           =   5
      Left            =   6480
      ScaleHeight     =   1935
      ScaleWidth      =   5775
      TabIndex        =   29
      Top             =   2160
      Width           =   5775
      Begin VB.TextBox txtRunnableMessage 
         Height          =   1215
         Left            =   0
         MultiLine       =   -1  'True
         ScrollBars      =   2  'Vertical
         TabIndex        =   41
         Text            =   "Demo.frx":0544
         Top             =   240
         Width           =   5775
      End
      Begin VB.CommandButton cmdRunnableStart 
         Caption         =   "Start Runnable Object"
         Height          =   375
         Left            =   3600
         TabIndex        =   30
         Top             =   1560
         Width           =   2175
      End
      Begin VB.Label lblRunnableMessage 
         Caption         =   "Message:"
         Height          =   255
         Left            =   0
         TabIndex        =   42
         Top             =   0
         Width           =   2055
      End
   End
   Begin VB.PictureBox picFrame 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &amp;H80000008&amp;
      Height          =   1935
      Index           =   4
      Left            =   6480
      ScaleHeight     =   1935
      ScaleWidth      =   5775
      TabIndex        =   22
      Top             =   120
      Width           =   5775
      Begin VB.TextBox txtTimerWaitLoops 
         Height          =   285
         Left            =   5040
         TabIndex        =   48
         Text            =   "200000"
         Top             =   0
         Width           =   735
      End
      Begin VB.CommandButton cmdTimerCancel 
         Caption         =   "Cancel"
         Height          =   375
         Left            =   4200
         TabIndex        =   39
         Top             =   1560
         Width           =   1575
      End
      Begin VB.TextBox txtTimerTick 
         Height          =   285
         Left            =   600
         Locked          =   -1  'True
         TabIndex        =   37
         Top             =   0
         Width           =   615
      End
      Begin VB.Timer tmrTimerControl 
         Enabled         =   0   'False
         Left            =   120
         Top             =   480
      End
      Begin VB.CommandButton cmdTimerObject 
         Caption         =   "Timer Object"
         Height          =   375
         Left            =   1680
         TabIndex        =   26
         Top             =   1560
         Width           =   1575
      End
      Begin VB.CommandButton cmdTimerControl 
         Caption         =   "Timer Control"
         Height          =   375
         Left            =   0
         TabIndex        =   25
         Top             =   1560
         Width           =   1575
      End
      Begin VB.TextBox txtTimerObjectResults 
         Height          =   735
         Left            =   0
         Locked          =   -1  'True
         MultiLine       =   -1  'True
         ScrollBars      =   2  'Vertical
         TabIndex        =   24
         Top             =   720
         Width           =   5775
      End
      Begin VB.TextBox txtTimerTicks 
         Height          =   285
         Left            =   1680
         TabIndex        =   23
         Text            =   "100"
         Top             =   0
         Width           =   615
      End
      Begin VB.Label lblTimerWaitLoops 
         Alignment       =   1  'Right Justify
         Caption         =   "Run loops in Timer event:"
         Height          =   255
         Left            =   2520
         TabIndex        =   49
         Top             =   0
         Width           =   2415
      End
      Begin VB.Label lblTimerTicks 
         Caption         =   "of"
         Height          =   255
         Left            =   1320
         TabIndex        =   38
         Top             =   0
         Width           =   375
      End
      Begin VB.Label lblTimerTick 
         Caption         =   "Tick"
         Height          =   255
         Left            =   0
         TabIndex        =   28
         Top             =   0
         Width           =   615
      End
      Begin VB.Label lblTimerObjectResults 
         Caption         =   "Test Results:"
         Height          =   255
         Left            =   0
         TabIndex        =   27
         Top             =   480
         Width           =   2055
      End
   End
   Begin VB.PictureBox picFrame 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &amp;H80000008&amp;
      Height          =   1935
      Index           =   3
      Left            =   360
      ScaleHeight     =   1935
      ScaleWidth      =   5775
      TabIndex        =   16
      Top             =   5040
      Width           =   5775
      Begin VB.TextBox txtWaitEventsResults 
         Height          =   975
         Left            =   0
         Locked          =   -1  'True
         MultiLine       =   -1  'True
         ScrollBars      =   2  'Vertical
         TabIndex        =   40
         Top             =   0
         Width           =   5775
      End
      Begin VB.CommandButton cmdWaitEventsContinueAll 
         Caption         =   "Continue All"
         Enabled         =   0   'False
         Height          =   375
         Left            =   4200
         TabIndex        =   21
         Top             =   1560
         Width           =   1575
      End
      Begin VB.CommandButton cmdWaitEventsContinue 
         Caption         =   "Continue"
         Enabled         =   0   'False
         Height          =   375
         Left            =   2520
         TabIndex        =   20
         Top             =   1560
         Width           =   1575
      End
      Begin VB.CheckBox chkWaitEventsTimeout 
         Caption         =   "Timeout (milliseconds):"
         Height          =   255
         Left            =   0
         TabIndex        =   19
         Top             =   1080
         Width           =   2415
      End
      Begin VB.TextBox txtWaitEventsTimeout 
         Height          =   285
         Left            =   2400
         TabIndex        =   18
         Text            =   "5000"
         Top             =   1080
         Width           =   735
      End
      Begin VB.CommandButton cmdWaitEvents 
         Caption         =   "WaitEvents"
         Height          =   375
         Left            =   840
         TabIndex        =   17
         Top             =   1560
         Width           =   1575
      End
   End
   Begin VB.PictureBox picFrame 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &amp;H80000008&amp;
      Height          =   1935
      Index           =   2
      Left            =   360
      ScaleHeight     =   1935
      ScaleWidth      =   5775
      TabIndex        =   9
      Top             =   3000
      Width           =   5775
      Begin VB.TextBox txtAsyncShellPollingInterval 
         Height          =   285
         Left            =   2880
         TabIndex        =   14
         Text            =   "1000"
         Top             =   600
         Width           =   735
      End
      Begin VB.TextBox txtAsyncShellCommandLine 
         Height          =   285
         Left            =   0
         TabIndex        =   12
         Text            =   "Notepad myfile.txt"
         Top             =   240
         Width           =   5775
      End
      Begin VB.CommandButton cmdAsyncShell 
         Caption         =   "AsyncShell"
         Height          =   375
         Left            =   4200
         TabIndex        =   11
         Top             =   1560
         Width           =   1575
      End
      Begin VB.Label lblAsyncShellPollingInterval 
         Caption         =   "Polling interval (milliseconds):"
         Height          =   255
         Left            =   0
         TabIndex        =   15
         Top             =   600
         Width           =   2895
      End
      Begin VB.Label lblAsyncShellCommandLine 
         Caption         =   "Command-line"
         Height          =   255
         Left            =   0
         TabIndex        =   13
         Top             =   0
         Width           =   5775
      End
   End
   Begin VB.PictureBox picFrame 
      Appearance      =   0  'Flat
      BorderStyle     =   0  'None
      ForeColor       =   &amp;H80000008&amp;
      Height          =   1935
      Index           =   1
      Left            =   360
      ScaleHeight     =   1935
      ScaleWidth      =   5775
      TabIndex        =   1
      Top             =   960
      Width           =   5775
      Begin VB.CommandButton cmdSyncShell 
         Caption         =   "SyncShell"
         Height          =   375
         Left            =   4200
         TabIndex        =   10
         Top             =   1560
         Width           =   1575
      End
      Begin VB.TextBox txtSyncShellCommandLine 
         Height          =   285
         Left            =   0
         TabIndex        =   7
         Text            =   "Notepad myfile.txt"
         Top             =   240
         Width           =   5775
      End
      Begin VB.TextBox txtSyncShellTimeout 
         Height          =   285
         Left            =   2400
         TabIndex        =   6
         Text            =   "1000"
         Top             =   1560
         Width           =   735
      End
      Begin VB.CheckBox chkSyncShellTimeout 
         Caption         =   "Timeout (milliseconds):"
         Height          =   255
         Left            =   0
         TabIndex        =   5
         Top             =   1560
         Width           =   2415
      End
      Begin VB.Frame fraSyncShell 
         Caption         =   "Wait &amp;until:"
         Height          =   855
         Left            =   0
         TabIndex        =   2
         Top             =   600
         Width           =   5775
         Begin VB.OptionButton optWaitForInputIdle 
            Caption         =   "the application is ready to receive UI input."
            Height          =   255
            Left            =   120
            TabIndex        =   4
            Top             =   480
            Width           =   5535
         End
         Begin VB.OptionButton optWaitForTermination 
            Caption         =   "the application terminates."
            Height          =   255
            Left            =   120
            TabIndex        =   3
            Top             =   240
            Value           =   -1  'True
            Width           =   5535
         End
      End
      Begin VB.Label lblSyncShellCommandLine 
         Caption         =   "Command-line"
         Height          =   255
         Left            =   0
         TabIndex        =   8
         Top             =   0
         Width           =   5775
      End
   End
   Begin ComctlLib.TabStrip tabMain 
      Height          =   3015
      Left            =   120
      TabIndex        =   0
      Top             =   120
      Width           =   6255
      _ExtentX        =   11033
      _ExtentY        =   5318
      MultiRow        =   -1  'True
      ImageList       =   "ImageList1"
      _Version        =   327682
      BeginProperty Tabs {0713E432-850A-101B-AFC0-4210102A8DA7} 
         NumTabs         =   7
         BeginProperty Tab1 {0713F341-850A-101B-AFC0-4210102A8DA7} 
            Caption         =   "&amp;SyncShell"
            Key             =   "syncshell"
            Object.Tag             =   ""
            Object.ToolTipText     =   "Demonstrates shelling an app and
             waiting for termination or UI readiness."
            ImageVarType    =   2
            ImageIndex      =   1
         EndProperty
         BeginProperty Tab2 {0713F341-850A-101B-AFC0-4210102A8DA7} 
            Caption         =   "&amp;AsyncShell"
            Key             =   "asyncshell"
            Object.Tag             =   ""
            Object.ToolTipText     =   "Demonstrates shelling an app and
             receiving a notification upon termination."
            ImageVarType    =   2
            ImageIndex      =   2
         EndProperty
         BeginProperty Tab3 {0713F341-850A-101B-AFC0-4210102A8DA7} 
            Caption         =   "&amp;WaitEvents"
            Key             =   "waitevents"
            Object.Tag             =   ""
            Object.ToolTipText     =   "Demonstrates pausing for event
             processing in the middle of a procedure."
            ImageVarType    =   2
            ImageIndex      =   3
         EndProperty
         BeginProperty Tab4 {0713F341-850A-101B-AFC0-4210102A8DA7} 
            Caption         =   "Code-Only &amp;Timer"
            Key             =   "objtimer"
            Object.Tag             =   ""
            Object.ToolTipText     =   "Demonstrates a timer object which can
             be used without a form."
            ImageVarType    =   2
            ImageIndex      =   4
         EndProperty
         BeginProperty Tab5 {0713F341-850A-101B-AFC0-4210102A8DA7} 
            Caption         =   "Start, &amp;Runnable_Start"
            Key             =   "runnable"
            Object.Tag             =   ""
            Object.ToolTipText     =   "Demonstrates starting asynchronous
             processing on a thread."
            ImageVarType    =   2
            ImageIndex      =   5
         EndProperty
         BeginProperty Tab6 {0713F341-850A-101B-AFC0-4210102A8DA7} 
            Caption         =   "S&amp;leep"
            Key             =   "sleep"
            Object.Tag             =   ""
            Object.ToolTipText     =   "Demonstrates processor-friendly
             pausing."
            ImageVarType    =   2
            ImageIndex      =   6
         EndProperty
         BeginProperty Tab7 {0713F341-850A-101B-AFC0-4210102A8DA7} 
            Caption         =   "State &amp;Machine"
            Key             =   "statemachine"
            Object.Tag             =   ""
            Object.ToolTipText     =   "Demonstrates use of a StateMachine
             object."
            ImageVarType    =   2
            ImageIndex      =   7
         EndProperty
      EndProperty
   End
   Begin ComctlLib.ImageList ImageList1 
      Left            =   0
      Top             =   0
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483633
      ImageWidth      =   16
      ImageHeight     =   16
      MaskColor       =   12632256
      _Version        =   327682
      BeginProperty Images {0713E8C2-850A-101B-AFC0-4210102A8DA7} 
         NumListImages   =   7
         BeginProperty ListImage1 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "Demo.frx":05D2
            Key             =   "synschell"
         EndProperty
         BeginProperty ListImage2 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "Demo.frx":06E4
            Key             =   "asyncshell"
         EndProperty
         BeginProperty ListImage3 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "Demo.frx":07F6
            Key             =   "waitevents"
         EndProperty
         BeginProperty ListImage4 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "Demo.frx":0908
            Key             =   "objtimer"
         EndProperty
         BeginProperty ListImage5 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "Demo.frx":0A1A
            Key             =   "runnable"
         EndProperty
         BeginProperty ListImage6 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "Demo.frx":0B2C
            Key             =   "sleep"
         EndProperty
         BeginProperty ListImage7 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "Demo.frx":0C3E
            Key             =   ""
         EndProperty
      EndProperty
   End
End
Attribute VB_Name = "frmMain"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'-------------------------------------------------------------------------------
' Copyright  1997 Microsoft Corporation. All rights reserved.
'
' You have a royalty-free right to use, modify, reproduce and distribute the
' Sample Application Files (and/or any modified version) in any way you find
' useful, provided that you agree that Microsoft has no warranty, obligations or
' liability for any Sample Application Files.
'-------------------------------------------------------------------------------

Option Explicit

'-------------------------------------------------------------------------------
'AsyncShell declarations:

Private WithEvents AsyncShell As AsyncShell
Attribute AsyncShell.VB_VarHelpID = -1

'-------------------------------------------------------------------------------
'WaitEvents declarations:

Private mfSingleStep As Boolean
Private mfCancel As Boolean

'-------------------------------------------------------------------------------
'Code-only timer declarations:

Private WithEvents TimerObject As objTimer
Attribute TimerObject.VB_VarHelpID = -1
Private Declare Function GetTickCount Lib "kernel32" () As Long
Private mnStartTime As Long

'-------------------------------------------------------------------------------
'StateMachine declarations:

Private WithEvents StateMachine As StateMachine
Attribute StateMachine.VB_VarHelpID = -1

'-------------------------------------------------------------------------------
'SyncShell code:

'The guts:

Private Sub cmdSyncShell_Click()
    Dim rc As Boolean
    Dim sMsg As String

    sMsg = "CodeFlow will run '" &amp; txtSyncShellCommandLine.Text &amp; "'. This demo
     will be blocked until the application"

    'The code below could look like this.
    '
    '    Dim nTimeout As Long
    '
    '    If chkSyncShellTimeout.Value = vbChecked Then
    '        nTimeout = Val(txtSyncShellTimeout.Text)
    '    Else
    '        nTimeout = 0
    '    End If
    '    If SyncShell(txtSyncShellCommandLine.Text, nTimeout,
     optWaitForInputIdle.Value) Then
    '    ...
    '
    'However, I wanted to demonstrate that you do not need to use the optional
     arguments.

    If optWaitForInputIdle.Value Then
        sMsg = sMsg &amp; " is ready for UI input"
        If chkSyncShellTimeout.Value = vbChecked Then
            MsgBox sMsg &amp; " or CodeFlow times out."
            rc = SyncShell(txtSyncShellCommandLine.Text,
             txtSyncShellTimeout.Text, True)
        Else
            MsgBox sMsg &amp; "."
            rc = SyncShell(txtSyncShellCommandLine.Text, , True)
        End If
        If rc Then
            MsgBox "The application is ready for input."
            Exit Sub
        End If
    Else
        sMsg = sMsg &amp; " terminates"
        If chkSyncShellTimeout.Value = vbChecked Then
            MsgBox sMsg &amp; " or CodeFlow times out."
            rc = SyncShell(txtSyncShellCommandLine.Text,
             txtSyncShellTimeout.Text)
        Else
            MsgBox sMsg &amp; "."
            rc = SyncShell(txtSyncShellCommandLine.Text)
        End If
        If rc Then
            MsgBox "The application has terminated."
            Exit Sub
        End If
    End If
    MsgBox "SyncShell has timed out."
End Sub

'The logistics:

Private Sub chkSyncShellTimeout_Click()
    EnableTextBoxBasedOnCheckBox txtSyncShellTimeout, chkSyncShellTimeout
End Sub

Private Sub txtSyncShellTimeout_LostFocus()
    ValidateCounterTextBoxAndSetCheckBox txtSyncShellTimeout,
     chkSyncShellTimeout
End Sub

'-------------------------------------------------------------------------------
'AsyncShell code:

'The guts:

Private Sub cmdAsyncShell_Click()
    Set AsyncShell = New AsyncShell
    MsgBox "CodeFlow will run '" &amp; txtAsyncShellCommandLine.Text &amp; "'. This
     demo will be NOT blocked while it waits for the application to terminate."
    AsyncShell.Shell txtAsyncShellCommandLine.Text,
     txtAsyncShellPollingInterval.Text
End Sub

Private Sub AsyncShell_Terminated()
    MsgBox "The application has terminated."
    Set AsyncShell = Nothing 'This is not necessary, but I might as well get
     rid of it right away instead of later.
End Sub

'The logistics:

Private Sub txtAsyncShellPollingInterval_LostFocus()
    ValidateNumericTextBox txtAsyncShellPollingInterval, 1
End Sub

'-------------------------------------------------------------------------------
'WaitEvents code:

'The guts:

Private Sub cmdWaitEvents_Click()
    Static nNestingLevel As Long
    Dim nTimeout As Long
    Dim sMsg As String

    cmdWaitEventsContinue.Enabled = True
    cmdWaitEventsContinueAll.Enabled = True

    nNestingLevel = nNestingLevel + 1
    MsgBox "Running cmdWaitEvents_Click (nested " &amp; nNestingLevel &amp; " levels
     deep). " &amp; _
           vbCrLf &amp; vbCrLf &amp; _
           "The routine will pause, allowing you to interact with the UI. It
            will resume " &amp; _
           "when WaitEvents times out (if you specified a timeout) or if you
            click Continue " &amp; _
           "or Continue All. However, before it resumes, you may press
            WaitEvents again " &amp; _
           "(perhaps with a new timeout setting) to nest another
            cmdWaitEvents_Click. " &amp; _
           "Pressing Continue will always resume the deepest-nested routine. "
            &amp; _
           "Pressing Continue All will resume all routines."
    'See whether or not we need a timeout
    If chkWaitEventsTimeout.Value = vbChecked Then
        nTimeout = Val(txtWaitEventsTimeout.Text)
    Else
        nTimeout = 0
    End If
    'Construct the message
    sMsg = "Nesting level " &amp; nNestingLevel &amp; " is finished"
    If WaitEvents(nTimeout) Then
        sMsg = sMsg &amp; " (user continued)"
    Else
        sMsg = sMsg &amp; " (timed out)"
    End If
    'It could be that the user has already unloaded the form, and the
    '   Form_Unload called ContinueAll. If this is the case, then referencing
    '   any control will reload the form, preventing the app from terminating.
    '   Therefore, I must check first:
    If Forms.Count = 0 Then Exit Sub
    'Post the message to the text box
    AddLineToTextBox txtWaitEventsResults, sMsg
    nNestingLevel = nNestingLevel - 1
    If nNestingLevel = 0 Then
        cmdWaitEventsContinue.Enabled = False
        cmdWaitEventsContinueAll.Enabled = False
    End If
End Sub

Private Sub cmdWaitEventsContinue_Click()
    Continue
End Sub

Private Sub cmdWaitEventsContinueAll_Click()
    ContinueAll
End Sub

Private Sub Form_Unload(Cancel As Integer)
    If Waiting Then
        MsgBox "Unloading the form will not automatically terminate the
         application because WaitEvents is still waiting for events. I must
         manually call ContinueAll to terminate the application."
        cmdWaitEventsContinueAll_Click
    End If
End Sub

'The logistics:

Private Sub chkWaitEventsTimeout_Click()
    EnableTextBoxBasedOnCheckBox txtWaitEventsTimeout, chkWaitEventsTimeout
End Sub

Private Sub txtWaitEventsTimeout_LostFocus()
    ValidateCounterTextBoxAndSetCheckBox txtWaitEventsTimeout,
     chkWaitEventsTimeout
End Sub

'-------------------------------------------------------------------------------
'SyncShell code:

'The guts:

Private Sub cmdTimerControl_Click()
    tmrTimerControl.Interval = 1
    tmrTimerControl.Enabled = True
    TimerStarting
End Sub

Private Sub cmdTimerObject_Click()
    Set TimerObject = New objTimer
    TimerObject.Interval = 1
    TimerObject.Enabled = True
    TimerStarting
End Sub

Private Sub TimerObject_Timer()
    Tick "Timer Object"
End Sub

Private Sub tmrTimerControl_Timer()
    Tick "Timer Control"
End Sub

Private Sub TimerStarting()
    cmdTimerObject.Enabled = False
    cmdTimerControl.Enabled = False
    txtTimerTicks.Enabled = False
    txtTimerWaitLoops.Enabled = False
    mnStartTime = GetTickCount
End Sub

Private Sub Tick(Name As String)
    Static nTicks As Long
    Const nSleepTime As Long = 20
    Dim nDuration As Long
    Dim sMsg As String
    Dim nLoops As Long

    'Depending on your machine, Windows can only send timer messages roughly 50
    '   times per second even though the timer interval is smaller than 20. Thus
    '   when comparing two timers, if both finish their work before Windows
    '   sends the next timer message, then it will look like they are both
    '   equally fast, when in fact one may be slower. Therefore for this test we
    '   will wait for a while to be sure that the next timer message is waiting.
    nLoops = Val(txtTimerWaitLoops.Text)
    Dim i As Long: For i = 1 To nLoops: Next i

    nTicks = nTicks + 1
    txtTimerTick.Text = nTicks
    If nTicks &gt;= Val(txtTimerTicks.Text) Then
        nDuration = GetTickCount - mnStartTime
        'Construct the message
        sMsg = Name &amp; ": " &amp; nTicks &amp; " timer messages in " &amp; _
               nDuration &amp; " ms (" &amp; nLoops * nTicks &amp; " loops included)."
        'Post the message to the textbox
        AddLineToTextBox txtTimerObjectResults, sMsg
        nTicks = 0
        'Stop the timer and fix the UI
        cmdTimerCancel_Click
    End If
End Sub

Private Sub cmdTimerCancel_Click()
    tmrTimerControl.Enabled = False
    Set TimerObject = Nothing
    cmdTimerObject.Enabled = True
    cmdTimerControl.Enabled = True
    txtTimerTicks.Enabled = True
End Sub

'The logistics:

Private Sub txtTimerTicks_LostFocus()
    ValidateNumericTextBox txtTimerTicks, 1
End Sub

Private Sub txtTimerWaitLoops_LostFocus()
    ValidateNumericTextBox txtTimerWaitLoops, 0
End Sub

'-------------------------------------------------------------------------------
'Runnable_Start code:

'The guts:

Private Sub cmdRunnableStart_Click()
    Dim o As Object
    Dim sPath As String

    On Error Resume Next
    'I've used late binding here because we tend not to ship compiled
     executables with our samples. Therefore I can't reference Runnable.exe.
    Set o = CreateObject("RunnableProject.RunnableClass")
    If o Is Nothing Then
        'Could not create the object, probably because it isn't compiled.
        If MsgBox("Could not create runnable object. You may need to compile
         Runnable.vbp. Do you want to use AsyncShell to compile it?", _
                  vbYesNo Or vbQuestion) = vbYes Then
            sPath = App.Path
            If Right$(sPath, 1) &lt;&gt; "\" Then sPath = sPath &amp; "\"
            sPath = sPath &amp; "Runnable.vbp"
            txtAsyncShellCommandLine.Text = "vb5 /m " &amp; """" &amp; sPath &amp; """"
            tabMain.Tabs("asyncshell").Selected = True
            MsgBox "Note: In order to compile Runnable.vbp, you must first do
             two things:" &amp; vbCrLf &amp; vbCrLf &amp; _
                   "1. Compile CodeFlow.vbp." &amp; vbCrLf &amp; _
                   "2. Open Runnable.vbp and set a reference to CodeFlow." &amp;
                    vbCrLf &amp; vbCrLf &amp; _
                   "If you do not do both of these, VB will report a compile
                    error." &amp; vbCrLf &amp; vbCrLf &amp; _
                   "The command-line shown assumes VB5 is in your path. You may
                    need to modify the command-line if it is not."
            cmdAsyncShell.SetFocus
        End If
    Else
        o.ModelessMsgBox txtRunnableMessage.Text
    End If
End Sub

'-------------------------------------------------------------------------------
'Sleep code:

'The guts:

Private Sub cmdSleep_Click()
    Dim nIterations As Long
    Dim nSleepTime As Long
    Dim i As Long

    Static nBorder As Single
    Static nJourneyLen As Single
    Static fJourneySet As Boolean

    If Not fJourneySet Then
        fJourneySet = True
        nBorder = imgSleeper.Left
        nJourneyLen = picFrame(1).ScaleWidth - (2 * nBorder) - imgSleeper.Width
    End If
    nIterations = Val(txtSleepLoopIterations.Text)
    nSleepTime = Val(txtSleepTime.Text)
    imgSleeper.Left = nBorder
    imgSleeper.Visible = True
    imgSleeper.Refresh
    For i = 1 To nIterations
        sleep nSleepTime
        imgSleeper.Left = (nJourneyLen * i / nIterations) + nBorder
    Next i
    sleep nSleepTime
    imgSleeper.Visible = False
End Sub

'The logistics:

Private Sub txtSleepLoopIterations_LostFocus()
    ValidateNumericTextBox txtSleepLoopIterations, 1
End Sub

Private Sub txtSleepTime_LostFocus()
    ValidateNumericTextBox txtSleepTime
End Sub

'-------------------------------------------------------------------------------
'Sleep code:

'The guts:

Private Sub InitializeStateMachine()
    Set StateMachine = New StateMachine
    StateMachine.Count = 4
End Sub

Private Sub cmdStateMachineBack_Click()
    StateMachine.Move -1
End Sub

Private Sub cmdStateMachineNext_Click()
    StateMachine.Move
End Sub

Private Sub cmdStateMachineFinish_Click()
    Static fFinished As Boolean

    fFinished = Not fFinished
    If fFinished Then
        lblStateMachineStatus.Caption = "The state-machine is finished!"
        cmdStateMachineBack.Enabled = False
        cmdStateMachineNext.Enabled = False
        cmdStateMachineFinish.Caption = "Start over"
    Else
        cmdStateMachineFinish.Caption = "Finish"
        InitializeStateMachine
    End If
End Sub

Private Sub StateMachine_SetState(ByVal State As Long)
    Select Case State
        Case 1
            lblStateMachineStatus.Caption = "This is the first state-machine
             state. Press Next to move on to the second state."
        Case 2
            lblStateMachineStatus.Caption = "This is the second state-machine
             state. Press Next to move on to the third state."
        Case 3
            lblStateMachineStatus.Caption = "This is the third state-machine
             state. Press Next to move on to the fourth state."
        Case 4
            lblStateMachineStatus.Caption = "This is the fourth state-machine
             state. Press Finish to finish."
    End Select
    cmdStateMachineBack.Enabled = (State &lt;&gt; 1)
    cmdStateMachineNext.Enabled = (State &lt;&gt; 4)
End Sub

'-------------------------------------------------------------------------------
'Demo framework code:

Private Sub Form_Load()
    'This will fire tabMain_Click even if Tab 1 is already selected.
    tabMain.Tabs(1).Selected = True

    'Initialize SyncShell UI
    chkSyncShellTimeout_Click 'This is more reliable than hoping I remember to
     set it right at design time.

    'Initialize WaitEvents UI
    chkWaitEventsTimeout_Click 'This is more reliable than hoping I remember to
     set it right at design time.

    'Initialize StateMachine
    InitializeStateMachine
End Sub

Private Sub tabMain_Click()
    Dim oFrame As Control

    For Each oFrame In picFrame
        oFrame.Visible = False
        oFrame.Enabled = False
    Next oFrame
    With picFrame(tabMain.SelectedItem.Index)
        .Top = picFrame(1).Top
        .Left = picFrame(1).Left
        .Enabled = True
        .Visible = True
    End With
End Sub

Private Sub AddLineToTextBox(TextBox As TextBox, Text As String)
    Dim nBeforeLen As Long
    Dim nLine2Pos As Long
    Dim nTargetLen As Long

    nBeforeLen = Len(TextBox.Text)
    TextBox.Text = TextBox.Text &amp; Text &amp; vbCrLf
    nTargetLen = nBeforeLen + Len(Text) + Len(vbCrLf)
    'Check to see if the text fit. If not, the textbox will add as much as it
     can, then fail silently
    Do Until Len(TextBox.Text) = nTargetLen
        'The text did not fit. Now I will begin stripping off the first lines
         until it does fit.
        nLine2Pos = InStr(TextBox.Text, vbCrLf) + 2
        nBeforeLen = nBeforeLen - nLine2Pos
        TextBox.Text = Mid$(TextBox.Text, nLine2Pos, nBeforeLen) &amp; Text &amp; vbCrLf
        nTargetLen = nBeforeLen + Len(Text) + Len(vbCrLf)
    Loop
    'Scroll the textbox to the bottom
    TextBox.SelStart = nTargetLen
End Sub

Private Function ValidateNumericTextBox(TextBox As TextBox, Optional Minimum)
 As Boolean
    Dim sText As String

    sText = TextBox.Text
    If IsNumeric(sText) Then
        If IsMissing(Minimum) Then
            ValidateNumericTextBox = True
        Else
            If Val(sText) &lt; Val(Minimum) Then
                MsgBox "You must enter a number &gt;= " &amp; Minimum &amp; "."
                TextBox.SetFocus
            Else
                ValidateNumericTextBox = True
            End If
        End If
    Else
        MsgBox "You must enter a number."
        TextBox.SetFocus
    End If
End Function

Private Sub ValidateCounterTextBoxAndSetCheckBox(TextBox As TextBox, CheckBox
 As CheckBox)
    If ValidateNumericTextBox(TextBox) Then
        If Val(TextBox.Text) &lt;= 0 Then
            CheckBox.Value = vbUnchecked
        End If
    End If
End Sub

Private Sub EnableTextBoxBasedOnCheckBox(TextBox As TextBox, CheckBox As
 CheckBox)
    If (CheckBox.Value = vbChecked) Then
        TextBox.Enabled = True
        TextBox.SetFocus
    Else
        TextBox.Enabled = False
    End If
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Threading</a>&#160;.&#160;<a href="article.html">Multi-Threaded VB Using ActiveX EXEs</a>&#160;.&#160;<a href="msdn_codeflow_sample.html">MSDN CodeFlow Sample</a>&#160;.&#160;DEMO_Demo.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>