<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: fTestReg.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: fTestReg.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Registry and Ini Files</a>&#160;.&#160;<a href="article.html">Complete Registry control</a>&#160;.&#160;<a href="vb5_registry_editor_demonstration.html">VB5 Registry Editor Demonstration</a>&#160;.&#160;fTestReg.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="cregistry_class.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />cRegistry Class</a> (6K)</p><p /><p class="nav"><a href="vb5_registry_editor_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Registry Editor Demonstration</a> (59K)</p><p /><p class="nav"><a href="vb6_registry_editor_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Registry Editor Demonstration</a> (52K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:2605</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=2605&type=zip&title=vb5_20registry_20editor_20demonstration_2ezip_5fftestreg.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 0 / 1</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 1 / 2</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:24 January 2004</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />23 Jan 2004<br /><p class="update">Added remote registry connection through the <span class="code">Machine</span>.  
Many thanks to Yaron Lavi for providing the code.</p><p class="update">Fixed problem with saving zero length strings.  Thanks to Shane Marsden for 
providing the fix.</p><p class="update">Fixed problem with truncation of binary data.  Thanks to Morten Egelund Rasmussen
(and many others!) for providing the fix.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: fTestReg.frm</h1><pre>VERSION 5.00
Object = "{6B7E6392-850A-101B-AFC0-4210102A8DA7}#1.3#0"; "COMCTL32.OCX"
Begin VB.Form frmRegEdit 
   Caption         =   "vbAccelerator VB Registry Editor"
   ClientHeight    =   5895
   ClientLeft      =   4710
   ClientTop       =   3090
   ClientWidth     =   6720
   Icon            =   "fTestReg.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   5895
   ScaleWidth      =   6720
   Begin ComctlLib.StatusBar sbrMain 
      Align           =   2  'Align Bottom
      Height          =   315
      Left            =   0
      TabIndex        =   3
      Top             =   5580
      Width           =   6720
      _ExtentX        =   11853
      _ExtentY        =   556
      SimpleText      =   ""
      _Version        =   327682
      BeginProperty Panels {0713E89E-850A-101B-AFC0-4210102A8DA7} 
         NumPanels       =   1
         BeginProperty Panel1 {0713E89F-850A-101B-AFC0-4210102A8DA7} 
            AutoSize        =   1
            Object.Width           =   11430
            TextSave        =   ""
            Key             =   ""
            Object.Tag             =   ""
         EndProperty
      EndProperty
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
   End
   Begin VB.PictureBox picSplitter 
      Height          =   5595
      Left            =   2700
      ScaleHeight     =   5535
      ScaleWidth      =   15
      TabIndex        =   2
      Top             =   0
      Width           =   75
   End
   Begin ComctlLib.ListView lvwReg 
      Height          =   4815
      Left            =   2760
      TabIndex        =   1
      Top             =   0
      Width           =   3915
      _ExtentX        =   6906
      _ExtentY        =   8493
      LabelWrap       =   -1  'True
      HideSelection   =   0   'False
      _Version        =   327682
      ForeColor       =   -2147483640
      BackColor       =   -2147483643
      BorderStyle     =   1
      Appearance      =   1
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      NumItems        =   0
   End
   Begin ComctlLib.TreeView tvwReg 
      Height          =   4815
      Left            =   60
      TabIndex        =   0
      Top             =   0
      Width           =   2595
      _ExtentX        =   4577
      _ExtentY        =   8493
      _Version        =   327682
      HideSelection   =   0   'False
      Indentation     =   441
      LineStyle       =   1
      Sorted          =   -1  'True
      Style           =   7
      Appearance      =   1
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
   End
   Begin ComctlLib.ImageList ilsIcons 
      Left            =   5700
      Top             =   4980
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   16
      ImageHeight     =   16
      MaskColor       =   12632256
      _Version        =   327682
      BeginProperty Images {0713E8C2-850A-101B-AFC0-4210102A8DA7} 
         NumListImages   =   3
         BeginProperty ListImage1 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "fTestReg.frx":014A
            Key             =   "OPENFOLDER"
         EndProperty
         BeginProperty ListImage2 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "fTestReg.frx":0464
            Key             =   "DATAITEM"
         EndProperty
         BeginProperty ListImage3 {0713E8C3-850A-101B-AFC0-4210102A8DA7} 
            Picture         =   "fTestReg.frx":077E
            Key             =   "CLOSEDFOLDER"
         EndProperty
      EndProperty
   End
   Begin VB.Menu mnuFileTOP 
      Caption         =   "&amp;File"
      Begin VB.Menu mnuFile 
         Caption         =   "&amp;Print"
         Index           =   0
      End
      Begin VB.Menu mnuFile 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuFile 
         Caption         =   "E&amp;xit"
         Index           =   2
      End
   End
   Begin VB.Menu mnuEditTOP 
      Caption         =   "&amp;Edit"
      Begin VB.Menu mnuEdit 
         Caption         =   "&amp;New..."
         Index           =   0
         Shortcut        =   ^N
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "&amp;Modify..."
         Index           =   2
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "&amp;Delete..."
         Index           =   3
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "-"
         Index           =   4
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "&amp;Find..."
         Index           =   5
         Shortcut        =   ^F
      End
   End
   Begin VB.Menu mnuViewTOP 
      Caption         =   "&amp;View"
      Begin VB.Menu mnuView 
         Caption         =   "&amp;Status Bar"
         Checked         =   -1  'True
         Index           =   0
      End
      Begin VB.Menu mnuView 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuView 
         Caption         =   "&amp;Refresh"
         Index           =   2
         Shortcut        =   {F5}
      End
   End
   Begin VB.Menu mnuHelpTOP 
      Caption         =   "&amp;Help"
      Begin VB.Menu mnuHelp 
         Caption         =   "&amp;About..."
         Index           =   0
      End
   End
End
Attribute VB_Name = "frmRegEdit"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private WithEvents m_cSplit As cSplitter
Attribute m_cSplit.VB_VarHelpID = -1
Private cReg As New cRegistry

Private Sub Form_Load()
Dim nodX As Node
   Set m_cSplit = New cSplitter
   m_cSplit.Initialise picSplitter, Me
   tvwReg.ImageList = ilsIcons
   Set nodX = tvwReg.Nodes.Add(, , "K" &amp; HKEY_CLASSES_ROOT,
    "HKEY_CLASSES_ROOT", "CLOSEDFOLDER")
      tvwReg.Nodes.Add nodX, tvwChild, , "Unexpanded"
   Set nodX = tvwReg.Nodes.Add(, , "K" &amp; HKEY_CURRENT_USER,
    "HKEY_CURRENT_USER", "CLOSEDFOLDER")
      tvwReg.Nodes.Add nodX, tvwChild, , "Unexpanded"
   Set nodX = tvwReg.Nodes.Add(, , "K" &amp; HKEY_LOCAL_MACHINE,
    "HKEY_LOCAL_MACHINE", "CLOSEDFOLDER")
      tvwReg.Nodes.Add nodX, tvwChild, , "Unexpanded"
   Set nodX = tvwReg.Nodes.Add(, , "K" &amp; HKEY_USERS, "HKEY_USERS",
    "CLOSEDFOLDER")
      tvwReg.Nodes.Add nodX, tvwChild, , "Unexpanded"
   lvwReg.SmallIcons = ilsIcons
   lvwReg.ColumnHeaders.Add , , "Key"
   lvwReg.ColumnHeaders.Add , , "Value"
   lvwReg.View = lvwReport
End Sub

Private Sub Form_MouseMove(Button As Integer, Shift As Integer, X As Single, Y
 As Single)
   m_cSplit.MouseMove X
End Sub

Private Sub Form_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As
 Single)
   m_cSplit.MouseUp X
End Sub

Private Sub Form_Resize()
Dim lM As Long
Dim lL As Long
Dim lH As Long

On Error Resume Next

   ' Do resize
   With tvwReg
      lH = Me.ScaleHeight - .Top * 2 - sbrMain.Height * -1 * sbrMain.Visible
      lM = picSplitter.Left - 2 * Screen.TwipsPerPixelX
      .Move .Left, .Top, lM, lH
      lL = lM + picSplitter.Width + 2 * Screen.TwipsPerPixelX
      lvwReg.Move lL, .Top, Me.ScaleWidth - lL - 4 * Screen.TwipsPerPixelX, lH
   End With
   With picSplitter
      .Move .Left, tvwReg.Top, .Width, lH
   End With
   
End Sub

Private Sub lvwReg_ColumnClick(ByVal ColumnHeader As ComctlLib.ColumnHeader)
Dim i As Long
    For i = 1 To lvwReg.ColumnHeaders.Count
        If (i &lt;&gt; ColumnHeader.Index) Then
            lvwReg.ColumnHeaders(i).Tag = ""
        End If
    Next i

    If ColumnHeader.Tag = "ASC" Then
        ColumnHeader.Tag = "DESC"
        lvwReg.SortOrder = lvwDescending
    Else
        ColumnHeader.Tag = "ASC"
        lvwReg.SortOrder = lvwAscending
    End If
    lvwReg.SortKey = ColumnHeader.Index - 1
    lvwReg.Sorted = True
            
End Sub

Private Sub lvwReg_DblClick()
    mnuEdit_Click 2
End Sub

Private Sub m_cSplit_DoSplit(bSplit As Boolean)
   ' Can cancell split here
End Sub

Private Sub m_cSplit_SplitComplete()
   Form_Resize
End Sub
Private Sub pGetSectionClassKey(ByRef sP As String, ByRef sK As String, ByRef l
 As Long)
Dim nodX As Node
Dim iPos As Long
    With tvwReg
        If (InStr(.SelectedItem.Key, ",") = 0) Then
            ' We are at a class key:
            sP = ""
            sK = ""
            l = CLng(Mid$(.SelectedItem.Key, 2))
        Else
            ' We are at a sub key:
            sK = tvwReg.SelectedItem.Key
            iPos = InStr(sK, ",")
            l = CLng(Mid$(.SelectedItem.Key, 2, (iPos - 2)))
            sK = .SelectedItem.Text
            Set nodX = .SelectedItem.Parent
            Do While Not (nodX Is Nothing)
                If (InStr(nodX.Key, ",") &lt;&gt; 0) Then
                    sP = nodX.Text &amp; "\" &amp; sP
                End If
                Set nodX = nodX.Parent
            Loop
            If (Len(sP) &gt; 0) Then
                sP = Left$(sP, Len(sP) - 1)
            End If
        End If
    End With
End Sub
Private Function Normalize(ByVal sParent As String, ByVal sKey As String) As
 String
    ' this wouldn't usually be required as you don't tend to create keys under
    ' the HKEY_CLASSES_* sections (ie. sectionkey = ""):
    If (Trim$(sParent) = "") Then
        Normalize = sKey
    Else
        Normalize = Trim$(sParent) &amp; "\" &amp; sKey
    End If
End Function

Private Sub mnuEdit_Click(Index As Integer)
Dim sK As String
Dim sParent As String
Dim sTHisKey As String
Dim iPos As Long
Dim f As New fNewItem
Dim lClassKey As Long
            
    Select Case Index
    Case 0
        ' New:
        pGetSectionClassKey sParent, sTHisKey, lClassKey
        f.mode = eNew
        If (sParent &lt;&gt; "") Then
            f.Parent = sParent &amp; "\" &amp; sTHisKey
        Else
            f.Parent = sTHisKey
        End If
        f.Show vbModal, Me
        If Not (f.Cancelled) Then
            If (f.ItemType = 0) Then
                cReg.ClassKey = lClassKey
                cReg.SectionKey = Normalize(f.Parent, f.ItemName)
                cReg.CreateKey
            Else
                cReg.ClassKey = lClassKey
                cReg.SectionKey = f.Parent
                cReg.ValueKey = f.ItemName
                If (f.ItemValueType = 0) Then
                    cReg.ValueType = REG_SZ
                    cReg.Value = f.ItemValue
                ElseIf (f.ItemValueType = 1) Then
                    cReg.ValueType = REG_DWORD
                    cReg.Value = CLng(f.ItemValue)
                Else
                    cReg.ValueType = REG_BINARY
                    cReg.Value = f.ItemValue
                    'MsgBox "Sorry, entering BINARY values is not supported by
                     this demo.  An example of binary writing is provided in
                     the TestBinary sub.", vbInformation
                End If
            End If
            ' Refresh:
            tvwReg.SelectedItem.Expanded = False
            tvwReg_Collapse tvwReg.SelectedItem
            If (tvwReg.SelectedItem.Children = 0) Then
                tvwReg.Nodes.Add tvwReg.SelectedItem, tvwChild, , "Unexpanded"
            End If
            mnuView_Click 2
        End If
    Case 2
        ' update
        pGetSectionClassKey sParent, sTHisKey, lClassKey
        f.mode = eUpdate
        If Not (lvwReg.SelectedItem Is Nothing) Then
            ' Modifying a value:
            f.Parent = Normalize(sParent, sTHisKey)
            f.ItemName = lvwReg.SelectedItem.Text
            f.ItemValue = lvwReg.SelectedItem.SubItems(1)
            f.ItemType = 1
            f.ItemValueType = CLng(lvwReg.SelectedItem.Tag)
                        
            f.Show vbModal
            
            If Not (f.Cancelled) Then
                cReg.ClassKey = lClassKey
                cReg.SectionKey = f.Parent
                If (lvwReg.SelectedItem.Text &lt;&gt; f.ItemName) Then
                    ' Delete the existing value:
                    cReg.ValueKey = lvwReg.SelectedItem.Text
                    cReg.DeleteValue
                End If
                cReg.ValueKey = f.ItemName
                If (f.ItemValueType = 0) Then
                    cReg.ValueType = REG_SZ
                    cReg.Value = f.ItemValue
                ElseIf (f.ItemValueType = 1) Then
                    cReg.ValueType = REG_DWORD
                    cReg.Value = CLng(f.ItemValue)
                Else
                    cReg.ValueType = REG_BINARY
                    cReg.Value = f.ItemValue
                    'MsgBox "Sorry, entering BINARY values is not supported by
                     this demo.  An example of binary writing is provided in
                     the TestBinary sub.", vbInformation
                End If
            End If
            ' Refresh:
            tvwReg_NodeClick tvwReg.SelectedItem
        Else
            ' Modifying a key:
            If (vbOK = MsgBox("Warning: In this sample, renaming a key will
             delete all its contents.  Ok to continue?", vbOKCancel Or
             vbExclamation Or vbDefaultButton2)) Then
                f.Parent = sParent
                f.ItemName = sTHisKey
                f.ItemType = 0
                f.Show vbModal, Me
                
                If Not (f.Cancelled) Then
                    cReg.ClassKey = lClassKey
                    ' Delete the original key:
                    cReg.SectionKey = Normalize(f.Parent, sTHisKey)
                    cReg.DeleteKey
                    ' Rename
                    cReg.SectionKey = Normalize(f.Parent, f.ItemName)
                    cReg.CreateKey
                    ' Refresh:
                    tvwReg.SelectedItem.Parent.Expanded = False
                    tvwReg_Collapse tvwReg.SelectedItem.Parent
                    If (tvwReg.SelectedItem.Parent.Children = 0) Then
                        tvwReg.Nodes.Add tvwReg.SelectedItem.Parent, tvwChild,
                         , "Unexpanded"
                    End If
                End If
            End If
        End If
                
    Case 3
        ' delete
        pGetSectionClassKey sParent, sTHisKey, lClassKey
        
        If Not (lvwReg.SelectedItem Is Nothing) Then
            If (vbYes = MsgBox("Are you sure you want to delete the value '" &amp;
             lvwReg.SelectedItem.Text &amp; "'?", vbYesNo Or vbQuestion)) Then
                cReg.SectionKey = Normalize(sParent, sTHisKey)
                cReg.ValueKey = lvwReg.SelectedItem.Text
                cReg.DeleteValue
                ' Refresh:
                tvwReg.SelectedItem.Expanded = False
                tvwReg_Collapse tvwReg.SelectedItem
                If (tvwReg.SelectedItem.Children = 0) Then
                    tvwReg.Nodes.Add tvwReg.SelectedItem, tvwChild, ,
                     "Unexpanded"
                End If
                mnuView_Click 2
            End If
        Else
            If (vbYes = MsgBox("Are you sure you want to delete the key '" &amp;
             tvwReg.SelectedItem.Text &amp; "'?", vbYesNo Or vbQuestion)) Then
                cReg.SectionKey = Normalize(sParent, sTHisKey)
                cReg.DeleteKey
                ' Refresh:
                tvwReg.SelectedItem.Expanded = False
                tvwReg_Collapse tvwReg.SelectedItem
                If (tvwReg.SelectedItem.Children = 0) Then
                    tvwReg.Nodes.Add tvwReg.SelectedItem, tvwChild, ,
                     "Unexpanded"
                End If
                mnuView_Click 2
            End If
        End If

    Case 5
        ' find:
        MsgBox "Find: Left as an exercise...", vbInformation
    End Select
End Sub

Private Sub mnuEditTOP_Click()
Dim bDisableEdit As Boolean
Dim iPos As Long
Dim sKey As String
    If (lvwReg.SelectedItem Is Nothing) Then
        If (tvwReg.SelectedItem Is Nothing) Then
            bDisableEdit = True
        Else
            sKey = tvwReg.SelectedItem.Key
            iPos = InStr(sKey, ",")
            If (iPos = 0) Then
                bDisableEdit = True
            End If
        End If
    End If
    mnuEdit(1).Enabled = Not (tvwReg.SelectedItem Is Nothing)
    mnuEdit(2).Enabled = Not (bDisableEdit)
    mnuEdit(3).Enabled = Not (bDisableEdit)
    
End Sub

Private Sub mnuFile_Click(Index As Integer)
    Select Case Index
    Case 0
        MsgBox "Print: Left as exercise...", vbInformation
    Case 2
        Unload Me
    End Select
End Sub

Private Sub mnuHelp_Click(Index As Integer)
    MsgBox "VB Registry Editor using cRegistry Class" &amp; vbCrLf &amp; vbCrLf &amp;
     "Copyright  1998-2000 Steve McMahon (steve@vbaccelerator.com)" &amp; vbCrLf &amp;
     "On the web: http://vbaccelerator.com/", vbInformation
End Sub

Private Sub mnuView_Click(Index As Integer)
Dim bExpanded As Boolean

    Select Case Index
    Case 0
        mnuView(Index).Checked = Not (mnuView(Index).Checked)
        sbrMain.Visible = mnuView(Index).Checked
        Form_Resize
    Case 2
        ' Remove current node's contents:
        bExpanded = tvwReg.SelectedItem.Expanded
        tvwReg.SelectedItem.Expanded = False
        ' Rebuild:
        tvwReg_NodeClick tvwReg.SelectedItem
        tvwReg.SelectedItem.Expanded = bExpanded
        tvwReg.SelectedItem.EnsureVisible
    End Select
End Sub

Private Sub picSplitter_MouseDown(Button As Integer, Shift As Integer, X As
 Single, Y As Single)
   m_cSplit.MouseDown X
End Sub

Private Sub tvwReg_Collapse(ByVal Node As ComctlLib.Node)
Dim lNode As Long
Dim sText As String
Dim sKey As String
Dim nodX As Node
Dim nodParent As Node

   Node.Image = "CLOSEDFOLDER"
   Screen.MousePointer = vbHourglass
   If Node.Children &gt; 0 Then
      ' The quickest way to remove a large number of nodes is to remove the
      ' node itself:
      If Not (Node.Parent Is Nothing) Then
          Set nodParent = Node.Parent
      End If
      sText = Node.Text
      sKey = Node.Key
      tvwReg.Nodes.Remove Node.Index
      If Not (nodParent Is Nothing) Then
          Set nodX = tvwReg.Nodes.Add(nodParent, tvwChild, sKey, sText,
           "CLOSEDFOLDER")
      Else
          Set nodX = tvwReg.Nodes.Add(, , sKey, sText, "CLOSEDFOLDER")
      End If
      tvwReg.Nodes.Add nodX, tvwChild, , "Unexpanded"
      nodX.Selected = True
   End If
   Screen.MousePointer = vbDefault
End Sub

Private Sub tvwReg_Expand(ByVal Node As ComctlLib.Node)
Dim sSect() As String
Dim iSectCount As Long
Dim sKey As String
Dim iPos As Long
Dim iSect As Long
Dim nodX As Node

   Screen.MousePointer = vbHourglass

   If Node.Children &gt; 0 Then
      If (Node.Child.Text = "Unexpanded") Then
               
         tvwReg.Nodes.Remove Node.Child.Index
         
         sKey = Node.Key
         iPos = InStr(sKey, ",")
         If (iPos &gt; 0) Then
            cReg.ClassKey = CLng(Mid$(sKey, 2, (iPos - 2)))
            cReg.SectionKey = Mid$(sKey, (iPos + 2))
         Else
            cReg.ClassKey = CLng(Mid$(sKey, 2))
            sKey = sKey &amp; ","
            cReg.SectionKey = ""
         End If
            
         ' Log "EnumeratingSection:" &amp; cReg.ClassKey &amp; "," &amp; cReg.SectionKey
         cReg.EnumerateSections sSect(), iSectCount
         
         ' Log "DisplayingSection:" &amp; cReg.ClassKey &amp; "," &amp; cReg.SectionKey
         If (iSectCount &gt; 0) Then
            For iSect = 1 To iSectCount
               ' Log "Key = " &amp; sKey &amp; "\" &amp; sSect(iSect) &amp; ",Value = '" &amp;
                sSect(iSect) &amp; "'"
               Set nodX = tvwReg.Nodes.Add(Node, tvwChild, sKey &amp; "\" &amp;
                sSect(iSect), sSect(iSect), "CLOSEDFOLDER")
                  tvwReg.Nodes.Add nodX, tvwChild, , "Unexpanded"
            Next iSect
            Node.Sorted = True
         End If
      End If
   End If
   
   Node.Image = "OPENFOLDER"
   
   Screen.MousePointer = vbNormal
   
End Sub

Private Sub tvwReg_NodeClick(ByVal Node As ComctlLib.Node)
Dim sKeyNames() As String
Dim iValueCount As Long
Dim iValue As Long
Dim sKey As String
Dim iPos As Long
Dim itmX As ListItem
Dim vValue As Variant
Dim iMax As Long, i As Long
Dim sOut As String
      
   Screen.MousePointer = vbHourglass
      
   lvwReg.ListItems.Clear
   
   tvwReg_Expand Node
   
   sKey = Node.Key
   iPos = InStr(sKey, ",")
   If (iPos &gt; 0) Then
      cReg.ClassKey = CLng(Mid$(sKey, 2, (iPos - 2)))
      cReg.SectionKey = Mid$(sKey, (iPos + 2))
   Else
      cReg.ClassKey = CLng(Mid$(sKey, 2))
      sKey = sKey &amp; ","
      cReg.SectionKey = ""
   End If
   
   ' Log "EnumeratingValueNames:" &amp; cReg.ClassKey &amp; "," &amp; cReg.SectionKey
   cReg.EnumerateValues sKeyNames(), iValueCount
   
   ' Log "DisplayingValues:" &amp; cReg.ClassKey &amp; "," &amp; cReg.SectionKey
   ' Log "ValueCount:" &amp; iValueCount
   For iValue = 1 To iValueCount
      If (sKeyNames(iValue) = "") Then
        Set itmX = lvwReg.ListItems.Add(, , "(default)", , "DATAITEM")
      Else
        Set itmX = lvwReg.ListItems.Add(, , sKeyNames(iValue), , "DATAITEM")
      End If
        cReg.ValueKey = sKeyNames(iValue)
        vValue = cReg.Value
        If cReg.ValueType &lt;&gt; REG_BINARY Then
            itmX.SubItems(1) = vValue
        Else
            iMax = UBound(vValue)
            If (iMax &gt; 255) Then iMax = 255
            For i = LBound(vValue) To iMax
                If (vValue(i) &lt; &amp;H10) Then
                    sOut = sOut &amp; "0"
                End If
                sOut = sOut &amp; Hex$(vValue(i)) &amp; " "
            Next i
            itmX.SubItems(1) = sOut
        End If
        ' Should break down into individual types:
        If cReg.ValueType = REG_SZ Then
            itmX.Tag = "0"
        ElseIf cReg.ValueType = REG_BINARY Then
            itmX.Tag = "2"
        Else
            itmX.Tag = "1"
        End If
   Next iValue
   lvwReg.SortKey = 0
   lvwReg.SortOrder = lvwAscending
   lvwReg.Sorted = True
   lvwReg.ColumnHeaders(1).Tag = "ASC"

   Screen.MousePointer = vbNormal

   ' Log "Exit NodeClick:" &amp; iValueCount

End Sub
Private Sub Testbinary()
Dim cR As New cRegistry
Dim i As Long
Dim lC As Long
Dim bR As Byte
Dim bG As Byte
Dim bB As Byte
Dim bOut() As Byte

ReDim bOut(0 To 15 * 3 - 1) As Byte
For i = 1 To 15
    ' Get the Red, Green, Blue for the QBColor at index i:
    lC = QBColor(i)
    bR = (lC And &amp;HFF&amp;)
    bG = ((lC And &amp;HFF00&amp;) \ &amp;H100&amp;)
    bB = ((lC And &amp;HFF0000) \ &amp;H10000)
    
    ' Add Red, Green, Blue to the byte array to store:
    bOut((i - 1) * 3) = bR
    bOut((i - 1) * 3 + 1) = bG
    bOut((i - 1) * 3 + 2) = bB
Next i

With cR
    .ClassKey = HKEY_CURRENT_USER
    .SectionKey = "software\vbaccelerator\cRegistry\Binary Test"
    .ValueKey = "QBColors"
    .ValueType = REG_BINARY
    .Value = bOut()
End With

End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Registry and Ini Files</a>&#160;.&#160;<a href="article.html">Complete Registry control</a>&#160;.&#160;<a href="vb5_registry_editor_demonstration.html">VB5 Registry Editor Demonstration</a>&#160;.&#160;fTestReg.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2004 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 4 February 2004</p></td><td></td></tr></table>
</body></html>