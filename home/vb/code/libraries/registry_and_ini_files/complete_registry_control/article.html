<html lang="en" >
<head>

<title>vbAccelerator - Complete Registry control</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="The cRegistry class is an easy, self-contained way to get complete access to the Windows registry. 
Simple methods allow you to create, enumerate and delete keys and values in the registry, without restriction. 
You can even read/write binary data to the registry. To see how powerful this library is, 
download the demonstration Registry Editor, written entirely in VB. Its not far off RegEdit 
shipped with Windows (although note in my version not all the features are finished!)" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Registry and Ini Files</a>&#160;.&#160;Complete Registry control</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="cregistry_class.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />cRegistry Class</a> (6K)</p><p /><p class="nav"><a href="vb5_registry_editor_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Registry Editor Demonstration</a> (59K)</p><p /><p class="nav"><a href="vb6_registry_editor_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Registry Editor Demonstration</a> (52K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:2518</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=2518&type=article&title=complete_20registry_20control.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 0 / 1</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 1 / 2</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:24 January 2004</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />23 Jan 2004<br /><p class="update">Added remote registry connection through the <span class="code">Machine</span>.  
Many thanks to Yaron Lavi for providing the code.</p><p class="update">Fixed problem with saving zero length strings.  Thanks to Shane Marsden for 
providing the fix.</p><p class="update">Fixed problem with truncation of binary data.  Thanks to Morten Egelund Rasmussen
(and many others!) for providing the fix.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Complete Registry control</h1><img src="cregedt.gif" width="401" height="232" alt="Registry Editor Sample Application" /><p /><p>The cRegistry class is an easy, self-contained way to get complete access to the Windows registry. 
Simple methods allow you to create, enumerate and delete keys and values in the registry, without restriction. 
You can even read/write binary data to the registry. To see how powerful this library is, 
download the demonstration Registry Editor, written entirely in VB. Its not far off RegEdit 
shipped with Windows (although note in my version not all the features are finished!)</p><h2>Usage</h2><p>Here is a brief summary of typical uses of the class:</p><h3>To get a String Value from the Registry</h3><pre>
    Dim c As New cRegistry 
    With c 
        .ClassKey = HKEY_LOCAL_MACHINE 
        .SectionKey = "Software\MyApp\Tips" 
        .ValueKey = "Tip1" 
        .ValueType = REG_SZ 
        sTip = .Value 
    End With 
</pre><h3>To get a Numeric Value from the Registry</h3><pre>
    Dim c As New cRegistry 
    With c 
        .ClassKey = HKEY_LOCAL_MACHINE 
        .SectionKey = "Software\MyApp\Tips" 
        .ValueKey = "TipCount" 
        .ValueType = REG_DWORD 
        lTipCount = .Value 
    End With 
</pre><h3>To Save a Form's position to the Registry</h3><pre>
    Dim c As New cRegistry 
    With c 
        .ClassKey = HKEY_CURRENT_USER 
        ' You don't need to check if this key already exists
        ' - the class will create it for you
        .SectionKey = "Software\" &amp; App.ExeName &amp; "\" &amp; frmThis.Name
        .ValueKey = "Maximized" 
        .ValueType = REG_DWORD 
        .Value = (frmThis.WindowState = vbMaximized) 
        If (frmThis.WindowState &lt;&gt; vbMaximized) 
            .ValueKey = "Left" 
            .Value = frmThis.Left 
            .ValueKey = "Top" 
            .Value = frmThis.Top 
            .ValueKey = "Width" 
            .Value = frmThis.Width 
            .ValueKey = "Height" 
            .Value = frmThis.Height 
        End If 
    End With 
</pre><h3>To Get All The SubKeys of a Key</h3><p>Note you can also get all the values for a key in a similar way, except you 
use <i>EnumerateValues</i> instead of <i>EnumerateSections</i>.</p><pre>
    Dim c As New cRegistry 
    Dim sKeys() As String, iKeyCount As Long 

    With c 
        .ClassKey = HKEY_LOCAL_MACHINE 
        .SectionKey = "Software"
        .EnumerateSections(sKeys(), iKeyCount)
        For iKey = 1 To iKeyCount
            Debug.Print sKeys(iKey)
        Next iKey
    End With 
</pre><h3>To Delete a Key</h3><pre>
    Dim c As New cRegistry 
    With c 
        .ClassKey = HKEY_LOCAL_MACHINE 
        .SectionKey = "Software\MyApp\Tips" 
        .DeleteKey 
    End With 
</pre><h3>To Delete a Value</h3><pre>
    Dim c As New cRegistry 
    With c 
        .ClassKey = HKEY_LOCAL_MACHINE 
        .SectionKey = "Software\MyApp\Tips" 
        .ValueKey = "Tip1" 
        .DeleteValue 
    End With 
</pre><h3>To Associate a File of type .CCD with your executable</h3><pre>
    Dim c As New cRegistry 
    With c 
        .CreateEXEAssociation _
            App.Path &amp; "\" &amp; App.ExeName, _
            "CCarDesign.Project", _
            "Custom Car Designer Project", _
            "CCD"
    End With 
</pre><h3>To Read BINARY values from the registry</h3><p>Binary values are returned as a variant of type byte array. This code demonstrates 
how to format the returned value into a string of hexadecimal values, similar to the 
display provided in RegEdit:</p><pre>
    Dim cR As New cRegistry
    Dim iByte As Long
    Dim vR as Variant

    With cR
        .ClassKey = HKEY_CURRENT_USER
        .SectionKey = "Control Panel\Appearance"
        .ValueKey = "CustomColors"
        vR = .Value

        If .ValueType = REG_BINARY Then
        ' Read through the byte array and output it as a series of hex values:
        For iByte = LBound(vR) To UBound(vR)
            sOut = sOut &amp; "&amp;H"
            If (iByte&lt;&amp;H10) Then
                sOut = sOut &amp; "0"
            End If
            sOut = sOut &amp; Hex$(vR(iByte)) &amp; " " 
            Next iByte
        Else
            sOut = vR
        End If

        Debug.Print sOut
    End With
</pre><h3>To Set BINARY values from the registry</h3><p>Similarly, to store binary values in the registry, cRegistry.cls expects a byte array of the binary 
values you wish to store. This example (rather uselessly!) stores all the Red, Green, Blue values 
of each of VB's <i>QBColors</i> into a binary array: </p><pre>
    Dim cR As New cRegistry
    Dim i As Long
    Dim lC As Long
    Dim bR As Byte
    Dim bG As Byte
    Dim bB As Byte
    Dim bOut() As Byte

    ' Create a binary array containing all the Red,Green,Blue values of the QBColors:
    ReDim bOut(0 To 15 * 3 - 1) As Byte
    For i = 1 To 15
        ' Get the Red, Green, Blue for the QBColor at index i:
        lC = QBColor(i)
        bR = (lC And &amp;HFF&amp;)
        bG = ((lC And &amp;HFF00&amp;) \ &amp;H100&amp;)
        bB = ((lC And &amp;HFF0000) \ &amp;H10000)
    
        ' Add Red, Green, Blue to the byte array to store:
        bOut((i - 1) * 3) = bR
        bOut((i - 1) * 3 + 1) = bG
        bOut((i - 1) * 3 + 2) = bB
    Next i

    ' Store it:
    With cR
        .ClassKey = HKEY_CURRENT_USER
        .SectionKey = "software\vbaccelerator\cRegistry\Binary Test"
        .ValueKey = "QBColors"
        .ValueType = REG_BINARY
        .Value = bOut()
    End With
</pre><p>Daniel Henry has written an article which provides a wrapper around this class to make things
even simpler.  Have a look at <a href="javascript:window.alert(&quot;http://www.hashpipe.org/display_article_asp?id=17\nThis link was not retrieved.&quot;)">cRegistry Wrapper</a>.</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Registry and Ini Files</a>&#160;.&#160;Complete Registry control</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2004 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 2 February 2004</p></td><td></td></tr></table>
</body></html>