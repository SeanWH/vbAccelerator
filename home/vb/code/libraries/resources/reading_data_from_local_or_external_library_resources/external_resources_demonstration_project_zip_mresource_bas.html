<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: mResource.bas</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: mResource.bas" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Resources</a>&#160;.&#160;<a href="article.html">Reading Data from Local or External Library Resources</a>&#160;.&#160;<a href="external_resources_demonstration_project.html">External Resources Demonstration Project</a>&#160;.&#160;mResource.bas</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="external_resources_demonstration_project.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />External Resources Demonstration Project</a> (52K)</p><p /><p class="nav"><a href="jpg_resource_file_sample_project.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />JPG Resource File Sample Project</a> (43K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:2676</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=2676&type=zip&title=external_20resources_20demonstration_20project_2ezip_5fmresource.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />1 Nov 1999<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: mResource.bas</h1><pre>Attribute VB_Name = "mResource"
Option Explicit


Private Declare Function EnumResourceLanguages Lib "kernel32" Alias
 "EnumResourceLanguagesA" (ByVal hModule As Long, ByVal lpType As String, ByVal
 lpName As String, ByVal lpEnumFunc As Long, ByVal lParam As Long) As Long
Private Declare Function EnumResourceNamesByNum Lib "kernel32" Alias
 "EnumResourceNamesA" (ByVal hModule As Long, ByVal lpType As Long, ByVal
 lpEnumFunc As Long, ByVal lParam As Long) As Long
Private Declare Function EnumResourceNamesByAny Lib "kernel32" Alias
 "EnumResourceNamesA" (ByVal hModule As Long, lpType As Any, ByVal lpEnumFunc
 As String, ByVal lParam As Long) As Long
Private Declare Function EnumResourceTypes Lib "kernel32" Alias
 "EnumResourceTypesA" (ByVal hModule As Long, ByVal lpEnumFunc As Long, ByVal
 lParam As Long) As Long

Private Declare Function lstrlen Lib "kernel32" Alias "lstrlenA" (ByVal
 lpString As Long) As Long
Private Declare Sub CopyMemory Lib "kernel32" Alias "RtlMoveMemory" ( _
    lpvDest As Any, lpvSource As Any, ByVal cbCopy As Long)

Private Declare Function GlobalLock Lib "kernel32" (ByVal hMem As Long) As Long
Private Declare Function GlobalAlloc Lib "kernel32" (ByVal wFlags As Long,
 ByVal dwBytes As Long) As Long
Private Declare Function GlobalFree Lib "kernel32" (ByVal hMem As Long) As Long
Private Declare Function GlobalUnlock Lib "kernel32" (ByVal hMem As Long) As
 Long
Private Const GMEM_ZEROINIT = &amp;H40
Private Const GMEM_FIXED = &amp;H0
Private Const GPTR = (GMEM_FIXED Or GMEM_ZEROINIT)

Private Declare Function LoadImageLong Lib "user32" Alias "LoadImageA" (ByVal
 hInst As Long, ByVal lpsz As Long, ByVal uType As Long, ByVal cx As Long,
 ByVal cy As Long, ByVal uFlags As Long) As Long
Private Declare Function LoadImageString Lib "user32" Alias "LoadImageA" (ByVal
 hInst As Long, ByVal lpsz As String, ByVal uType As Long, ByVal cx As Long,
 ByVal cy As Long, ByVal uFlags As Long) As Long
Private Const IMAGE_BITMAP = 0
Private Const IMAGE_ICON = 1
Private Const IMAGE_CURSOR = 2

Private Declare Function LoadStringAsAny Lib "user32" Alias "LoadStringA"
 (ByVal hInstance As Long, wID As Any, ByVal lpBuffer As String, ByVal
 nBufferMax As Long) As Long
Private Declare Function LoadStringWAsAny Lib "user32" Alias "LoadStringW"
 (ByVal hInstance As Long, wID As Any, lpBuffer As Any, ByVal nBufferMax As
 Long) As Long

Private Declare Function FindResource Lib "kernel32" Alias "FindResourceA"
 (ByVal hInstance As Long, lpName As Any, lpType As Any) As Long
Private Declare Function LockResource Lib "kernel32" (ByVal hResData As Long)
 As Long
Private Declare Function LoadResource Lib "kernel32" (ByVal hInstance As Long,
 ByVal hResInfo As Long) As Long
Private Declare Function SizeofResource Lib "kernel32" (ByVal hInstance As
 Long, ByVal hResInfo As Long) As Long
Private Declare Function FreeResource Lib "kernel32" (ByVal hResData As Long)
 As Long


Private Const LR_DEFAULTCOLOR = &amp;H0
Private Const LR_MONOCHROME = &amp;H1
Private Const LR_COLOR = &amp;H2
Private Const LR_COPYRETURNORG = &amp;H4
Private Const LR_COPYDELETEORG = &amp;H8
Private Const LR_LOADFROMFILE = &amp;H10
Private Const LR_LOADTRANSPARENT = &amp;H20
Private Const LR_DEFAULTSIZE = &amp;H40
Private Const LR_VGACOLOR = &amp;H80
Private Const LR_LOADMAP3DCOLORS = &amp;H1000&amp;
Private Const LR_CREATEDIBSECTION = &amp;H2000&amp;
Private Const LR_COPYFROMRESOURCE = &amp;H4000&amp;
Private Const LR_SHARED = &amp;H8000&amp;

Private m_cR As cResources


Public Property Get PictureFromResource( _
      ByVal hMod As Long, _
      ByVal sName As String, _
      ByVal eType As CRStandardResourceTypeConstants _
   ) As IPicture
Dim hBmp As Long
Dim hIcon As Long
Dim hCur As Long
Dim lErr As Long
Dim lID As Long

   If eType = crBitmap Then
      If IsNumeric(sName) Then
         lID = CLng(sName)
         hBmp = LoadImageLong(hMod, lID, IMAGE_BITMAP, 0, 0, 0)
      Else
         hBmp = LoadImageString(hMod, sName, IMAGE_BITMAP, 0, 0, 0)
      End If
      If Not hBmp = 0 Then
         Set PictureFromResource = BitmapToPicture(hBmp)
      Else
         lErr = Err.LastDllError
         Err.Raise vbObjectError + 1048 + 3, App.EXEName &amp; ".cResource",
          WinError(lErr)
      End If
   ElseIf eType = crGroupIcon Then
      If IsNumeric(sName) Then
         lID = CLng(sName)
         hIcon = LoadImageLong(hMod, lID, IMAGE_ICON, 0, 0, 0)
      Else
         hIcon = LoadImageString(hMod, sName, IMAGE_ICON, 0, 0, 0)
      End If
      If Not hIcon = 0 Then
         Set PictureFromResource = IconToPicture(hIcon)
      Else
         lErr = Err.LastDllError
         Err.Raise vbObjectError + 1048 + 3, App.EXEName &amp; ".cResource",
          WinError(lErr)
      End If
   ElseIf eType = crGroupCursor Then
      If IsNumeric(sName) Then
         lID = CLng(sName)
         hCur = LoadImageLong(hMod, lID, IMAGE_CURSOR, 0, 0, 0)
      Else
         hCur = LoadImageString(hMod, sName, IMAGE_CURSOR, 0, 0, 0)
      End If
      If Not hCur = 0 Then
         Set PictureFromResource = IconToPicture(hCur)
      Else
         lErr = Err.LastDllError
         Err.Raise vbObjectError + 1048 + 3, App.EXEName &amp; ".cResource",
          WinError(lErr)
      End If
      
   End If
End Property

Public Sub SaveResource( _
      ByVal hMod As Long, _
      ByVal sName As String, _
      ByVal sType As String, _
      ByVal sFile As String _
   )
Dim sBuf As String
Dim hGbl As Long
Dim hRes As Long
Dim lID As Long
Dim lSize As Long
Dim lPtr As Long
Dim lR As Long
Dim iFile As Integer
Dim lErr As Long
   
On Error GoTo ErrorHandler
   
   If IsNumeric(sName) Then
      lID = CLng(sName)
      sName = "#" &amp; sName
   End If
   If IsNumeric(sType) Then
      hRes = FindResource(hMod, ByVal sName, ByVal CLng(sType))
   Else
      hRes = FindResource(hMod, ByVal sName, ByVal sType)
   End If
   If Not hRes = 0 Then
      hGbl = LoadResource(hMod, hRes)
      If Not hGbl = 0 Then
         lPtr = LockResource(hGbl)
         If Not lPtr = 0 Then
            lSize = SizeofResource(hMod, hRes)
            If lSize &gt; 0 Then
               ReDim b(0 To lSize) As Byte
               CopyMemory b(0), ByVal lPtr, lSize
               
               On Error Resume Next
                  Kill sFile
               On Error GoTo ErrorHandler
               
               iFile = FreeFile
               Open sFile For Binary Access Write Lock Read As #iFile
               Put #iFile, , b
               Close #iFile
               iFile = 0
                                             
            End If
         Else
            lErr = Err.LastDllError
            Err.Raise vbObjectError + 1048 + 4, App.EXEName &amp; ".cResource",
             WinError(lErr)
         End If
      Else
         lErr = Err.LastDllError
         Err.Raise vbObjectError + 1048 + 3, App.EXEName &amp; ".cResource",
          WinError(lErr)
      End If
      FreeResource hRes
   Else
      Err.Raise vbObjectError + 1048 + 3, App.EXEName &amp; ".cResource",
       "Specified Resource Not Found."
   End If
   Exit Sub
      
ErrorHandler:
   Err.Raise Err.Number, App.EXEName &amp; ".cResource", Err.Description
   If Not (iFile = 0) Then
      Close #iFile
   End If
   Exit Sub
End Sub

Public Function GetResourceNames(cR As cResources, ByVal vType As Variant) As
 Long
Dim lR As Long
Dim lErr As Long
Dim lType As Long
Dim sType As String
Dim b() As Byte
Dim lpType As Long
Dim hMem As Long
Dim lPtr As Long

   Set m_cR = cR
   If (VarType(vType) = vbLong) Then
      lType = vType
      lR = EnumResourceNamesByNum(cR.hModule, lType, AddressOf
       EnumResNamesProc, 0)
   Else
      sType = vType
      b = StrConv(sType, vbFromUnicode)
      ReDim Preserve b(0 To UBound(b) + 1) As Byte
      hMem = GlobalAlloc(GPTR, UBound(b) + 1)
      If Not hMem = 0 Then
         lPtr = GlobalLock(hMem)
         If Not lPtr = 0 Then
            CopyMemory ByVal lPtr, b(0), UBound(b) + 1
            lR = EnumResourceNamesByNum(cR.hModule, lPtr, AddressOf
             EnumResNamesProc, 0)
            GlobalUnlock lPtr
         End If
         GlobalFree hMem
      End If
   End If
   If (lR = 0) Then
      lErr = Err.LastDllError
      Err.Raise vbObjectError + 1048 + 2, App.EXEName &amp; ".cResource",
       WinError(lErr)
   End If
   Set m_cR = Nothing
   GetResourceNames = lR
      
End Function

Public Function EnumResNamesProc( _
      ByVal hMod As Long, _
      ByVal lpszType As Long, _
      ByVal lpszName As Long, _
      ByVal lParam As Long _
   ) As Long
Dim sName As String
Dim lName As Long
Dim b() As Byte
Dim lLen As Long

   If (lpszName And &amp;HFFFF0000) = 0 Then
      ' resource number:
      lName = lpszName And &amp;HFFFF&amp;
      m_cR.AddResourceName lName, ""
   Else
      ' resource string:
      lLen = lstrlen(lpszName)
      If (lLen &gt; 0) Then
         ReDim b(0 To lLen - 1) As Byte
         CopyMemory b(0), ByVal lpszName, lLen
         sName = StrConv(b, vbUnicode)
      End If
      m_cR.AddResourceName 0, sName
   End If
   EnumResNamesProc = 1
End Function

Public Function GetResourceTypes(cR As cResources) As Long
Dim lR As Long
Dim lErr As Long
   Set m_cR = cR
   lR = EnumResourceTypes(cR.hModule, AddressOf EnumResTypesProc, 0)
   If (lR = 0) Then
      lErr = Err.LastDllError
      Set m_cR = Nothing
      Err.Raise vbObjectError + 1048 + 1, App.EXEName &amp; ".cResource",
       WinError(lErr)
   End If
   Set m_cR = Nothing
   GetResourceTypes = lR
End Function

Private Function EnumResTypesProc( _
      ByVal hMod As Long, _
      ByVal lpszType As Long, _
      ByVal lParam As Long _
   ) As Long
Dim lType As Long
Dim sType As String
Dim lLen As Long
Dim b() As Byte
   If (lpszType And &amp;HFFFF0000) = 0 Then
      ' standard resource type:
      lType = lpszType And &amp;HFFFF&amp;
      m_cR.AddResourceType lType, ""
   Else
      ' string:
      lLen = lstrlen(lpszType)
      If (lLen &gt; 0) Then
         ReDim b(0 To lLen - 1) As Byte
         CopyMemory b(0), ByVal lpszType, lLen
         sType = StrConv(b, vbUnicode)
      End If
      m_cR.AddResourceType 0, sType
   End If
   
   EnumResTypesProc = 1
   
End Function




</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Resources</a>&#160;.&#160;<a href="article.html">Reading Data from Local or External Library Resources</a>&#160;.&#160;<a href="external_resources_demonstration_project.html">External Resources Demonstration Project</a>&#160;.&#160;mResource.bas</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>