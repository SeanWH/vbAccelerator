<html lang="en" >
<head>

<title>vbAccelerator - Zipping files using the free Info-Zip Zip DLL (now with encryption support)</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="This article provides a class to enable you to simply add the ability to 
zip files to a VB application. With this class you can create zips which recurse 
subdirectories, store full or relative path names, add and delete files from zips, 
freshen zips - basically everything you would expect to be able to do from a 
fully featured zipping application, and all under your programmatic control." /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Compression</a>&#160;.&#160;Zipping files using the free Info-Zip Zip DLL (now with encryption support)</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="info-zip_zip_dll_(renmaed_vbzip11_dll).html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Info-ZIP Zip DLL (Renmaed vbzip11.dll)</a> (72K)</p><p /><p class="nav"><a href="vb5_zip_sample_project.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Zip Sample Project</a> (39K)</p><p /><p class="nav"><a href="vb6_zip_sample_project.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Zip Sample Project</a> (37K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:1426</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=1426&type=article&title=zipping_20files_20using_20the_20free_20info_2dzip_20zip_20dll_20_28now_20.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 5 / 5</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 1 / 1</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:14 November 2003</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />26 Jan 2003<br /><p class="update">Added support for Encrypting zip files, and adding
zip file comments.</p><p class="update">Added VB6 project</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\unzipping_files\article.html">Unzipping files using the free Info-Zip Unzip DLL with VB</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\introduction_to_the_info-zip_libraries\article.html">Introduction to the freeware Info-ZIP libraries</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\utilities\vbpzip\article.html">Visual Basic Project Zip Utility</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Zipping files using the free Info-Zip Zip DLL (now with encryption support)</h1><p class="splash">Add the ability to ZIP up data to your application without needing third-party controls</p><img src="zip.png" width="269" height="198" alt="Zip Sample Application" /><p /><p>This article provides a class to enable you to simply add the ability to 
zip files to a VB application. With this class you can create zips which recurse 
subdirectories, store full or relative path names, add and delete files from zips, 
freshen zips - basically everything you would expect to be able to do from a 
fully featured zipping application, and all under your programmatic control.</p><h2>Reusing the VB code - Quick Start</h2><p>To get the simplest overview of the code, extract these two files 
from the Zip Sample project:</p><ul><li>cZip.cls</li><li>mZip.bas</li></ul><p>Add these two files to a new project in VB, and then declare a 
<i>WithEvents</i> instance of the cZip class:</p><pre>
   Private WithEvents m_cZip As cZip
</pre><p>The simplest operation is to add a single file to a new zip file. 
This is all you need to do:</p><pre>
   ' Set the zip file:
   m_cZip.ZipFile = sFile

   ' Make sure any previously zipped files are cleared:
   m_cZip.ClearFileSpecs

   ' Add the name of the file you want to zip:
   m_cZip.AddFileSpec "C:\Stevemac\HTML\ssite\index.html"

   ' Create the zip!
   m_cZip.Zip

   ' Check for success failure:
   If Not(m_cZip.Success) Then 
      ' Zip failed.  One of the notifications will have
      ' provided the reason.
      ' e.g. can't write output file, can't find any
      '      matching files
   End If
</pre><h2>In More Detail</h2><h3>Adding Files to a Zip</h3><p>Adding files to the zip is accomplished using the <i>AddFileSpec</i> method. 
A file specification can either be a fully specified path name (e.g. 
C:\Stevemac\HTML\ssite\index.html), a wildcard specification (e.g. 
C:\Stevemac\HTML\ssite\*.htm? ) or a relative path (e.g. 
index.html). Relative paths are taken relative to the BasePath property of the zip. 
If you wish to store relative directory names in your zip, then you must specify 
relative paths as the file spec.</p><p><i>AddFileSpec</i> adds additional file specifications to be used during operations. 
To clear the buffer, use <i>ClearFileSpecs</i>. To modify existing file specifications, 
you can use <i>FileSpecCount</i> to return how many specifications have been set up 
and the property <i>FileSpec</i> to read or write the property.</p><h3>Progress and Cancel</h3><p>As Zipping operations are performed, the class will raise the <i>Progress</i> event, 
which you can use to display status messages about the directory operation, 
and <i>Cancel</i> events, which allows you to stop the directory or unzip operation.</p><h3>Options</h3><p>The most important zip options are 
<i>RecurseSubDirs</i> and <i>StoreFolderNames</i>. When you set <i>RecurseSubDirs</i>, 
the zip DLL will check for all files starting at the <i>BasePath</i> property and 
below for matches against each of the <i>FileSpecs</i>. So, for example, 
if you add "*.*" as a specification, all files in the <i>BasePath</i> folder and 
below will be added to the zip. The <i>StoreFolderNames</i> option determines whether 
the zip will include the folder names as well as the file names. The default operation 
of this option is to store the full folder name, however, if your <i>FileSpec</i> items 
are relative paths at or below the <i>BasePath</i> then the zip will include the 
relative path name instead. Note that relative folder names can only be stored 
for deeper folders, so ..\MyFolder will not be represented.</p><h3>Deleting Files</h3><p>Deleting files from a Zip is accomplished in exactly the same way as zipping, 
except you use the <i>Delete</i> method instead of the Zip method.</p><h3>Password Protecting Zip File Contents</h3><p>Password protection is enabled by setting the <i>Encrypt</i> flag in the 
class.  If set, once the <i>Zip</i> method has been called the <i>PasswordRequest</i>
event will be fired.  This is fired twice: first to get the password and second to 
confirm the password originally typed.  The <i>bConfirm</i> flag is set true for
password confirmations.  Otherwise, check the maximum allowed password length
from the <i>lMaxPasswordLength</i> parameter, and then request the password from
the user and put it into the <i>sPassword</i> parameter.  A sample of using this
event is as follows:
</p><pre>
Private WithEvents m_cZ As cZip

...

Private Sub ZipLog()
   With m_cZ
      .ZipFile = App.Path &amp; "\backup.zip"
      .Encrypt = True
      .BasePath = App.Path
      .ClearFileSpecs
      .AddFileSpec App.Path &amp; "\appdata.log"
      .Zip
   End With
End Sub

...

Private Sub m_cZ_PasswordRequest( _
      sPassword As String, _
      ByVal lMaxPasswordLength As Long, _
      ByVal bConfirm As Boolean, _
      bCancel As Boolean _
   )
   '
Dim sPass As String
Dim sMsg As String
   
If (bConfirm) Then
      sMsg = "Confirm password:"
   Else
      sMsg = "Enter password (maximum length = " &amp; _
         lMaxPasswordLength &amp; ") characters"
   End If

   sPass = InputBox(sMsg, App.EXEName)
   sPass = Trim(sPass)

   If (Len(sPass) = 0) Then
      bCancel = True
   ElseIf (Len(sPass) &gt; lMaxPasswordLength) Then
      ' here we ignore it; the DLL will truncate it
      ' but you could re-prompt the user
      sPassword = sPass
   Else
      sPassword = sPass
   End If
   
   '
End Sub
</pre><h3>Adding Comments to Zip Files</h3><p>Adding comments works in a similar way to password protecting zip contents.  
If you set the <i>AddComment</i> flag to true, then the  <i>RequestComment</i> event 
will be raised during zipping.  Note that
the maximum length of a comment using Info-ZIP's libraries is 255 characters.</p><h2>More</h2><p>For a more sophisticated zipping sample, check out the 
<a href="..\..\..\..\utilities\vbpzip\article.html">VBP Zip utility</a> in the Utilities
section of the site.</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Compression</a>&#160;.&#160;Zipping files using the free Info-Zip Zip DLL (now with encryption support)</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 26 January 2003</p></td><td></td></tr></table>
</body></html>
