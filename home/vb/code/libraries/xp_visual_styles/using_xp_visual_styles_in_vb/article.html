<html lang="en" >
<head>

<title>vbAccelerator - Adding XP Visual Styles to Your Visual Basic Application</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="
When you run a Visual Basic application on an XP machine, you will see that 
although the form gets an XP-style title bar, the controls on the form still
draw in the old-fashioned Windows style.  However, it doesn't take much to 
persuade an application to use the new styles.  In some cases, you can get 
existing applications to use the new styles with no additional code whatsover!
" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">XP Visual Styles</a>&#160;.&#160;Adding XP Visual Styles to Your Visual Basic Application</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_xp_styles_demonstration_-_manifest_file.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 XP Styles Demonstration - Manifest File</a> (18K)</p><p class="nav"><a href="vb5_xp_styles_demonstration_-_manifest_resource.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 XP Styles Demonstration - Manifest Resource</a> (17K)</p><p /><p class="nav"><a href="vb6_xp_styles_demonstration_-_manifest_file.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 XP Styles Demonstration - Manifest File</a> (17K)</p><p class="nav"><a href="vb6_xp_styles_demonstration_-_manifest_resource.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 XP Styles Demonstration - Manifest Resource</a> (17K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:1427</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=1427&type=article&title=adding_20xp_20visual_20styles_20to_20your_20visual_20basic_20application.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 0 / 1</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 0 / 0</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 1 / 1</a></p><p class="nav">Updated:10 January 2004</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />26 Jan 2003<br /><p class="update">The text incorrectly stated that the Manifest in the resource
file had to be all on one line, thanks to Thomas Kessler for correcting me
on this.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\drawing_with_xp_visual_styles\article.html">Drawing with XP Visual Styles</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\resources\using_rc_exe\article.html">Using RC.EXE</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Adding XP Visual Styles to Your Visual Basic Application</h1><img src="xpstyles.png" width="480" height="147" alt="Before and After applying XP Visual Styles" /><p />
When you run a Visual Basic application on an XP machine, you will see that 
although the form gets an XP-style title bar, the controls on the form still
draw in the old-fashioned Windows style.  However, it doesn't take much to 
persuade an application to use the new styles.  In some cases, you can get 
existing applications to use the new styles with no additional code whatsover!
<h2>The New XP Styles</h2><p>The Windows XP Visual Styles are provided by ComCtl32.dll version 6 or later. (In fact,
anyone who is as old as me and remembers back to Visual Basic 3 may find this familiar, 
since the exciting 3D control look which was provided with Windows 95 was also implemented 
in the same way).
Note 
that unlike previous versions of this DLL, version 6 is not redistributable - which 
sadly means you can only use the visual styles on an operating system that has this version
installed. At the time of writing this means XP only.</p><p>ComCtl32 does not apply the latest styles to the client area of an application by default.  
In order to enable it, you need to ensure that your application is linked to 
ComCtl32.dll (by calling the ComCtl
<span class="code">InitCommonControls</span> API call) and then you need to provide a <span class="i">Manifest</span>
which specifies that the new version of the control styles should be used.</p><h2>Manifests</h2><p>Manifests are part of the technologies introduced by Microsoft to attempt to resolve the 
DLL versioning conflicts (normally referred to as DLL hell) so common in Windows development.
You can read more about these technologies and manifests in the Windows XP Technical Article 
"How To Build and Service Isolated Applications and Side-by-Side Assemblies for Windows XP"
at MSDN.  However, for this article all you need to know is that to use version 6 of the common
controls you need to be able to provide an XML document known as a Manifest to ComCtl32.</p><p>The manifest XML document required to use XP Visual Styles is as follows:</p><pre>
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes" ?&gt;
&lt;assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0"&gt;
    &lt;assemblyIdentity 
        version="1.0.0.0" 
        processorArchitecture="X86" 
        name="CompanyName.ProductName.YourAppName" 
        type="win32" /&gt;
    &lt;description&gt;Your application description here&lt;/description&gt;
    &lt;dependency&gt;
        &lt;dependentAssembly&gt;
            &lt;assemblyIdentity 
                type="win32" 
                name="Microsoft.Windows.Common-Controls" 
                version="6.0.0.0" 
                processorArchitecture="X86" 
                publicKeyToken="6595b64144ccf1df" 
                language="*" /&gt;
        &lt;/dependentAssembly&gt;
    &lt;/dependency&gt;
&lt;/assembly&gt;
</pre><p>Note that the <span class="code">name</span> attribute and the <span class="code">description</span> element are essentially free text.</p><h2>Ensuring Your Application Links to ComCtl32.dll</h2><p>If you provide a manifest, but your application does not link to ComCtl32.dll, then it will fail to
load - sometimes with no error message!.  You need to call at least <span class="code">InitCommonControls</span> before any 
visual elements are displayed.  Sometimes, you don't need to do anything because your application may 
already link to ComCtl32.dll (for example, if it includes any of the Windows Common Controls provided 
with Visual Basic), however, to be certain it works it is best to call <span class="code">InitCommonControls</span> prior
to displaying any forms.</p><p>Here is the code you need at the start of your application to ensure you've linked to ComCtl32.dll:</p><pre>
Private Type tagInitCommonControlsEx
   lngSize As Long
   lngICC As Long
End Type
Private Declare Function InitCommonControlsEx Lib "comctl32.dll" _
   (iccex As tagInitCommonControlsEx) As Boolean
Private Const ICC_USEREX_CLASSES = &amp;H200

Public Function InitCommonControlsVB() As Boolean
   On Error Resume Next
   Dim iccex As tagInitCommonControlsEx
   ' Ensure CC available:
   With iccex
       .lngSize = LenB(iccex)
       .lngICC = ICC_USEREX_CLASSES
   End With
   InitCommonControlsEx iccex
   InitCommonControlsVB = (Err.Number = 0)
   On Error Goto 0
End Function

Public Sub Main()
   InitCommonControlsVB

   '   
   ' Start your application here:
   ' 

End Sub
</pre><h2>Providing the Manifest</h2><p>There are two ways to provide the manifest: the simplest (but least elegant) way is to provide
the manifest on disk for an executable.  Let's say your application is called <span class="i">TimeSlot.exe</span>.  
Then if you save the manifest XML above as <pre>TimeSlot.exe.manifest</pre> in the same directory as
the executable, TimeSlot.exe will automatically get the XP styles.  VB5 and VB6 examples are provided.
If you rename the .manifest file prior to running the app, you can switch off the XP styles.</p><p>A more robust method is to compile the manifest as a resource in your application.  To do this,
the manifest must appear as resource type <span class="code">RT_MANIFEST</span> (24) with id 
<span class="code">CREATEPROCESS_MANIFEST_RESOURCE_ID</span> (1).  For some bizarre reason, you <strong>must</strong> also 
ensure that the resulting XML file is an even multiple of 4 bytes long.  So for example, if your file 
is actually 597 bytes you need to add padding spaces to make up the file size to 600 bytes before compiling.
The Resource examples demonstrate how to create
this resource file using a resource compiler script (.rc file) and <span class="i">RC.exe</span>.</p><h2>Some Notes</h2><ul><li>XP styles do not apply during development time, only at run time. Test your executable frequently.</li><li>Option buttons do not seem to draw correctly when placed on a frame, particularly with VB6.  You must
place your option boxes onto a picture box.</li><li>3D borders on PictureBoxes, Images and so on do not draw in the new XP style, which is a single line
in some combination of the highlight color and the form background.  To draw these new borders, check out
the article <a href="..\drawing_with_xp_visual_styles\article.html">Drawing with the XP Visual Styles</a>.</li></ul><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">XP Visual Styles</a>&#160;.&#160;Adding XP Visual Styles to Your Visual Basic Application</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 7 September 2003</p></td><td></td></tr></table>
</body></html>
