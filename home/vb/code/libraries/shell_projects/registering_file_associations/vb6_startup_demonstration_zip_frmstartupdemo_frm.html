<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmStartupDemo.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmStartupDemo.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Shell Projects</a>&#160;.&#160;<a href="article.html">Registering File Associations and Passing Command Line Parameters to an Existing App Instance</a>&#160;.&#160;<a href="vb6_startup_demonstration.html">VB6 Startup Demonstration</a>&#160;.&#160;frmStartupDemo.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_startup_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Startup Demonstration</a> (43K)</p><p /><p class="nav"><a href="vb6_startup_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Startup Demonstration</a> (41K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:14430</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=14430&type=zip&title=vb6_20startup_20demonstration_2ezip_5ffrmstartupdemo.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />15 Feb 2004<br /><p class="update">Fixed missing downloads.</p><p class="update">The code now correctly restoring and activates Windows on
all systems, and the bug with restoring iconic Windows (incorrect constant)
has been fixed.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\registry_and_ini_files\complete_registry_control\article.html">Complete Registry control</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\tips\create_guids\article.html">Create New GUIDs</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\utilities\goldfish\article.html">Goldfish</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\windows\enumerating_windows\article.html">Enumerating Windows Using the API </a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmStartupDemo.frm</h1><pre>VERSION 5.00
Begin VB.Form frmStartupDemo 
   Caption         =   "Startup and Command Line Passing Demo"
   ClientHeight    =   3990
   ClientLeft      =   2955
   ClientTop       =   2550
   ClientWidth     =   6555
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmStartupDemo.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   3990
   ScaleWidth      =   6555
   Begin VB.TextBox txtDemo 
      Height          =   2535
      Left            =   120
      MultiLine       =   -1  'True
      ScrollBars      =   2  'Vertical
      TabIndex        =   0
      Text            =   "frmStartupDemo.frx":27A2
      Top             =   1080
      Width           =   6375
   End
   Begin VB.Label lblInfo 
      Caption         =   $"frmStartupDemo.frx":27AC
      Height          =   675
      Left            =   120
      TabIndex        =   2
      Top             =   60
      Width           =   6195
   End
   Begin VB.Label lblCurrent 
      Height          =   255
      Left            =   120
      TabIndex        =   1
      Top             =   780
      Width           =   6315
   End
End
Attribute VB_Name = "frmStartupDemo"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Implements ISubclass
Private m_emr As EMsgResponse


Private Sub ParseCommand(ByVal sCmd As String)
Dim sFIle As String
Dim iFIle As Long
Dim sText As String

   ' If you are running as a systray app and your
   ' main window is hidden, then restore it (not
   ' applicable in this simple app):
   If (Me.Visible = False) Then
      Me.Visible = True
   End If
   
   ' Bring me to the foreground and restore
   ' if iconic:
   RestoreAndActivate Me.hwnd
   ' Your function to parse the command line:
   sCmd = Trim$(sCmd)
   ' for debugging:
   If Len(sCmd) &gt; 0 Then
      If (Left$(sCmd, 1) = """") Then
         sCmd = Mid$(sCmd, 2)
      End If
      If (Right$(sCmd, 1) = """") Then
         sCmd = Left$(sCmd, Len(sCmd) - 1)
      End If
      On Error GoTo ErrorHandler
      sFIle = Dir(sCmd, vbNormal)
      ' for debugging:
      lblCurrent = sCmd
      ' We have a file:
      iFIle = FreeFile
      Open sCmd For Binary Access Read As #iFIle
      sText = Space$(LOF(iFIle))
      Get #iFIle, , sText
      Close #iFIle
      iFIle = 0
      txtDemo.Text = sText
   End If
   Exit Sub
   
ErrorHandler:
Dim sErr As String
   sErr = Err.Description
   If (iFIle &lt;&gt; 0) Then
      Close #iFIle
   End If
   MsgBox "An error occurred: " &amp; sErr, vbExclamation
   Exit Sub
   
End Sub

Private Sub Form_Load()
Dim sPath As String

   sPath = App.Path
   If (Right$(sPath, 1) &lt;&gt; "\") Then sPath = sPath &amp; "\"
   sPath = sPath &amp; App.EXEName &amp; ".exe"

   ' Create an association with this program to
   ' .VAS files:
   Dim cR As New cRegistry
   ' Create an open association, and set the file icon to be the icon with
    resource id 24 within
   ' the executable (note that resource id 1 is the exe's icon):
   cR.CreateEXEAssociation sPath, "StartupDemo.StartUpFile", "vbAccelerator
    StartUp Demo", "VAS", lDefaultIconIndex:=1
   ' Create a customised right click menu item in explorer to allow the file
   ' to be opened with Notepad...
   cR.CreateAdditionalEXEAssociations "StartupDemo.StartUpFile", "Notepad",
    "Open with &amp;Notepad", "NOTEPAD.EXE ""%1"""
   
   ' Start subclassing:
   AttachMessage Me, Me.hwnd, WM_COPYDATA
   
   ' Tell the startup module to tag this window:
   TagWindow Me.hwnd
   
   ' If we have a command line, then parse it:
   ParseCommand Command
   
End Sub

Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)
   ' stop subclassing:
   DetachMessage Me, Me.hwnd, WM_COPYDATA
   ' clear up mutex...
   EndApp
End Sub

Private Sub Form_Resize()
   On Error Resume Next
   txtDemo.Move txtDemo.Left, txtDemo.Top, Me.ScaleWidth - txtDemo.Left * 2,
    Me.ScaleHeight - txtDemo.Top - 8 * Screen.TwipsPerPixelY
End Sub

Private Property Let ISubclass_MsgResponse(ByVal RHS As EMsgResponse)
   ' This shouldn't really be in SSUBTMR.
   ' In fact, SSUBTMR should have a BeforeMessage and AfterMessage
   ' function if it was going to be easier to use.
   ' Sometime....
End Property

Private Property Get ISubclass_MsgResponse() As EMsgResponse
   ' This will tell you which message you are responding to:
   ' WM_COPYDATA, send response after we've done with it:
   ISubclass_MsgResponse = emrPostProcess
   
End Property

Private Function ISubclass_WindowProc(ByVal hwnd As Long, ByVal iMsg As Long,
 ByVal wParam As Long, ByVal lParam As Long) As Long
Dim tCDS As COPYDATASTRUCT
Dim b() As Byte
Dim sCommand As String

   Select Case iMsg
   Case WM_COPYDATA
      ' Copy for processing:
      CopyMemory tCDS, ByVal lParam, Len(tCDS)
      If (tCDS.cbData &gt; 0) Then
         ReDim b(0 To tCDS.cbData - 1) As Byte
         CopyMemory b(0), ByVal tCDS.lpData, tCDS.cbData
         sCommand = StrConv(b, vbUnicode)
         
         ' We've got the info, now do it:
         ParseCommand sCommand
      Else
         ' no data.  This is only sent by the main
         ' module if it detects this window is hidden.
         ' since this can't occur in this project,
         ' this won't occur.  However, in a project
         ' where your main window can be hidden, you
         ' would make your window visible and activate
         ' it here.
      End If
      
   End Select
   
End Function

</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Shell Projects</a>&#160;.&#160;<a href="article.html">Registering File Associations and Passing Command Line Parameters to an Existing App Instance</a>&#160;.&#160;<a href="vb6_startup_demonstration.html">VB6 Startup Demonstration</a>&#160;.&#160;frmStartupDemo.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2004 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 14 February 2004</p></td><td></td></tr></table>
</body></html>