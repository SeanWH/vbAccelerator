<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: Test_frmMain.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: Test_frmMain.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Persistance</a>&#160;.&#160;<a href="article.html">XML Property Bag</a>&#160;.&#160;<a href="vb6_xml_property_bag_dll_and_demonstration.html">VB6 XML Property Bag DLL and Demonstration</a>&#160;.&#160;Test_frmMain.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_xml_property_bag_dll_and_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 XML Property Bag DLL and Demonstration</a> (28K)</p><p /><p class="nav"><a href="vb6_xml_property_bag_dll_and_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 XML Property Bag DLL and Demonstration</a> (28K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:2992</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=2992&type=zip&title=vb6_20xml_20property_20bag_20dll_20and_20demonstration_2ezip_5ftest_5ffrmmain.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><p class="nav">&#160;&#160;<a href="mailto:Aaron.Anderson@mail.farmcreditbank.com">Aaron Anderson</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />21 Mar 2000<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: Test_frmMain.frm</h1><pre>VERSION 5.00
Begin VB.Form frmMain 
   Caption         =   "XML Property Bag Demonstration"
   ClientHeight    =   4455
   ClientLeft      =   2490
   ClientTop       =   2325
   ClientWidth     =   8430
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmMain.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   4455
   ScaleWidth      =   8430
   Begin VB.CommandButton cmdClear 
      Caption         =   "&amp;Clear"
      Height          =   375
      Left            =   60
      TabIndex        =   23
      Top             =   4020
      Width           =   1215
   End
   Begin VB.TextBox txtZipCode 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Left            =   1020
      Locked          =   -1  'True
      TabIndex        =   13
      Top             =   3480
      Width           =   1275
   End
   Begin VB.TextBox txtCity 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Left            =   1020
      Locked          =   -1  'True
      TabIndex        =   12
      Top             =   3120
      Width           =   3075
   End
   Begin VB.TextBox txtState 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Left            =   1020
      Locked          =   -1  'True
      TabIndex        =   11
      Top             =   2760
      Width           =   3075
   End
   Begin VB.TextBox txtAddress2 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Left            =   1020
      Locked          =   -1  'True
      TabIndex        =   10
      Top             =   2400
      Width           =   3075
   End
   Begin VB.TextBox txtAddress1 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Left            =   1020
      Locked          =   -1  'True
      TabIndex        =   9
      Top             =   2040
      Width           =   3075
   End
   Begin VB.ComboBox cboAddresses 
      Height          =   315
      Left            =   1020
      Style           =   2  'Dropdown List
      TabIndex        =   8
      Top             =   1560
      Width           =   1275
   End
   Begin VB.TextBox txtBirthday 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Left            =   1020
      Locked          =   -1  'True
      TabIndex        =   7
      Top             =   1080
      Width           =   3075
   End
   Begin VB.TextBox txtSurname 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Left            =   1020
      Locked          =   -1  'True
      TabIndex        =   6
      Top             =   720
      Width           =   3075
   End
   Begin VB.TextBox txtFirstName 
      BackColor       =   &amp;H8000000F&amp;
      Height          =   315
      Left            =   1020
      Locked          =   -1  'True
      TabIndex        =   5
      Top             =   360
      Width           =   3075
   End
   Begin VB.CommandButton cmdFromXML 
      Caption         =   "&lt;&lt; &amp;Restore"
      Height          =   375
      Left            =   4260
      TabIndex        =   2
      Top             =   4020
      Width           =   1395
   End
   Begin VB.CommandButton cmdToXML 
      Caption         =   "&amp;Save &gt;&gt;"
      Height          =   375
      Left            =   2640
      TabIndex        =   1
      Top             =   4020
      Width           =   1395
   End
   Begin VB.TextBox txtXML 
      BeginProperty Font 
         Name            =   "Lucida Console"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   3495
      Left            =   4260
      MultiLine       =   -1  'True
      ScrollBars      =   3  'Both
      TabIndex        =   0
      Top             =   300
      Width           =   4155
   End
   Begin VB.Label lblInfo 
      Caption         =   "&amp;Zip"
      Height          =   195
      Index           =   10
      Left            =   60
      TabIndex        =   22
      Top             =   3540
      Width           =   915
   End
   Begin VB.Label lblInfo 
      Caption         =   "&amp;City"
      Height          =   195
      Index           =   9
      Left            =   60
      TabIndex        =   21
      Top             =   3180
      Width           =   915
   End
   Begin VB.Label lblInfo 
      Caption         =   "&amp;State"
      Height          =   195
      Index           =   8
      Left            =   60
      TabIndex        =   20
      Top             =   2820
      Width           =   915
   End
   Begin VB.Label lblInfo 
      Caption         =   "Address &amp;2"
      Height          =   195
      Index           =   7
      Left            =   60
      TabIndex        =   19
      Top             =   2460
      Width           =   915
   End
   Begin VB.Label lblInfo 
      Caption         =   "Address &amp;1"
      Height          =   195
      Index           =   6
      Left            =   60
      TabIndex        =   18
      Top             =   2100
      Width           =   915
   End
   Begin VB.Label lblInfo 
      Caption         =   "A&amp;ddresses"
      Height          =   195
      Index           =   5
      Left            =   60
      TabIndex        =   17
      Top             =   1620
      Width           =   915
   End
   Begin VB.Label lblInfo 
      Caption         =   "&amp;Birthday"
      Height          =   195
      Index           =   4
      Left            =   60
      TabIndex        =   16
      Top             =   1140
      Width           =   915
   End
   Begin VB.Label lblInfo 
      Caption         =   "&amp;Surname"
      Height          =   195
      Index           =   3
      Left            =   60
      TabIndex        =   15
      Top             =   780
      Width           =   915
   End
   Begin VB.Label lblInfo 
      Caption         =   "&amp;First Name"
      Height          =   195
      Index           =   2
      Left            =   60
      TabIndex        =   14
      Top             =   420
      Width           =   915
   End
   Begin VB.Label lblInfo 
      Caption         =   "Class Contents:"
      Height          =   195
      Index           =   1
      Left            =   60
      TabIndex        =   4
      Top             =   60
      Width           =   4095
   End
   Begin VB.Label lblInfo 
      Caption         =   "Property Bag Contents:"
      Height          =   195
      Index           =   0
      Left            =   4260
      TabIndex        =   3
      Top             =   60
      Width           =   4095
   End
End
Attribute VB_Name = "frmMain"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private m_oPerson As New Person

Private Sub ShowPerson()
Dim i As Long
   txtFirstName = m_oPerson.FirstName
   txtSurname = m_oPerson.LastName
   txtBirthday = m_oPerson.Birthday
   cboAddresses.Clear
   For i = 1 To m_oPerson.Addresses.Count
      cboAddresses.AddItem "Address " &amp; i
   Next i
   If cboAddresses.ListCount &gt; 0 Then
      cboAddresses.Enabled = True
      cboAddresses.ListIndex = 0
   Else
      cboAddresses.Enabled = False
      cboAddresses_Click
   End If
End Sub

Private Function NiceXML(sXML As String) As String
Dim iOpenPos As Long
Dim iClosePos As Long
Dim iLastPos As Long
Dim iLevel As Long
Dim sLevelSpace As String
Dim sOut As String
   ' SPM: this is quick &amp; dirty, it could fail on CDATA sections...
   ' to do it properly, use MSXML to enum the nodes instead.
   iLastPos = 1
   iOpenPos = InStr(iLastPos, sXML, "&lt;")
   If iOpenPos &gt; 0 Then
      If iOpenPos &gt; 1 Then
         sOut = sOut &amp; Left$(sXML, iOpenPos)
      End If
      Do
         iClosePos = InStr(iOpenPos, sXML, "&gt;")
         If iClosePos &gt; 0 Then
            If (Mid$(sXML, iOpenPos + 1, 1) = "/") Then
               iLevel = iLevel - 1
               If iLevel &gt; 0 Then sLevelSpace = Space$(iLevel * 3) Else
                sLevelSpace = ""
               sOut = sOut &amp; vbCrLf &amp; sLevelSpace &amp; Mid$(sXML, iOpenPos,
                iClosePos - iOpenPos + 1) &amp; vbCrLf
            Else
               sOut = sOut &amp; sLevelSpace &amp; Mid$(sXML, iOpenPos, iClosePos -
                iOpenPos + 1) &amp; vbCrLf
               iLevel = iLevel + 1
               If iLevel &gt; 0 Then sLevelSpace = Space$(iLevel * 3) Else
                sLevelSpace = ""
            End If
            iLastPos = iClosePos + 1
            iOpenPos = InStr(iLastPos, sXML, "&lt;")
            If iOpenPos &gt; iLastPos Then
               sOut = sOut &amp; sLevelSpace &amp; Mid$(sXML, iLastPos, iOpenPos -
                iLastPos)
            End If
         End If
      Loop While iOpenPos &gt; 0
   End If
   If iLastPos &gt; 0 And iLastPos &lt; Len(sXML) Then
      sOut = sOut &amp; Mid$(sXML, iLastPos)
   End If
   NiceXML = sOut
End Function

Private Sub cboAddresses_Click()
   If cboAddresses.ListIndex &gt; -1 Then
      With m_oPerson.Addresses(cboAddresses.ListIndex + 1)
         txtAddress1 = .AddressLine1
         txtAddress2 = .AddressLine2
         txtState = .State
         txtCity = .City
         txtZipCode = .ZipCode
      End With
   Else
      txtAddress1 = ""
      txtAddress2 = ""
      txtState = ""
      txtCity = ""
      txtZipCode = ""
   End If
End Sub

Private Sub cmdClear_Click()
   Set m_oPerson = New Person
   ShowPerson
End Sub

Private Sub cmdFromXML_Click()
   Dim oPropertyBag As New XMLPropertyBag

   oPropertyBag.Contents = txtXML.Text

   oPropertyBag.RestoreState m_oPerson, "Person1"

   ShowPerson
   
End Sub

Private Sub cmdToXML_Click()
   Dim oPropertyBag As New XMLPropertyBag
   
   ' Demonstrates how we can save multiple objects
   ' to the same property bag using the Name property
   ' to uniquely identify the item:
   oPropertyBag.SaveState m_oPerson, "Person1"
   
   oPropertyBag.SaveState m_oPerson, "Person2"
   Debug.Print NiceXML(oPropertyBag.Contents)
   
   ' You can replace existing object values:
   oPropertyBag.SaveState m_oPerson, "Person1"
   Debug.Print NiceXML(oPropertyBag.Contents)
      
   ' You can delete objects completely:
   oPropertyBag.DeleteObject "Person", "Person2"

   txtXML.Text = NiceXML(oPropertyBag.Contents)

End Sub

Private Sub Form_Load()

   ' Set up the class states:
   m_oPerson.FirstName = "Billy"
   m_oPerson.LastName = "Bob"
   m_oPerson.Birthday = "09/09/1969"
   With m_oPerson.Addresses.Add
      .AddressLine1 = "123 Main Street"
      .AddressLine2 = "Suite 456"
      .City = "Austin"
      .State = "TX"
      .ZipCode = "78799"
   End With
   With m_oPerson.Addresses.Add
      .AddressLine1 = "22A Mount Pleasant St"
      .City = "Liverpool"
      .State = "N/A"
      .ZipCode = "L25 9RQ"
   End With

   ShowPerson

End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Libraries</a>&#160;.&#160;<a href="..\index.html">Persistance</a>&#160;.&#160;<a href="article.html">XML Property Bag</a>&#160;.&#160;<a href="vb6_xml_property_bag_dll_and_demonstration.html">VB6 XML Property Bag DLL and Demonstration</a>&#160;.&#160;Test_frmMain.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>