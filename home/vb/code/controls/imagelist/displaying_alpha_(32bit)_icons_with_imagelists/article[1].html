<html lang="en" >
<head>

<title>vbAccelerator - Displaying Alpha (32bit) Icons with ImageLists</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="Version 6 of ComCtl32.DLL (shipped with Windows XP) supports icons with alpha channels.  This
article describes how you can use icons with alpha channels with the vbAccelerator Image Lists." /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">ImageList</a>&#160;.&#160;Displaying Alpha (32bit) Icons with ImageLists</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="image_list_and_alpha_icons[1].html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Image List and Alpha Icons</a> (111K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:3406</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3406&type=article&title=displaying_20alpha_20_2832bit_29_20icons_20with_20imagelists.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />15 Jan 2002<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\xp_visual_styles\making_vb_apply_visual_styles_at_design_and_debug_time\article.html">Making VB Apply XP Visual Styles at Design and Debug Time</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\xp_visual_styles\using_xp_visual_styles_in_vb\article.html">Adding XP Visual Styles to Your Visual Basic Application</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\system_image_list\article.html">Using the System Image List with (and without) vbAccelerator Controls</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\vbaccelerator_image_list_control\article.html">vbAccelerator ImageList Control and Class v2.0</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Displaying Alpha (32bit) Icons with ImageLists</h1><img src="alphaicons[1].png" width="530" height="151" alt="Displaying Icons with Alpha Channels" /><p /><p>Version 6 of ComCtl32.DLL (shipped with Windows XP) supports icons with alpha channels.  This
article describes how you can use icons with alpha channels with the vbAccelerator Image Lists.</p><h2>Using ImageLists to Draw Alpha-Channel Icons</h2><p>Versions of ComCtl32.DLL prior to 6.0 don't support drawing icons with alpha
channels.  For this reason, you first need to link your application to ComCtl32.DLL 
version 6.0.  There are two articles which describe how to link your application
to ComCtl32.DLL:</p><ul><li><a href="..\..\..\libraries\xp_visual_styles\making_vb_apply_visual_styles_at_design_and_debug_time\article.html">At Design- and Debug- Time</a></li><li><a href="..\..\..\libraries\xp_visual_styles\using_xp_visual_styles_in_vb\article.html">For a Compiled Executable</a></li></ul><p>Once you've successfully set this up, then you're ready to create an alpha-channel
ImageList.  If you're using the <a href="..\vbaccelerator_image_list_control\article.html">vbAccelerator Image List
Control</a>, then you need to use version 2.0 (released on 14 January 2003) or above 
in order to persist icons added in the property pages.  This was because the 
previous versions only persisted the icon graphics to a maximum of 24-bit colour resolution, 
resulting in the alpha channel begin discarded.  If you're using the ImageList class or the 
<a href="..\system_image_list\article.html">System Image List</a> then alpha channels are supported.</p><p>Then creating an ImageList which supports alpha icons is easy.  Just set the 
<i>ColourDepth</i> to 32-bit (<i>ILC_COLOR32</i>) either prior to adding any
images in the control or prior to calling <i>Create</i> in the class.</p><h2>In Case You Can't</h2><p>If your system doesn't support ImageLists allowing icons with alpha channels, or doesn't support
alpha then trying to draw icons with an alpha channel will look bad:</p><img src="with[1].png" width="58" height="60" alt="Icon Drawn with an Alpha Channel" /><p><small><strong>Icon Drawn correctly with an Alpha Channel</strong></small></p><img src="without[1].png" width="58" height="60" alt="Icon Drawn without Alpha Channel" /><p><small><strong>Icon Drawn without Alpha Channel - the Drop Shadow renders all black.</strong></small></p><p>You therefore should check in your application if alpha-icons are supported, and if not, fall
back to icons without an alpha channel.  There are two reasons why the system may not 
support alpha channels:</p><ul><li>Using a Pre-Windows XP version of ComCtl32.DLL</li><li>If the system colour depth is less than 32 bits per pixel.</li></ul><p>You can check whether the system supports alpha icons with the following
code:</p><h3>General Functions</h3><pre>
Private Declare Function CreateDCAsNull Lib "gdi32" Alias "CreateDCA" ( _
    ByVal lpDriverName As String, _
    lpDeviceName As Any, _
    lpOutput As Any, _
    lpInitData As Any) As Long
Private Declare Function DeleteDC Lib "gdi32" ( _
    ByVal hdc As Long) As Long
Private Declare Function GetDeviceCaps Lib "gdi32" ( _
    ByVal hdc As Long, ByVal nIndex As Long) As Long
Private Const BITSPIXEL = 12         '  Number of bits per pixel
Private Const PLANES = 14            '  Number of planes

Private Type DLLVERSIONINFO
    cbSize As Long
    dwMajor As Long
    dwMinor As Long
    dwBuildNumber As Long
    dwPlatformID As Long
End Type
Private Declare Function LoadLibrary Lib "kernel32" Alias "LoadLibraryA" _
    (ByVal lpLibFileName As String) As Long
Private Declare Function FreeLibrary Lib "kernel32" _
    (ByVal hLibModule As Long) As Long
Private Declare Function GetProcAddress Lib "kernel32" _
    (ByVal hModule As Long, ByVal lpProcName As String) As Long
Private Declare Function DllGetVersion Lib "comctl32" _
    (pdvi As DLLVERSIONINFO) As Long
Private Const S_OK = 0

Public Function BitsPerPixel() As Long
Dim lhDCD As Long
Dim lBitsPixel As Long
Dim lPlanes As Long
   lhDCD = CreateDCAsNull("DISPLAY", ByVal 0&amp;, ByVal 0&amp;, ByVal 0&amp;)
   lBitsPixel = GetDeviceCaps(lhDCD, BITSPIXEL)
   lPlanes = GetDeviceCaps(lhDCD, PLANES)
   BitsPerPixel = (lBitsPixel * lPlanes)
   DeleteDC lhDCD
End Function

Public Function ComCtlVersion( _
        ByRef lMajor As Long, _
        ByRef lMinor As Long, _
        Optional ByRef lBuild As Long _
    ) As Boolean
Dim hMod As Long
Dim lR As Long
Dim lptrDLLVersion As Long
Dim tDVI As DLLVERSIONINFO

    lMajor = 0: lMinor = 0: lBuild = 0

    hMod = LoadLibrary("comctl32.dll")
    If Not(hMod = 0) Then
        lR = S_OK
        ' You must get this function explicitly because earlier versions 
        ' of the DLL don't implement this function. That makes the 
        ' lack of implementation of the function a version 
        ' marker in itself.
        lptrDLLVersion = GetProcAddress(hMod, "DllGetVersion")
        If Not(lptrDLLVersion = 0) Then
            tDVI.cbSize = Len(tDVI)
            lR = DllGetVersion(tDVI)
            If (lR = S_OK) Then
                lMajor = tDVI.dwMajor
                lMinor = tDVI.dwMinor
                lBuild = tDVI.dwBuildNumber
            End If
        Else
            'If GetProcAddress failed, then the DLL is a 
            ' version previous to the one shipped with IE 3.x.
            lMajor = 4
        End If
        FreeLibrary hMod
        ComCtlVersion = True
    End If

End Function
</pre><h3>Checking Code</h3><pre>
   Dim bSupportsAlphaIcons As Boolean
   If (BitsPerPixel &gt;= 32) Then
      Dim lMajor As Long
      Dim lMinor As Long
      ComCtlVersion lMajor, lMinor
      If (lMajor &gt;= 6) Then
         bSupportsAlphaIcons = True
      End If
   End If
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">ImageList</a>&#160;.&#160;Displaying Alpha (32bit) Icons with ImageLists</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 5 February 2003</p></td><td></td></tr></table>
</body></html>
