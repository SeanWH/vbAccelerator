<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmChild.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmChild.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Combo and List Boxes</a>&#160;.&#160;<a href="article.html">Owner Draw Combo and List Boxes Version 2.1</a>&#160;.&#160;<a href="vb6_owner_draw_combo_list_full_source.html">VB6 Owner Draw Combo List Full Source</a>&#160;.&#160;frmChild.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_owner_draw_combo_list_control.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Owner Draw Combo List Control</a> (40K)</p><p class="nav"><a href="vb5_owner_draw_combo_list_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Owner Draw Combo List Full Source</a> (255K)</p><p /><p class="nav"><a href="vb6_owner_draw_combo_list_control.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Owner Draw Combo List Control</a> (41K)</p><p class="nav"><a href="vb6_owner_draw_combo_list_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Owner Draw Combo List Demonstration</a> (153K)</p><p class="nav"><a href="vb6_owner_draw_combo_list_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Owner Draw Combo List Full Source</a> (239K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:1603</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=1603&type=zip&title=vb6_20owner_20draw_20combo_20list_20full_20source_2ezip_5ffrmchild.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />19 Dec 2002<br />VB6 Version Added</p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\type_libraries\ole_guid_and_interface_definitions\article.html">Ole Guid and interface definitions (OleGuids.Tlb) </a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\imagelist\system_image_list\article.html">Using the System Image List with (and without) vbAccelerator Controls</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\imagelist\vbaccelerator_image_list_control\article.html">vbAccelerator ImageList Control and Class v2.0</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmChild.frm</h1><pre>VERSION 5.00
Object = "{72D18DD4-0DA7-11D2-8E21-00B404C10000}#2.1#0"; "ODCboLst6.ocx"
Object = "*\AODCboLst6.vbp"
Begin VB.Form frmChild 
   Caption         =   "Test Child Form"
   ClientHeight    =   3975
   ClientLeft      =   4515
   ClientTop       =   3720
   ClientWidth     =   6045
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   LinkTopic       =   "Form1"
   MDIChild        =   -1  'True
   ScaleHeight     =   3975
   ScaleWidth      =   6045
   Begin VB.CommandButton cmdSetFont 
      Caption         =   "Set &amp;Font..."
      Height          =   375
      Left            =   120
      TabIndex        =   7
      Top             =   3540
      Width           =   1335
   End
   Begin VB.ListBox lstVB 
      BeginProperty Font 
         Name            =   "Tahoma"
         Size            =   9.75
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1800
      IntegralHeight  =   0   'False
      Left            =   3060
      TabIndex        =   5
      Top             =   1080
      Width           =   2835
   End
   Begin ODCboLst6.OwnerDrawComboList lstODCBO 
      Height          =   1815
      Left            =   120
      TabIndex        =   4
      Top             =   1080
      Width           =   2835
      _ExtentX        =   5001
      _ExtentY        =   3201
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   9.75
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   -2147483630
      Style           =   4
      FullRowSelect   =   -1  'True
      MaxLength       =   0
   End
   Begin ODCboLst6.OwnerDrawComboList cboTest 
      Height          =   315
      Left            =   120
      TabIndex        =   1
      Top             =   3060
      Width           =   2835
      _ExtentX        =   5001
      _ExtentY        =   556
      ExtendedUI      =   -1  'True
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   -2147483630
      ClientDraw      =   5
      Style           =   0
      AutoComplete    =   -1  'True
      AutomCompleteListItemsOnly=   -1  'True
   End
   Begin VB.ComboBox cboReal 
      BeginProperty Font 
         Name            =   "Tahoma"
         Size            =   9.75
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   360
      Left            =   3060
      Style           =   2  'Dropdown List
      TabIndex        =   0
      Top             =   360
      Width           =   2835
   End
   Begin ODCboLst6.OwnerDrawComboList cboCopy 
      Height          =   405
      Left            =   120
      TabIndex        =   6
      Top             =   360
      Width           =   2835
      _ExtentX        =   5001
      _ExtentY        =   635
      ExtendedUI      =   -1  'True
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   9.75
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   -2147483630
      MaxLength       =   0
   End
   Begin VB.Label lblInfo 
      Caption         =   "VB Controls:"
      Height          =   195
      Index           =   1
      Left            =   3060
      TabIndex        =   3
      Top             =   120
      Width           =   2775
   End
   Begin VB.Label lblInfo 
      Caption         =   "Owner Draw Combo List:"
      Height          =   195
      Index           =   0
      Left            =   120
      TabIndex        =   2
      Top             =   120
      Width           =   2775
   End
End
Attribute VB_Name = "frmChild"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private Type TCHOOSEFONT
    lStructSize As Long         ' Filled with UDT size
    hWndOwner As Long           ' Caller's window handle
    hdc As Long                 ' Printer DC/IC or NULL
    lpLogFont As Long           ' Pointer to LOGFONT
    iPointSize As Long          ' 10 * size in points of font
    flags As Long               ' Type flags
    rgbColors As Long           ' Returned text color
    lCustData As Long           ' Data passed to hook function
    lpfnHook As Long            ' Pointer to hook function
    lpTemplateName As Long      ' Custom template name
    hInstance As Long           ' Instance handle for template
    lpszStyle As String         ' Return style field
    nFontType As Integer        ' Font type bits
    iAlign As Integer           ' Filler
    nSizeMin As Long            ' Minimum point size allowed
    nSizeMax As Long            ' Maximum point size allowed
End Type
Private Declare Function ChooseFont Lib "COMDLG32" _
    Alias "ChooseFontA" (chfont As TCHOOSEFONT) As Long
Private Const LF_FACESIZE = 32
Private Type LOGFONT
    lfHeight As Long
    lfWidth As Long
    lfEscapement As Long
    lfOrientation As Long
    lfWeight As Long
    lfItalic As Byte
    lfUnderline As Byte
    lfStrikeOut As Byte
    lfCharSet As Byte
    lfOutPrecision As Byte
    lfClipPrecision As Byte
    lfQuality As Byte
    lfPitchAndFamily As Byte
    lfFaceName(LF_FACESIZE) As Byte
End Type

Public Enum EChooseFont
    CF_ScreenFonts = &amp;H1
    CF_PrinterFonts = &amp;H2
    CF_BOTH = &amp;H3
    CF_FontShowHelp = &amp;H4
    CF_UseStyle = &amp;H80
    CF_EFFECTS = &amp;H100
    CF_AnsiOnly = &amp;H400
    CF_NoVectorFonts = &amp;H800
    CF_NoOemFonts = CF_NoVectorFonts
    CF_NoSimulations = &amp;H1000
    CF_LimitSize = &amp;H2000
    CF_FixedPitchOnly = &amp;H4000
    CF_WYSIWYG = &amp;H8000  ' Must also have ScreenFonts And PrinterFonts
    CF_ForceFontExist = &amp;H10000
    CF_ScalableOnly = &amp;H20000
    CF_TTOnly = &amp;H40000
    CF_NoFaceSel = &amp;H80000
    CF_NoStyleSel = &amp;H100000
    CF_NoSizeSel = &amp;H200000
    ' Win95 only
    CF_SelectScript = &amp;H400000
    CF_NoScriptSel = &amp;H800000
    CF_NoVertFonts = &amp;H1000000

    CF_InitToLogFontStruct = &amp;H40
    CF_Apply = &amp;H200
    CF_EnableHook = &amp;H8
    CF_EnableTemplate = &amp;H10
    CF_EnableTemplateHandle = &amp;H20
    CF_FontNotSupported = &amp;H238
End Enum

' These are extra nFontType bits that are added to what is returned to the
' EnumFonts callback routine

Public Enum EFontType
    Simulated_FontType = &amp;H8000
    Printer_FontType = &amp;H4000
    Screen_FontType = &amp;H2000
    Bold_FontType = &amp;H100
    Italic_FontType = &amp;H200
    Regular_FontType = &amp;H400
End Enum
Private Declare Sub CopyMemoryStr Lib "kernel32" Alias "RtlMoveMemory" ( _
    lpvDest As Any, ByVal lpvSource As String, ByVal cbCopy As Long)

' ChooseFont wrapper
Private Function VBChooseFont(CurFont As Font, _
                      Optional PrinterDC As Long = -1, _
                      Optional Owner As Long = -1, _
                      Optional Color As Long = vbBlack, _
                      Optional MinSize As Long = 0, _
                      Optional MaxSize As Long = 0, _
                      Optional flags As Long = 0 _
                    ) As Boolean
Dim lR As Long

   ' Unwanted Flags bits
   Const CF_FontNotSupported = CF_Apply Or CF_EnableHook Or CF_EnableTemplate
   
   ' Flags can get reference variable or constant with bit flags
   ' PrinterDC can take printer DC
   If PrinterDC = -1 Then
       PrinterDC = 0
       If flags And CF_PrinterFonts Then PrinterDC = Printer.hdc
   Else
       flags = flags Or CF_PrinterFonts
   End If
   ' Must have some fonts
   If (flags And CF_PrinterFonts) = 0 Then flags = flags Or CF_ScreenFonts
   ' Color can take initial color, receive chosen color
   If Color &lt;&gt; vbBlack Then flags = flags Or CF_EFFECTS
   ' MinSize can be minimum size accepted
   If MinSize Then flags = flags Or CF_LimitSize
   ' MaxSize can be maximum size accepted
   If MaxSize Then flags = flags Or CF_LimitSize
   
   ' Put in required internal flags and remove unsupported
   flags = (flags Or CF_InitToLogFontStruct) And Not CF_FontNotSupported
   
   ' Initialize LOGFONT variable
   Dim fnt As LOGFONT
   Const PointsPerTwip = 1440 / 72
   fnt.lfHeight = -(CurFont.Size * (PointsPerTwip / Screen.TwipsPerPixelY))
   fnt.lfWeight = CurFont.Weight
   fnt.lfItalic = CurFont.Italic
   fnt.lfUnderline = CurFont.Underline
   fnt.lfStrikeOut = CurFont.Strikethrough
   ' Other fields zero
   StrToBytes fnt.lfFaceName, CurFont.Name
   
   ' Initialize TCHOOSEFONT variable
   Dim cf As TCHOOSEFONT
   cf.lStructSize = Len(cf)
   If Owner &lt;&gt; -1 Then cf.hWndOwner = Owner
   cf.hdc = PrinterDC
   cf.lpLogFont = VarPtr(fnt)
   cf.iPointSize = CurFont.Size * 10
   cf.flags = flags
   cf.rgbColors = Color
   cf.nSizeMin = MinSize
   cf.nSizeMax = MaxSize
       
   ' All other fields zero
   lR = ChooseFont(cf)
   Select Case lR
   Case 1
       ' Success
       VBChooseFont = True
       flags = cf.flags
       Color = cf.rgbColors
       CurFont.Bold = cf.nFontType And Bold_FontType
       'CurFont.Italic = cf.nFontType And Italic_FontType
       CurFont.Italic = fnt.lfItalic
       CurFont.Strikethrough = fnt.lfStrikeOut
       CurFont.Underline = fnt.lfUnderline
       CurFont.Weight = fnt.lfWeight
       CurFont.Size = cf.iPointSize / 10
       CurFont.Name = BytesToStr(fnt.lfFaceName)
   Case 0
       ' Cancelled
       VBChooseFont = False
   Case Else
       ' Extended error
       VBChooseFont = False
   End Select
        
End Function
Private Function IsArrayEmpty(va As Variant) As Boolean
    Dim v As Variant
    On Error Resume Next
    v = va(LBound(va))
    IsArrayEmpty = (Err &lt;&gt; 0)
End Function

Private Sub StrToBytes(ab() As Byte, s As String)
    If IsArrayEmpty(ab) Then
        ' Assign to empty array
        ab = StrConv(s, vbFromUnicode)
    Else
        Dim cab As Long
        ' Copy to existing array, padding or truncating if necessary
        cab = UBound(ab) - LBound(ab) + 1
        If Len(s) &lt; cab Then s = s &amp; String$(cab - Len(s), 0)
        'If UnicodeTypeLib Then
        '    Dim st As String
        '    st = StrConv(s, vbFromUnicode)
        '    CopyMemoryStr ab(LBound(ab)), st, cab
        'Else
            CopyMemoryStr ab(LBound(ab)), s, cab
        'End If
    End If
End Sub
Private Function BytesToStr(ab() As Byte) As String
    BytesToStr = StrConv(ab, vbUnicode)
End Function


Private Sub cboReal_KeyPress(KeyAscii As Integer)
If (KeyAscii &gt;= Asc("a") And KeyAscii &lt;= Asc("b")) Then
   KeyAscii = Asc(UCase$(Chr$(KeyAscii)))
End If
End Sub


Private Sub cmdSetFont_Click()
Dim sFnt As StdFont
   Set sFnt = cboReal.Font
   If (VBChooseFont(sFnt, , Me.hwnd, , 8, 36)) Then
      Set cboReal.Font = sFnt
      Set cboCopy.Font = sFnt
      cboCopy.DropDownWidth = (cboCopy.Width * 2) \ Screen.TwipsPerPixelX
      Set lstVB.Font = sFnt
      Set lstODCBO.Font = sFnt
   End If
End Sub

Private Sub Form_Load()
Dim i As Integer, l As Long
   AddItems lstVB
   AddItems lstODCBO
   AddItems cboReal
   AddItems cboCopy
End Sub
Private Sub AddItems(ctlThis As Control)
Dim l As Long
   If TypeOf ctlThis Is OwnerDrawComboList Then
      For l = 1 To 100
        ctlThis.AddItemAndData "Item:" &amp; l &amp; " &amp; for testing ampersand", , (l
         Mod 3) * 8
      Next l
   Else
      For l = 1 To 100
        ctlThis.AddItem "Item:" &amp; l &amp; " &amp; for testing ampersand"
      Next l
   End If
   ctlThis.ListIndex = 0
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\libraries\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Combo and List Boxes</a>&#160;.&#160;<a href="article.html">Owner Draw Combo and List Boxes Version 2.1</a>&#160;.&#160;<a href="vb6_owner_draw_combo_list_full_source.html">VB6 Owner Draw Combo List Full Source</a>&#160;.&#160;frmChild.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 11 May 2003</p></td><td></td></tr></table>
</body></html>