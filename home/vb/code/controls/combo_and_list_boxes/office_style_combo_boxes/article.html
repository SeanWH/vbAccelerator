<html lang="en" >
<head>

<title>vbAccelerator - Office/VS.NET Style Flat Combo Boxes</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="
This project provides a class which subclasses Combo Boxes and other controls so that they draw 
in a flat style and highlight when the mouse is over or they are in focus.  The class
works on all types of Combo and ComboBoxEx controls as well as on TextBoxes and PictureBoxes.
By default, the Office 10/VS.NET drawing style is used, but there is also an Office 9 style.
" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Combo and List Boxes</a>&#160;.&#160;Office/VS.NET Style Flat Combo Boxes</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_office_combo_as_dll.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Office Combo As DLL</a> (35K)</p><p class="nav"><a href="vb5_office_combo_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Office Combo Demonstration</a> (30K)</p><p /><p class="nav"><a href="vb6_office_combo_as_dll.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Office Combo As DLL</a> (32K)</p><p class="nav"><a href="vb6_office_combo_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Office Combo Demonstration</a> (28K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:13007</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=13007&type=article&title=office_2fvs_2enet_20style_20flat_20combo_20boxes.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />29 Sep 2003<br /><p class="update">Provided Office 10 style drawing mode.  Office 11 style will be
made availble shortly!</p><p class="update">Added code to ensure that combo boxes are still drawn correctly 
when a XP Visual Styles are applied using a Manifest with the application.</p><p class="update">Provided support for right-to-left Combo boxes.</p><p class="update">Refactored all the drawing code to enable multiple drawing modes more easily.</p><p class="update">Added VB6 version.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Office/VS.NET Style Flat Combo Boxes</h1><p class="splash">A drop-in class which makes all types of combo boxes and text boxes draw flat.</p><img src="officecombo.png" width="222" height="243" alt="Office-Style Flat Combo box demonstration project" /><p /><p>
This project provides a class which subclasses Combo Boxes and other controls so that they draw 
in a flat style and highlight when the mouse is over or they are in focus.  The class
works on all types of Combo and ComboBoxEx controls as well as on TextBoxes and PictureBoxes.
By default, the Office 10/VS.NET drawing style is used, but there is also an Office 9 style.
</p><h2>How It Works</h2><p>
Combo boxes normally draw their own sunken border and drop-down button. The 
code takes the sneaky approach of intercepting the painting messages and drawing 
over the default borders and the drop-down button with nice new ones. 
To do this means we have to subclass the following messages:
</p><ul><li><span class="code">WM_PAINT</span> - Windows controls (should) do all of their
painting during this event.  By performing additional painting tasks after 
Windows has completed we can overdraw Window's version.  (Note that some controls, 
such as ScrollBars and TextBoxes paint at many other times and hence are harder
to customise than the Combo Box).</li><li><span class="code">WM_COMMAND</span> - The drop-down button needs to be 
repainted depending on the drop-down state: combo boxes notify their parent through
this event whenever the drop-down state changes.</li><li><span class="code">WM_SETFOCUS</span> - Occurs when the control gets the
focus.  In Office the focused control always has a flat border when it is 
in focus regardless of whether the mouse is over it or not.</li><li><span class="code">WM_KILLFOCUS</span> - Occurs when the control loses
focus, and is used to reset the border when focus is removed.</li><li><span class="code">WM_MOUSEMOVE</span> - So the control can be highlighted when
the mouse is over.  The control then sets a timer to check if the mouse has moved
off the control again so the highlight can be removed when it is no longer needed.
</li></ul><p>
On receiving one of these messages, the code gets the Combo box's 
<span class="code">hDC</span> and then paints over the controls borders so that 
they appear either flat (when the mouse is not over) or highlighted when the mouse is over. 
Smart!  
</p><p class="tipHeader">Removing XP Visual Styles</p><p class="tip">This code does not agree with 
the extra drawing that's performed when XP Visual Styles are applied.  To prevent this,
the code removes XP Visual Styles from the control it is attached to using the
<span class="code">SetWindowTheme</span> call:
</p><pre class="tip">
Private Declare Function SetWindowTheme Lib "uxtheme.dll" ( _
   ByVal hWnd As Long, 
   ByVal pszSubAppName As Long, 
   ByVal pszSubIdList As Long) As Long

Private Sub RemoveTheme(ByVal hWnd As Long)
   ' On error means the code is skipped on pre-XP OS   
   On Error Resume Next
   Dim lR As Long
   lR = SetWindowTheme(hWnd, StrPtr(" "), StrPtr(" "))
   On Error GoTo 0
End Sub
</pre><p>
Subclassing other controls cannot be achieved by drawing over the existing border. 
However, you can draw a border on the control's container (thanks to Peter Siebler for
pointing this out). So if you set the border-style of the control to None, the 
DLL can achieve the mouse-over highlighting effect by drawing on the 
control's container. 
</p><h2>How to Make Your Combo Boxes and Controls Flat</h2><p>This is the easy bit!</p><p>There are two versions of this code. One is a small private class module which 
you can compile directly into your executable. The other is exactly the same 
class built into an ActiveX DLL. The reason for providing the DLL is to make 
it easier to debug code using this class. Because the class has to subclass the 
<span class="code">WM_PAINT</span> message, when you break in VB's IDE many 
events can fire which make it difficult to debug (and, in the worst case, cause VB to crash, 
particularly under older Windows versions). By using the DLL, you don't need to worry 
about these problems because all the subclassing code is isolated from 
your project. (And since the DLL is binary compatible, and supported, you can ship it 
with your project as well).
</p><p>
Start a new project, and add a combo box to the form. If you are using the DLL, 
add a reference to it (it will appear as "vbAccelerator Flat Combo Box Extender" in 
the references list. Otherwise, add the <span class="i">cFlatControl.cls</span> file to 
your project.
</p><p>
Then you only need two lines of code for each control you want to make flat:
</p><pre>
' In the declarations section of the form: 
Private m_c As New cFlatControl 

Private Sub Form_Load() 

    ' Attach your combo box to the flat combo box 
    ' drawing routines: 
    m_c.Attach cboThis 


End Sub 
</pre><p>
Erm, and that's it. If you want to give multiple controls in a form a 
flat style, a simple way to do is to declare an array of 
<span class="code">cFlatControl</span> classes and enumerate through the 
controls in the form, setting the style: 
</p><pre>
' In the declarations section of the form: 
Private m_c() As cFlatControl 
Private m_iCount As Long

Private Sub Form_Load() 

Dim ctl As Control

   For Each ctl In Controls
      If TypeName(ctl) = "ComboBox" Then
         m_iCount = m_iCount + 1
         ReDim Preserve m_cFlatten(1 To m_iCount) As cFlatControl
         Set m_cFlatten(m_iCount) = New cFlatControl
         m_cFlatten(m_iCount).Attach ctl
      End If
   Next

End Sub 
</pre><p>
If you want the most accurate Office emulation, you should also modify the background
colour of combo boxes to <span class="code">vbButtonFace</span> when the control is
disabled.  A routine like this can be used whenever you disable controls:
</p><pre>
Public Sub EnableWithColour(ctl As Control, ByVal state As Boolean)
   If Not(state) Then ctl.BackColor = vbButtonFace
   ctl.Enabled = state
   If (state) Then ctl.BackColor = vbWindowBackground
End Sub
</pre><h2>Credits</h2><p>
Many thanks to Kirk Stowell for writing and posting the original MFC sample which provided
the ideas that brought this code to life. The site this was sourced from is no longer around 
but I believe he is associated with <a href="javascript:window.alert(&quot;http://www.codejock.com/\nThis link was not retrieved.&quot;)">Code Jock</a> 
software.
</p><h2>Conclusion</h2><p>
This article provides an easy to use class that converts combo boxes and other controls
to a flat, Office style.
</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Combo and List Boxes</a>&#160;.&#160;Office/VS.NET Style Flat Combo Boxes</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 2 November 2003</p></td><td></td></tr></table>
</body></html>