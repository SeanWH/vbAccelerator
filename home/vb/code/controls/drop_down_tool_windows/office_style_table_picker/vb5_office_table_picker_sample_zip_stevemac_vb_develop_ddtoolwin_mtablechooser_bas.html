<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: Stevemac_VB_Develop_DDToolWin_mTableChooser.bas</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: Stevemac_VB_Develop_DDToolWin_mTableChooser.bas" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Drop Down Tool Windows</a>&#160;.&#160;<a href="article.html">Creating drop-down tool windows</a>&#160;.&#160;<a href="vb5_office_table_picker_sample.html">VB5 Office Table Picker Sample</a>&#160;.&#160;Stevemac_VB_Develop_DDToolWin_mTableChooser.bas</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_office_table_picker_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Office Table Picker Sample</a> (21K)</p><p class="nav"><a href="vb5_vbaccelerator_toolbar_with_office_table_picker_sample.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 vbAccelerator Toolbar with Office Table Picker Sample</a> (38K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:1188</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=1188&type=zip&title=vb5_20office_20table_20picker_20sample_2ezip_5fstevemac_5fvb_5fdevelop_5fddto[1].html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />13 Aug 1999<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\detecting_when_another_application_is_activated\article.html">Detecting when another application is activated</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\toolbar\vbaccelerator_toolbar_and_coolmenu_control\article.html">vbAccelerator Toolbar and CoolMenu Control v3.5</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\drop_down_form_control\article.html">vbAccelerator Drop-Down and Popup Form Control</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\imagelist\vbaccelerator_image_list_control\article.html">vbAccelerator ImageList Control and Class v2.0</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: Stevemac_VB_Develop_DDToolWin_mTableChooser.bas</h1><pre>Attribute VB_Name = "mTableChooser"
Option Explicit

' ============================================================
' File:     mTableChooser
' Author:   Steve McMahon (steve@dogma.demon.co.uk)
' Date:     22 November 1998
'
' Requires: cDropDownToolWindow
'           (available from http://vbaccelerator.com)
'
' Implements the drawing and control for a Word 97/Front Page
' style drop-down table size picker.
' Please report any bugs or problems to the author for
' incorporation into the release version.
'
' Visit vbAccelerator, the resource for free, advanced VB code
' http://vbaccelerator.com
' ============================================================

' To draw the window:
Private Type RECT
   Left As Long
   Top As Long
   Right As Long
   Bottom As Long
End Type
Private Type POINTAPI
   x As Long
   y As Long
End Type
Private Declare Function GetSysColorBrush Lib "user32" (ByVal nIndex As Long)
 As Long
Private Declare Function GetSysColor Lib "user32" (ByVal nIndex As Long) As Long
Private Const COLOR_ACTIVEBORDER = 10
Private Const COLOR_ACTIVECAPTION = 2
Private Const COLOR_ADJ_MAX = 100
Private Const COLOR_ADJ_MIN = -100  'shorts
Private Const COLOR_APPWORKSPACE = 12
Private Const COLOR_BACKGROUND = 1
Private Const COLOR_BTNFACE = 15
Private Const COLOR_BTNHIGHLIGHT = 20
Private Const COLOR_BTNSHADOW = 16
Private Const COLOR_BTNTEXT = 18
Private Const COLOR_CAPTIONTEXT = 9
Private Const COLOR_GRAYTEXT = 17
Private Const COLOR_HIGHLIGHT = 13
Private Const COLOR_HIGHLIGHTTEXT = 14
Private Const COLOR_INACTIVEBORDER = 11
Private Const COLOR_INACTIVECAPTION = 3
Private Const COLOR_INACTIVECAPTIONTEXT = 19
Private Const COLOR_MENU = 4
Private Const COLOR_MENUTEXT = 7
Private Const COLOR_SCROLLBAR = 0
Private Const COLOR_WINDOW = 5
Private Const COLOR_WINDOWFRAME = 6
Private Const COLOR_WINDOWTEXT = 8
Private Declare Function FillRect Lib "user32" (ByVal hdc As Long, lpRect As
 RECT, ByVal hBrush As Long) As Long
Private Declare Function CreatePen Lib "gdi32" (ByVal nPenStyle As Long, ByVal
 nWidth As Long, ByVal crColor As Long) As Long
Private Const PS_SOLID = 0
Private Declare Function MoveToEx Lib "gdi32" (ByVal hdc As Long, ByVal x As
 Long, ByVal y As Long, lpPoint As POINTAPI) As Long
Private Declare Function LineTo Lib "gdi32" (ByVal hdc As Long, ByVal x As
 Long, ByVal y As Long) As Long
Private Declare Function GetClientRect Lib "user32" (ByVal hwnd As Long, lpRect
 As RECT) As Long
Private Declare Function SelectObject Lib "gdi32" (ByVal hdc As Long, ByVal
 hObject As Long) As Long
Private Declare Function DeleteObject Lib "gdi32" (ByVal hObject As Long) As
 Long
Private Declare Function Rectangle Lib "gdi32" (ByVal hdc As Long, ByVal X1 As
 Long, ByVal Y1 As Long, ByVal X2 As Long, ByVal Y2 As Long) As Long
Private Declare Function InflateRect Lib "user32" (lpRect As RECT, ByVal x As
 Long, ByVal y As Long) As Long
Private Declare Function OffsetRect Lib "user32" (lpRect As RECT, ByVal x As
 Long, ByVal y As Long) As Long
Private Declare Function DrawStatusText Lib "COMCTL32" Alias "DrawStatusTextA"
 (ByVal hdc As Long, lprc As RECT, ByVal pszText As String, ByVal uFlags As
 Long) As Long

Private m_lCurrentX As Long
Private m_lCurrentY As Long

Public Sub DefaultSize( _
      ByRef picDropDown As PictureBox _
   )
   picDropDown.Width = (6 + 24 * 5) * Screen.TwipsPerPixelX
   picDropDown.Height = (6 + 24 * 4 + 24) * Screen.TwipsPerPixelY
   picDropDown.Cls
End Sub

Public Sub Draw( _
      ByRef cDW As cDropDownToolWindow, _
      ByVal xPixels As Long, _
      ByVal yPixels As Long, _
      ByVal button As MouseButtonConstants, _
      Optional ByRef bIn As Boolean, _
      Optional ByRef xCellHit As Long, _
      Optional ByRef yCellHit As Long _
   )
Dim tR As RECT
Dim tWR As RECT
Dim tJunk As POINTAPI
Dim lHDC As Long
Dim hPen As Long, hPenOld As Long
Dim bInX As Boolean, bInY As Boolean
Dim hBrIn As Long, hBrOut As Long, hBr As Long
Dim x As Long, y As Long, tBoxR As RECT
Dim xMax As Long, yMax As Long, sStatus As String
Dim bResize As Boolean
   
   ' This example uses API methods to draw on the
   ' PictureBox. But you don't have to use API
   ' methods, VB drawing methods work just as well
   ' and seem to be very quick these days.
   
   
   ' Get size of pic
   GetClientRect cDW.DropDownObject.hwnd, tR
      
   ' Cache HDC for speed:
   lHDC = cDW.DropDownObject.hdc
            
   ' The client area:
   If cDW.InRect(xPixels * Screen.TwipsPerPixelX, yPixels *
    Screen.TwipsPerPixelY) Then
      ' in.  Caption is cancel and boxes up to xPixels,yPixels are highlighted:
      bIn = True
   Else
      ' not in.  Caption is cancel and all boxes are blank
      ' either we exceed in x or y and thus should increase size..
      If (button = vbLeftButton) Then
         If xPixels &gt; tR.Right Then
            tR.Right = tR.Right + 24
            bResize = True
         End If
         If yPixels &gt; tR.Bottom Then
            tR.Bottom = tR.Bottom + 24
            bResize = True
         End If
         If bResize Then
            cDW.Resize tR.Right - tR.Left, tR.Bottom - tR.Top
            ' HDC has changed:
            lHDC = cDW.DropDownObject.hdc
            ' Clear the area:
            LSet tWR = tR
            tWR.Right = tWR.Right + 3
            tWR.Bottom = tWR.Bottom + 3
            hBr = GetSysColorBrush(COLOR_BTNFACE)
            FillRect lHDC, tWR, hBr
            DeleteObject hBr
         End If
         bIn = bResize
      Else
         bIn = False
      End If
   End If
        
   ' Draw the border to the drop down window:
   hPen = CreatePen(PS_SOLID, 1, GetSysColor(COLOR_BTNSHADOW))
   hPenOld = SelectObject(lHDC, hPen)
   Rectangle lHDC, tR.Left, tR.Top, tR.Right, tR.Bottom
   SelectObject lHDC, hPenOld
   DeleteObject hPen
   MoveToEx lHDC, 1, tR.Bottom - 2, tJunk
   hPen = CreatePen(PS_SOLID, 1, GetSysColor(COLOR_BTNHIGHLIGHT))
   hPenOld = SelectObject(lHDC, hPen)
   LineTo lHDC, 1, tR.Top + 1
   LineTo lHDC, tR.Right - 1, tR.Top + 1
   SelectObject lHDC, hPenOld
   DeleteObject hPen
   
   ' Modify the client rectangle to exclude the
   ' border and the "status bar"
   InflateRect tR, -6, -27
   OffsetRect tR, -3, -24
   
   ' Set up a selected and non-selected brush:
   hBrIn = GetSysColorBrush(COLOR_HIGHLIGHT)
   hBrOut = GetSysColorBrush(COLOR_WINDOW)
   
   ' Draw the table cells to pick from, highlighting
   ' the ones the mouse has "selected":
   For x = tR.Left To tR.Right Step 24
      tBoxR.Left = x + 1
      tBoxR.Right = x + 23
      If (xPixels &gt;= tBoxR.Left) Then
         bInX = True
      Else
         bInX = False
      End If
      For y = tR.Top To tR.Bottom Step 24
         tBoxR.Top = y + 1
         tBoxR.Bottom = y + 23
         If (yPixels &gt; tBoxR.Top) Then
            bInY = True
         Else
            bInY = False
         End If
         If (bIn And bInX And bInY) Then
            hBr = hBrIn
            If (x &gt; xMax) Then
               xMax = x
            End If
            If (y &gt; yMax) Then
               yMax = y
            End If
         Else
            hBr = hBrOut
         End If
         FillRect lHDC, tBoxR, hBr
      Next y
   Next x
   DeleteObject hBrIn
   DeleteObject hBrOut
   
   ' Draw the "status bar"
   tR.Left = tR.Left + 1
   tR.Right = tR.Right + 6
   tR.Top = tR.Bottom + 27
   tR.Bottom = tR.Top + 20
   If (bIn) Then
      xCellHit = xMax \ 24 + 1
      yCellHit = yMax \ 24 + 1
      m_lCurrentX = xCellHit
      m_lCurrentY = yCellHit
      sStatus = xCellHit &amp; " x " &amp; yCellHit &amp; " table"
   Else
      m_lCurrentX = 0
      m_lCurrentY = 0
      sStatus = "Cancel"
   End If
   DrawStatusText lHDC, tR, sStatus, 0
   
   ' Show the changes on screen:
   cDW.DropDownObject.Refresh
   
End Sub

Public Sub KeyEffect(ByVal iKey As KeyCodeConstants, ByRef bDoIt As Boolean,
 ByRef x As Single, ByRef y As Single, ByRef eButton As MouseButtonConstants,
 ByRef bCancel As Boolean, ByRef bSelect As Boolean)
   bDoIt = False
   x = (m_lCurrentX - 1) * 24 + 3
   y = (m_lCurrentY - 1) * 24 + 3
   eButton = vbLeftButton
   bCancel = False
   bSelect = False
   Select Case iKey
   Case vbKeyUp
      bDoIt = True
      y = y - 24
      If (y &lt; 0) Then y = 0
   Case vbKeyDown
      bDoIt = True
      y = y + 24
   Case vbKeyRight
      bDoIt = True
      x = x + 24
   Case vbKeyLeft
      bDoIt = True
      x = x - 24
      If (x &lt; 0) Then x = 0
   Case vbKeyReturn, vbKeySpace
      bDoIt = True
      bSelect = True
   Case vbKeyEscape
      bDoIt = True
      bCancel = True
   End Select
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Drop Down Tool Windows</a>&#160;.&#160;<a href="article.html">Creating drop-down tool windows</a>&#160;.&#160;<a href="vb5_office_table_picker_sample.html">VB5 Office Table Picker Sample</a>&#160;.&#160;Stevemac_VB_Develop_DDToolWin_mTableChooser.bas</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>