<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmTestIconEditor.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmTestIconEditor.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Icon Controls</a>&#160;.&#160;<a href="article.html">vbAccelerator Icon Editor Control</a>&#160;.&#160;<a href="vb5_iconeditor_full_source_code.html">VB5 IconEditor Full Source Code</a>&#160;.&#160;frmTestIconEditor.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="iconeditor_documentation.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />IconEditor Documentation</a> (1K)</p><p /><p class="nav"><a href="vb5_iconeditor_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 IconEditor Demonstration</a> (126K)</p><p class="nav"><a href="vb5_iconeditor_full_source_code.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 IconEditor Full Source Code</a> (211K)</p><p class="nav"><a href="vb5_iconeditor_ocx.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 IconEditor OCX</a> (43K)</p><p /><p class="nav"><a href="vb6_iconeditor_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 IconEditor Demonstration</a> (123K)</p><p class="nav"><a href="vb6_iconeditor_full_source_code.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 IconEditor Full Source Code</a> (209K)</p><p class="nav"><a href="vb6_iconeditor_ocx.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 IconEditor OCX</a> (43K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:11560</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=11560&type=zip&title=vb5_20iconeditor_20full_20source_20code_2ezip_5ffrmtesticoneditor.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />21 Mar 2000<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmTestIconEditor.frm</h1><pre>VERSION 5.00
Object = "{D755E39B-ECA7-11D3-B06C-00500427A693}#1.0#0"; "vbalIcEd5.ocx"
Begin VB.Form frmIconEditor 
   Caption         =   "vbAccelerator Icon Editor"
   ClientHeight    =   4950
   ClientLeft      =   3315
   ClientTop       =   2010
   ClientWidth     =   5250
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmTestIconEditor.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   4950
   ScaleWidth      =   5250
   Begin vbalIcEd5.vbalIconEditor iceMain 
      Height          =   3120
      Left            =   60
      TabIndex        =   3
      Top             =   420
      Width           =   3720
      _ExtentX        =   6562
      _ExtentY        =   5503
      LeftColor       =   128
      RightColor      =   8388608
      TileGridSizeX   =   8
      TileGridSizeY   =   8
      TransparentColor=   8421376
   End
   Begin VB.CommandButton cmdDeviceImage 
      Caption         =   "..."
      Height          =   315
      Left            =   1980
      TabIndex        =   2
      Top             =   60
      Width           =   315
   End
   Begin VB.ComboBox cboDevice 
      Height          =   315
      Left            =   60
      Style           =   2  'Dropdown List
      TabIndex        =   1
      Top             =   60
      Width           =   1875
   End
   Begin VB.ComboBox cboZoom 
      Height          =   315
      Left            =   2340
      Style           =   2  'Dropdown List
      TabIndex        =   0
      Top             =   60
      Width           =   855
   End
   Begin VB.Menu mnuFileTOP 
      Caption         =   "&amp;File"
      Begin VB.Menu mnuFile 
         Caption         =   "&amp;New..."
         Index           =   0
         Shortcut        =   ^N
      End
      Begin VB.Menu mnuFile 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuFile 
         Caption         =   "&amp;Open..."
         Index           =   2
         Shortcut        =   ^O
      End
      Begin VB.Menu mnuFile 
         Caption         =   "&amp;Save"
         Index           =   3
         Shortcut        =   ^S
      End
      Begin VB.Menu mnuFile 
         Caption         =   "Save &amp;As..."
         Index           =   4
      End
      Begin VB.Menu mnuFile 
         Caption         =   "-"
         Index           =   5
      End
      Begin VB.Menu mnuFile 
         Caption         =   "&amp;Properties..."
         Index           =   6
      End
      Begin VB.Menu mnuFile 
         Caption         =   "-"
         Index           =   7
      End
      Begin VB.Menu mnuFile 
         Caption         =   ""
         Index           =   8
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile 
         Caption         =   ""
         Index           =   9
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile 
         Caption         =   ""
         Index           =   10
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile 
         Caption         =   ""
         Index           =   11
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile 
         Caption         =   ""
         Index           =   12
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile 
         Caption         =   ""
         Index           =   13
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile 
         Caption         =   ""
         Index           =   14
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile 
         Caption         =   ""
         Index           =   15
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile 
         Caption         =   "-"
         Index           =   16
         Visible         =   0   'False
      End
      Begin VB.Menu mnuFile 
         Caption         =   "E&amp;xit"
         Index           =   17
      End
   End
   Begin VB.Menu mnuEditTOP 
      Caption         =   "&amp;Edit"
      Begin VB.Menu mnuEdit 
         Caption         =   "&amp;Undo"
         Index           =   0
         Begin VB.Menu mnuUndo 
            Caption         =   "Undo List"
            Enabled         =   0   'False
            Index           =   0
            Shortcut        =   ^Z
         End
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "&amp;Redo"
         Index           =   1
         Begin VB.Menu mnuRedo 
            Caption         =   "Redo List"
            Enabled         =   0   'False
            Index           =   0
            Shortcut        =   ^Y
         End
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "-"
         Index           =   2
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "Cu&amp;t"
         Index           =   3
         Shortcut        =   ^X
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "&amp;Copy"
         Index           =   4
         Shortcut        =   ^C
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "&amp;Paste"
         Enabled         =   0   'False
         Index           =   5
         Shortcut        =   ^V
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "Clea&amp;r"
         Index           =   6
         Shortcut        =   {DEL}
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "-"
         Index           =   7
      End
      Begin VB.Menu mnuEdit 
         Caption         =   "Select &amp;All"
         Index           =   8
         Shortcut        =   ^A
      End
   End
   Begin VB.Menu mnuViewTOP 
      Caption         =   "&amp;View"
      Begin VB.Menu mnuView 
         Caption         =   "Icon &amp;Preview"
         Checked         =   -1  'True
         Index           =   0
      End
      Begin VB.Menu mnuView 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuView 
         Caption         =   "&amp;Zoom"
         Index           =   2
         Begin VB.Menu mnuZoom 
            Caption         =   ""
            Index           =   0
         End
      End
      Begin VB.Menu mnuView 
         Caption         =   "&amp;Grid Settings..."
         Index           =   3
      End
   End
   Begin VB.Menu mnuToolTOP 
      Caption         =   "&amp;Tools"
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Selection"
         Checked         =   -1  'True
         Index           =   0
      End
      Begin VB.Menu mnuTool 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Pen"
         Index           =   2
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Brush"
         Index           =   3
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Eraser"
         Index           =   4
      End
      Begin VB.Menu mnuTool 
         Caption         =   "-"
         Index           =   5
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Line"
         Index           =   6
      End
      Begin VB.Menu mnuTool 
         Caption         =   "-"
         Index           =   7
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Rectangle"
         Index           =   8
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Filled Rectangle"
         Index           =   9
      End
      Begin VB.Menu mnuTool 
         Caption         =   "Roun&amp;ded Rectangle"
         Index           =   10
      End
      Begin VB.Menu mnuTool 
         Caption         =   "Filled Rou&amp;nded Rectangle"
         Index           =   11
      End
      Begin VB.Menu mnuTool 
         Caption         =   "-"
         Index           =   12
      End
      Begin VB.Menu mnuTool 
         Caption         =   "E&amp;llipse"
         Index           =   13
      End
      Begin VB.Menu mnuTool 
         Caption         =   "Filled Ellip&amp;se"
         Index           =   14
      End
      Begin VB.Menu mnuTool 
         Caption         =   "-"
         Index           =   15
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Fill"
         Index           =   16
      End
      Begin VB.Menu mnuTool 
         Caption         =   "-"
         Index           =   17
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Lock Aspect"
         Index           =   18
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Draw Opaque"
         Index           =   19
      End
      Begin VB.Menu mnuTool 
         Caption         =   "-"
         Index           =   20
      End
      Begin VB.Menu mnuTool 
         Caption         =   "&amp;Transparent Colour..."
         Index           =   21
      End
   End
   Begin VB.Menu mnuColourTOP 
      Caption         =   "&amp;Colours"
      Begin VB.Menu mnuColours 
         Caption         =   "&amp;Left Colour"
         Index           =   0
         Begin VB.Menu mnuLeftColour 
            Caption         =   ""
            Index           =   0
         End
      End
      Begin VB.Menu mnuColours 
         Caption         =   "&amp;Right Colour"
         Index           =   1
         Begin VB.Menu mnuRightColour 
            Caption         =   ""
            Index           =   0
         End
      End
   End
   Begin VB.Menu mnuImageTOP 
      Caption         =   "I&amp;mage"
      Begin VB.Menu mnuImage 
         Caption         =   "Flip &amp;Horizontal"
         Index           =   0
      End
      Begin VB.Menu mnuImage 
         Caption         =   "Flip &amp;Vertical"
         Index           =   1
      End
      Begin VB.Menu mnuImage 
         Caption         =   "&amp;Rotate 90 degrees"
         Index           =   2
      End
      Begin VB.Menu mnuImage 
         Caption         =   "&amp;Invert"
         Index           =   3
      End
      Begin VB.Menu mnuImage 
         Caption         =   "-"
         Index           =   4
      End
      Begin VB.Menu mnuImage 
         Caption         =   "&amp;Load Palette..."
         Index           =   5
      End
      Begin VB.Menu mnuImage 
         Caption         =   "&amp;Save Palette..."
         Index           =   6
      End
      Begin VB.Menu mnuImage 
         Caption         =   "-"
         Index           =   7
      End
      Begin VB.Menu mnuImage 
         Caption         =   "&amp;Device Images..."
         Index           =   8
      End
   End
   Begin VB.Menu mnuHelpTOP 
      Caption         =   "&amp;Help"
      Begin VB.Menu mnuHelp 
         Caption         =   "&amp;vbAccelerator on the Web..."
         Index           =   0
         Shortcut        =   {F1}
      End
      Begin VB.Menu mnuHelp 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuHelp 
         Caption         =   "&amp;About..."
         Index           =   2
      End
   End
End
Attribute VB_Name = "frmIconEditor"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private m_sFile As String
Private m_cMRU As cMRU
Private Sub pRemoveFromMRU(ByVal sFIle As String)
   m_cMRU.Remove sFIle
   pShowMRU
End Sub
Private Sub pAddToMRU(ByVal sFIle As String)
   m_cMRU.Add sFIle
   pShowMRU
End Sub
Private Sub pShowMRU()
Dim i As Long
   mnuFile(16).Visible = Not (m_cMRU.Count = 0)
   For i = 1 To m_cMRU.Count
      mnuFile(7 + i).Visible = True
      mnuFile(7 + i).Caption = m_cMRU.Item(i)
      If i = 1 Then
         mnuFile(7 + i).Checked = (mnuFile(7 + i).Caption = m_sFile)
      End If
   Next i
   For i = m_cMRU.Count + 8 To 15
      mnuFile(i).Visible = False
   Next i
   
End Sub

Private Sub pSelTool(ByVal nIndex As Long)
Dim i As Long
   For i = 0 To 16
      If Not mnuTool(i).Caption = "-" Then
         mnuTool(i).Checked = (nIndex = i)
      End If
   Next i
End Sub

Private Sub pShowDevice()
Dim i As Long
   
   cboDevice.Clear
   With iceMain
      For i = 1 To .DeviceImageCount
         cboDevice.AddItem .DeviceImageWidth(i) &amp; " x " &amp; .DeviceImageHeight(i)
          &amp; " (" &amp; .DeviceImageColours(i) &amp; " colours)"
         cboDevice.ItemData(cboDevice.NewIndex) = i
         If i = .DeviceImage Then
            cboDevice.ListIndex = cboDevice.NewIndex
         End If
      Next i
   End With
   
End Sub

Private Sub cboDevice_Click()
   If cboDevice.Tag = "" Then
      iceMain.DeviceImage = cboDevice.ItemData(cboDevice.ListIndex)
   End If
End Sub

Private Sub cboZoom_Click()
Dim i As Long
   If cboZoom.Tag = "" Then
      iceMain.Zoom = cboZoom.ItemData(cboZoom.ListIndex)
      For i = 0 To cboZoom.ListCount - 1
         mnuZoom(i).Checked = (i = cboZoom.ListIndex)
      Next i
   End If
End Sub

Private Sub cmdDeviceImage_Click()
Dim i As Long
Dim cX As Long
Dim cD As Long
Dim nIdx As Long

   Dim f As New frmDeviceImage
   For i = 1 To iceMain.DeviceImageCount
      f.ItemSelected(pImageToIndex(i)) = True
   Next i
   f.Show vbModal, Me
   If Not f.Cancelled Then
      For i = 6 To 1 Step -1
         nIdx = pIndexToImage(i, cX, cD)
         If f.ItemSelected(i) Then
            If nIdx = 0 Then
               iceMain.AddDeviceImage cX, cX, cD
            End If
         Else
            If nIdx &lt;&gt; 0 Then
               iceMain.RemoveDeviceImage nIdx
            End If
         End If
      Next i
      pShowDevice
   End If
   
End Sub
Private Function pIndexToImage(ByVal i As Long, ByRef cX As Long, ByRef cD As
 Long) As Long
Dim lR As Long
   cX = ((i + 1) \ 2) * 16
   If i Mod 2 = 1 Then
      cD = 16
   Else
      cD = 256
   End If
   For i = 1 To iceMain.DeviceImageCount
      If iceMain.DeviceImageWidth(i) = cX Then
         If iceMain.DeviceImageColours(i) = cD Then
            pIndexToImage = i
            Exit For
         End If
      End If
   Next i
End Function
Private Function pImageToIndex(ByVal i As Long) As Long
Dim lR As Long
   Select Case iceMain.DeviceImageWidth(i)
   Case 16
      lR = 1
   Case 32
      lR = 3
   Case 48
      lR = 5
   End Select
   If iceMain.DeviceImageColours(i) &gt; 16 Then
      lR = lR + 1
   End If
   pImageToIndex = lR
End Function
Private Sub pSetColour(mnu As Menu, i As Long)
Dim sC As String
Dim lC As Long
   lC = QBColor(i)
   mnu.Tag = lC
   Select Case i
   Case 0
      sC = "Black"
   Case 8
      sC = "Dark Gray"
   Case 1
      sC = "Dark Blue"
   Case 9
      sC = "Blue"
   Case 2
      sC = "Dark Green"
   Case 10
      sC = "Green"
   Case 3
      sC = "Dark Cyan"
   Case 11
      sC = "Cyan"
   Case 4
      sC = "Dark Red"
   Case 12
      sC = "Red"
   Case 5
      sC = "Purple"
   Case 13
      sC = "Magenta"
   Case 6
      sC = "Ochre"
   Case 14
      sC = "Yellow"
   Case 7
      sC = "Gray"
   Case 15
      sC = "White"
   End Select
   mnu.Caption = sC
End Sub

Private Sub Form_Load()
Dim i As Long
Dim lIdx As Long
   
   Set m_cMRU = New cMRU
   Dim cR As New cRegistry
   cR.SectionKey = "SOFTWARE\vbAccelerator\IconEditorDemo"
   cR.ClassKey = HKEY_LOCAL_MACHINE
   If Not m_cMRU.DeSerialise(cR) Then
      cR.ClassKey = HKEY_CURRENT_USER
      m_cMRU.DeSerialise cR
   End If
   m_cMRU.MaxCount = 8
   pShowMRU
      
   ' Zoom Options:
   cboZoom.AddItem "1:1"
   cboZoom.ItemData(cboZoom.NewIndex) = 1
   cboZoom.AddItem "1:2"
   cboZoom.ItemData(cboZoom.NewIndex) = 2
   cboZoom.AddItem "1:4"
   cboZoom.ItemData(cboZoom.NewIndex) = 4
   cboZoom.AddItem "1:6"
   cboZoom.ItemData(cboZoom.NewIndex) = 6
   lIdx = cboZoom.NewIndex
   cboZoom.AddItem "1:8"
   cboZoom.ItemData(cboZoom.NewIndex) = 8
   cboZoom.AddItem "1:16"
   cboZoom.ItemData(cboZoom.NewIndex) = 16
   For i = 0 To cboZoom.ListCount - 1
      If i &gt; 0 Then
         Load mnuZoom(i)
         mnuZoom(i).Visible = True
      End If
      mnuZoom(i).Caption = cboZoom.List(i)
   Next i
   cboZoom.ListIndex = lIdx

   ' Colour options:
   For i = 0 To 15
      If i &gt; 0 Then
         Load mnuLeftColour(i)
         Load mnuRightColour(i)
      End If
      pSetColour mnuLeftColour(i), i
      pSetColour mnuRightColour(i), i
      If iceMain.LeftColor = mnuLeftColour(i).Tag Then
         mnuLeftColour(i).Checked = True
      End If
      If iceMain.RightColor = mnuRightColour(i).Tag Then
         mnuRightColour(i).Checked = True
      End If
   Next i

   ' Device Images:
   pShowDevice
   Debug.Print Me.hdc
   
End Sub

Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)
   Dim cR As New cRegistry
   cR.SectionKey = "SOFTWARE\vbAccelerator\IconEditorDemo"
   cR.ClassKey = HKEY_CURRENT_USER
   m_cMRU.Serialise cR
   cR.ClassKey = HKEY_LOCAL_MACHINE
   m_cMRU.Serialise cR
End Sub

Private Sub mnuEdit_Click(Index As Integer)
   Select Case Index
   Case 0 'undo menu
   Case 1 'redo menu
   Case 3 'cut
      iceMain.Cut
   Case 4 'copy
      iceMain.Copy
   Case 5 'paste
      If iceMain.CanPaste Then
         iceMain.Paste
      End If
   Case 6 'clear
      iceMain.Clear
   Case 8 'selectall
      iceMain.SelectAll
   End Select
End Sub

Private Sub mnuEditTOP_Click()
Dim i As Long
   ' Populate undo &amp; redo menus, set Cut/Copy/Paste state:
   mnuEdit(5).Enabled = iceMain.CanPaste
   
   ' Up to 32 Undo/Redo steps!
   For i = 1 To iceMain.UndoDepth
      If i - 1 &gt; mnuUndo.UBound Then
         Load mnuUndo(i - 1)
         mnuUndo(i - 1).Visible = True
      End If
      mnuUndo(i - 1).Caption = iceMain.UndoType(i)
      mnuUndo(i - 1).Enabled = True
   Next i
   If mnuUndo.UBound - 1 &gt; iceMain.UndoDepth Then
      For i = mnuUndo.UBound To iceMain.UndoDepth - 1 Step -1
         If i &gt; 0 Then
            Unload mnuUndo(i)
         End If
      Next i
   End If
   mnuUndo(0).Enabled = (iceMain.UndoDepth &gt; 0)
   If iceMain.UndoDepth = 0 Then
      mnuUndo(0).Caption = "Undo List"
   End If
   
   For i = 1 To iceMain.RedoDepth
      If i - 1 &gt; mnuRedo.UBound Then
         Load mnuRedo(i - 1)
         mnuRedo(i - 1).Visible = True
      End If
      mnuRedo(i - 1).Caption = iceMain.RedoType(i)
      mnuRedo(i - 1).Enabled = True
   Next i
   If mnuRedo.UBound - 1 &gt; iceMain.RedoDepth Then
      For i = mnuRedo.UBound To iceMain.RedoDepth - 1 Step -1
         If i &gt; 0 Then
            Unload mnuRedo(i)
         End If
      Next i
   End If
   mnuRedo(0).Enabled = (iceMain.RedoDepth &gt; 0)
   If iceMain.RedoDepth = 0 Then
      mnuRedo(0).Caption = "Undo List"
   End If
   
End Sub

Private Sub mnuFile_Click(Index As Integer)
Dim cc As GCommonDialog
Dim sI As String
   Select Case Index
   Case 0 'new
      m_sFile = ""
      iceMain.NewIcon
      pShowDevice
      
   Case 2 'open
      Set cc = New GCommonDialog
      If cc.VBGetOpenFileName(m_sFile, , , , , , "Icon Files
       (*.ICO)|*.ICO|Resource Files (*.EXE;*.DLL)|*.EXE;*.DLL|All Files
       (*.*)|*.*", , , , "ICO", Me.hwnd) Then
         pLoadFile
      End If

   Case 3 'save
      If Not (m_sFile) = "" Then
         iceMain.SaveIcon m_sFile
         pAddToMRU m_sFile
      Else
         ' saveas
         mnuFile_Click 4
      End If
      
   Case 4 'saveas
      Set cc = New GCommonDialog
      If cc.VBGetSaveFileName(m_sFile, , , "Icon Files (*.ICO)|*.ICO|All Files
       (*.*)|*.*", , , , "ICO", Me.hwnd) Then
         iceMain.SaveIcon m_sFile
         pAddToMRU m_sFile
      End If
      
   Case 6 'properties
      ' todo
      MsgBox "Left as an exercise.", vbInformation
   
   Case 8 To 15
      m_sFile = m_cMRU.Item(Index - 7)
      pLoadFile
   
   Case 17 'exit
      Unload Me
   End Select
   
End Sub

Private Sub pLoadFile()
Dim sI As String
Dim bOk As Boolean

On Error GoTo ErrorHandler

   If iceMain.IsAnIconFile(m_sFile) Then
      bOk = iceMain.LoadIcon(m_sFile)
   Else
      ' This is not the way you would do this in a real
      ' app :)  See the vbAccelerator Icon Extractor project
      ' for details of how to do this properly:
      sI = InputBox$("Please enter the id or name of the resource you want to
       load", , "1")
      If Not sI = "" Then
         bOk = iceMain.LoadIconFromLibrary(m_sFile, sI)
      Else
         Exit Sub
      End If
   End If
   If bOk Then
      pAddToMRU m_sFile
   Else
      pRemoveFromMRU m_sFile
   End If
   pShowDevice
   Exit Sub
   
ErrorHandler:
   MsgBox "Unable to load the file '" &amp; m_sFile &amp; "'" &amp; vbCrLf &amp; vbCrLf &amp;
    Err.Description, vbInformation
   If Not m_sFile = "" Then
      pRemoveFromMRU m_sFile
   End If
   Exit Sub
End Sub

Private Sub mnuHelp_Click(Index As Integer)
   Select Case Index
   Case 0
   Case 2
      frmAbout.Show vbModal, Me
   End Select
End Sub

Private Sub mnuImage_Click(Index As Integer)
Dim sFIle As String
Dim bS As Boolean
Dim cc As New GCommonDialog
   Select Case Index
   Case 0 ' fliphoriz
      iceMain.Mirror
   Case 1 ' flipvert
      iceMain.Flip
   Case 2 ' rotate 90
      iceMain.Rotate90
   Case 3 ' invert
      iceMain.Invert
   Case 5 ' load palette
      If cc.VBGetOpenFileName(sFIle, , , , , , "Palette Files (*.PAL)|*.PAL|All
       Files (*.*)|*.*", , , , "PAL", Me.hwnd) Then
         iceMain.DevicePalette(iceMain.DeviceImage).LoadFromJASCFile sFIle
      End If
   Case 6 ' save palette
      If cc.VBGetSaveFileName(sFIle, , , "Palette Files (*.PAL)|*.PAL|All FIles
       (*.*)|*.*", , , , "PAL", Me.hwnd) Then
         iceMain.DevicePalette(iceMain.DeviceImage).SaveToJASCFile sFIle
      End If
   Case 8 ' device images.  Note in this UI we restrict to standard
          ' sizes only, but any size is handled.
      cmdDeviceImage_Click
   End Select
End Sub

Private Sub mnuImageTOP_Click()
Dim bPalette As Boolean
   bPalette = (iceMain.DeviceImageColours(iceMain.DeviceImage) = 256)
   mnuImage(5).Enabled = bPalette
   mnuImage(6).Enabled = bPalette
End Sub

Private Sub mnuLeftColour_Click(Index As Integer)
Dim i As Long
   For i = mnuLeftColour.LBound To mnuLeftColour.UBound
      mnuLeftColour(i).Checked = (i = Index)
   Next i
   iceMain.LeftColor = mnuLeftColour(Index).Tag
End Sub

Private Sub mnuRedo_Click(Index As Integer)
   '
   iceMain.Redo Index + 1
End Sub

Private Sub mnuRightColour_Click(Index As Integer)
Dim i As Long
   For i = mnuRightColour.LBound To mnuRightColour.UBound
      mnuRightColour(i).Checked = (i = Index)
   Next i
   iceMain.RightColor = mnuRightColour(Index).Tag

End Sub

Private Sub mnuTool_Click(Index As Integer)
Dim bS As Boolean
   Select Case Index
   Case 0 'selection
      pSelTool 0
      iceMain.Mode = ecModeSelection
   Case 2 'pen
      pSelTool 2
      iceMain.BrushWidth = 1
      iceMain.Mode = ecModeBrush
   Case 3 'brush
      pSelTool 3
      iceMain.BrushWidth = 4
      iceMain.Mode = ecModeBrush
   Case 4 'eraser
      pSelTool 4
      iceMain.LineWidth = 1
      iceMain.Mode = ecModeEraser
   Case 6 'line
      pSelTool 6
      iceMain.Mode = ecModeLine
   Case 8 'rect
      pSelTool 8
      iceMain.Mode = ecModeRectangle
   Case 9 'fillrect
      pSelTool 9
      iceMain.Mode = ecModeRectangleFilled
   Case 10 'roundrect
      pSelTool 10
      iceMain.Mode = ecModeRoundRectangle
   Case 11 'fillroundrect
      pSelTool 11
      iceMain.Mode = ecModeRoundRectangleFilled
   Case 13 'ellipse
      pSelTool 13
      iceMain.Mode = ecModeEllipse
   Case 14 'fillellipse
      pSelTool 14
      iceMain.Mode = ecModeEllipseFilled
   Case 16 'fill
      pSelTool 16
      iceMain.Mode = ecModeFloodFill
   Case 18 'lock aspect
      bS = Not (mnuTool(Index).Checked)
      mnuTool(Index).Checked = False
      iceMain.LockAspect = bS
   Case 19 ' draw transparent/opaque:
      bS = Not (mnuTool(Index).Checked)
      mnuTool(Index).Checked = bS
      If bS Then
         iceMain.SelectionMode = ecSelectionOpaque
      Else
         iceMain.SelectionMode = ecSelectionTransparent
      End If
   Case 21
      ' TODO
      Dim cc As New GCommonDialog
      Dim oColor As OLE_COLOR
      oColor = iceMain.TransparentColor
      If cc.VBChooseColor(oColor, , True, , Me.hwnd) Then
         iceMain.TransparentColor = oColor
      End If
   End Select
End Sub

Private Sub mnuUndo_Click(Index As Integer)
   '
   iceMain.Undo Index + 1
End Sub

Private Sub mnuView_Click(Index As Integer)
Dim bS As Boolean
   Select Case Index
   Case 0 ' icon preview
      bS = Not (mnuView(Index).Checked)
      mnuView(Index).Checked = bS
      iceMain.ShowPreview = bS
   Case 3 ' grid settings
      Dim fG As New frmGridLineSettings
      Dim bGridLines As Boolean
      Dim bTileGridLines As Boolean
      Dim lTileGridSizeX As Long, lTileGridSizeY As Long
      fG.SetValues iceMain.GridLines, iceMain.TileGridLines,
       iceMain.TileGridSizeX, iceMain.TileGridSizeY
      fG.Show vbModal, Me
      If Not fG.Cancelled Then
         fG.GetValues bGridLines, bTileGridLines, lTileGridSizeX, lTileGridSizeY
         iceMain.GridLines = bGridLines
         iceMain.TileGridLines = bTileGridLines
         If bTileGridLines Then
            iceMain.TileGridSizeX = lTileGridSizeX
            iceMain.TileGridSizeY = lTileGridSizeY
         End If
      End If
      
   End Select
End Sub

Private Sub mnuZoom_Click(Index As Integer)
   cboZoom.ListIndex = Index
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Icon Controls</a>&#160;.&#160;<a href="article.html">vbAccelerator Icon Editor Control</a>&#160;.&#160;<a href="vb5_iconeditor_full_source_code.html">VB5 IconEditor Full Source Code</a>&#160;.&#160;frmTestIconEditor.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>