<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmTestTreeView.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmTestTreeView.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">TreeView</a>&#160;.&#160;<a href="article.html">vbAccelerator TreeView Control</a>&#160;.&#160;<a href="vb5_treeview_full_source.html">VB5 TreeView Full Source</a>&#160;.&#160;frmTestTreeView.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_treeview_control.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 TreeView Control</a> (83K)</p><p class="nav"><a href="vb5_treeview_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 TreeView Demonstration</a> (51K)</p><p class="nav"><a href="vb5_treeview_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 TreeView Full Source</a> (176K)</p><p /><p class="nav"><a href="vb6_treeview_control.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 TreeView Control</a> (82K)</p><p class="nav"><a href="vb6_treeview_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 TreeView Demonstration</a> (45K)</p><p class="nav"><a href="vb6_treeview_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 TreeView Full Source</a> (170K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:13500</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=13500&type=zip&title=vb5_20treeview_20full_20source_2ezip_5ffrmtesttreeview.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><p class="nav">&#160;&#160;<a href="mailto:litwin@gottliebaza.org">Dan Litwin</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 5 / 19</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 1 / 4</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 1 / 1</a></p><p class="nav">Updated:27 February 2004</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />16 Apr 2004<br /><p class="update">Drag enhancements and bug fixes.  See
BugTrak for full details.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\type_libraries\ole_guid_and_interface_definitions\article.html">Ole Guid and interface definitions (OleGuids.Tlb) </a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\imagelist\system_image_list\article.html">Using the System Image List with (and without) vbAccelerator Controls</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\imagelist\vbaccelerator_image_list_control\article.html">vbAccelerator ImageList Control and Class v2.0</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\type_libraries\ishellfolder\article.html">IShellFolder Extended Type Library Version 1.2 (ISHF_Ex.Tlb)</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmTestTreeView.frm</h1><pre>VERSION 5.00
Object = "{A3A35BDB-3B6A-46F3-B662-08B8F72ECD03}#11.1#0"; "vbalTreeView.ocx"
Object = "{8245A918-4CF7-11D2-8E21-10B404C10000}#8.1#0"; "vbalIml.ocx"
Begin VB.Form frmTestTreeView 
   Caption         =   "vbAccelerator TreeView Control Demonstration"
   ClientHeight    =   4230
   ClientLeft      =   1845
   ClientTop       =   2145
   ClientWidth     =   11085
   BeginProperty Font 
      Name            =   "Tahoma"
      Size            =   8.25
      Charset         =   0
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   Icon            =   "frmTestTreeView.frx":0000
   LinkTopic       =   "Form1"
   OLEDropMode     =   1  'Manual
   ScaleHeight     =   4230
   ScaleWidth      =   11085
   Begin VB.CheckBox chkHistory 
      Caption         =   "&amp;History Mode"
      Height          =   195
      Left            =   8400
      TabIndex        =   11
      Top             =   3720
      Value           =   1  'Checked
      Width           =   2595
   End
   Begin VB.CommandButton cmdRepopulate 
      Caption         =   "&amp;Repopulate"
      Height          =   315
      Left            =   2520
      TabIndex        =   10
      Top             =   3660
      Width           =   1155
   End
   Begin VB.CommandButton cmdClear 
      Caption         =   "&amp;Clear"
      Height          =   315
      Left            =   1260
      TabIndex        =   9
      Top             =   3660
      Width           =   1155
   End
   Begin VB.CommandButton cmdNewInstance 
      Caption         =   "&amp;New..."
      Height          =   315
      Left            =   60
      TabIndex        =   8
      Top             =   3660
      Width           =   1155
   End
   Begin vbalIml.vbalImageList vbalImageList1 
      Left            =   7320
      Top             =   3780
      _ExtentX        =   953
      _ExtentY        =   953
      ColourDepth     =   8
      Size            =   10332
      Images          =   "frmTestTreeView.frx":1272
      Version         =   131072
      KeyCount        =   9
      Keys            =   ""
   End
   Begin vbalTreeViewLib.vbalTreeView tvwDemo 
      Height          =   3255
      Left            =   60
      TabIndex        =   1
      Top             =   360
      Width           =   2655
      _ExtentX        =   4683
      _ExtentY        =   5741
      NoCustomDraw    =   0   'False
      FullRowSelect   =   -1  'True
      LineStyle       =   0
      Style           =   3
      LabelEdit       =   -1  'True
      OLEDropMode     =   1
      DragAutoExpand  =   -1
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
   End
   Begin vbalTreeViewLib.vbalTreeView tvwColours 
      Height          =   3255
      Left            =   2820
      TabIndex        =   3
      Top             =   360
      Width           =   2655
      _ExtentX        =   4683
      _ExtentY        =   5741
      BackColor       =   0
      CheckBoxes      =   -1  'True
      NoCustomDraw    =   0   'False
      ForeColor       =   3182688
      LineColor       =   1393968
      SelectedBackColor=   3182688
      SelectedForeColor=   6353088
      SelectedBackColor=   3182688
      SelectedForeColor=   6353088
      SelectedBackColor=   3182688
      SelectedForeColor=   6353088
      SelectedBackColor=   3182688
      SelectedForeColor=   6353088
      OLEDropMode     =   1
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
   End
   Begin vbalTreeViewLib.vbalTreeView tvwHistory 
      Height          =   3255
      Left            =   8340
      TabIndex        =   7
      Top             =   360
      Width           =   2655
      _ExtentX        =   4683
      _ExtentY        =   5741
      BorderStyle     =   0
      NoCustomDraw    =   0   'False
      HistoryStyle    =   -1  'True
      FullRowSelect   =   -1  'True
      SingleSel       =   -1  'True
      Style           =   1
      OLEDropMode     =   1
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
   End
   Begin vbalTreeViewLib.vbalTreeView tvwNumbers 
      Height          =   3255
      Left            =   5580
      TabIndex        =   5
      Top             =   360
      Width           =   2655
      _ExtentX        =   4683
      _ExtentY        =   5741
      NoCustomDraw    =   0   'False
      LabelEdit       =   -1  'True
      OLEDropMode     =   1
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
   End
   Begin VB.Label lblInfo 
      BackColor       =   &amp;H80000010&amp;
      Caption         =   " History Style"
      Height          =   255
      Index           =   3
      Left            =   8340
      TabIndex        =   6
      Top             =   60
      Width           =   2655
   End
   Begin VB.Label lblInfo 
      BackColor       =   &amp;H80000010&amp;
      Caption         =   " Item Numbering"
      Height          =   255
      Index           =   2
      Left            =   5580
      TabIndex        =   4
      Top             =   60
      Width           =   2655
   End
   Begin VB.Label lblInfo 
      BackColor       =   &amp;H80000010&amp;
      Caption         =   " Global Colours and Checkboxes"
      Height          =   255
      Index           =   1
      Left            =   2820
      TabIndex        =   2
      Top             =   60
      Width           =   2655
   End
   Begin VB.Label lblInfo 
      BackColor       =   &amp;H80000010&amp;
      Caption         =   " Per-Item Formatting"
      Height          =   255
      Index           =   0
      Left            =   60
      TabIndex        =   0
      Top             =   60
      Width           =   2655
   End
   Begin VB.Menu mnuContextTOP 
      Caption         =   ""
      Visible         =   0   'False
      Begin VB.Menu mnuContext 
         Caption         =   "&amp;Add Child Node..."
         Index           =   0
      End
      Begin VB.Menu mnuContext 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuContext 
         Caption         =   "&amp;Count Child Nodes..."
         Index           =   2
      End
      Begin VB.Menu mnuContext 
         Caption         =   "-"
         Index           =   3
      End
      Begin VB.Menu mnuContext 
         Caption         =   "&amp;Clear Child Nodes..."
         Index           =   4
      End
   End
End
Attribute VB_Name = "frmTestTreeView"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private Type POINTAPI
   x As Long
   y As Long
End Type
Private Declare Function GetCursorPos Lib "user32" (lpPoint As POINTAPI) As Long
Private Declare Function ScreenToClient Lib "user32" (ByVal hwnd As Long, tP As
 POINTAPI) As Long
Private Declare Function timeGetTime Lib "winmm.dll" () As Long

Private m_cIml As cVBALSysImageList
Private m_colKey As New Collection
Private contextNode As cTreeViewNode
Private m_lNewKeyID As Long

Private Sub PrepareImageList()
   
   ' Create a System Image List:
   Set m_cIml = New cVBALSysImageList
   m_cIml.IconSizeX = 16
   m_cIml.IconSizeY = 16
   m_cIml.Create
   
   ' Assign it to all of the TreeView controls:
   tvwDemo.ImageList = m_cIml.hIml
   tvwColours.ImageList = vbalImageList1.hIml
   tvwNumbers.ImageList = m_cIml.hIml
   tvwHistory.ImageList = m_cIml.hIml
   
   ' Enumerate the shell's desktop folder for files
   Dim shl As New Shell
   Dim desktopFolder As Folder
   Set desktopFolder = shl.NameSpace(ssfDESKTOP)
   Dim desktopItem As FolderItem
   Dim count As Long
   For Each desktopItem In desktopFolder.Items
      If (InStr(desktopItem.Path, "\") &gt; 0 Or InStr(desktopItem.Path, "::{") &gt;
       0) Then
         m_colKey.Add desktopItem.Path, CStr(count)
         count = count + 1
      End If
   Next
   
End Sub

Private Sub AddToTree(tvw As vbalTreeView, Optional ByVal iter As Long = 1)
Dim nodTop As cTreeViewNode
Dim nodSub As cTreeViewNode
Dim nodSubSub As cTreeViewNode
Dim i As Long
Dim j As Long
Dim childCount As Long
Dim fnt As StdFont
Dim subIcon As Long
Dim subSubIcon As Long
Dim children As cTreeViewNodes
Dim subChildren As cTreeViewNodes

   Set fnt = New StdFont
   fnt.Name = "Times New Roman"
   fnt.Size = 10
   fnt.Italic = True
   
   Set nodTop = tvw.Nodes.Add(, etvwFirst, iter &amp; "TOP", "Test Top",
    IIf(tvw.BackColor = &amp;H0, Int(Rnd * vbalImageList1.ImageCount),
    m_cIml.ItemIndex(m_colKey(CStr(Int(Rnd * m_colKey.count))))))
   If (tvw Is tvwDemo) Then
      nodTop.Bold = True
      nodTop.BackColor = &amp;HB7FBFA
      nodTop.ForeColor = vbWindowText
      nodTop.SelectedBackColor = nodTop.BackColor
      nodTop.SelectedForeColor = vbWindowText
      nodTop.MouseOverBackColor = nodTop.BackColor
      nodTop.MouseOverForeColor = &amp;H477574
      nodTop.SelectedMouseOverBackColor = nodTop.BackColor
      nodTop.SelectedMouseOverForeColor = vbWindowText
      nodTop.SelectedNoFocusBackColor = nodTop.BackColor
      nodTop.SelectedNoFocusForeColor = vbWindowText
      
   ElseIf (tvw.BackColor = &amp;H0) Then
      nodTop.Bold = True
      nodTop.NoCheckBox = True
      
   ElseIf (tvw.HistoryStyle) Then
      nodTop.Selected = True
      
   End If
   
   Set children = nodTop.children
   
   subIcon = IIf(tvw.BackColor = &amp;H0, Int(Rnd * vbalImageList1.ImageCount),
    m_cIml.ItemIndex(m_colKey(CStr(Int(Rnd * m_colKey.count)))))
   For i = 1 To 10
      
      Set nodSub = children.Add(, etvwChild, iter &amp; "SUB" &amp; i, "Sub-item " &amp; i,
       subIcon)
      If (tvw Is tvwDemo) Then
         If (i Mod 2) = 0 Then
            nodSub.BackColor = &amp;H95E3E2
            nodSub.ForeColor = vbWindowText
            nodSub.SelectedBackColor = nodSub.BackColor
            nodSub.MouseOverBackColor = nodSub.BackColor
            nodSub.SelectedMouseOverBackColor = nodSub.BackColor
            nodSub.SelectedNoFocusBackColor = nodSub.BackColor
         Else
            nodSub.BackColor = &amp;HAAE6B7
            nodSub.ForeColor = vb3DHighlight
            nodSub.SelectedBackColor = nodSub.BackColor
            nodSub.MouseOverBackColor = nodSub.BackColor
            nodSub.SelectedMouseOverBackColor = nodSub.BackColor
            nodSub.SelectedNoFocusBackColor = nodSub.BackColor
         End If
         nodSub.Font = fnt
      End If
      
      childCount = 2 + Rnd * 5
      If (tvw.ShowNumber) Then
         nodSub.ItemNumber = childCount
      End If
      subSubIcon = IIf(tvw.BackColor = &amp;H0, Int(Rnd *
       vbalImageList1.ImageCount), m_cIml.ItemIndex(m_colKey(CStr(Int(Rnd *
       m_colKey.count)))))
      Set subChildren = nodSub.children
      For j = 1 To childCount
         Set nodSubSub = subChildren.Add(, etvwChild, iter &amp; "SUB" &amp; i &amp; " SUB"
          &amp; j, "Sub-item " &amp; i &amp; ", child " &amp; j, subSubIcon)
      Next j
      If Not (tvw.HistoryStyle) Then
         nodSub.Expanded = True
      End If
   Next i
   
   If Not (tvw.HistoryStyle) Then
      nodTop.Expanded = True
   End If

End Sub

Private Sub chkHistory_Click()
   tvwHistory.HistoryStyle = (chkHistory.Value = Checked)
End Sub

Private Sub cmdClear_Click()
   tvwDemo.Nodes.Clear
   tvwColours.Nodes.Clear
   tvwNumbers.Nodes.Clear
   tvwHistory.Nodes.Clear
End Sub

Private Sub cmdNewInstance_Click()
   Dim fNew As New frmTestTreeView
   fNew.left = Me.left + 20 * Screen.TwipsPerPixelX
   fNew.tOp = Me.tOp + 20 * Screen.TwipsPerPixelY
   fNew.Show
End Sub

Private Sub cmdRepopulate_Click()
   AddToTree tvwDemo
   AddToTree tvwColours
   AddToTree tvwNumbers
   Dim i As Long
   For i = 1 To 6
      AddToTree tvwHistory, i
   Next i
End Sub

Private Sub Form_Load()

   Me.Show
   Me.Refresh

   ' This speeds things up a bit (approx 100ms)
   tvwDemo.Visible = False
   tvwColours.Visible = False
   tvwNumbers.Visible = False
   tvwHistory.Visible = False

   PrepareImageList
   
   Dim lTime As Long
   lTime = timeGetTime()
   tvwDemo.FullRowSelect = True
   AddToTree tvwDemo
   tvwDemo.Visible = True
   Debug.Print timeGetTime() - lTime
   
   lTime = timeGetTime()
   tvwColours.BackColor = &amp;H0&amp;
   tvwColours.ForeColor = &amp;HC080&amp;
   tvwColours.LineColor = &amp;H6030&amp;
   AddToTree tvwColours
   tvwColours.Visible = True
   Debug.Print timeGetTime() - lTime
   
   lTime = timeGetTime()
   tvwNumbers.ShowNumber = True
   AddToTree tvwNumbers
   tvwNumbers.Visible = True
   Debug.Print timeGetTime() - lTime
   
   lTime = timeGetTime()
   Dim i As Long
   For i = 1 To 6
      AddToTree tvwHistory, i
   Next i
   tvwHistory.Visible = True
   Debug.Print timeGetTime() - lTime
   
End Sub

Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)
   If (Forms.count = 2) Then ' only me and frmEvents still showing
      Unload frmEvents
   End If
End Sub

Private Sub Form_Resize()
Dim lHeight As Long
Dim lWidth As Long
   
   lWidth = (Me.ScaleWidth - tvwDemo.left * 5) \ 4
   If (lWidth &lt; 128 * Screen.TwipsPerPixelX) Then
      lWidth = 128 * Screen.TwipsPerPixelX
   End If
   lHeight = Me.ScaleHeight - tvwDemo.tOp * 2
   
   On Error Resume Next
   
   tvwDemo.Move tvwDemo.left, tvwDemo.tOp, lWidth, lHeight
   lblInfo(0).Move tvwDemo.left, lblInfo(0).tOp, lWidth
   
   tvwColours.Move tvwDemo.left + tvwDemo.Width + tvwDemo.left, tvwDemo.tOp,
    lWidth, lHeight
   lblInfo(1).Move tvwColours.left, lblInfo(0).tOp, lWidth
   
   tvwNumbers.Move tvwColours.left + tvwColours.Width + tvwDemo.left,
    tvwDemo.tOp, lWidth, lHeight
   lblInfo(2).Move tvwNumbers.left, lblInfo(0).tOp, lWidth
   
   tvwHistory.Move tvwNumbers.left + tvwNumbers.Width + tvwDemo.left,
    tvwDemo.tOp, lWidth, lHeight
   lblInfo(3).Move tvwHistory.left, lblInfo(0).tOp, lWidth
   
   cmdNewInstance.tOp = tvwDemo.tOp + tvwDemo.Height + Screen.TwipsPerPixelY
   cmdClear.tOp = cmdNewInstance.tOp
   cmdRepopulate.tOp = cmdNewInstance.tOp
   chkHistory.Move tvwHistory.left, cmdNewInstance.tOp, tvwHistory.Width
   
End Sub

Private Sub mnuContext_Click(Index As Integer)
   Select Case Index
   Case 0
      Dim sR As String
      sR = InputBox("Enter new caption")
      If (Len(sR) &gt; 0) Then
         m_lNewKeyID = m_lNewKeyID + 1
         contextNode.children.Add , , "NEW" &amp; m_lNewKeyID, sR
      End If
   Case 2
      MsgBox "Child Nodes: " &amp; contextNode.children.count, vbInformation
   Case 4
      If (contextNode.children.count = 0) Then
         If (vbYes = MsgBox("Are you sure you want to delete the node " &amp;
          contextNode.Text &amp; "?", vbQuestion Or vbYesNo)) Then
            contextNode.Delete
         End If
      Else
         If (vbYes = MsgBox("Are you sure you want to delete all the children
          of node " &amp; contextNode.Text &amp; "?", vbQuestion Or vbYesNo)) Then
            contextNode.children.Clear
         End If
      End If
   End Select
End Sub

Private Sub tvwColours_NodeCheck(node As vbalTreeViewLib.cTreeViewNode)
   frmEvents.LogEvent tvwColours, "NodeCheck", node.Key &amp; ", Checked=" &amp;
    node.Checked
End Sub

Private Sub tvwDemo_AfterLabelEdit(node As vbalTreeViewLib.cTreeViewNode,
 NewString As String, Cancel As Boolean)
   frmEvents.LogEvent tvwDemo, "AfterLabelEdit", node.Key &amp; ", NewString=" &amp;
    NewString &amp; ",Cancel=" &amp; Cancel
End Sub

Private Sub tvwDemo_BeforeCollapse(node As vbalTreeViewLib.cTreeViewNode,
 Cancel As Boolean)
   frmEvents.LogEvent tvwDemo, "BeforeCollapse", node.Text &amp; " (" &amp; node.Key &amp;
    ")"
End Sub

Private Sub tvwDemo_BeforeExpand(node As vbalTreeViewLib.cTreeViewNode, Cancel
 As Boolean)
   frmEvents.LogEvent tvwDemo, "BeforeExpand", node.Text &amp; " (" &amp; node.Key &amp; ")"
End Sub

Private Sub tvwDemo_BeforeLabelEdit(node As vbalTreeViewLib.cTreeViewNode,
 Cancel As Boolean)
   frmEvents.LogEvent tvwDemo, "BeforeLabelEdit", node.Key &amp; ",Cancel=" &amp; Cancel
End Sub

Private Sub tvwDemo_Click()
   frmEvents.LogEvent tvwDemo, "Click", ""
End Sub

Private Sub tvwDemo_Collapse(node As vbalTreeViewLib.cTreeViewNode)
   frmEvents.LogEvent tvwDemo, "Collapse", node.Text &amp; " (" &amp; node.Key &amp; ")"
End Sub

Private Sub tvwDemo_DblClick()
   frmEvents.LogEvent tvwDemo, "DblClick", ""
End Sub

Private Sub tvwDemo_DragDropRequest(Data As DataObject, nodeOver As
 vbalTreeViewLib.cTreeViewNode, ByVal bAbove As Boolean, ByVal hitTest As Long)
   frmEvents.LogEvent tvwDemo, "DragDropRequest", IIf(nodeOver Is Nothing, "No
    Node", nodeOver.Text) &amp; ",Above=" &amp; bAbove &amp; ",HitTest=" &amp; hitTest
End Sub

Private Sub tvwDemo_Expand(node As vbalTreeViewLib.cTreeViewNode)
   frmEvents.LogEvent tvwDemo, "Expand", node.Text &amp; " (" &amp; node.Key &amp; ")"
End Sub

Private Sub tvwDemo_GotFocus()
   frmEvents.LogEvent tvwDemo, "GotFocus", ""
End Sub

Private Sub tvwDemo_KeyDown(KeyCode As Integer, Shift As Integer)
   frmEvents.LogEvent tvwDemo, "KeyDown", "Key=" &amp; KeyCode &amp; ",Shift=" &amp; Shift
End Sub

Private Sub tvwDemo_KeyPress(KeyAscii As Integer)
   frmEvents.LogEvent tvwDemo, "KeyPress", "KeyAscii=" &amp; KeyAscii
End Sub

Private Sub tvwDemo_LostFocus()
   frmEvents.LogEvent tvwDemo, "LostFocus", ""
End Sub

Private Sub tvwDemo_MouseDown(Button As Integer, Shift As Integer, x As Single,
 y As Single)
   frmEvents.LogEvent tvwDemo, "MouseDown", "Button=" &amp; Button &amp; ",Shift=" &amp;
    Shift &amp; ",X=" &amp; x &amp; ",Y=" &amp; y
End Sub

Private Sub tvwDemo_MouseMove(Button As Integer, Shift As Integer, x As Single,
 y As Single)
   frmEvents.LogEvent tvwDemo, "MouseMove", "Button=" &amp; Button &amp; ",Shift=" &amp;
    Shift &amp; ",X=" &amp; x &amp; ",Y=" &amp; y
End Sub

Private Sub tvwDemo_MouseUp(Button As Integer, Shift As Integer, x As Single, y
 As Single)
   frmEvents.LogEvent tvwDemo, "MouseUp", "Button=" &amp; Button &amp; ",Shift=" &amp;
    Shift &amp; ",X=" &amp; x &amp; ",Y=" &amp; y
End Sub

Private Sub tvwDemo_NodeCheck(node As vbalTreeViewLib.cTreeViewNode)
   Debug.Assert tvwDemo.CheckBoxes ' should not occur unless we have checkboxes
   frmEvents.LogEvent tvwDemo, "NodeCheck", node.Text &amp; " (" &amp; node.Key &amp; ")"
End Sub

Private Sub tvwDemo_NodeClick(node As vbalTreeViewLib.cTreeViewNode)
   frmEvents.LogEvent tvwDemo, "Click", node.Text &amp; " (" &amp; node.Key &amp; ")"
End Sub

Private Sub tvwDemo_NodeDblClick(node As vbalTreeViewLib.cTreeViewNode)
   frmEvents.LogEvent tvwDemo, "NodeDblClick", node.Text &amp; " (" &amp; node.Key &amp; ")"
End Sub

Private Sub tvwDemo_NodeRightClick(node As vbalTreeViewLib.cTreeViewNode)
   frmEvents.LogEvent tvwDemo, "NodeRightClick", node.Text &amp; " (" &amp; node.Key &amp;
    ")"
   Dim tP As POINTAPI
   GetCursorPos tP
   ScreenToClient tvwDemo.hwnd, tP
   If (node.children.count &gt; 0) Then
      mnuContext(2).Enabled = True
      mnuContext(4).Caption = "&amp;Delete Child Nodes..."
   Else
      mnuContext(2).Enabled = False
      mnuContext(4).Caption = "&amp;Delete Node..."
   End If
   Set contextNode = node
   Me.PopupMenu mnuContextTOP, , tvwDemo.left + tP.x * Screen.TwipsPerPixelX,
    tvwDemo.tOp + tP.y * Screen.TwipsPerPixelY
End Sub

Private Sub tvwDemo_OLEStartDrag(Data As DataObject, AllowedEffects As Long)
   frmEvents.LogEvent tvwDemo, "OLEStartDrag", ""
   AllowedEffects = vbDropEffectMove
End Sub

Private Sub tvwDemo_SelectedNodeChanged()
   frmEvents.LogEvent tvwDemo, "SelectedNodeChanged", tvwDemo.SelectedItem.Text
End Sub

</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\libraries\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">TreeView</a>&#160;.&#160;<a href="article.html">vbAccelerator TreeView Control</a>&#160;.&#160;<a href="vb5_treeview_full_source.html">VB5 TreeView Full Source</a>&#160;.&#160;frmTestTreeView.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2004 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 18 April 2004</p></td><td></td></tr></table>
</body></html>