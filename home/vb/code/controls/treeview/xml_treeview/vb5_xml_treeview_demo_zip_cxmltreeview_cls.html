<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: cXmlTreeView.cls</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: cXmlTreeView.cls" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">TreeView</a>&#160;.&#160;<a href="article.html">XML Rendering in a TreeView</a>&#160;.&#160;<a href="vb5_xml_treeview_demo.html">VB5 XML TreeView Demo</a>&#160;.&#160;cXmlTreeView.cls</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_xml_treeview_demo.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 XML TreeView Demo</a> (19K)</p><p /><p class="nav"><a href="vb6_xml_treeview_demo.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 XML TreeView Demo</a> (18K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:14684</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=14684&type=zip&title=vb5_20xml_20treeview_20demo_2ezip_5fcxmltreeview.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />16 Apr 2004<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\treeview_control\article.html">vbAccelerator TreeView Control</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: cXmlTreeView.cls</h1><pre>VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "cXmlTreeView"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit

' The DOM tree for the XML document
Private m_xml As DOMDocument
' File name of the XML document
Private m_filename As String
' TreeView to render to
Private m_tvw As vbalTreeView
' Cached italic font used to render attributes
Private m_fntItalic As StdFont

' Gets/sets the XML Filename
Public Property Get Filename() As String
   Filename = m_filename
End Property
Public Property Let Filename(ByVal value As String)
   m_filename = value
End Property

' Gets/sets the Treeview control used to render the document
Public Property Get TreeView() As vbalTreeView
   Set TreeView = m_tvw
End Property
Public Property Let TreeView(tvw As vbalTreeView)
   Set m_tvw = tvw
End Property

' Loads the document, shows the root element and its children
Public Sub Load()

   m_tvw.Nodes.Clear

   Set m_xml = New DOMDocument
   m_xml.Load m_filename
   If Not (m_xml.parsed) Then
      Err.Raise 11540, App.EXEName &amp; ".cXmlTreeView", m_xml.parseError.reason &amp;
       " at " &amp; m_xml.parseError.Line &amp; ", position " &amp; m_xml.parseError.linepos
   Else
      Dim nodTop As cTreeViewNode
      Set nodTop = m_tvw.Nodes.Add(, etvwChild, m_xml.documentElement.nodeName,
       m_xml.documentElement.nodeName)
      nodTop.Bold = True
      addChildren nodTop, m_xml.documentElement
      nodTop.Selected = True
      nodTop.Expanded = True
   End If

End Sub

' Dynamically loads the children of an element
Public Sub NodeExpand(node As cTreeViewNode)
Dim sXpath As String
Dim xmlNode As IXMLDOMNode
   
   If (node.Children.Count = 0) Then
      sXpath = node.Key
      Set xmlNode = m_xml.selectSingleNode(sXpath)
      addChildren node, xmlNode
   End If
   
End Sub

' Adds the child attributes and nodes to the specified parent
Private Sub addChildren(nodTop As cTreeViewNode, xmlNode As IXMLDOMNode)

Dim child As IXMLDOMNode
Dim attr As IXMLDOMAttribute
Dim nodChild As cTreeViewNode
Dim iCount As Long
Dim sKey As String
Dim sBaseKey As String
Dim bChildNodes As Boolean
Dim sText As String
Dim bText As Boolean
Dim bComment As Boolean

   ' Add the attributes:
   For Each attr In xmlNode.Attributes
      sKey = nodTop.Key &amp; "/@" &amp; attr.nodeName
      Set nodChild = nodTop.Children.Add(, etvwChild, sKey, attr.nodeName)
      nodChild.BackColor = RGB(232, 230, 187)
      nodChild.MouseOverBackColor = RGB(232, 230, 187)
      nodChild.Font = m_fntItalic
   Next

   ' Add the child nodes
   For Each child In xmlNode.childNodes
      
      bComment = False
      bText = False
      
      If (child.nodeType = NODE_TEXT) Then
         sBaseKey = nodTop.Key &amp; "/text()"
         sText = child.nodeValue
         bText = True
      ElseIf (child.nodeType = NODE_COMMENT) Then
         sBaseKey = nodTop.Key &amp; "/comment()"
         sText = child.nodeValue
         bComment = True
      Else
         sBaseKey = nodTop.Key &amp; "/" &amp; child.nodeName
         sText = child.nodeName
      End If
      
      ' XML documents can have many nodes with the same
      ' name or type under a node.  To uniquely identify
      ' them with XPath we need to know the index of the
      ' item within its parent.  Here we just loop to
      ' find the index - that is a bit expensive if the
      ' document is enormous, so you could have a
      ' collection of previously added items here
      sKey = sBaseKey
      If (nodTop.Children.Exists(sKey)) Then
         nodTop.Children(sKey).Key = sBaseKey &amp; "[0]"
         sKey = sBaseKey &amp; "[1]"
      ElseIf (nodTop.Children.Exists(sKey &amp; "[0]")) Then
         iCount = 2
         Do
            sKey = sBaseKey &amp; "[" &amp; iCount &amp; "]"
            iCount = iCount + 1
         Loop While (nodTop.Children.Exists(sKey))
      End If
      
      ' Actually add the node and format it
      Set nodChild = nodTop.Children.Add(, etvwChild, sKey, sText)
      If bText Then
         nodChild.BackColor = RGB(181, 209, 238)
         nodChild.MouseOverBackColor = RGB(181, 209, 238)
      ElseIf bComment Then
         nodChild.ForeColor = RGB(138, 188, 92)
         nodChild.MouseOverForeColor = RGB(138, 188, 92)
      End If
      
      ' Now set the ShowPlusMinus to indicate whether this node
      ' can be expanded or not.  This allows us to dynamically
      ' add children on the TreeView's BeforeExpand event.
      bChildNodes = child.hasChildNodes
      If Not (child.Attributes Is Nothing) Then
         bChildNodes = bChildNodes Or (child.Attributes.length &gt; 0)
      End If
      nodChild.ShowPlusMinus = bChildNodes
   
   Next
   
End Sub

' Gets the text for the specified tree node
Public Function GetItemText(nod As cTreeViewNode) As String
Dim sXpath As String
Dim xmlNode As IXMLDOMNode
   sXpath = nod.Key
   Set xmlNode = m_xml.selectSingleNode(nod.Key)
   GetItemText = xmlNode.Text
End Function

' Constructs a new instance of this class
Private Sub Class_Initialize()
   Set m_fntItalic = New StdFont
   m_fntItalic.Name = "Tahoma"
   m_fntItalic.Size = 8.25
   m_fntItalic.Italic = True
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\libraries\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">TreeView</a>&#160;.&#160;<a href="article.html">XML Rendering in a TreeView</a>&#160;.&#160;<a href="vb5_xml_treeview_demo.html">VB5 XML TreeView Demo</a>&#160;.&#160;cXmlTreeView.cls</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2004 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 18 April 2004</p></td><td></td></tr></table>
</body></html>