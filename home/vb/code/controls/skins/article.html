<html lang="en" >
<head>

<title>vbAccelerator - vbAccelerator NeoCaption Component v2.0</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="This code sample provides a DLL you can use right away to radically modify the non-client area of a form, similar to the sort of customisation provided by NeoPlanet and WindowBlinds. And, since the full source code is available, you get the chance to build your customised client area derivatives. Sounds like fun? It is!" /><link rel="stylesheet" href="..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\index.html">Code</a>&#160;.&#160;<a href="..\index.asp\index.html">Controls</a>&#160;.&#160;vbAccelerator NeoCaption Component v2.0</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="skins.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Skins</a> (52K)</p><p /><p class="nav"><a href="vb5_neocaption_demonstration.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 NeoCaption Demonstration</a> (114K)</p><p class="nav"><a href="vb5_neocaption_dll.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 NeoCaption DLL</a> (74K)</p><p class="nav"><a href="vb5_neocaption_full_source.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 NeoCaption Full Source</a> (239K)</p><p /><p class="nav"><a href="vb6_neocaption_demonstration.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 NeoCaption Demonstration</a> (127K)</p><p class="nav"><a href="vb6_neocaption_dll.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 NeoCaption DLL</a> (74K)</p><p class="nav"><a href="vb6_neocaption_full_source.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 NeoCaption Full Source</a> (253K)</p><br /><br /><img src="..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:755</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\linkto_asp\id=755&type=article&title=vbaccelerator_20neocaption_20component_20v2_2e0.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 3 / 3</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 1 / 1</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:10 November 2003</p>
<br /><br /><img src="..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\res\update.png" width="8" height="8" alt="Update" />21 Feb 2002<br /><p class="update">Release of Version 2.0.</p><p class="update">Fixes for support of different sized skinning parts.</p><p class="update">New <i>cSkinConfiguration</i> object for setting up the skin, which
includes XML serialization and deserialization</p><p class="update">Colour customisation using HLS and RGB added.</p><p class="update">Transparent colour now added.</p><p class="update">Three new skins included.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><br /><br /><img src="..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator NeoCaption Component v2.0</h1><p class="splash">Skin the entire non-client area (titlebar, border, menu, control box and buttons) of your VB project by adding this component to your project</p><img src="darkmetal.png" width="359" height="205" alt="Form with NeoCaption applied; Dark Metal skin" /><p /><p>This code sample provides a DLL you can use right away to radically modify the non-client area of a form, similar to the sort of customisation provided by NeoPlanet and WindowBlinds. And, since the full source code is available, you get the chance to build your customised client area derivatives. Sounds like fun? It is!</p><img src="bluemedia.png" width="361" height="216" alt="Blue Media Skin Applied" /><h2>A Little History</h2><p>The first program out there I remember which offered any sort of customisation of the non-client area was Office 95, with those gradient caption bars. Although gradient captions aren't so much of interest now MS have rolled support into Win98/2000, they certainly were when Office 95 was launched. Suddenly everyone wanted a go at doing their own captions. How did you do it? And how come you could detach the menu bar in Office 95 - surely you could do this in your own app? After all, how hard could it be?</p><p>Well, it turns out that drawing customised menu captions isn't easy at all. Windows just does not play fair - it continually redraws parts of the non-client area such as the Min/Max/Close buttons when you least expect it. Trying to reimplement a menu as a tear-off window whilst still allowing your app respond to Alt-Tab accelerator and the clicks in the Taskbar correctly is even more difficult.</p><p>MS weren't very forthcoming on the subject of the Office 95 titlebar. The only Knowledge Base article (Q99046) on the subject coyly skirts around the topic, saying that whilst you could subclass <i>WM_NCPAINT</i> and <i>WM_NCACTIVATE</i> messages and then draw your own caption, it really isn't recommended; the whole idea of modifying the caption bar is foolish and outside the bounds of decent human behaviour (something even this author could agree with during the rash of windows which appeared at the time with primary red to neon blue gradients - very bad when encountered during a hangover).</p><p>More interestingly, the Knowledge Base article somehow managed to totally avoid mentioning the fact that the Office implementation only worked at all because it was jam-packed with hacks. So we subclass two messages and do a little additional work afterwards? Yeah, right. Turns out you need to do all sorts of other somewhat abnormal things, such as removing the window style bit <i>WS_VISIBLE</i> during <i>WM_SETCURSOR</i> message processing and then putting it back again straight away afterwards. Anyway, luckily the nicer people at Microsoft Systems Journal (MSJ) and Spy++ help you to understand what you really need to do.</p><p>This sample brings together pieces of code from all sources, plus it adds some additional, VB specific workarounds to provide a full method for changing the size of the non-client area, plus drawing whatever you like into that region and providing an override to draw menus in a new style as well (this code is the basis for the vbAccelerator PopMenu2 object).</p><p><b>Note:</b> in the current version, this component does not work properly with MDI forms. When you maximise an MDI child, the system attempts to add new items to the menu for the control box and min/max/close buttons - which is not handled in the current code and causes a crash. A fix for this problem is under investigation. </p><h2>Version 2.0 Upgrades</h2><p>Version 2.0 of this component fixes some problems with hardcoding of the skin dimensions
in the first release, and also adds some new features.  The new features are:</p><ol><li>New <i>cSkinConfiguration</i> object.<br />
      This object helps to manage all of the skin properties.  This object
      can save and restore to XML files, making it easier to add customisable skins.</li><li>Skin Colour Customisation.<br />
      The code includes Image Processing functions allowing you to
      adjust the overall colour properties of the skin in pretty much realtime: you can either
      modify the overall Hue and Saturation or change the percentage of Red, Green and Blue 
      components.  NeoCaption also now provides a method to preview the skin on screen.</li><li>New Skin properties.<br />
      In version 2.0 there are a whole range of new skin properties:
      <ul><li>Borders can have different bitmaps for the active and inactive window display.</li><li>Borders can be asymmetrical, i.e. the different width to height, and you can 
             configure which part of the border should be treated as the border element 
             and which should be regarded as part of the client.</li><li>Configure whether a title is drawn or not, and choose where to place this 
              relative to the caption area.</li><li>Control buttons can have different bitmaps for the active and inactive window
              display, and the position relative to the caption area can be customised.</li></ul></li><li>Transparent Color support.<br />
     One of the colours in the bitmaps can be now set as a Transparent Color under Windows 2000
     or XP. This colour is untouched when you perform a colour customisation.</li></ol><h2>The vbAccelerator NeoCaption Component</h2><p>The DLL supplied with the download exposes three classes for public use:</p><ul><li><i>cNeoCaption</i></li><li><i>cSkinConfiguration</i></li><li><i>cNCCalcSize</i></li></ul><p><i>cNeoCaption</i> is a reference implementation of the Non-Client area modifier, including the drawing code and menuing. It implements the <i>INCAreaModifier</i> interface which must be supported in order to take advantage of the <i>cNCCalcSize</i> class - which is the basic framework for building radically customised non-client areas.</p><h2>Using the cNeoCaption Interface</h2><p>This should prove to be quite simple to use. There are basically two methods you will
   use to initialise the custom caption.  Note that although there are a number of options 
   to control colours and fonts,  these are now deprecated and the <i>cSkinConfiguration</i> object 
   should be used instead.</p><ul><li><strong>Attach2</strong><br />
        Starts the NeoCaption processing, and sets the skin to use.</li><li><strong>Detach</strong><br />
        Ends NeoCaption processing.  The form is set back to its standard state.</li></ul><h2>Using the cSkinConfiguration Object</h2><p>The cSkinConfiguration object is where you do all of the work in setting up 
    the Skin to draw.  First we look at configuring the skin pictures.</p><p>NeoCaption draws the interface using two bitmaps: a caption bitmap and a border bitmap.
    These bitmaps have to be drawn in a specific way and NeoCaption told about the positions
    of each of the subcomponents within the bitmap in order for the skin to draw correctly.</p><h3>The Caption Bitmap</h3><p>The caption bitmap contains the images drawn to create the title bar and menu areas
     of the form.  In this bitmap you need images for the active title bar and the inactive
    one, as well as images for each of the control buttons when they are up and down.</p><img src="neocapcaption.png" width="432" height="84" alt="How to set up a bitmap resources for the title bar image" /><p><small><strong>Caption Bitmap Example</strong></small></p><p>Using the example above, you then need to tell NeoCaption about each of the details:</p><pre>
        With cSkin

          ' picCaption is StdPicture object containing the
          ' caption bitmap:          
          Set .Caption = picCaption

         .ActiveLeftEnd = 90
         .ActiveRightStart = 142
         .ActiveRightEnd = 240
         .InactiveOffset = 372

         .ButtonWidth = 13
         .ButtonHeight = 14

         ' Note that you can also have inactive
         ' versions of the control buttons; these would
         ' be drawn at the end of the inactive version
         ' of the caption.
         .ControlButtonHasInactiveVersion = False

        End With
    </pre><h3>The Borders Bitmap</h3><p>The border picture consists of seven square images in-line which represent 1 x left hand border,    2 x bottom-left corner, 1 x bottom border, 1 x right hand border and finally 
    2 x bottom-right corner.  The first of the two corners is used to when the form is 
   sizable; the second of the two corners when it has a fixed border. You can optionally 
   have a second line of border images to use when the form is inactive as well:</p><img src="neocapborders.png" width="182" height="75" alt="How to set up a bitmap resource for the borders" /><p><small><strong>Borders Bitmap Example</strong></small></p><p>This is how you would configure the skin for this border example:</p><pre>
       With cSkin

          ' picBorders is StdPicture object containing the
          ' borders bitmap:          
          Set .Caption = picBorders

          ' We have both an active and inactive border:
          .BorderHasInactiveVersion = True

          ' NeoCaption will automatically configure the border size
          ' of 20 x 20 from the bitmap, however, we can tell it that
          ' the actual border portions are smaller than this:
          .LeftBorderWidth = 8
          .RightBorderWidth = 8
          .BottomSizingBorderHeight = 4
          .TopSizingBorderHeight = 4
       End With
   </pre><h3>Other Settings</h3><p>There are various other settings you can use to customise how NeoCaption draws, 
   as follows:</p><ul><li><strong>ActiveCaptionColor, InActiveCaptionColor, CaptionFont</strong><br />
      Specify the colour and font used to draw the form's caption.</li><li><strong>ActiveMenuColor, ActiveMenuColorOver, InActiveMenuColor, MenuBackgroundColor, MenuFont</strong><br />
	Specify the colours and fonts used to draw the menu.</li><li><strong>DrawTitle</strong><br />
      Tells NeoCaption whether to draw the title in the area between <i>ActiveLeftEnd</i>
      and <i>ActiveRightStart</i> or not. The default is to draw the title.</li><li><strong>TitleStartOffsetY</strong><br />
      By default NeoCaption will place the title starting at x = <i>ActiveLeftEnd</i> and
      y = <i>TopSizingBorderHeight</i> (or the dimension of a border if that isn't set). 
      If you set these properties then the drawing position of the title will be offset 
      by the specified amounts.</li><li><strong>MenuStartOffsetX, MenuStartOffsetY</strong><br />
      By default NeoCaption will draw the menu starting at x = <i>ActiveLeftEnd</i> and
      y = (title position) + (title height).  These properties allow you to set the
      exact position of the menu relative to the Top-Left of the form.</li><li><strong>CustomControlButtonPosition, ControlButtonOffsetX, ControlButtonOffsetY</strong><br />
      By default NeoCaption places the buttons at x = <i>ActiveRightEnd</i> - <i>RightBorderWidth</i>.
      Setting these properties allow you to adjust the control position relative to the top-right
      of the form.</li><li><strong>Colourise, Hue, Saturation</strong><br />
      If you set <i>Colourise</i> to True then NeoCaption will adjust the bitmap to the specified
      <i>Hue</i> and <i>Saturation</i>.  Hue values run from -1 to 5; this corresponds to 
      the colours range Purple-Red-Yellow-Green-Blue-Purple.  Saturation values run from 0
      (totally unsaturated, or grey) to 1 (totally saturated).</li><li><strong>AdjustRGB, PercentRed, PercentGreen, PercentBlue</strong><br />
      If you set <i>AdjustRGB</i> then NeoCaption will adjust the colours in the bitmap according
      to the percentages provided.  Percentages between -100% (-1) and 100% (1) can be set for
      each.</li><li><strong>TransparentColor</strong><br />
      The colour you'd like to be set Transparent on the form.  Only valid for Windows 2000/XP.
      Note that the drawing performance is poor when resizing with Transparency set on.  Set to 
      -1 if you don't want transparency (the default).</li><li><strong>Name</strong><br />
      The name of your skin.</li></ul><h3>cSkinConfiguration Methods</h3><p>You can also use cSkinConfiguration to draw a sample of the specified skin and to
    Load and Save skin configuration details to an XML file.</p><ul><li><strong>Store</strong><br />
      Returns an string containing the skin configuration as XML.  Note that the XML does
      not include the actual pictures; you need to save them elsewhere.  To save the
      skin configuration to a file, use an MSXML DomDocument:
      <pre>
         Dim d as New DomDocument
         d.LoadXML cSkin.Store()
         d.Save App.Path " "\MySkin.xml"
      </pre></li><li><strong>Restore</strong><br />
      Initialises the cSkinConfiguration object from the specified XML and the Caption
      and Borders picture objects.  To get the XML, you should use a DomDocument:
      <pre>
          Dim d as New DomDocument
          d.Load App.Path " "\MySkin.xml"
          cSkin.Restore d.xml, picCaption, picBorders
      </pre></li><li><strong>DrawSample</strong><br />
     Draws an image of the skin currently in the cSkinConfiguration object onto the
     specified window, DC and at the specified position.</li></ul><h2>Demonstration</h2><p>The sample provided in the demonstration download show how to use the NeoCaption 
    component to swap different skins at runtime and even how to remove a skin from a form. 
    It also provides a reusable skin customisation form for performing colourisation.</p><p>Currently the demonstration does not use XML to configure the skins, but is  easy
    to add.  The Skins.zip download contains all of the skins used in the sample as XML
    files along with the original bitmaps.</p><h2>Using the <i>cNCCalcSize</i> Object</h2><p>To gain lower level control over non-client area processing, you can implement the <i>INCAreaModifier</i> interface and attach directly to the <i>cNCCalcSize</i> object. Implementing the <i>INCAreaModifier</i> interface involves doing the following:</p><ol><li>Returning Specific Values<br />
When the <i>GetTopMarginHeight</i>, <i>GetLeftMarginWidth</i>, <i>GetRightMarginWidth</i> and <i>GetBottomMarginHeight</i> methods are called, you get the opportunity to modify the border sizes and titlebar height to suit your own graphics. The <i>hWnd</i> property is queried when the <i>cNCCalcSize</i> object needs to know the handle of the window you want to modify the non-client area for.</li><li>Performing NonClient Painting<br />
The <i>NCPaint</i> method is fired whenever you need to paint the Non-Client area. The method passes the size of the window and also a valid device context to paint into.</li><li>Assigning Window Areas to their non-client function<br />
The <i>HitTest</i> method is called whenever Windows wants to know what function the area under the mouse should perform (e.g. is it the control menu, a border, titlebar, one of the min/max/close buttons etc). The caller assigns a default value for the function based on the x,y position but you can override this with the type of region you want.</li><li>Non-Client MouseDown and MouseUp processing<br />
In customising the response to the <i>HitTest</i> method, you may also wish to customise how your application reacts to non-client mouse clicks. The <i>NCMouseDown</i> and <i>NCMouseUp</i> methods allow you to perform your own actions.</li><li>Menu Processing<br />
The <i>InitMenuPopup</i> and <i>AltKeyAccelerator</i> methods enable your application to integrate customised menu painting into the non-client area (you would want to ignore these methods if menuing was being performed by a separate method, for example, using the vbAccelerator CoolMenu control).</li></ol><p>Implementing these functions from scratch is quite a lot of effort. If you want to do it, the best place to start is to examine how the cNeoCaption class works.</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\index.html" ><IMG SRC="..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\index.html">Code</a>&#160;.&#160;<a href="..\index.asp\index.html">Controls</a>&#160;.&#160;vbAccelerator NeoCaption Component v2.0</p><br /><p class="nav"><a href="..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 21 February 2003</p></td><td></td></tr></table>
</body></html>
