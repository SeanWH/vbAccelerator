<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: Examples_Example2_ctlEnumControls.ctl</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: Examples_Example2_ctlEnumControls.ctl" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">UserControl OLE Extensions</a>&#160;.&#160;<a href="article.html">Using IPerPropertyBrowse to Customise the Design Time Properties for a Control</a>&#160;.&#160;<a href="ex_property_browsing_in_vb.html">EX Property Browsing in VB</a>&#160;.&#160;Examples_Example2_ctlEnumControls.ctl</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="ex_property_browsing_in_vb.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />EX Property Browsing in VB</a> (19K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:4874</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=4874&type=zip&title=ex_20property_20browsing_20in_20vb_2ezip_5fexamples_5fexample2_5fctlenumcontr.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:prw.exponential@dial.pipex.com">Paul Wilde</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />23 Nov 1998<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: Examples_Example2_ctlEnumControls.ctl</h1><pre>VERSION 5.00
Begin VB.UserControl ctlEnumControls 
   BorderStyle     =   1  'Fixed Single
   ClientHeight    =   3384
   ClientLeft      =   0
   ClientTop       =   0
   ClientWidth     =   3840
   ScaleHeight     =   3384
   ScaleWidth      =   3840
   Begin VB.Label Label3 
      AutoSize        =   -1  'True
      Caption         =   $"ctlEnumControls.ctx":0000
      Height          =   768
      Left            =   168
      TabIndex        =   2
      Top             =   1992
      Width           =   3444
      WordWrap        =   -1  'True
   End
   Begin VB.Label Label2 
      AutoSize        =   -1  'True
      Caption         =   "Select this control and then look at the
       'ControlsOnForm' property in the VB properties window."
      Height          =   576
      Left            =   180
      TabIndex        =   1
      Top             =   1224
      Width           =   3396
      WordWrap        =   -1  'True
   End
   Begin VB.Label Label1 
      AutoSize        =   -1  'True
      Caption         =   $"ctlEnumControls.ctx":00A6
      Height          =   768
      Left            =   180
      TabIndex        =   0
      Top             =   180
      Width           =   3396
      WordWrap        =   -1  'True
   End
End
Attribute VB_Name = "ctlEnumControls"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit

'implement 'VB friendly' version of the IPerPropertyBrowsing interface
Implements IPerPropertyBrowsingVB

'private members
Private m_oPerProp As New CPerPropertyBrowsing
Private m_DispID_ControlsOnForm As Long
Private m_strControlsArray() As String

'persistent property members
Private m_strControlsOnForm As String

Public Property Get ControlsOnForm() As String
'return member m_strControlsOnForm

    ControlsOnForm = m_strControlsOnForm
End Property
Public Property Let ControlsOnForm(ByVal NewVal As String)
'set member m_strControlsOnForm

    m_strControlsOnForm = NewVal
    PropertyChanged "ControlsOnForm"
End Property
Private Function IPerPropertyBrowsingVB_GetDisplayString(DispID As Long,
 DisplayName As String) As Boolean
'return a more friendly string than the the default enum variable name
'remember we aren't limited to variable names here, so we can
'use any normally invalid characters, such as spaces and semicolons.
'(returning False let's the caller, ie.VB, do it's default implementation)

    'if DispID is for property 'ControlsOnForm'
    If DispID = m_DispID_ControlsOnForm Then
        'in this instance we are want to return the proper value
        'of the property so we can just return it
        DisplayName = m_strControlsOnForm
        
        'return True to override the default implementation
        IPerPropertyBrowsingVB_GetDisplayString = True
        
    End If
End Function
Private Function IPerPropertyBrowsingVB_GetPredefinedStrings(DispID As Long,
 StringsOut() As String, CookiesOut() As Long) As Boolean
'returns an array of strings to represent the property
'names of the specified DispID
'(returning False let's the caller, ie.VB, do it's default implementation)

    Dim oControl As Object
    Dim lngUbound As Long
    
    'if DispID is for property 'ControlsOnForm'
    If DispID = m_DispID_ControlsOnForm Then
        'copy the names of all command button controls on this form into the
         array
        On Error GoTo CATCH_EXCEPTION
        For Each oControl In UserControl.Parent.Controls
            'NOTE:to change this list to display all the controls
            'dropped by a user on a container control, just change
            'the UserControl.Parent.Controls to UserControl.ContainedControls
            If TypeOf oControl Is CommandButton Then
                lngUbound = UBound(StringsOut)
                ReDim Preserve StringsOut(lngUbound + 1) As String
                ReDim Preserve CookiesOut(lngUbound + 1) As Long
                StringsOut(lngUbound) = oControl.Name
                CookiesOut(lngUbound) = lngUbound
                
            End If
            
        Next oControl
        On Error GoTo 0
        'cache the array of control names so we can find them later
        ReDim m_strControlsArray(UBound(StringsOut))
        For lngUbound = 0 To UBound(StringsOut)
            m_strControlsArray(lngUbound) = StringsOut(lngUbound)
            
        Next lngUbound
        
        'NOTE: The CookiesOut array can contain any value. It is
        'used to store numerical data alongside the string representation
        'of the property. It is similar to the relationship between the
        'ItemData and ListItem properties of a ListBox or ComboBox.

        'return True to override the default implementation
        IPerPropertyBrowsingVB_GetPredefinedStrings = True
        
    End If
    Exit Function
    
CATCH_EXCEPTION:
    'The 'Parent' property of the usercontrol is an Extender property,
    'and as such may not be implemented by the controls container
    '(although it is by VB), and so we need to allow for that.
    'Under these circumstances it is safest to allow the container to
    'do it's own default implementation of this routine.
    IPerPropertyBrowsingVB_GetPredefinedStrings = False
    
End Function
Private Function IPerPropertyBrowsingVB_GetPredefinedValue(DispID As Long,
 Cookie As Long, Value As Variant) As Boolean
'convert the value we passed previously in 'GetPredefinedStrings' to
'the actual property value.
'(returning False let's the caller, ie.VB, do it's default implementation)

    'if DispID is for property 'ControlsOnForm'
    If DispID = m_DispID_ControlsOnForm Then
        'use the cookie to find the array item we need
        '(we stored the array indexes during the call to GetPredefinedStrings)
        If Cookie &lt; UBound(m_strControlsArray) Then
            Value = m_strControlsArray(Cookie)
    
        Else
            Value = ""
            
        End If
    
        'return True to override the default implementation
        IPerPropertyBrowsingVB_GetPredefinedValue = True
        
    End If
End Function
Private Sub UserControl_Initialize()
    
    'attach the new IPerPropertyBrowsing interface to this control
    m_oPerProp.Attach Me
    'cache the despatch identifiers
    m_DispID_ControlsOnForm = m_oPerProp.GetDispID("ControlsOnForm")
    'initialise controls array
    ReDim m_strControlsArray(0) As String
End Sub
Private Sub UserControl_InitProperties()

    'initialise default property values
    m_strControlsOnForm = ""
End Sub
Private Sub UserControl_ReadProperties(PropBag As PropertyBag)

    'read properties from stash
    With PropBag
        m_strControlsOnForm = .ReadProperty("ControlsOnForm", "")
        
    End With
End Sub
Private Sub UserControl_Terminate()
    
    'restore the original interface
    m_oPerProp.Detach
End Sub
Private Sub UserControl_WriteProperties(PropBag As PropertyBag)

    'write properties to stash
    With PropBag
        .WriteProperty "ControlsOnForm", m_strControlsOnForm, ""
        
    End With
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="javascript:window.alert(&quot;http://vbaccelerator.com/home/include/adredir.asp?url=http://oneandone.co.uk/xml/init?k_id=5791003&image=http://oneandone.co.uk/xml/banner?size=1&number=1\nThis link was not retrieved.&quot;)" ><IMG SRC="..\..\..\..\..\..\..\oneandone_co_uk\xml\banner\size=1&number=1.html" ALT="1&1 Web Hosting" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">UserControl OLE Extensions</a>&#160;.&#160;<a href="article.html">Using IPerPropertyBrowse to Customise the Design Time Properties for a Control</a>&#160;.&#160;<a href="ex_property_browsing_in_vb.html">EX Property Browsing in VB</a>&#160;.&#160;Examples_Example2_ctlEnumControls.ctl</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>