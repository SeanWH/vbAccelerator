<html lang="en" >
<head>

<title>vbAccelerator - vbAccelerator ListBar Control</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="The vbAccelerator ListBar control is an all-VB control which emulates the Outlook sidebar as accurately as possible. I was inspired to write it when I started playing with Microsoft's Spy++ utility and pointed it at Outlook's list bar (or 'ShortcutBar' as it publicises itself to the world) and noticed that the main component of the ListBar was actually a standard COMCTL32.DLL ListView." /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">ListBar</a>&#160;.&#160;vbAccelerator ListBar Control</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_list_bar_control_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 List Bar Control Binary</a> (44K)</p><p class="nav"><a href="vb5_list_bar_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 List Bar Demonstration</a> (39K)</p><p class="nav"><a href="vb5_list_bar_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 List Bar Full Source</a> (136K)</p><p /><p class="nav"><a href="vb6_list_bar_control_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 List Bar Control Binary</a> (45K)</p><p class="nav"><a href="vb6_list_bar_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 List Bar Demonstration</a> (35K)</p><p class="nav"><a href="vb6_list_bar_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 List Bar Full Source</a> (132K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:3911</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3911&type=article&title=vbaccelerator_20listbar_20control.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 4 / 7</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 6 / 7</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:21 January 2004</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />17 Feb 2003<br /><p class="update">Added Office XP highlighting style.</p><p class="update">Fixed two bugs in the cListBar class: ForeColor and HelpText
 	properties did not work correctly - thanks to Simon Horton.</p><p class="update">Added a method to the <i>cListBarItems</i> class to 
	remove all items from a bar, and fixed an intermittent problem with 
	removing the last item from a bar (item still showed and caused a crash 
	if you clicked on it - thanks to Daniel).
	this.</p><p class="update">Prevented BarClick events from firing when the ListBar was
	resized - thanks to Billy Propes.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\..\type_libraries\ole_guid_and_interface_definitions\article.html">Ole Guid and interface definitions (OleGuids.Tlb) </a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\visual_studio_style_listbar\article.html">vbAccelerator Visual Studio Style ToolBox ListBar</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\imagelist\vbaccelerator_image_list_control\article.html">vbAccelerator ImageList Control and Class v2.0</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\s_grid\article.html">vbAccelerator S-Grid Control</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator ListBar Control</h1><p class="splash">An accurate reproduction of the Microsoft Outlook Bar, incorporating a solid ComCtl32.DLL ListView implementation in VB for you to play with!</p><img src="listbar.png" width="301" height="314" alt="ListBar Control Tester" /><p /><p>The vbAccelerator ListBar control is an all-VB control which emulates the Outlook sidebar as accurately as possible. I was inspired to write it when I started playing with Microsoft's Spy++ utility and pointed it at Outlook's list bar (or "ShortcutBar" as it publicises itself to the world) and noticed that the main component of the ListBar was actually a standard COMCTL32.DLL ListView.</p><h2>Flies</h2><p>So, having seen how the MS version worked, I figured there would be no problem implementing a 
ListView like this and next thing there would be a super accurate Outlook Bar just ready for 
playing with. Not to mention I could provide you with in-place editing without writing any code, and 
provide Background Bitmap support so easily! How hard could it be?</p><p>Well, one day I will finally stop saying "How hard can it be?" and may even stop having to 
compile my code at 4:30am and dragging in to work the next day with flies buzzing around my head. One day.</p><p>In the meantime, here are the results! Go download the <a href="..\..\s_grid\article.html">S-Grid Control</a> and you 
will have a serious pair of complementary tools for building real world UI solutions. Combine everything with 
the ultimate in Windows style using the <a href="..\..\toolbar\vbaccelerator_toolbar_and_coolmenu_control\article.html">CoolMenu/ToolBar/Rebar control</a> and 
you're well on your way to having a killer business app!</p><h2>Objective Gratification</h2><p>One of the differences between this control and many of the previous controls at vbAccelerator is that it h
as a fully-fledged object model - bars are programmed using the <i>cListBar</i> object which is collected in the 
<i>CListBars</i> collection, and within a bar items are modified using a <i>cListBarItem</i> object which is 
collected in the <i>cListBarItems</i> collection.</p><p>The collection is shown in the object model:</p><img src="vlbarhr.gif" width="147" height="130" alt="vbAccelerator ListBar Object Model" /><p><strong><small>vbAccelerator ListBar Object Model</small></strong></p><p>One of the issues with programming an object model like this is it is easy to get into problems 
with circular references; where objects are referred to by an external consumer of the control and by 
the control itself, which is also referred to by the consumer. Such problems can prevent the 
<i>_Terminate</i> event of objects ever firing. This situation is normally undesirable 
(causing memory leaks) but when you have subclassing and Win32 API controls it becomes uncontrollable, 
leading to UAE/GPFs whenever a form containing the control is closed.</p><p>The object model coded in this control demonstrates one technique you can use to <i>completely guarantee</i> 
no possibility of a circular reference. The downside to the technique is that it requires more code 
to be run before an object is provided to the user. That isn't a problem in a control which is 
managing only a small number of objects, such as the Outlook bar (i.e. less than 1,000). But it 
would be unsuitable for use in a control like the <a href="..\..\s_grid\article.html">vbAccelerator S-Grid control</a>, 
which is currently capable of adding and displaying tens of thousands of objects at a reasonable speed.</p><h2>The Struture of the ListBar/Outlook Bar</h2><img src="vllbarst.gif" width="177" height="240" alt="List Bar Structure" /><p><strong><small>ListBar Structure</small></strong></p><p>The ListBar consists of 4 window parts:</p><ol><li><strong>The Main Container</strong><p>This window is responsible for the border around the control and drawing the bar selection buttons. 
The border is either turned off or implemented using the extended window styles <i>WS_EX_STATICEDGE</i> for 
a thin 3D border or the <i>WS_EX_CLIENTEDGE</i> style for a standard 3D border. By using extended window 
styles to draw the control border, the internal dimensions of the control (<i>.ScaleWidth</i> and <i>.ScaleHeight</i>)
 are automatically adjusted to take account of the border and windows draws the border for you.</p><p>In the Microsoft Outlook implementation, this window has a caption of "ShortcutBar" and 
a class name of "rctrl_renwnd32" - this class is used as a general container in Outlook.</p></li><li><strong>The Scroll ViewPort</strong><p>This window is responsible for clipping the areas of the ListBar which can't be seen as 
the ListBar is scrolled up and down. When the container resizes this window, it instructs it 
to detect whether the ListBar is bigger than its client area, so it can then determine whether to 
display the up and down buttons.</p><p>In the Microsoft Outlook implementation, this window has the same class name as the 
main window and a caption of "FIScrollWnd".</p></li><li><strong>The ListBar</strong><p>This is the list of icons. In both the Microsoft and my implementation this is 
implemented using an API created ImageList control with the <i>LVS_NOSCROLL</i> style turned on. 
The same window is reused for each ListBar: when the bar selection button is clicked, 
a snapshot of the ListView display is taken and displayed, the ListView is then made invisible 
and filled with the new items and finally the container animates the ListView window in steps.</p><p>Controlling the position of the icons in the ListView is performed by sending 
<i>LVM_SETITEMPOSITION32</i> messages whenever the ListBar is resized.</p><p>To implement the hot, mouse-over highlighting of buttons, the ListView Custom Draw services are used. 
Firstly, the ListView has the <i>LVS_EX_ONECLICKACTIVATE</i> extended style set, which causes the control 
to start highlighting hot items. The default highlighting scheme is to underline the text and 
colour it in the selected text colour, however when using the Custom Draw services 
you can override the colours and to some extent the graphics being drawn.</p></li><li><strong>The ScrollButtons</strong><p>This is the only area in which the vbAccelerator control diverges from the Outlook implementation. 
In Outlook, this control appears to be drawn directly onto the ListView, however the 
vbAccelerator control uses two standard VB CommandButton controls with the <i>Style</i> property set to 
<i>Graphical</i>. The face of the control is then drawn by overriding the <i>WM_DRAWITEM</i> message 
sent by the control.</p></li></ol><h2>Important Note About VB6 ImageLists</h2><p>Please note that VB6 ImageList (from MSCOMCTL.OCX) doesn't work with this 
  control under Windows 2000/XP.  This is because the ImageList handle returned by the
  control isn't compatible with ComCtl32.DLL on those systems.    Microsoft may have some
  sort of fix for this (see KB article <i>KB811415</i>) but currently the fix is only 
  available by contacting Microsoft support directly and isn't redistributable.  If 
  you have a copy of this (MSCOMCTL.OCX version 6.0.97.1) to try it out then <a href="mailto:steve@vbaccelerator.com">please let me know!</a>.</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">ListBar</a>&#160;.&#160;vbAccelerator ListBar Control</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 17 February 2003</p></td><td></td></tr></table>
</body></html>
