<html lang="en" >
<head>
<title>vbAccelerator - Add Support for other ListView Background Image Positions</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="This control provides an alternative to the VB ListView control and adds support for
almost all of the new ComCtl32.DLL v6.0 features that are missing from the VB version: 
ListView grouping, Tile view with configurable sub-items, Multiple Work Areas and more.
" /><link rel="stylesheet" href="..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\res\print.css" media="PRINT" /><link rel="SHORTCUT ICON" href="/home/res/vbaccel.ico" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\index.html">Code</a>&#160;.&#160;<a href="..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="article.html">vbAccelerator ListView Control</a>&#160;.&#160;<a href="bugtrak.html">BugTrak Summary</a>&#160;.&#160;Add Support for other ListView Background Image Positions</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_listview_control.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 ListView Control</a> (84K)</p><p class="nav"><a href="vb5_listview_demonstration.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 ListView Demonstration</a> (200K)</p><p class="nav"><a href="vb5_listview_full_source.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 ListView Full Source</a> (344K)</p><p /><p class="nav"><a href="vb6_listview_control.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 ListView Control</a> (85K)</p><p class="nav"><a href="vb6_listview_demonstration.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 ListView Demonstration</a> (196K)</p><p class="nav"><a href="vb6_listview_full_source.html"><img src="..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 ListView Full Source</a> (341K)</p><br /><br /><img src="..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:4089</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\linkto_asp\id=4089&type=article&title=vbaccelerator_20listview_20control.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 8 / 16</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 8 / 11</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:8 February 2004</p>
<br /><br /><img src="..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\res\update.png" width="8" height="8" alt="Update" />20 Jun 2003<br /><p class="update">Bug fixes and minor enhancements to the control:</p><p class="update">The <span class="code">Selected</span> property of
a ListItem always returned false, meaning it was impossible to 
determine which items were selected in a multi-select ListView.
Corrected. Same problem with the <span class="code">ItemCut</span>
property.</p><p class="update"><span class="code">Icon</span> property of ListItem set
the icon of the next item along in the control.  Fixed.</p><p class="update"><span class="code">Position</span> property added to the 
ColumnHeader object to allow the order of the column headers to be read
and set programmatically.</p><p class="update">Insert before parameter to the <span class="code">Add</span> method
of the ListItems collection was ignored.  Corrected.</p><p class="update">Setting a column alignment to right caused the column to be
centred, and vice-versa. Fixed.</p><p class="update">Mouse Up events were only generated for double-clicks.  Now
corrected.</p><p class="update">A <span class="code">KeyDown</span> event was generated when
a <span class="code">KeyUp</span> should have been.  Fixed</p><p class="update">Option to place the background image at a specified location
rather than tile it added.</p><p class="update"><span class="code">NoColumnHeaders</span> property added to
allow column headers to be hidden in Detail view.</p><p class="update">Added a call to <span class="code">LoadLibrary</span> on 
Shell32.DLL to prevent crashes when using a manifest.</p><p class="update">Thanks to Ben Andersen, Ian Goodwin, Vasanth Raj, Greg Thomson,
Frank Peters for the bug reports and code.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\libraries\xp_visual_styles\making_vb_apply_visual_styles_at_design_and_debug_time\article.html">Making VB Apply XP Visual Styles at Design and Debug Time</a></p><p class="nav"><img src="..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\libraries\xp_visual_styles\using_xp_visual_styles_in_vb\article.html">Adding XP Visual Styles to Your Visual Basic Application</a></p><p class="nav"><img src="..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\type_libraries\ole_guid_and_interface_definitions\article.html">Ole Guid and interface definitions (OleGuids.Tlb) </a></p><p class="nav"><img src="..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\imagelist\vbaccelerator_image_list_control\article.html">vbAccelerator ImageList Control and Class v2.0</a></p><p class="nav"><img src="..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\type_libraries\ishellfolder\article.html">IShellFolder Extended Type Library Version 1.2 (ISHF_Ex.Tlb)</a></p><br /><br /><img src="..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>Add Support for other ListView Background Image Positions</h1><h2>Summary</h2><table class="article"><tr><td>Id:</td><td>4089.2</td></tr><tr><td>Type:</td><td><img src="..\..\..\..\res\btissueclosed.png" width="16" height="16" alt="Issue" />&#160;Issue</td></tr><tr><td>Current Status:</td><td>Resolved</td></tr></table><h2>Detail</h2><table class="article"><tr class="header"><td>8&#160;May&#160;2003</td><td>Open</td><td width="100%">Ben Andersen</td></tr><tr><td colspan="3"><p>Below is primarily the code used for it. Really simple, and note that I removed the transparency bg color as this actually degrades performance of the listview as stated in the MSDN listview section.</p><p>Let me know if you have any problems. I have not looked at this code in quite a long time, and seem to recall some other changes I made as well but I this should work. I have been using it for quite some time with no issues. The only exception is that you when it resizes, depending on whether or now you have auto redraw and or clip controls you may need to refresh the control. For whatever reason the listview will not update the background fully, but this is really more of an issue with how you are painting your canvas. </p><codeChar>Public Property Get BackgroundPicture() As String</codeChar><codeChar>   BackgroundPicture = m_sPicture</codeChar><codeChar>End Property</codeChar><codeChar></codeChar><codeChar>'The Offset is primarily percentage based. 50% is centered </codeChar><codeChar>' 0% is far left, 100% is far right and so on. </codeChar><codeChar>' Or top and bottom </codeChar><codeChar>Public Property Let TileBgPicture(bTile As Boolean)</codeChar><codeChar>    m_bTileBgPic = bTile</codeChar><codeChar>    PropertyChanged "TileBgPicture"</codeChar><codeChar>End Property</codeChar><codeChar></codeChar><codeChar>Public Property Get TileBgPicture() As Boolean</codeChar><codeChar>    TileBgPicture = m_bTileBgPic</codeChar><codeChar>End Property</codeChar><codeChar></codeChar><codeChar>Public Property Let BgPicXOffset(xOffset As Long)</codeChar><codeChar>    m_lBgPicXOffset = xOffset</codeChar><codeChar>    PropertyChanged "BgPicXOffset"</codeChar><codeChar>End Property</codeChar><codeChar></codeChar><codeChar>Public Property Get BgPicXOffset() As Long</codeChar><codeChar>    BgPicXOffset = m_lBgPicXOffset</codeChar><codeChar>End Property</codeChar><codeChar></codeChar><codeChar>Public Property Let BgPicYOffset(yOffset As Long)</codeChar><codeChar>    m_lBgPicYOffset = yOffset</codeChar><codeChar>    PropertyChanged "BgPicYOffset"</codeChar><codeChar>End Property</codeChar><codeChar></codeChar><codeChar>Public Property Get BgPicYOffset() As Long</codeChar><codeChar>    BgPicYOffset = m_lBgPicYOffset</codeChar><codeChar>End Property</codeChar><codeChar></codeChar><codeChar>Public Property Let BackgroundPicture(ByVal sURL As String)</codeChar><codeChar>Dim tLBI As LVBKIMAGE</codeChar><codeChar>   m_sPicture = sURL</codeChar><codeChar>   If Not (m_hWnd = 0) Then</codeChar><codeChar>      tLBI.pszImage = sURL &amp; Chr$(0)</codeChar><codeChar>      tLBI.cchImageMax = Len(sURL) + 1</codeChar><codeChar>      If m_lBgPicXOffset &lt;&gt; 0 Then</codeChar><codeChar>        tLBI.xOffsetPercent = m_lBgPicXOffset</codeChar><codeChar>      End If</codeChar><codeChar>      If m_lBgPicYOffset &lt;&gt; 0 Then</codeChar><codeChar>        tLBI.yOffsetPercent = m_lBgPicYOffset</codeChar><codeChar>      End If</codeChar><codeChar>      If (m_bTileBgPic = False) Then</codeChar><codeChar>        tLBI.ulFlags = LVBKIF_SOURCE_URL Or LVBKIF_STYLE_NORMAL 'LVBKIF_STYLE_TILE</codeChar><codeChar>      Else</codeChar><codeChar>        tLBI.ulFlags = LVBKIF_SOURCE_URL Or LVBKIF_STYLE_TILE</codeChar><codeChar>      End If</codeChar><codeChar>      SendMessage m_hWnd, LVM_SETBKIMAGE, 0, tLBI</codeChar><codeChar>      ' Set the background colour of the ListView to &amp;HFFFFFFFF (-1)</codeChar><codeChar>      ' so it will be transparent!</codeChar><codeChar>      'SendMessageLong m_hWnd, LVM_SETTEXTBKCOLOR, 0, CLR_NONE</codeChar><codeChar>      ' it will perform worse with transparent color as </codeChar><codeChar>      ' indicated in the online api. do nothing leave it the same</codeChar><codeChar>      'SendMessageLong m_hWnd, LVM_SETBKCOLOR, 0, TranslateColor(m_oBackColor)</codeChar><codeChar>      'SendMessageLong m_hWnd, LVM_SETTEXTBKCOLOR, 0, TranslateColor(m_oBackColor)</codeChar><codeChar>   End If</codeChar><codeChar>   PropertyChanged "BackgroundPicture"</codeChar><codeChar></codeChar><codeChar>End Property </codeChar><codeChar></codeChar><codeChar>Public Property Get NoScrollBar() As Boolean</codeChar><codeChar>   NoScrollBar = m_bNoScrollBar</codeChar><codeChar>End Property</codeChar><codeChar>Public Property Let NoScrollBar(ByVal bState As Boolean)</codeChar><codeChar>   m_bNoScrollBar = bState</codeChar><codeChar></codeChar><codeChar>        If bState Then</codeChar><codeChar>           pSetStyle LVS_NOSCROLL, 0</codeChar><codeChar>        Else</codeChar><codeChar>           pSetStyle 0, LVS_NOSCROLL</codeChar><codeChar>        End If</codeChar><codeChar>        PropertyChanged "NoScrollBar"</codeChar><codeChar></codeChar><codeChar>End Property </codeChar><p>Added this to the intialize of the control:</p><codeChar>   m_bTileBgPic = False</codeChar><codeChar>   m_lBgPicXOffset = 0</codeChar><codeChar>   m_lBgPicYOffset = 0 </codeChar><p>To Read Properties:</p><codeChar>   NoColumnHeaders = PropBag.ReadProperty("NoColumnHeaders", False)</codeChar><codeChar>   TileBgPicture = PropBag.ReadProperty("TileBgPicture", False)</codeChar><codeChar>   BgPicXOffset = PropBag.ReadProperty("BgPicXOffset", 0)</codeChar><codeChar>   BgPicYOffset = PropBag.ReadProperty("BgPicYOffset", 0) </codeChar><p>Write Properties:</p><codeChar>    PropBag.WriteProperty "TileBgPicture", TileBgPicture, False</codeChar><codeChar>    PropBag.WriteProperty "BgPicXOffset", BgPicXOffset, 0</codeChar><codeChar>    PropBag.WriteProperty "BgPicYOffset", BgPicYOffset, 0</codeChar><codeChar>PropBag.WriteProperty "NoColumnHeaders", NoColumnHeaders, False</codeChar><codeChar></codeChar></td></tr><tr class="header"><td>20&#160;Jun&#160;2003</td><td>Resolved</td><td width="100%">Steve McMahon</td></tr><tr><td colspan="3"><p>Added all properties.</p></td></tr></table><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\index.html" ><IMG SRC="..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\index.html">Code</a>&#160;.&#160;<a href="..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="article.html">vbAccelerator ListView Control</a>&#160;.&#160;<a href="bugtrak.html">BugTrak Summary</a>&#160;.&#160;Add Support for other ListView Background Image Positions</p><br /><p class="nav"><a href="..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 20 June 2003</p></td><td></td></tr></table>
</body></html>