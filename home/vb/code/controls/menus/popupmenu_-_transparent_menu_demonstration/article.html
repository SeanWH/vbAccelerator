<html lang="en" >
<head>

<title>vbAccelerator - PopupMenu - Transparent Menu Demonstration</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="Windows 2000 and XP support all sorts of exciting new user interface effects, one of them being the ability
	to make Windows transparent.  For more details, visit MSDN and search for the technical article 
	'Layered Windows: A New Way to Use Translucency and Transparency Effects in Windows Applications.' This
	sample demonstrates how to use the OwnerDraw facility of the vbAccelerator PopupMenu DLL to make your 
	menus transparent too." /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Menus</a>&#160;.&#160;PopupMenu - Transparent Menu Demonstration</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_transparent_menu_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Transparent Menu Demonstration</a> (32K)</p><p /><p class="nav"><a href="vb6_transparent_menu_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Transparent Menu Demonstration</a> (31K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:743</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=743&type=article&title=popupmenu_20_2d_20transparent_20menu_20demonstration.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />25 Nov 2002<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\graphics_and_gdi\changing_window_shapes\window_shapes_using_layering\article.html">Window Shapes Using Layering</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>PopupMenu - Transparent Menu Demonstration</h1><p class="splash">Demonstrates how to create transparent menus in Windows 2000 or XP using the PopupMenu object.</p><img src="transparentmenu.png" width="351" height="221" alt="Transparent Menu Demonstration" /><p /><p>Windows 2000 and XP support all sorts of exciting new user interface effects, one of them being the ability
	to make Windows transparent.  For more details, visit MSDN and search for the technical article 
	"Layered Windows: A New Way to Use Translucency and Transparency Effects in Windows Applications." This
	sample demonstrates how to use the <i>OwnerDraw</i> facility of the vbAccelerator PopupMenu DLL to make your 
	menus transparent too.</p><h2>About Window Transparency</h2><p>There are a number of techniques for making Windows transparent, however, the simplest is to change 
	a window's style bits to add the new <i>WS_EX_LAYERED</i> style attribute.  Once this has been set, you can
	use the new layered window API <i>SetLayeredWindowAttributes</i> to modify the alpha of the window (the alpha
	defines the window's transparency, between 0 for completely transparent and 255 for opaque.)</p><p>Here is a quick overview of the code you use to change a Window's transparency:</p><pre>
' Declares:
Private Declare Function GetWindowLong Lib "USER32" Alias "GetWindowLongA" _
    (ByVal hWnd As Long, ByVal nIndex As Long) As Long
Private Declare Function SetWindowLong Lib "USER32" Alias "SetWindowLongA" _
    (ByVal hWnd As Long, ByVal nIndex As Long, _
    ByVal dwNewLong As Long) As Long
Private Const GWL_STYLE = (-16)
Private Const GWL_EXSTYLE = (-20)
'Requires Windows 2000 or later:
Private Const WS_EX_LAYERED = &amp;H80000

Private Declare Function SetLayeredWindowAttributes Lib "USER32" _
    (ByVal hWnd As Long, ByVal crKey As Long, _
    ByVal bAlpha As Byte, ByVal dwFlags As Long) As Long
Private Const LWA_COLORKEY = &amp;H1
Private Const LWA_ALPHA = &amp;H2

Public Sub MakeWindowTransparent(ByVal hWnd As Long, ByVal alphaAmount As Byte)
Dim lStyle As Long
    lStyle = GetWindowLong(hWnd, GWL_EXSTYLE)
    lStyle = lStyle Or WS_EX_LAYERED
    SetWindowLong hWnd, GWL_EXSTYLE, lStyle
    SetLayeredWindowAttributes hWnd, 0, alphaAmount, LWA_ALPHA
End Sub
</pre><p>Note that this technique only works with top-level windows, so unfortunately you cannot apply
	it to individual controls.</p><h2>Creating Transparent Menus</h2><p>In order to use this technique, you just need to know the <i>hWnd</i> of the Window you want to change.
	So how do we use this for a menu?  The answer to this is surprisingly simple.  Menus are actually
	implemented internally in Windows using a specific class of window, however, unfortunately none of the Menu
	APIs actually provide you with this window handle.  When you set a menu to OwnerDraw style, though, Windows
	passes you the <i>hDC</i> of the menu to draw onto.  This means you can find the Window handle using the
	API call <i>GetWindowFromDC</i> (note: of course it is possible in future versions of Windows that this 
	implementation could change).</p><p>Using the PopupMenu object makes it simple to create a transparent menu since you can set the <i>OwnerDraw</i>
	attribute for any menu item.  This means that the object notifies you through <i>DrawItem</i>
	event whenever an item needs to be drawn, and one of the parameters you get is the <i>hDC</i> to 
	draw onto.  If you don't do anything in these methods, PopupMenu assumes you want the menu to draw in the
	default style so just gets on with it.</p><p>So having set <i>OwnerDraw</i> to true for all menu items, we can find the window handle by calling
	<i>WindowFromDC</i> during the <i>DrawItem</i> and then setting the window to the layered style if it isn't
	already.  The only slight catch is that in Windows 2000 and XP menus can be animated when they pop open.  If
	this style is enabled, the Window and DC that you get to draw onto whilst the menu is popping open is actually 
	a temporary one which goes away.  Therefore to ensure the menu gets to be transparent as soon as it opens,
	the code stops menu animations for the popup menu it displays using the PopupMenu object <i>NoMenuAnimation</i>
	setting.</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Menus</a>&#160;.&#160;PopupMenu - Transparent Menu Demonstration</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 8 January 2003</p></td><td></td></tr></table>
</body></html>
