<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: frmMenuColourPick.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: frmMenuColourPick.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Menus</a>&#160;.&#160;<a href="article.html">Using The IconMenu Control To Create a Colour Picker</a>&#160;.&#160;<a href="iconmenu_control_color_picker_demonstration.html">IconMenu Control Color Picker Demonstration</a>&#160;.&#160;frmMenuColourPick.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="iconmenu_control_color_picker_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />IconMenu Control Color Picker Demonstration</a> (12K)</p><p class="nav"><a href="iconmenu_vb6_color_picker_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />IconMenu VB6 Color Picker Demonstration</a> (11K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:200</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=200&type=zip&title=iconmenu_20control_20color_20picker_20demonstration_2ezip_5ffrmmenucolourpick.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />10 Jan 1999<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\icon_menu_control\article.html">IconMenu Control</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\imagelist\vbaccelerator_image_list_control\article.html">vbAccelerator ImageList Control and Class v2.0</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: frmMenuColourPick.frm</h1><pre>VERSION 5.00
Object = "{8245A918-4CF7-11D2-8E21-10B404C10000}#8.0#0"; "vbalIml.ocx"
Object = "{A22D979F-2684-11D2-8E21-10B404C10000}#1.4#0"; "cPopMenu.ocx"
Begin VB.Form frmMenuColourPick 
   Caption         =   "Menu Colour Picker Demonstration"
   ClientHeight    =   4185
   ClientLeft      =   3180
   ClientTop       =   2895
   ClientWidth     =   6585
   Icon            =   "frmMenuColourPick.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   4185
   ScaleWidth      =   6585
   Begin cPopMenu.PopMenu ctlPopMenu 
      Left            =   1320
      Top             =   660
      _ExtentX        =   1058
      _ExtentY        =   1058
      HighlightCheckedItems=   0   'False
      TickIconIndex   =   0
   End
   Begin VB.CommandButton cmdShow 
      Caption         =   "&amp;Show"
      Height          =   375
      Left            =   60
      TabIndex        =   0
      Top             =   60
      Width           =   1095
   End
   Begin vbalIml.vbalImageList ilsIcons 
      Left            =   1980
      Top             =   660
      _ExtentX        =   953
      _ExtentY        =   953
      ColourDepth     =   24
      Size            =   0
      Images          =   0
   End
   Begin VB.Label lblDemo 
      BorderStyle     =   1  'Fixed Single
      Caption         =   " vbAccelerator!"
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   9.75
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   315
      Left            =   1200
      TabIndex        =   1
      Top             =   60
      Width           =   5295
   End
   Begin VB.Menu mnuColourTOP 
      Caption         =   "&amp;Colours"
      Begin VB.Menu mnuColours 
         Caption         =   "&amp;Foreground"
         Index           =   0
         Begin VB.Menu mnuForeColour 
            Caption         =   ""
         End
      End
      Begin VB.Menu mnuColours 
         Caption         =   "&amp;Background"
         Index           =   1
         Begin VB.Menu mnuBackColour 
            Caption         =   ""
         End
      End
   End
End
Attribute VB_Name = "frmMenuColourPick"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private Type RECT
   left As Long
   top As Long
   right As Long
   bottom As Long
End Type
Private Declare Function SelectObject Lib "gdi32" (ByVal hdc As Long, ByVal
 hObject As Long) As Long
Private Declare Function DeleteObject Lib "gdi32" (ByVal hObject As Long) As
 Long
Private Declare Function CreateCompatibleDC Lib "gdi32" (ByVal hdc As Long) As
 Long
Private Declare Function CreateCompatibleBitmap Lib "gdi32" (ByVal hdc As Long,
 ByVal nWidth As Long, ByVal nHeight As Long) As Long
Private Declare Function CreateSolidBrush Lib "gdi32" (ByVal crColor As Long)
 As Long
Private Declare Function FillRect Lib "user32" (ByVal hdc As Long, lpRect As
 RECT, ByVal hBrush As Long) As Long
Private Declare Function CreateDCAsNull Lib "gdi32" Alias "CreateDCA" (ByVal
 lpDriverName As String, lpDeviceName As Any, lpOutput As Any, lpInitData As
 Any) As Long
Private Declare Function DeleteDC Lib "gdi32" (ByVal hdc As Long) As Long
Private Declare Function BitBlt Lib "gdi32" (ByVal hDestDC As Long, ByVal x As
 Long, ByVal y As Long, ByVal nWidth As Long, ByVal nHeight As Long, ByVal
 hSrcDC As Long, ByVal xSrc As Long, ByVal ySrc As Long, ByVal dwRop As Long)
 As Long
Private Declare Function GetSysColorBrush Lib "user32" (ByVal nIndex As Long)
 As Long
Private Const COLOR_MENU = 4

Private Sub MakeColourChart()
Dim lhDCDesk As Long
Dim lhDC As Long
Dim lhBmp As Long
Dim lhBmpOld As Long
Dim lColourDepth As Long
Dim tR As RECT, tTR As RECT
Dim lWidth As Long
Dim i As Long, r As Long, g As Long, b As Long
Dim hBrush As Long
   
   lColourDepth = ilsIcons.SystemColourDepth
   If (lColourDepth &lt;= 8) Then
      ilsIcons.ColourDepth = ILC_COLOR
      lWidth = 16
   Else
      ilsIcons.ColourDepth = ILC_COLOR24
      lWidth = 232
   End If
   
   ' Make a compatible DC:
   lhDC = CreateCompatibleDC(Me.hdc)
   DeleteDC lhDCDesk
   lhBmp = CreateCompatibleBitmap(Me.hdc, lWidth * ilsIcons.IconSizeX,
    ilsIcons.IconSizeY)
   lhBmpOld = SelectObject(lhDC, lhBmp)
   tR.bottom = ilsIcons.IconSizeY
   tR.left = 0
   tR.right = lWidth * ilsIcons.IconSizeX
   hBrush = GetSysColorBrush(COLOR_MENU)
   FillRect lhDC, tR, hBrush
   DeleteObject hBrush
   tR.right = ilsIcons.IconSizeX - 1
   For i = 1 To 16
      hBrush = CreateSolidBrush(QBColor(i - 1))
      FillRect lhDC, tR, hBrush
      DeleteObject hBrush
      tR.left = tR.left + ilsIcons.IconSizeX
      tR.right = tR.left + ilsIcons.IconSizeX
   Next i
   If (lWidth &gt; 16) Then
      ReDim lColors(0 To 5) As Long
      lColors(0) = &amp;H0
      lColors(1) = &amp;H33
      lColors(2) = &amp;H66
      lColors(3) = &amp;H99
      lColors(4) = &amp;HCC
      lColors(5) = &amp;HFF
      For r = 0 To 5
         For g = 0 To 5
            For b = 0 To 5
               hBrush = CreateSolidBrush(RGB(lColors(r), lColors(g),
                lColors(b)))
               LSet tTR = tR
               tTR.right = tTR.right - 2
               tTR.bottom = tTR.bottom - 1
               FillRect lhDC, tTR, hBrush
               DeleteObject hBrush
               tR.left = tR.left + ilsIcons.IconSizeX
               tR.right = tR.left + ilsIcons.IconSizeX
            Next b
         Next g
      Next r
   End If
   
   SelectObject lhDC, lhBmpOld
   
   ilsIcons.AddFromHandle lhBmp, IMAGE_BITMAP, , vbMenuBar

   DeleteObject lhBmp
   DeleteObject lhDC

End Sub

Private Sub Command1_Click()
Dim x As Long
Dim y As Long
Dim i As Long
   y = (cmdShow.top + cmdShow.Height * 2) \ Screen.TwipsPerPixelY
   x = 16
   For i = 1 To ilsIcons.ImageCount
      ilsIcons.DrawImage i, Me.hdc, x, y
      x = x + 18
      If (x &gt; Me.ScaleWidth \ Screen.TwipsPerPixelX - 16) Then
         x = 16
         y = y + 18
      End If
   Next i
End Sub

Private Sub cmdShow_Click()
Dim lR As Long
   lR = ctlPopMenu.ShowPopupMenu(cmdShow, "mnuColours(0)", 0, cmdShow.Height)
End Sub

Private Sub ctlPopMenu_Click(ItemNumber As Long)
Dim sKey As String
Dim iItem As Long
Dim i As Long

   sKey = ctlPopMenu.MenuKey(ItemNumber)
   If InStr(sKey, "ForeColour") &lt;&gt; 0 Then
      iItem = CLng(Mid$(sKey, 11))
      ctlPopMenu.Checked(ItemNumber) = True
      lblDemo.ForeColor = ctlPopMenu.ItemData(ItemNumber)
      For i = 1 To ilsIcons.ImageCount
         If (iItem &lt;&gt; i) Then
            ctlPopMenu.Checked("ForeColour" &amp; i) = False
         End If
      Next i
   ElseIf InStr(sKey, "BackColour") &lt;&gt; 0 Then
      iItem = CLng(Mid$(sKey, 11))
      ctlPopMenu.Checked(ItemNumber) = True
      lblDemo.BackColor = ctlPopMenu.ItemData(ItemNumber)
      For i = 1 To ilsIcons.ImageCount
         If (iItem &lt;&gt; i) Then
            ctlPopMenu.Checked("BackColour" &amp; i) = False
         End If
      Next i
   End If
End Sub
Private Sub AddColours(ByVal sKeyBit As String, ByVal lParentIndex As Long)
Dim sPrefix As String
Dim i As Long
Dim r As Long, g As Long, b As Long
Dim lIndex As Long
   
   ReDim lColors(0 To 5) As Long
   lColors(0) = &amp;H0
   lColors(1) = &amp;H33
   lColors(2) = &amp;H66
   lColors(3) = &amp;H99
   lColors(4) = &amp;HCC
   lColors(5) = &amp;HFF

   With ctlPopMenu
      .ClearSubMenusOfItem lParentIndex
      For i = 1 To ilsIcons.ImageCount
         If ((i - 1) Mod 12) = 0 Then
            sPrefix = "^"
         Else
            sPrefix = ""
         End If
         lIndex = .AddItem(sPrefix, sKeyBit &amp; "Colour" &amp; i, , , lParentIndex, i
          - 1)
         If (i &lt; 17) Then
            .ItemData(lIndex) = QBColor(i - 1)
         Else
            .ItemData(lIndex) = RGB(lColors(r), lColors(g), lColors(b))
            b = b + 1
            If (b = 6) Then
               b = 0
               g = g + 1
               If (g = 6) Then
                  g = 0
                  r = r + 1
               End If
            End If
         End If
      Next i
   End With
   
End Sub

Private Sub Form_Load()
Dim lParent As Long

   MakeColourChart
   With ctlPopMenu
      .SubClassMenu Me
      .ImageList = ilsIcons.hIml
      lParent = .MenuIndex("mnuColours(0)")
      AddColours "Fore", lParent
      lParent = .MenuIndex("mnuColours(1)")
      AddColours "Back", lParent
   End With
   
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Menus</a>&#160;.&#160;<a href="article.html">Using The IconMenu Control To Create a Colour Picker</a>&#160;.&#160;<a href="iconmenu_control_color_picker_demonstration.html">IconMenu Control Color Picker Demonstration</a>&#160;.&#160;frmMenuColourPick.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>