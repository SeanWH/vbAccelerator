<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: mfrmTest.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: mfrmTest.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Menus</a>&#160;.&#160;<a href="article.html">vbAccelerator IconMenu DLL</a>&#160;.&#160;<a href="vb5_icon_menu_dll_full_source.html">VB5 Icon Menu DLL Full Source</a>&#160;.&#160;mfrmTest.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_icon_menu_dll_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Icon Menu DLL Demonstration</a> (61K)</p><p class="nav"><a href="vb5_icon_menu_dll_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Icon Menu DLL Full Source</a> (106K)</p><p class="nav"><a href="vb5_iconmenu_dll_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 IconMenu DLL Binary</a> (20K)</p><p /><p class="nav"><a href="vb6_iconmenu_dll_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 IconMenu DLL Binary</a> (21K)</p><p class="nav"><a href="vb6_iconmenu_dll_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 IconMenu DLL Demonstration</a> (58K)</p><p class="nav"><a href="vb6_iconmenu_dll_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 IconMenu DLL Full Source</a> (101K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:4820</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=4820&type=zip&title=vb5_20icon_20menu_20dll_20full_20source_2ezip_5fmfrmtest.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />28 Mar 2003<br /><p class="update">Added Office XP Menu style</p><p class="update">Added VB6 ImageList Compatibility for XP, and fixed bug
with disabling of icons for MS Image Lists.</p><p class="update">Tidied sample code up.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\popup_menu_activex_dll\article.html">PopupMenu DLL - Create Unlimited Popup Menus</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\skins\article.html">vbAccelerator NeoCaption Component v2.0</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\icon_menu_control\article.html">IconMenu Control</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\imagelist\vbaccelerator_image_list_control\article.html">vbAccelerator ImageList Control and Class v2.0</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: mfrmTest.frm</h1><pre>VERSION 5.00
Object = "{8245A918-4CF7-11D2-8E21-10B404C10000}#8.1#0"; "vbalIml.ocx"
Begin VB.MDIForm mfrmMDITest 
   BackColor       =   &amp;H8000000C&amp;
   Caption         =   "Test PopMenu Control in MDI Form"
   ClientHeight    =   5040
   ClientLeft      =   4920
   ClientTop       =   3150
   ClientWidth     =   6870
   Icon            =   "mfrmTest.frx":0000
   LinkTopic       =   "MDIForm1"
   Begin VB.PictureBox picStatus 
      Align           =   2  'Align Bottom
      BorderStyle     =   0  'None
      Height          =   315
      Left            =   0
      ScaleHeight     =   315
      ScaleWidth      =   6870
      TabIndex        =   0
      Top             =   4725
      Width           =   6870
      Begin VB.Label lblStatus 
         Height          =   255
         Left            =   60
         TabIndex        =   1
         Top             =   60
         Width           =   6795
      End
   End
   Begin vbalIml.vbalImageList ilsIcons 
      Left            =   120
      Top             =   60
      _ExtentX        =   953
      _ExtentY        =   953
      ColourDepth     =   4
      Size            =   19740
      Images          =   "mfrmTest.frx":030A
      KeyCount        =   21
      Keys            =   $"mfrmTest.frx":5046
   End
   Begin VB.Menu mnuFileTOP 
      Caption         =   "&amp;File"
      Begin VB.Menu mnuFile 
         Caption         =   "&amp;New..."
         Index           =   0
         Shortcut        =   ^N
      End
      Begin VB.Menu mnuFile 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuFile 
         Caption         =   "&amp;Open..."
         Index           =   2
         Shortcut        =   ^O
      End
      Begin VB.Menu mnuFile 
         Caption         =   "&amp;Save..."
         Index           =   3
         Shortcut        =   ^S
      End
      Begin VB.Menu mnuFile 
         Caption         =   "Save &amp;As"
         Index           =   4
      End
      Begin VB.Menu mnuFile 
         Caption         =   "-"
         Index           =   5
      End
      Begin VB.Menu mnuFile 
         Caption         =   "&amp;Print"
         Index           =   6
         Shortcut        =   ^P
      End
      Begin VB.Menu mnuFile 
         Caption         =   "Print Pre&amp;view"
         Index           =   7
      End
      Begin VB.Menu mnuFile 
         Caption         =   "-"
         Index           =   8
      End
      Begin VB.Menu mnuFile 
         Caption         =   "P&amp;roperties"
         Index           =   9
      End
      Begin VB.Menu mnuFile 
         Caption         =   "-"
         Index           =   10
      End
      Begin VB.Menu mnuFile 
         Caption         =   "E&amp;xit"
         Index           =   11
      End
   End
   Begin VB.Menu mnuWindowTOP 
      Caption         =   "&amp;Window"
      WindowList      =   -1  'True
      Begin VB.Menu mnuWindow 
         Caption         =   "&amp;Cascade"
         Index           =   0
      End
      Begin VB.Menu mnuWindow 
         Caption         =   "Tile &amp;Horizontally"
         Index           =   1
      End
      Begin VB.Menu mnuWindow 
         Caption         =   "Tile &amp;Vertically"
         Index           =   2
      End
      Begin VB.Menu mnuWindow 
         Caption         =   "Close &amp;All"
         Index           =   3
      End
      Begin VB.Menu mnuWindow 
         Caption         =   "-"
         Index           =   4
      End
      Begin VB.Menu mnuWindow 
         Caption         =   "&amp;Next Window"
         Index           =   5
      End
      Begin VB.Menu mnuWindow 
         Caption         =   "&amp;Previous Window"
         Index           =   6
      End
   End
   Begin VB.Menu mnuHelpTOP 
      Caption         =   "&amp;Help"
      Begin VB.Menu mnuHelp 
         Caption         =   "&amp;Contents..."
         Index           =   0
         Shortcut        =   {F1}
      End
      Begin VB.Menu mnuHelp 
         Caption         =   "-"
         Index           =   1
      End
      Begin VB.Menu mnuHelp 
         Caption         =   "&amp;About..."
         Index           =   2
      End
   End
End
Attribute VB_Name = "mfrmMDITest"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private cIM As New cIconMenu

Private m_lAboutId As Long
Private Declare Function SendMessageLong Lib "user32" Alias "SendMessageA"
 (ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Long, ByVal lParam As
 Long) As Long
Private Const WM_MDINEXT = &amp;H224
Private Declare Function FindWindowEx Lib "user32" Alias "FindWindowExA" (ByVal
 hWnd1 As Long, ByVal hWnd2 As Long, ByVal lpsz1 As String, ByVal lpsz2 As
 String) As Long

Private Function GetMDIClienthWnd() As Long
   GetMDIClienthWnd = FindWindowEx(Me.hwnd, 0, "MDIClient", vbNullString)
End Function

Private Sub ctlPopMenu_InitPopupMenu(ParentItemNumber As Long)
'Dim lIcon As Long
'Dim i As Long
'Dim sKey As String
'Dim iCount As Long
'Dim bCheck As Boolean
'Dim bFIrst As Boolean
'Dim iWInCOunt As Long
'Dim sCap As String
'
'    If (ctlPopMenu.MenuKey(ParentItemNumber) = "mnuWindowTOP") Then
'         build a window menu:
'        With ctlPopMenu
'            .ClearSubMenusOfItem ParentItemNumber
'
'            lIcon = ilsIcons.ListImages("CASCADEH").Index - 1
'            .AddItem "&amp;Tile", "winTILE", , -8001, ParentItemNumber, lIcon,
 False, True
'            lIcon = ilsIcons.ListImages("CASCADE").Index - 1
'            .AddItem "&amp;Cascade", "winCASCADE", , -8002, ParentItemNumber,
 lIcon, False, True
'            lIcon = ilsIcons.ListImages("MAXIMISE").Index - 1
'            .AddItem "Maximise &amp;All", "winMAXIMISE", , -8003,
 ParentItemNumber, lIcon, False, True
'            lIcon = ilsIcons.ListImages("MINIMISE").Index - 1
'            .AddItem "Mini&amp;mise All", "winMINIMISE", , -8004,
 ParentItemNumber, lIcon, False, True
'            For i = 0 To Forms.Count - 1
'               If Not (Forms(i) Is Me) Then
'                  If (Forms(i).Visible And Forms(i).MDIChild) Then
'                     iCount = iCount + 1
'                  End If
'               End If
'            Next i
'            .AddItem "-", , , -8005, ParentItemNumber
'            lIcon = ilsIcons.ListImages("NEXTWIN").Index - 1
'            .AddItem "Ne&amp;xt" &amp; vbTab &amp; "Ctrl-F6", "winNEXT", , -8006,
 ParentItemNumber, lIcon, False, (iCount &gt; 1)
'            lIcon = ilsIcons.ListImages("PREVWIN").Index - 1
'            .AddItem "Pre&amp;vious" &amp; vbTab &amp; "Shift-Ctrl-F6", "winPREVIOUS", ,
 -8007, ParentItemNumber, lIcon, False, (iCount &gt; 1)
'
'            bFIrst = True
'            For i = 0 To Forms.Count - 1
'               If Not (Forms(i) Is Me) Then
'                  If (Forms(i).Visible) And (Forms(i).MDIChild) Then
'                     If (Forms(i) Is Me.ActiveForm) Then
'                        bCheck = True
'                     Else
'                        bCheck = False
'                     End If
'                     sKey = Forms(i).Name
'                     On Error Resume Next
'                     lIcon = ilsIcons.ListImages(sKey).Index - 1
'                     If (Err.Number &lt;&gt; 0) Then
'                        Err.Clear
'                        ilsIcons.ListImages.Add , Forms(i).Name, Forms(i).Icon
'                        lIcon = ilsIcons.ListImages(Forms(i).Name).Index - 1
'                     End If
'                     If (bFIrst) Then
'                        .AddItem "-", , , -8008, ParentItemNumber
'                        bFIrst = False
'                     End If
'                     iWInCOunt = iWInCOunt + 1
'                     sCap = GetCaption(Forms(i).Caption)
'                     .AddItem "&amp;" &amp; CStr(iWInCOunt) &amp; " )  " &amp; sCap,
 "winFORM:" &amp; (i), , (-8009 - i), ParentItemNumber, lIcon, bCheck, True
'                  End If
'               End If
'            Next i
'      End With
'    End If
End Sub

Private Sub ctlPopMenu_ItemHighlight(ItemNumber As Long, bEnabled As Boolean,
 bSeparator As Boolean)
'   If Not (bSeparator) Then
'      lblStatus.Caption = "Highlighted " &amp; ctlPopMenu.Caption(ItemNumber)
'   End If
End Sub

Private Sub ctlPopMenu_MenuExit()
   lblStatus.Caption = ""
End Sub

Private Sub ctlPopMenu_SystemMenuClick(ItemNumber As Long)
    If (ItemNumber = m_lAboutId) Then
        MsgBox "vbAccelerator PopMenu component MDI demonstration.",
         vbInformation
    End If
End Sub

Private Sub MDIForm_Load()
Dim l As Long
Dim lIndex As Long
Dim lC As Long
   
   With cIM
      .attach Me.hwnd
      .ImageList = ilsIcons
      .IconIndex(mnuFile(0).Caption) = ilsIcons.ItemIndex("NEW")
      .IconIndex(mnuFile(2).Caption) = ilsIcons.ItemIndex("OPEN")
      .IconIndex(mnuFile(3).Caption) = ilsIcons.ItemIndex("SAVE")
      .IconIndex(mnuFile(6).Caption) = ilsIcons.ItemIndex("PRINT")
      .IconIndex(mnuFile(7).Caption) = ilsIcons.ItemIndex("FIND_DOC")
      
      .IconIndex(mnuWindow(0).Caption) = ilsIcons.ItemIndex("CASCADE")
      .IconIndex(mnuWindow(1).Caption) = ilsIcons.ItemIndex("TILEHORZ")
      .IconIndex(mnuWindow(2).Caption) = ilsIcons.ItemIndex("TILEVERT")
      .IconIndex(mnuWindow(3).Caption) = ilsIcons.ItemIndex("KILLWIN")
      .IconIndex(mnuWindow(5).Caption) = ilsIcons.ItemIndex("NEXTWIN")
      .IconIndex(mnuWindow(6).Caption) = ilsIcons.ItemIndex("PREVWIN")
      .IconIndex("&amp;More Windows...") = ilsIcons.ItemIndex("MOREWINS")

      .IconIndex(mnuHelp(0).Caption) = ilsIcons.ItemIndex("HELP")

   End With
   mnuFile_Click 0
   
End Sub

Private Sub mnuFile_Click(Index As Integer)
   Select Case Index
   Case 0
      Dim f As frmMDIChild
      Set f = New frmMDIChild
      f.Show
   Case 2
   Case 3
   Case 4
   Case 6
   Case 7
   Case 9
   Case 11
      Unload Me
   End Select
End Sub

Private Sub mnuFileTOP_Click()
Dim bS As Boolean
   bS = Not (Me.ActiveForm Is Nothing)
   mnuFile(3).Enabled = bS
   mnuFile(4).Enabled = bS
   mnuFile(6).Enabled = bS
   mnuFile(7).Enabled = bS
   mnuFile(9).Enabled = bS
End Sub

Private Sub mnuWindow_Click(Index As Integer)
Dim lhWNd As Long
   Select Case Index
   Case 0
      Me.Arrange vbCascade
   Case 1
      Me.Arrange vbTileHorizontal
   Case 2
      Me.Arrange vbTileVertical
   Case 3
      Dim f As Object
      For Each f In Forms
         On Error Resume Next
         If f.MDIChild Then
            If Err.Number = 0 Then
               Unload f
            End If
         End If
         Err.Clear
      Next
   Case 5
      lhWNd = GetMDIClienthWnd()
      SendMessageLong lhWNd, WM_MDINEXT, 0, 0
   Case 6
      lhWNd = GetMDIClienthWnd()
      SendMessageLong lhWNd, WM_MDINEXT, 0, 1
   End Select
End Sub

Private Sub mnuWindowTOP_Click()
Dim f As Object
Dim l As Long
   For Each f In Forms
      On Error Resume Next
      If f.MDIChild Then
         If Err.Number = 0 Then
            l = l + 1
         End If
      End If
      Err.Clear
   Next
   mnuWindow(0).Enabled = (l &gt; 0)
   mnuWindow(1).Enabled = (l &gt; 0)
   mnuWindow(2).Enabled = (l &gt; 0)
   mnuWindow(3).Enabled = (l &gt; 0)
   mnuWindow(5).Enabled = (l &gt; 1)
   mnuWindow(6).Enabled = (l &gt; 1)
End Sub

</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\libraries\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Menus</a>&#160;.&#160;<a href="article.html">vbAccelerator IconMenu DLL</a>&#160;.&#160;<a href="vb5_icon_menu_dll_full_source.html">VB5 Icon Menu DLL Full Source</a>&#160;.&#160;mfrmTest.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>