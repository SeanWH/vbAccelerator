<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: fODMenu.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: fODMenu.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Menus</a>&#160;.&#160;<a href="article.html">Owner-Draw Pop-up Menus</a>&#160;.&#160;<a href="vb6_ownerdraw_menus_demonstration.html">VB6 OwnerDraw Menus Demonstration</a>&#160;.&#160;fODMenu.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_ownerdraw_menus_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 OwnerDraw Menus Demonstration</a> (22K)</p><p /><p class="nav"><a href="vb6_ownerdraw_menus_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 OwnerDraw Menus Demonstration</a> (18K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:353</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=353&type=zip&title=vb6_20ownerdraw_20menus_20demonstration_2ezip_5ffodmenu.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />13 Feb 1999<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: fODMenu.frm</h1><pre>VERSION 5.00
Begin VB.Form fODMenu 
   Caption         =   "Popup Menu Owner Draw Style Demonstration"
   ClientHeight    =   3195
   ClientLeft      =   3855
   ClientTop       =   2460
   ClientWidth     =   5925
   Icon            =   "fODMenu.frx":0000
   LinkTopic       =   "Form1"
   ScaleHeight     =   3195
   ScaleWidth      =   5925
   Begin VB.CommandButton cmdHighlight 
      Caption         =   "&amp;Highlight"
      BeginProperty Font 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   1260
      TabIndex        =   2
      Top             =   720
      Width           =   1035
   End
   Begin VB.PictureBox picDemo 
      BackColor       =   &amp;H80000005&amp;
      FillColor       =   &amp;H80000005&amp;
      Height          =   1275
      Left            =   60
      ScaleHeight     =   1215
      ScaleWidth      =   5715
      TabIndex        =   1
      TabStop         =   0   'False
      Top             =   1260
      Width           =   5775
   End
   Begin VB.CommandButton cmdLinePicker 
      Caption         =   "&amp;Line Style"
      BeginProperty Font 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   60
      TabIndex        =   0
      Top             =   720
      Width           =   1155
   End
   Begin VB.Label lblInfo 
      Caption         =   "Click either of the two buttons below to demonstrate
       menus drawn entirely within the code of this form:"
      BeginProperty Font 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   555
      Left            =   60
      TabIndex        =   3
      Top             =   120
      Width           =   5775
   End
   Begin VB.Image imgPointNow 
      Height          =   480
      Left            =   300
      Picture         =   "fODMenu.frx":1272
      Top             =   2640
      Visible         =   0   'False
      Width           =   480
   End
   Begin VB.Image imgPoint 
      Height          =   480
      Left            =   60
      Picture         =   "fODMenu.frx":157C
      Top             =   2640
      Visible         =   0   'False
      Width           =   480
   End
   Begin VB.Image imgTick 
      Height          =   480
      Left            =   480
      Picture         =   "fODMenu.frx":1886
      Top             =   2640
      Visible         =   0   'False
      Width           =   480
   End
End
Attribute VB_Name = "fODMenu"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private Declare Function GetClientRect Lib "user32" (ByVal hwnd As Long, lpRect
 As RECT) As Long
Private m_sCurrentMenu As String

Private WithEvents c As cPopupMenu
Attribute c.VB_VarHelpID = -1

Private Sub pDrawLine(ByVal hdc As Long, ByVal lMenuIndex As Long, ByRef tR As
 RECT, ByVal lColor As Long)
Dim iLineWidth As Long
Dim iLineStyle As Long
Dim lY As Long

   iLineStyle = c.ItemData(lMenuIndex)
   iLineWidth = c.ItemKey(lMenuIndex)
   Select Case iLineStyle
   Case 1
      ' single line:
      lY = tR.tOp + (tR.Bottom - tR.tOp) \ 2 - 2
      pDrawOneLine hdc, tR.left, tR.Right, lY, (iLineWidth \ 100), , lColor
   Case 2
      ' two thin lines:
      lY = tR.tOp + (tR.Bottom - tR.tOp) \ 2 - 2
      lY = lY - 1
      pDrawOneLine hdc, tR.left, tR.Right, lY, 1, , lColor
      lY = lY + 1
      pDrawOneLine hdc, tR.left, tR.Right, lY, 1, , lColor
   Case 3
      ' thin then thick:
      lY = tR.tOp + (tR.Bottom - tR.tOp) \ 2 - 2
      lY = lY - 2
      pDrawOneLine hdc, tR.left, tR.Right, lY, 1, , lColor
      lY = lY + 3
      pDrawOneLine hdc, tR.left, tR.Right, lY, 2, , lColor
   Case 4
      ' thick then thin:
      lY = tR.tOp + (tR.Bottom - tR.tOp) \ 2 - 2
      lY = lY - 2
      pDrawOneLine hdc, tR.left, tR.Right, lY, 2, , lColor
      lY = lY + 2
      pDrawOneLine hdc, tR.left, tR.Right, lY, 1, , lColor
   Case 5
      ' thin-thick-thin
      lY = tR.tOp + (tR.Bottom - tR.tOp) \ 2 - 2
      lY = lY - 3
      pDrawOneLine hdc, tR.left, tR.Right, lY, 1, , lColor
      lY = lY + 3
      pDrawOneLine hdc, tR.left, tR.Right, lY, 2, , lColor
      lY = lY + 2
      pDrawOneLine hdc, tR.left, tR.Right, lY, 1, , lColor
   End Select
   
End Sub

Private Sub pDrawOneLine(ByVal hdc As Long, ByVal lXStart As Long, ByVal lXEnd
 As Long, ByVal lY As Long, ByVal lWidth As Long, Optional ByVal lStyle As Long
 = PS_SOLID, Optional ByVal lColor As Long = COLOR_WINDOWTEXT)
Dim hPen As Long
Dim hPenOld As Long
Dim tP As POINTAPI
Dim tLB As LOGBRUSH

   tLB.lbColor = GetSysColor(lColor)
   hPen = ExtCreatePen(PS_GEOMETRIC Or PS_ENDCAP_FLAT Or lStyle, lWidth, tLB,
    0, ByVal 0&amp;)
   hPenOld = SelectObject(hdc, hPen)
   BeginPath hdc
   MoveToEx hdc, lXStart, lY, tP
   LineTo hdc, lXEnd, lY
   EndPath hdc
   StrokePath hdc
   SelectObject hdc, hPenOld
   DeleteObject hPen

End Sub
Private Sub pDrawSelectedLine(ByVal lMenuIndex As Long, ByVal lColor As Long)
Dim tR As RECT
   picDemo.Cls
   GetClientRect picDemo.hwnd, tR
   InflateRect tR, -4, -4
   pDrawLine picDemo.hdc, lMenuIndex, tR, lColor
End Sub

Private Sub c_DrawItem(ByVal hdc As Long, ByVal lMenuIndex As Long, lLeft As
 Long, lTop As Long, lRight As Long, lBottom As Long, ByVal bSelected As
 Boolean, ByVal bChecked As Boolean, ByVal bDisabled As Boolean, bDoDefault As
 Boolean)
Dim tR As RECT
Dim tTXR As RECT
Dim sText As String
Dim hBrush As Long
Dim lColor As Long

   ' This event is sent whenever the menu wants to draw an item.
   bDoDefault = False
   
   ' First, set backmode to transparent and store the rectangle:
   SetBkMode hdc, TRANSPARENT
   tR.left = lLeft
   tR.tOp = lTop
   tR.Bottom = lBottom
   tR.Right = lRight
   
   ' Fill the background of the menu:
   If (bSelected) Then
       hBrush = CreateSolidBrush(GetSysColor(COLOR_HIGHLIGHT))
       lColor = COLOR_HIGHLIGHTTEXT
       SetTextColor hdc, GetSysColor(lColor)
   Else
       hBrush = CreateSolidBrush(GetSysColor(COLOR_MENU))
       lColor = COLOR_MENUTEXT
       SetTextColor hdc, GetSysColor(lColor)
   End If
   FillRect hdc, tR, hBrush
   DeleteObject hBrush
      
   ' If the item to be drawn is a real menu item:
   If (lMenuIndex &lt;&gt; -1) Then
   
      ' Draw as required:
      Select Case m_sCurrentMenu
      Case "LineStyle"
         
         sText = c.Caption(lMenuIndex)
         LSet tTXR = tR
         tTXR.left = tTXR.left + tTXR.Bottom - tTXR.tOp
         tTXR.Right = tTXR.left + 24
         DrawText hdc, sText, -1, tTXR, DT_LEFT
         
         If (c.Checked(lMenuIndex)) Then
            DrawIcon hdc, tR.left + 2, tR.tOp + (tR.Bottom - tR.tOp - 14) \ 2,
             imgTick.Picture.Handle
         End If
         
         tR.left = tTXR.Right
         tR.Right = tR.Right - 4
             
         pDrawLine hdc, lMenuIndex, tR, lColor
         
      Case "Highlight"
         InflateRect tR, -1, -1
         tR.left = tR.left + 16
         If bSelected Then
            If c.Checked(lMenuIndex) Then
               DrawIcon hdc, tR.left - 14, tR.tOp + (tR.Bottom - tR.tOp - 14) \
                2, imgPointNow.Picture.Handle
            Else
               DrawIcon hdc, tR.left - 14, tR.tOp + (tR.Bottom - tR.tOp - 14) \
                2, imgPoint.Picture.Handle
            End If
         Else
            If c.Checked(lMenuIndex) Then
               DrawIcon hdc, tR.left - 14, tR.tOp + (tR.Bottom - tR.tOp - 14) \
                2, imgTick.Picture.Handle
            End If
         End If
         If bSelected Or c.Caption(lMenuIndex) = "None" Then
            DrawEdge hdc, tR, BDR_SUNKENOUTER, BF_RECT
            InflateRect tR, -1, -1
         End If
         hBrush = CreateSolidBrush(c.ItemData(lMenuIndex))
         FillRect hdc, tR, hBrush
         DeleteObject hBrush
         If c.Caption(lMenuIndex) = "None" Then
            SetTextColor hdc, GetSysColor(vb3DDKShadow And &amp;H1F&amp;)
            tR.left = tR.left + 2
            DrawText hdc, "None", 4, tR, DT_VCENTER Or DT_SINGLELINE
         End If

      End Select
   End If
    

End Sub

Private Sub c_MeasureItem(ByVal lMenuIndex As Long, lWidth As Long, lHeight As
 Long)
   ' This event is fired whenever the cNewMenu DLL is about to show
   ' a menu item for the first time.  The DLL will fill in Width and
   ' Height based on the caption and assuming there is an icon to
   ' the left of the caption.
   
   ' Here we Override the default width and height properties for the
   ' menu items:
   lWidth = (cmdLinePicker.Width * 2) \ Screen.TwipsPerPixelX
   lHeight = lHeight - 4
   
End Sub

Private Sub cmdHighlight_Click()
Dim lR As Long
Dim i As Long
   ' Restore the highlight menu:
   m_sCurrentMenu = "Highlight"
   ' Set a flag so we know what to do during the DrawItem event:
   c.Restore m_sCurrentMenu
   ' Show it:
   lR = c.ShowPopupMenu(cmdHighlight.left, cmdHighlight.tOp +
    cmdHighlight.Height)
   If (lR &gt; 0) Then
      ' If we clicked an item, set it checked and display the demo
      ' on screen:
      For i = 1 To c.Count
         c.Checked(i) = (i = lR)
      Next i
      ' We need to save the state so the checked states are stored:
      c.Store "Highlight"
      ' Show the demo:
      If (c.Caption(lR) = "None") Then
         picDemo.BackColor = vbWindowBackground
      Else
         picDemo.BackColor = c.ItemData(lR)
      End If
   End If
   
End Sub

Private Sub cmdLinePicker_Click()
Dim lR As Long
Dim i As Long
   ' Restore the linestyle menu:
   m_sCurrentMenu = "LineStyle"
   ' Set a flag so we know what to do during the DrawItem event:
   c.Restore m_sCurrentMenu
   lR = c.ShowPopupMenu(cmdLinePicker.left, cmdLinePicker.tOp +
    cmdLinePicker.Height)
   If (lR &gt; 0) Then
      ' If we clicked an item, set it checked and display the demo
      ' on screen:
      For i = 1 To c.Count
         c.Checked(i) = (i = lR)
      Next i
      ' We need to save the state so the checked states are stored:
      c.Store "LineStyle"
      ' Show the demo:
      pDrawSelectedLine lR, COLOR_MENUTEXT
   End If
   
End Sub


Private Sub Form_Load()
Dim i As Long

   Set c = New cPopupMenu
   With c
      .hWndOwner = Me.hwnd
      
      ' Create menus for line style picker:
      .AddItem "", , 1, bChecked:=True, sKey:="25"
      .AddItem "", , 1, sKey:="50"
      .AddItem "", , 1, sKey:="75"
      .AddItem "1", , 1, sKey:="100"
      .AddItem "1", , 1, sKey:="150"
      .AddItem "2", , 1, sKey:="225"
      .AddItem "3", , 1, sKey:="300"
      .AddItem "4", , 1, sKey:="450"
      .AddItem "6", , 1, sKey:="600"
      
      .AddItem "3", , 2, sKey:="100"
      .AddItem "4", , 3, sKey:="150"
      .AddItem "4", , 4, sKey:="150"
      .AddItem "6", , 5, sKey:="150"
        
      ' Set all the items to Owner-Draw:
      For i = 1 To c.Count
         c.OwnerDraw(i) = True
      Next i
      ' Show a sample line:
      pDrawSelectedLine 1, COLOR_MENUTEXT
      ' Store this menu:
      .Store "LineStyle"
      
      ' Clear to create a menu for highlight:
      .Clear
      .AddItem "None", , GetSysColor(COLOR_MENU)
      .AddItem "", , &amp;H80FFFF
      .AddItem "", , &amp;H80FF80
      .AddItem "", , &amp;HFFFF00
      .AddItem "", , &amp;HFF00FF
      ' Set all items to Owner-Draw:
      For i = 1 To c.Count
         c.OwnerDraw(i) = True
      Next i
      ' Store this menu:
      .Store "Highlight"
   End With
End Sub

</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\libraries\compression\index.html" ><IMG SRC="..\..\..\..\..\res\compress.png" ALT="Create and read Zip files and compress your data using Zlib" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Menus</a>&#160;.&#160;<a href="article.html">Owner-Draw Pop-up Menus</a>&#160;.&#160;<a href="vb6_ownerdraw_menus_demonstration.html">VB6 OwnerDraw Menus Demonstration</a>&#160;.&#160;fODMenu.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 April 2003</p></td><td></td></tr></table>
</body></html>