<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: mfrmMain.frm</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: mfrmMain.frm" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Toolbar</a>&#160;.&#160;<a href="article.html">vbAccelerator Office Docking Bar Control</a>&#160;.&#160;<a href="vb6_officebar_full_source.html">VB6 OfficeBar Full Source</a>&#160;.&#160;mfrmMain.frm</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_officebar_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 OfficeBar Binary</a> (35K)</p><p class="nav"><a href="vb5_officebar_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 OfficeBar Demonstration</a> (68K)</p><p class="nav"><a href="vb5_officebar_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 OfficeBar Full Source</a> (138K)</p><p /><p class="nav"><a href="vb6_officebar_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 OfficeBar Binary</a> (35K)</p><p class="nav"><a href="vb6_officebar_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 OfficeBar Demonstration</a> (65K)</p><p class="nav"><a href="vb6_officebar_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 OfficeBar Full Source</a> (134K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:11904</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=11904&type=zip&title=vb6_20officebar_20full_20source_2ezip_5fmfrmmain.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 5 / 6</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 0 / 0</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:6 February 2004</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />5 Jul 2003<br /><p class="update">Corrected Demonstration projects</p><p class="update">Added note about IDE error when undocking</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\vbaccelerator_toolbar_and_coolmenu_control\article.html">vbAccelerator Toolbar and CoolMenu Control v3.5</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\menus\popup_menu_activex_dll\article.html">PopupMenu DLL - Create Unlimited Popup Menus</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\tab_controls\mdi_tabs\article.html">vbAccelerator MDITabs Control</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: mfrmMain.frm</h1><pre>VERSION 5.00
Object = "{E142732F-A852-11D4-B06C-00500427A693}#1.13#0"; "vbalTbar6.ocx"
Object = "{76A5D4ED-0D69-44AD-835D-B1429EF8E25C}#1.0#0"; "vbalDkTb6.ocx"
Begin VB.MDIForm mfrmMain 
   AutoShowChildren=   0   'False
   BackColor       =   &amp;H8000000C&amp;
   Caption         =   "Office Bar Tester"
   ClientHeight    =   6315
   ClientLeft      =   3750
   ClientTop       =   2040
   ClientWidth     =   9015
   Icon            =   "mfrmMain.frx":0000
   Begin vbalDkTb6.vbalDockContainer vbalDockContainer4 
      Align           =   4  'Align Right
      Height          =   5550
      Left            =   8985
      TabIndex        =   10
      Top             =   405
      Width           =   30
      _ExtentX        =   53
      _ExtentY        =   9790
   End
   Begin vbalDkTb6.vbalDockContainer vbalDockContainer3 
      Align           =   3  'Align Left
      Height          =   5550
      Left            =   0
      TabIndex        =   9
      Top             =   405
      Width           =   30
      _ExtentX        =   53
      _ExtentY        =   9790
   End
   Begin vbalDkTb6.vbalDockContainer vbalDockContainer2 
      Align           =   2  'Align Bottom
      Height          =   360
      Left            =   0
      TabIndex        =   3
      Top             =   5955
      Width           =   9015
      _ExtentX        =   15901
      _ExtentY        =   635
      NonDockingArea  =   -1  'True
      Begin VB.PictureBox picStatus 
         BorderStyle     =   0  'None
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   375
         Left            =   0
         ScaleHeight     =   375
         ScaleWidth      =   9015
         TabIndex        =   4
         Top             =   0
         Width           =   9015
         Begin VB.CommandButton cmdRestoreLayout 
            Caption         =   "Restore &amp;Layout"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   5520
            TabIndex        =   8
            Top             =   30
            Width           =   1335
         End
         Begin VB.CommandButton cmdSaveLayout 
            Caption         =   "Save &amp;Layout"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   4140
            TabIndex        =   7
            Top             =   30
            Width           =   1335
         End
         Begin VB.CommandButton cmdShowState 
            Caption         =   "Show &amp;State"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   315
            Left            =   2760
            TabIndex        =   6
            Top             =   30
            Width           =   1335
         End
         Begin VB.CheckBox Check1 
            Caption         =   "&amp;Lock Main Toolbar"
            BeginProperty Font 
               Name            =   "Tahoma"
               Size            =   8.25
               Charset         =   0
               Weight          =   400
               Underline       =   0   'False
               Italic          =   0   'False
               Strikethrough   =   0   'False
            EndProperty
            Height          =   255
            Left            =   1080
            TabIndex        =   5
            Top             =   60
            Width           =   1995
         End
      End
   End
   Begin vbalDkTb6.vbalDockContainer vbalDockContainer1 
      Align           =   1  'Align Top
      Height          =   30
      Left            =   0
      TabIndex        =   2
      Top             =   375
      Width           =   9015
      _ExtentX        =   15901
      _ExtentY        =   53
   End
   Begin vbalTBar6.cToolbar tbrStandard 
      Left            =   1800
      Top             =   4020
      _ExtentX        =   8916
      _ExtentY        =   873
   End
   Begin vbalTBar6.cToolbar tbrAddress 
      Left            =   1200
      Top             =   3300
      _ExtentX        =   8281
      _ExtentY        =   873
   End
   Begin vbalTBar6.cToolbar tbrMenu 
      Left            =   840
      Top             =   2640
      _ExtentX        =   6694
      _ExtentY        =   873
   End
   Begin VB.PictureBox picGeneral 
      Align           =   1  'Align Top
      BeginProperty Font 
         Name            =   "Tahoma"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   0
      ScaleHeight     =   315
      ScaleWidth      =   8955
      TabIndex        =   0
      Top             =   0
      Visible         =   0   'False
      Width           =   9015
      Begin VB.ComboBox cboAddress 
         BeginProperty Font 
            Name            =   "Tahoma"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   315
         Left            =   900
         TabIndex        =   1
         Text            =   "Combo1"
         Top             =   0
         Width           =   1035
      End
   End
End
Attribute VB_Name = "mfrmMain"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private WithEvents m_cMenu As cPopupMenu
Attribute m_cMenu.VB_VarHelpID = -1
Private m_cSBar As cNoStatusBar
Private m_cILNormal20 As cVBALImageList
Private m_cILHot20 As cVBALImageList

Private Sub showState()
Dim ctl As Control
Dim ctlDock As vbalDockContainer
Dim i As Long
   IndicateClear
   For Each ctl In Me.Controls
      If TypeName(ctl) = "vbalDockContainer" Then
         Set ctlDock = ctl
         Indicate ctlDock.Name
         Indicate "   Owns " &amp; ctlDock.BarCount &amp; " bars"
         Indicate "   Showing " &amp; ctlDock.RowCount &amp; " rows"
         For i = 1 To ctlDock.BarCount
            Indicate "      Bar " &amp; i &amp; " has key " &amp; ctlDock.BarKey(i) &amp; "; "
             &amp; IIf(ctlDock.IsDocked(ctlDock.BarKey(i)), "Bar is docked", "Bar
             is undocked")
         Next i
      End If
   Next
End Sub

Private Sub IndicateClear()
Dim frm As Form
   For Each frm In Forms
      If TypeName(frm) = "frmChild" Then
         frm.IndicateClear
      End If
   Next
   
End Sub

Private Sub Indicate(ByVal sMsg As String)
Dim frm As Form
   For Each frm In Forms
      If TypeName(frm) = "frmChild" Then
         frm.Indicate sMsg
      End If
   Next
End Sub

Private Sub createMenu()
Dim iMain As Long
Dim iP As Long
Dim iP2 As Long
Dim iP3 As Long

   With m_cMenu
      ' Build bars for MENU &amp; TOOLBAR:
      iMain = .AddItem("MENU", "Menu Bar", , , , , , "MENUBAR")
      
      iP = .AddItem("&amp;File", , , iMain, , , , "mnuFileTOP")
      .AddItem "&amp;New Instance" &amp; vbTab &amp; "Ctrl+N", , , iP, , , , "mnuFile(0)"
      .AddItem "Show &amp;MDI!", , , iP, , , False, "mnuFile(1)"
      .AddItem "-", , , iP, , , , "mnuFile(2)"
      .AddItem "&amp;Close", , , iP, , , , "mnuFile(3)"
      
      iP = .AddItem("&amp;Button", , , iMain, , , , "mnuButtonTOP")
      .AddItem "Button 2 &amp;Visible", , , iP, , True, , "mnuButton(0)"
      .AddItem "Button 2 &amp;Enabled", , , iP, , False, , "mnuButton(1)"
      .AddItem "-", , , iP, , , , "mnuButton(2)"
      iP2 = .AddItem("Change Button 2 &amp;Caption", , , iP, , , , "mnuButton(3)")
      .ItemInfrequentlyUsed(iP2) = True
      iP2 = .AddItem("Change Button 1 Captio&amp;n", , , iP, , , , "mnuButton(4)")
      .ItemInfrequentlyUsed(iP2) = True
      .AddItem "-", , , iP, , , , "mnuButton(5)"
      iP2 = .AddItem("Change Button 2 &amp;Image", , , iP, , , , "mnuButton(6)")
      .ItemInfrequentlyUsed(iP2) = True
      iP2 = .AddItem("Chec&amp;k Last Button", , , iP, , , , "mnuButton(7)")
      .ItemInfrequentlyUsed(iP2) = True
      .AddItem "-", , , iP, , , , "mnuButton(8)"
      .AddItem "In&amp;sert Button...", , , iP, , , , "mnuButton(9)"
      .AddItem "-", , , iP, , , , "mnuButton(10)"
      .AddItem "&amp;Show Captions", , , iP, , True, , "mnuButton(11)"
      
      iP = .AddItem("&amp;View", , , iMain, , , , "mnuViewTOP")
      .AddItem "&amp;Large Toolbar", , , iP, , True, , "mnuView(0)"
      .AddItem "&amp;Small Toolbar", , , iP, , True, , "mnuView(1)"
      .AddItem "Lin&amp;ks Toolbar", , , iP, , True, , "mnuView(2)"
      .AddItem "St&amp;yle Bar", , , iP, , True, , "mnuView(3)"
      .AddItem "-", , , iP, , , , "mnuView(4)"
      .AddItem "Background &amp;Bitmap", , , iP, , True, , "mnuView(5)"
      
      iP = .AddItem("&amp;Position", , , iMain, , , , "mnuPositionTOP")
      iP2 = .AddItem("&amp;Top", , , iP, , , , "mnuPosition(0)")
      .RadioCheck(iP2) = True
      .AddItem "&amp;Left", , , iP, , , , "mnuPosition(1)"
      .AddItem "&amp;Right", , , iP, , , , "mnuPosition(2)"
      .AddItem "&amp;Bottom", , , iP, , , , "mnuPosition(3)"
      
      iP = .AddItem("&amp;Help", , , iMain, , , , "mnuHelpTOP")
      .AddItem "&amp;Contents" &amp; vbTab &amp; "F1", , , iP, , , , "mnuHelp(0)"
      iP2 = .AddItem("&amp;Index", , , iP, , , , "mnuHelp(1)")
      .ItemInfrequentlyUsed(iP2) = True
      iP2 = .AddItem("&amp;Search", , , iP, , , , "mnuHelp(2)")
      .ItemInfrequentlyUsed(iP2) = True
      .AddItem "-", , , iP
      iP2 = .AddItem("&amp;vbAccelerator on the Web", , , iP, , , , "mnuHelp(1)")
      iP3 = .AddItem("&amp;Free Stuff", , , iP2)
      iP3 = .AddItem("&amp;Product News", , , iP2)
      iP3 = .AddItem("Frequently Asked &amp;Questions", , , iP2)
      iP3 = .AddItem("-", , , iP2)
      iP3 = .AddItem("For &amp;Developers Only", , , iP2)
      .ItemInfrequentlyUsed(iP3) = True
      iP3 = .AddItem("Send Feed&amp;back", , , iP2)
      .ItemInfrequentlyUsed(iP3) = True
      iP3 = .AddItem("&amp;Best of the Web", , , iP2)
      .ItemInfrequentlyUsed(iP3) = True
      iP3 = .AddItem("Search the &amp;Web", , , iP2)
      .ItemInfrequentlyUsed(iP3) = True
      iP3 = .AddItem("Web &amp;Tutorial", , , iP2)
      .ItemInfrequentlyUsed(iP3) = True
      .AddItem "-", , , iP
      .AddItem "&amp;About...", , , iP, , , , "mnuHelp(3)"
            
      
      ' Toolbar:
      iMain = .AddItem("TOOLBAR", "Standard Toolbar", , , , , , "STDTOOLBAR")
      
      iP = .AddItem("Back", "Back To ", , iMain, 0, , , "TOOLBAR:GO:BACK")
      iP2 = .AddItem("&lt;empty&gt;", , , iP, , , False, "TOOLBAR:BACK:1")
      iP = .AddItem("Forward", "Forward To ", , iMain, 1, , False,
       "TOOLBAR:GO:FORWARD")
      iP2 = .AddItem("&lt;empty&gt;", , , iP, , , False, "TOOLBAR:FORWARD:1")
      iP = .AddItem("Up", "Up", , iMain, 28, , , "TOOLBAR:GO:UP")
      iP = .AddItem("-", , , iMain)
      iP = .AddItem("Search", , , iMain, 17, , , "TOOLBAR:EXPLORER:SEARCH")
      iP = .AddItem("Folders", , , iMain, 43, True, ,
       "TOOLBAR:EXPLORER:FOLDERS")
      .RadioCheck(iP) = True
      iP = .AddItem("History", , , iMain, 17, , , "TOOLBAR:EXPLORER:HISTORY")
      iP = .AddItem("Favourites", , , iMain, 2, , ,
       "TOOLBAR:EXPLORER:FAVOURITES")
      .Visible(iP) = False
      iP = .AddItem("&lt;None&gt;", , , iMain, 17, , , "TOOLBAR:EXPLORER:NONE")
      .Visible(iP) = False
      iP = .AddItem("-", , , iMain)
      iP = .AddItem("Move To", "Move To", , iMain, 44, , False,
       "TOOLBAR:EDIT:MOVETO")
      iP = .AddItem("Copy To", "Copy To", , iMain, 45, , False,
       "TOOLBAR:EDIT:COPYTO")
      iP = .AddItem("Delete", "Delete", , iMain, 10, , , "TOOLBAR:FILE:DELETE")
      iP = .AddItem("Undo", "Undo", , iMain, 8, , , "TOOLBAR:EDIT:UNDO")
      iP = .AddItem("-", , , iMain)
      iP = .AddItem("Views", "Views", , iMain, 20, , , "TOOLBAR:TOP:VIEWS")
      iP2 = .AddItem("Lar&amp;ge Icons", , , iP, 20, , , "TOOLBAR:VIEW:LARGE")
      .RadioCheck(iP2) = True
      iP2 = .AddItem("S&amp;mall Icons", , , iP, 21, , , "TOOLBAR:VIEW:SMALL")
      iP2 = .AddItem("&amp;List", , , iP, 22, , , "TOOLBAR:VIEW:LIST")
      iP2 = .AddItem("&amp;Details", , , iP, 23, , , "TOOLBAR:VIEW:DETAILS")
      iP2 = .AddItem("T&amp;humbnails", , , iP, , , , "TOOLBAR:VIEW:THUMBNAILS")
      
      
      ' Address/Go toolbar:
      iMain = .AddItem("ADDRESS", "Address Toolbar", , , , , , "ADRTOOLBAR")
      .AddItem "Address", , , iMain, , , , "TOOLBAR:ADDRESS:COMBO"
      .AddItem "&amp;Go", , , iMain, 0, , , "TOOLBAR:ADDRESS:GO"
      
      
      .HideInfrequentlyUsed = True

   End With
   
End Sub
Private Sub buildImageLists()
   '
    ============================================================================
   =======
   ' 20 x 20 Hot &amp; Standard Images:
   '
    ============================================================================
   =======
   Set m_cILNormal20 = New cVBALImageList
   With m_cILNormal20
      .IconSizeX = 20: .IconSizeY = 20: .ColourDepth = ILC_COLOR24
      .Create
      .AddFromFile App.Path &amp; "\exp20n.bmp", IMAGE_BITMAP
   End With
   Set m_cILHot20 = New cVBALImageList
   With m_cILHot20
      .IconSizeX = 20: .IconSizeY = 20: .ColourDepth = ILC_COLOR24
      .Create
      .AddFromFile App.Path &amp; "\exp20h.bmp", IMAGE_BITMAP
   End With

End Sub

Private Function chevronPress(ctl As vbalDockContainer, ByVal sKey As String,
 ByVal lX As Long, ByVal lY As Long)
   Debug.Print "ChevronPress Start", sKey
   Select Case sKey
   Case "MENU"
      tbrMenu.chevronPress lX, lY
      ctl.BandSizeChange "MENU", tbrMenu.ToolbarWidth, tbrMenu.ToolbarHeight,
       getVerticalHeight(tbrMenu), getVerticalWidth(tbrMenu)
   Case "UTILITY"
      tbrAddress.chevronPress lX, lY
      ctl.BandSizeChange "UTILITY", 256, tbrAddress.ToolbarHeight,
       getVerticalHeight(tbrAddress), getVerticalWidth(tbrAddress)
   Case "STANDARD"
      tbrStandard.chevronPress lX, lY
      ctl.BandSizeChange "STANDARD", tbrStandard.ToolbarWidth,
       tbrStandard.ToolbarHeight, getVerticalHeight(tbrStandard),
       getVerticalWidth(tbrStandard)
   End Select
   Debug.Print "ChevronPress End", sKey
End Function

Private Function getVerticalHeight(tbrThis As cToolbar) As Long
Dim l As Long
Dim lHeight As Long
Dim lMaxWidth As Long
Dim lRowHeight As Long
Dim lRowWidth As Long

   lMaxWidth = getVerticalWidth(tbrThis)
   
   For l = 0 To tbrThis.ButtonCount - 1
      If tbrThis.ButtonVisible(l) Then
         If tbrThis.ButtonControl(l) = 0 Then
            
            If tbrThis.ButtonStyle(l) = CTBSeparator Then
               ' we'll start a new row for the next one
               lHeight = lHeight + lRowHeight
               lRowHeight = 0
               lRowWidth = 0
            Else
               If (lRowWidth + tbrThis.ButtonWidth(l) &gt; lMaxWidth) Then
                  ' This button needs to go on a new row:
                  lHeight = lHeight + lRowHeight
                  lRowHeight = 0
                  lRowWidth = lRowWidth + tbrThis.ButtonWidth(l)
                  If (tbrThis.ButtonHeight(l) &gt; lRowHeight) Then
                     lRowHeight = tbrThis.ButtonHeight(l)
                  End If
               Else
                  ' This button goes on this row:
                  If (tbrThis.ButtonHeight(l) &gt; lRowHeight) Then
                     lRowHeight = tbrThis.ButtonHeight(l)
                  End If
                  lRowWidth = lRowWidth + tbrThis.ButtonWidth(l)
               End If
            End If
         End If
      End If
   Next l
   lHeight = lHeight + lRowHeight
   getVerticalHeight = lHeight
End Function

Private Function getVerticalWidth(tbrThis As cToolbar) As Long
Dim l As Long
Dim lMaxWidth As Long
   For l = 0 To tbrThis.ButtonCount - 1
      If tbrThis.ButtonVisible(l) Then
         If tbrThis.ButtonControl(l) = 0 Then
            If (tbrThis.ButtonWidth(l) &gt; lMaxWidth) Then
               lMaxWidth = tbrThis.ButtonWidth(l)
            End If
         End If
      End If
   Next l
   getVerticalWidth = lMaxWidth
   
End Function

Public Sub newChild()
   Dim f As New frmChild
   f.Show
End Sub

Private Sub cboAddress_Change()
   Debug.Print "cboAddress_Change"
End Sub

Private Sub cboAddress_Click()
   Debug.Print "cboAddress_Click"
End Sub

Private Sub Check1_Click()
   vbalDockContainer1.LockToolBars = (Check1.Value = Checked)
End Sub

Private Sub cmdRestoreLayout_Click()
   Dim sFile As String
   sFile = App.Path &amp; "\layout.xml"
   
   Dim iFile As Integer
   iFile = FreeFile
   Open sFile For Binary Access Read As #iFile
   Dim sXml As String
   sXml = String(LOF(iFile), " ")
   Get #iFile, , sXml
   Close #iFile
   
   ReDim sKey(1 To 6) As String
   Dim hwnd(1 To 6) As Long
   sKey(1) = "MENU": hwnd(1) = tbrMenu.hwnd
   sKey(2) = "STANDARD": hwnd(2) = tbrStandard.hwnd
   sKey(3) = "UTILITY": hwnd(3) = tbrAddress.hwnd
   sKey(4) = "DRAWING": hwnd(4) = 0
   sKey(5) = "TABLES": hwnd(5) = 0
   sKey(6) = "HELP": hwnd(6) = 0
   
   Dim ctl As Control
   Dim ctlDock As vbalDockContainer
   For Each ctl In Me.Controls
      If TypeName(ctl) = "vbalDockContainer" Then
         Set ctlDock = ctl
         Debug.Print "Before Restore on "; ctlDock.Name; ": "; tbrStandard.hwnd
         ctlDock.RestoreLayout sXml, sKey(), hwnd()
         Debug.Print "After Restore on "; ctlDock.Name; ": "; tbrStandard.hwnd
      End If
   Next

End Sub

Private Sub cmdSaveLayout_Click()
Dim sMsg As String
Dim ctl As Control
Dim ctlDock As vbalDockContainer
   sMsg = "&lt;Layout&gt;"
   For Each ctl In Me.Controls
      If TypeName(ctl) = "vbalDockContainer" Then
         Set ctlDock = ctl
         sMsg = sMsg &amp; vbCrLf &amp; ctlDock.SaveLayout()
      End If
   Next
   sMsg = sMsg &amp; vbCrLf &amp; "&lt;/Layout&gt;"
   IndicateClear
   Indicate sMsg
   
   Dim sFile As String
   sFile = App.Path &amp; "\layout.xml"
   On Error Resume Next
   Kill sFile
   On Error GoTo errorHandler
   
   Dim iFile As Integer
   iFile = FreeFile
   Open sFile For Binary Access Write As #iFile
   Put #iFile, , sMsg
   Close #iFile
   Exit Sub
   
errorHandler:
   MsgBox "Failed to save layout: " &amp; Err.Description, vbExclamation
   Close #iFile
   Exit Sub
End Sub

Private Sub cmdShowState_Click()
   showState
End Sub

Private Sub m_cMenu_Click(ItemNumber As Long)
   If (m_cMenu.ItemKey(ItemNumber) = "mnuFile(3)") Then
      Unload Me
   Else
      MsgBox "CLICKED:" &amp; m_cMenu.ItemKey(ItemNumber)
   End If
End Sub

Private Sub MDIForm_Load()
   
   '
    ----------------------------------------------------------------------------
   --------
   ' Create status bar:
   Set m_cSBar = New cNoStatusBar
   m_cSBar.Create picStatus
   m_cSBar.SizeGrip = True
   m_cSBar.AddPanel estbrStandard, "Ready.", , , True
   '
    ----------------------------------------------------------------------------
   --------
   
   
   '
    ----------------------------------------------------------------------------
   --------
   ' Create the Menu for the form:
   Set m_cMenu = New cPopupMenu
   m_cMenu.hWndOwner = Me.hwnd
   m_cMenu.OfficeXpStyle = True

   createMenu
   With tbrMenu
      .DrawStyle = CTBDrawOfficeXPStyle
      .CreateFromMenu2 m_cMenu, CTBMenuStyle, "MENUBAR"
      .Wrappable = True
      .ChevronButton(CTBChevronAdditionalAddorRemove) = True
      .ChevronButton(CTBChevronAdditionalReset) = True
      .ChevronButton(CTBChevronAdditionalCustomise) = True
   End With
   '
    ----------------------------------------------------------------------------
   --------
   
   
   '
    ----------------------------------------------------------------------------
   --------
   ' Create an Address/Go toolbar
   With tbrAddress
      .ImageSource = CTBLoadFromFile
      .ImageFile = App.Path &amp; "\1616.bmp"
      .DrawStyle = CTBDrawOfficeXPStyle
      
      ' Create the toolbar
      .CreateFromMenu2 m_cMenu, CTBToolbarStyle, "ADRTOOLBAR"
      
      ' Customise the toolbar so there is a combo box for the first button:
      .SetControl cboAddress.hwnd, "TOOLBAR:ADDRESS:COMBO"
      ' Set the combo box to stretch into the available area:
      .ControlStretch("TOOLBAR:ADDRESS:COMBO") = True
      
      ' Make the Go button text visible:
      .ButtonTextVisible("TOOLBAR:ADDRESS:GO") = True
      
      .Wrappable = True
      .ChevronButton(CTBChevronAdditionalAddorRemove) = True
      .ChevronButton(CTBChevronAdditionalReset) = True
   End With
   Dim i As Long
   For i = 1 To 20
      cboAddress.AddItem "Test Item " &amp; i
   Next i
   cboAddress.ListIndex = 0
   '
    ----------------------------------------------------------------------------
   --------
   
   '
    ----------------------------------------------------------------------------
   --------
   ' Create an Explorer toolbar:
   buildImageLists
   With tbrStandard
      ' Set up the image source:
      .ImageSource = CTBExternalImageList
      .SetImageList m_cILHot20, CTBImageListNormal
      .DrawStyle = CTBDrawOfficeXPStyle
      
      ' Since our images are a different size to the menu,
      ' we should create the toolbar with the right button
      ' size before calling CreateFromMenu
      .CreateToolbar 20, True, True, True
      
      ' Now we create the toolbar:
      .CreateFromMenu2 m_cMenu, CTBToolbarStyle, "STDTOOLBAR"
      
      ' Customise the buttons for the desired appearance:
      .ButtonStyle("TOOLBAR:TOP:VIEWS") = CTBDropDownArrow
      .ButtonTextVisible("TOOLBAR:GO:BACK") = True
      .ButtonTextVisible("TOOLBAR:EXPLORER:FOLDERS") = True
      .ButtonTextVisible("TOOLBAR:EXPLORER:SEARCH") = True
      .ButtonTextVisible("TOOLBAR:EXPLORER:HISTORY") = True
      .ButtonTextVisible("TOOLBAR:EXPLORER:FAVOURITES") = True
      
      .ButtonVisible("TOOLBAR:EXPLORER:FAVOURITES") = False
      .ButtonVisible("TOOLBAR:EXPLORER:NONE") = False
      
      .ChevronButton(CTBChevronAdditionalAddorRemove) = True
      .ChevronButton(CTBChevronAdditionalCustomise) = True
      .ChevronButton(CTBChevronAdditionalReset) = True
   End With
   '
    ----------------------------------------------------------------------------
   --------
   
   
   
   '
    ----------------------------------------------------------------------------
   --------
   ' Set up the docking containers in their initial condition:
   With vbalDockContainer1
      .Add _
         "MENU", _
         tbrMenu.ToolbarWidth, tbrMenu.ToolbarHeight, _
         getVerticalHeight(tbrMenu), tbrMenu.MaxButtonWidth, _
         "Menu Bar", , , , _
         True, , , False
      .Capture "MENU", tbrMenu.hwnd
      .Add _
         "STANDARD", _
         tbrStandard.ToolbarWidth, tbrStandard.ToolbarHeight, _
         getVerticalHeight(tbrStandard), getVerticalWidth(tbrStandard), _
         "Standard"
      .Capture "STANDARD", tbrStandard.hwnd
      .Add _
         "UTILITY", _
         256, tbrAddress.ToolbarHeight, _
         getVerticalHeight(tbrAddress), getVerticalWidth(tbrAddress), _
         "Utility"
      .Capture "UTILITY", tbrAddress.hwnd
   End With

   With vbalDockContainer2
      .NonDockingArea = True
   End With
   
   With vbalDockContainer3
      .Add "DRAWING", 128, 26, 128, 26, "Drawing"
      .Add "TABLES", 192, 26, 192, 26, "Tables", 1
      .Add "HELP", 64, 26, 64, 26, "Help"
   End With
   '
    ----------------------------------------------------------------------------
   --------
   
   
   '
    ----------------------------------------------------------------------------
   --------
   ' Load a new child form, and start
   newChild
   '
    ----------------------------------------------------------------------------
   --------
   

End Sub


Private Sub picStatus_Paint()
   m_cSBar.Draw
End Sub

Private Sub vbalDockContainer1_chevronPress(ByVal Key As String, ByVal x As
 Long, ByVal y As Long)
   '
   chevronPress vbalDockContainer1, Key, x, y
   '
End Sub

Private Sub vbalDockContainer1_Docked(ByVal Key As String)
   showState
End Sub

Private Sub vbalDockContainer1_Undocked(ByVal Key As String)
   showState
End Sub

Private Sub vbalDockContainer2_chevronPress(ByVal Key As String, ByVal x As
 Long, ByVal y As Long)
   '
   chevronPress vbalDockContainer2, Key, x, y
   '
End Sub

Private Sub vbalDockContainer2_Docked(ByVal Key As String)
   showState
End Sub

Private Sub vbalDockContainer2_SizeChanged()
   picStatus.Move 0, vbalDockContainer2.Height -
    vbalDockContainer2.NonDockingAreaSize * Screen.TwipsPerPixelY,
    vbalDockContainer2.Width, vbalDockContainer2.NonDockingAreaSize *
    Screen.TwipsPerPixelY
End Sub

Private Sub vbalDockContainer2_Undocked(ByVal Key As String)
showState
End Sub

Private Sub vbalDockContainer3_chevronPress(ByVal Key As String, ByVal x As
 Long, ByVal y As Long)
   '
   chevronPress vbalDockContainer3, Key, x, y
   '
End Sub

Private Sub vbalDockContainer3_Docked(ByVal Key As String)
   showState
End Sub

Private Sub vbalDockContainer3_Undocked(ByVal Key As String)
   showState
End Sub

Private Sub vbalDockContainer4_chevronPress(ByVal Key As String, ByVal x As
 Long, ByVal y As Long)
   '
   chevronPress vbalDockContainer4, Key, x, y
   '
End Sub

Private Sub vbalDockContainer4_Docked(ByVal Key As String)
   showState
End Sub

Private Sub vbalDockContainer4_Undocked(ByVal Key As String)
   showState
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Toolbar</a>&#160;.&#160;<a href="article.html">vbAccelerator Office Docking Bar Control</a>&#160;.&#160;<a href="vb6_officebar_full_source.html">VB6 OfficeBar Full Source</a>&#160;.&#160;mfrmMain.frm</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 24 April 2003</p></td><td></td></tr></table>
</body></html>