<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: cMDIToolbarMenu.cls</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: cMDIToolbarMenu.cls" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Toolbar</a>&#160;.&#160;<a href="article.html">vbAccelerator Toolbar and CoolMenu Control v3.5</a>&#160;.&#160;<a href="vb6_toolbar_complete_source.html">VB6 Toolbar Complete Source</a>&#160;.&#160;cMDIToolbarMenu.cls</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="coolmenu_toolbar_control_documentation.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />CoolMenu Toolbar Control Documentation</a> (5K)</p><p /><p class="nav"><a href="vb5_toolbar_complete_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Toolbar Complete Source</a> (263K)</p><p class="nav"><a href="vb5_toolbar_control_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Toolbar Control Binary</a> (78K)</p><p class="nav"><a href="vb5_toolbar_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Toolbar Demonstration</a> (97K)</p><p /><p class="nav"><a href="vb6_toolbar_complete_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Toolbar Complete Source</a> (261K)</p><p class="nav"><a href="vb6_toolbar_control_binary.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Toolbar Control Binary</a> (80K)</p><p class="nav"><a href="vb6_toolbar_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Toolbar Demonstration</a> (93K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:1317</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=1317&type=zip&title=vb6_20toolbar_20complete_20source_2ezip_5fcmditoolbarmenu.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 2 / 2</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 1 / 1</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 0</a></p><p class="nav">Updated:4 November 2003</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />11 May 2003<br /><p class="update">Bug fix release to fix accelerator and chevron problems.</p><p class="update">Coolmenu accelerators caused problems - sometimes the menus
triggered without the Alt- key being pressed, othertimes they did not trigger
when they should.  The logic has been rewritten to correct this.</p><p class="update">Chevrons created by the toolbar did not trigger when clicked with 
the mouse.  Fixed.  The chevron now also uses a Menu window class as a base so it
draws in the same way as menus on the system.</p><p class="update">Some non-English keys did not work as accelerators. Fixed with code
provided by Sergey Pitutin.</p><p class="update">The Toolbar, Rebar and ToolbarHost controls could not be hosted
on a UserControl.  They now can. Thanks to Alexander Stetsenko for the information.</p><p class="update">The MDI buttons in the toolbar host control now render using XP
Visual Style if appropriate.  Thanks to Nguyen Tuan Anh for the suggestion.</p><p class="update"><i>SaveLayout</i> and <i>RestoreLayout</i> (beta) methods have been
added to the Rebar based on a method suggested by Ralph Brugger at LinkPool.  Feedback
please!</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\menus\popup_menu_activex_dll\article.html">PopupMenu DLL - Create Unlimited Popup Menus</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: cMDIToolbarMenu.cls</h1><pre>VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
  Persistable = 0  'NotPersistable
  DataBindingBehavior = 0  'vbNone
  DataSourceBehavior  = 0  'vbNone
  MTSTransactionMode  = 0  'NotAnMTSObject
END
Attribute VB_Name = "cMDIToolbarMenu"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Option Explicit
' =========================================================================
' cMDIToolbarMenu.cls
'
' vbAccelerator Toolbar control
' Copyright  1998-2000 Steve McMahon (steve@vbaccelerator.com)
'
' Removes the menu and child control non-client area from an
' MDI form and determines when an MDI child is activated
' and/or maximized.
'
' -------------------------------------------------------------------------
' Visit vbAccelerator at http://vbaccelerator.com
' =========================================================================

Implements ISubclass

Private m_hWnd As Long
Private m_hWndMDIClient As Long
Private m_bActive As Boolean
Private m_lPtr As Long
Private m_bState As Boolean
Private m_hDC As Long
Private m_hBmp As Long
Private m_hBmpOld As Long

Private Declare Function GetForegroundWindow Lib "user32" () As Long

Friend Sub Attach(ByVal hWndA As Long, ByRef tBH As cToolbarHost)
Dim lHDC As Long
   Detach
   m_hWndMDIClient = FindWindowEx(hWndA, 0, "MDIClient", ByVal 0&amp;)
   If m_hWndMDIClient &lt;&gt; 0 Then
      m_hWnd = hWndA
      m_bActive = (GetForegroundWindow() = m_hWnd)
      AttachMessage Me, m_hWnd, WM_NCCALCSIZE
'      AttachMessage Me, m_hWnd, WM_NCPAINT
'      AttachMessage Me, m_hWnd, WM_SETCURSOR
'      AttachMessage Me, m_hWnd, WM_STYLECHANGED
      AttachMessage Me, m_hWnd, WM_ACTIVATE
      AttachMessage Me, m_hWnd, WM_DESTROY
      AttachMessage Me, m_hWnd, WM_MDISETMENU
      
      lHDC = CreateDCAsNull("DISPLAY", ByVal 0&amp;, ByVal 0&amp;, ByVal 0&amp;)
      m_hDC = CreateCompatibleDC(lHDC)
      m_hBmp = CreateCompatibleBitmap(lHDC, Screen.width \
       Screen.TwipsPerPixelX, GetSystemMetrics(SM_CYCAPTION) * 4)
      DeleteDC lHDC
      m_hBmpOld = SelectObject(m_hDC, m_hBmp)
      
      m_lPtr = ObjPtr(tBH)
   End If
End Sub
Friend Sub Detach()
   If m_hWnd &lt;&gt; 0 Then
      DetachMessage Me, m_hWnd, WM_NCCALCSIZE
'      DetachMessage Me, m_hWnd, WM_NCPAINT
'      DetachMessage Me, m_hWnd, WM_SETCURSOR
'      DetachMessage Me, m_hWnd, WM_STYLECHANGED
      DetachMessage Me, m_hWnd, WM_ACTIVATE
      DetachMessage Me, m_hWnd, WM_MDISETMENU
      DetachMessage Me, m_hWnd, WM_DESTROY
   End If
   If m_hDC &lt;&gt; 0 Then
      If m_hBmpOld &lt;&gt; 0 Then
         SelectObject m_hDC, m_hBmp
         m_hBmpOld = 0
      End If
      If m_hBmp &lt;&gt; 0 Then
         DeleteObject m_hBmp
         m_hBmp = 0
      End If
      If m_hDC &lt;&gt; 0 Then
         DeleteDC m_hDC
         m_hDC = 0
      End If
   End If
   m_hWnd = 0
   m_hWndMDIClient = 0
   m_lPtr = 0
End Sub

Private Property Get Toolbarhost() As cToolbarHost
Dim cT As cToolbarHost
   If m_lPtr &lt;&gt; 0 Then
      CopyMemory cT, m_lPtr, 4
      Set Toolbarhost = cT
      CopyMemory cT, 0&amp;, 4
   End If
End Property

Private Sub pShowMDIButtons(ByVal hwnd As Long, ByVal bState As Boolean)
Dim cT As cToolbarHost
Dim lS As Long
Dim lNewS As Long

   m_bState = bState
   Set cT = Toolbarhost
   If Not cT Is Nothing Then
      cT.MDIButtons hwnd, bState
   End If
   lS = GetWindowLong(m_hWndMDIClient, GWL_EXSTYLE)
   If bState Then
      ' removing the MDI Border:
      lNewS = lS And Not WS_EX_CLIENTEDGE
   Else
      ' putting MDI border back again:
      lNewS = lS Or WS_EX_CLIENTEDGE
   End If
   ' Set the new style:
   If Not (lS = lNewS) Then
      SetWindowLong m_hWndMDIClient, GWL_EXSTYLE, lNewS
      ' Ensure the style 'takes'
      SetWindowPos m_hWndMDIClient, 0, 0, 0, 0, 0, SWP_FRAMECHANGED Or
       SWP_NOMOVE Or SWP_NOSIZE Or SWP_NOOWNERZORDER Or SWP_NOZORDER
   End If
End Sub

Private Sub Class_Initialize()
   debugmsg "cMDIToolbarMenu:Initialize"
End Sub

Private Sub Class_Terminate()
   Detach
   debugmsg "cMDIToolbarMenu:Terminate"
End Sub

Private Property Let ISubclass_MsgResponse(ByVal RHS As EMsgResponse)
   '
End Property

Private Property Get ISubclass_MsgResponse() As EMsgResponse
   Select Case CurrentMessage
   Case WM_MDIGETACTIVE, WM_NCPAINT, WM_SETCURSOR, WM_MDISETMENU
      ISubclass_MsgResponse = emrConsume
   Case Else
      ISubclass_MsgResponse = emrPreprocess
   End Select
End Property

Private Function ISubclass_WindowProc(ByVal hwnd As Long, ByVal iMsg As Long,
 ByVal wParam As Long, ByVal lParam As Long) As Long
Dim tNCR As NCCALCSIZE_PARAMS
Dim tWP As WINDOWPOS
Dim tR As RECT, ttR As RECT, tSR As RECT
Dim lhWnd As Long
Dim lpfMaximised As Long
Dim lPtr As Long
Dim hRgn As Long
Dim hBr As Long, hBrButton As Long
Dim hdc As Long
Dim lFlag As Long
Dim lStyle As Long
Dim lHasGradient As Long

   Select Case iMsg
   
   Case WM_DESTROY
      Detach
      
'   Case WM_NCPAINT
'      ' Get the non-client DC to draw in:
'      hdc = GetWindowDC(m_hWnd)
'
'      SystemParametersInfo SPI_GETGRADIENTCAPTIONS, 0, lHasGradient, 0
'      m_bActive = getTheActiveWindow()
'      If m_bActive Then
'         lFlag = DC_ACTIVE
'         ' if 98 or 2000 then we need to check for
'         ' gradient end color:
'         If Not (lHasGradient = 0) Then
'            lFlag = lFlag Or DC_GRADIENT
'            hBrButton = GetSysColorBrush(COLOR_GRADIENTACTIVECAPTION)
'         Else
'            hBrButton = GetSysColorBrush(COLOR_ACTIVECAPTION)
'         End If
'         hBr = GetSysColorBrush(COLOR_ACTIVEBORDER)
'      Else
'         If Not (lHasGradient = 0) Then
'            lFlag = lFlag Or DC_GRADIENT
'            hBrButton = GetSysColorBrush(COLOR_GRADIENTINACTIVECAPTION)
'         Else
'            hBrButton = GetSysColorBrush(COLOR_INACTIVECAPTION)
'         End If
'         hBr = GetSysColorBrush(COLOR_INACTIVEBORDER)
'      End If
'
'      ' Titlebar area:
'      GetWindowRect m_hWnd, tR
'      OffsetRect tR, -tR.left, -tR.top
'      ' Draw the part between the edge &amp; the client:
'      LSet ttR = tR
'      ' left edge
'      ttR.top = GetSystemMetrics(SM_CYFRAME)
'      ttR.bottom = ttR.bottom - GetSystemMetrics(SM_CYFRAME)
'      ttR.right = GetSystemMetrics(SM_CXFRAME)
'      FillRect hdc, ttR, hBr
'      ' top
'      LSet ttR = tR
'      ttR.bottom = GetSystemMetrics(SM_CYFRAME)
'      FillRect hdc, ttR, hBr
'      ' right
'      LSet ttR = tR
'      ttR.top = GetSystemMetrics(SM_CYFRAME)
'      ttR.bottom = ttR.bottom - GetSystemMetrics(SM_CYFRAME)
'      ttR.left = ttR.right - GetSystemMetrics(SM_CXFRAME)
'      FillRect hdc, ttR, hBr
'      ' bottom
'      LSet ttR = tR
'      ttR.top = ttR.bottom - GetSystemMetrics(SM_CYFRAME)
'      FillRect hdc, ttR, hBr
'      ' top bit under titlebar:
'      LSet ttR = tR
'      ttR.top = GetSystemMetrics(SM_CXFRAME) + GetSystemMetrics(SM_CYCAPTION)
 - 1
'      ttR.bottom = ttR.top + 1
'      FillRect hdc, ttR, hBr
'      DeleteObject hBr
'
'      ' Edge 3d
'      DrawEdge hdc, tR, EDGE_RAISED, BF_RECT
'
'      ' Draw the titlebar into a work DC to prevent flicker:
'      lFlag = lFlag Or DC_ICON Or DC_TEXT
'      LSet ttR = tR
'      ttR.left = ttR.left + GetSystemMetrics(SM_CXFRAME)
'      ttR.right = ttR.right - GetSystemMetrics(SM_CXFRAME)
'      ttR.top = ttR.top + GetSystemMetrics(SM_CYFRAME)
'      ttR.bottom = ttR.top + GetSystemMetrics(SM_CYCAPTION) - 1
'      LSet tR = ttR
'      OffsetRect tR, -tR.left, -tR.top
'      LSet tSR = tR
'      tSR.right = tSR.right - (tR.bottom - tR.top) * 3 - 2
'      DrawCaption m_hWnd, m_hDC, tSR, lFlag
'
'      ' Draw the titlebar buttons:
'      tSR.left = tSR.right
'      tSR.right = tR.right
'      FillRect m_hDC, tSR, hBrButton
'      DeleteObject hBrButton
'
'      InflateRect tR, 0, -2
'      tR.right = tR.right - 2
'      tR.left = tR.right - (tR.bottom - tR.top) - 2
'      DrawFrameControl m_hDC, tR, DFC_CAPTION, DFCS_CAPTIONCLOSE
'      OffsetRect tR, -(tR.right - tR.left + 2), 0
'      If IsZoomed(m_hWnd) Then
'         DrawFrameControl m_hDC, tR, DFC_CAPTION, DFCS_CAPTIONRESTORE
'      Else
'         DrawFrameControl m_hDC, tR, DFC_CAPTION, DFCS_CAPTIONMAX
'      End If
'      OffsetRect tR, -(tR.right - tR.left), 0
'      DrawFrameControl m_hDC, tR, DFC_CAPTION, DFCS_CAPTIONMIN
'
'
'      ' Finished drawing the NC area:
'      BitBlt hdc, ttR.left, ttR.top, ttR.right - ttR.left, ttR.bottom -
 ttR.top, m_hDC, 0, 0, vbSrcCopy
'      ReleaseDC m_hWnd, hdc
'
   
   Case WM_NCCALCSIZE
      'Debug.Print "CalcSize"
      If wParam &lt;&gt; 0 Then
         CopyMemory tNCR, ByVal lParam, Len(tNCR)
         CopyMemory tWP, ByVal tNCR.lppos, Len(tWP)
         'pDebugCalcSize tNCR
         With tNCR.rgrc(0)
            .left = tWP.x + GetSystemMetrics(SM_CXFRAME)
            .top = tWP.y + GetSystemMetrics(SM_CYCAPTION) +
             GetSystemMetrics(SM_CYFRAME)
            .right = tWP.x + tWP.cx - GetSystemMetrics(SM_CXFRAME)
            .bottom = tWP.y + tWP.cy - GetSystemMetrics(SM_CYFRAME)
         End With
         LSet tNCR.rgrc(1) = tNCR.rgrc(0)
         CopyMemory ByVal lParam, tNCR, Len(tNCR)
         ISubclass_WindowProc = WVR_VALIDRECTS
      Else
         ' lParam points to a rectangle
         ISubclass_WindowProc = CallOldWindowProc(hwnd, iMsg, wParam, lParam)
      End If
         
      ' Check for the active window:
      lPtr = VarPtr(lpfMaximised)
      lhWnd = SendMessageLong(m_hWndMDIClient, WM_MDIGETACTIVE, 0, lPtr)
      'Debug.Print lhWnd, lPtr
      pShowMDIButtons lhWnd, (lpfMaximised &lt;&gt; 0)
      
   
'   Case WM_SETCURSOR
'      lStyle = GetWindowLong(m_hWnd, GWL_STYLE)
'      SetWindowLong m_hWnd, GWL_STYLE, lStyle And Not WS_VISIBLE
'      ISubclass_WindowProc = CallOldWindowProc(hWnd, iMsg, wParam, lParam)
'      SetWindowLong m_hWnd, GWL_STYLE, lStyle
   
   Case WM_ACTIVATE
      ' This message is fired when a form is activated or deactivated,
      ' normally immediately after the WM_NCACTIVATE message.
      ' Here we reset the safety check counter:
      m_bActive = (wParam &lt;&gt; 0)
      If m_bState Then
         'Debug.Print "cMDIToolbarMenu"; Hex$(hWnd)
         redrawToolbarHost
      End If
   End Select
            
End Function

Private Sub redrawToolbarHost()
Dim lhWnd As Long
   Dim cT As cToolbarHost
   Set cT = Toolbarhost
   If Not cT Is Nothing Then
      lhWnd = GetParent(cT.hwnd)
      lhWnd = GetParent(lhWnd)
      'Debug.Print "Redrawing: "; Hex$(lhWnd)
      RedrawWindowAsNull lhWnd, ByVal 0&amp;, 0, RDW_INVALIDATE Or RDW_UPDATENOW Or
       RDW_ALLCHILDREN ' RDW_ERASE Or
   End If
End Sub

Private Function getTheActiveWindow() As Boolean
Dim lhWnd As Long
   lhWnd = getActiveWindow()
   If lhWnd = m_hWnd Then
      getTheActiveWindow = True
   Else
      lhWnd = GetProp(lhWnd, TOOLWINDOWPARENTWINDOWHWND)
      If lhWnd = m_hWnd Then
         ' is active
         getTheActiveWindow = True
      Else
         If g_bTitleBarModifier Then
            lhWnd = GetWindow(lhWnd, GW_OWNER)
            If lhWnd = m_hWnd Then
               getTheActiveWindow = True
            End If
         End If
      End If
   End If
End Function

Private Sub pDebugCalcSize(ByRef tNCR As NCCALCSIZE_PARAMS)
Dim i As Long
Dim tWP As WINDOWPOS
Dim sMsg As String
   ' Use to show what is happening:
   With tNCR
      For i = 1 To 3
         With .rgrc(i - 1)
            sMsg = sMsg &amp; "rgrc(" &amp; i - 1 &amp; "):" &amp; .left &amp; "," &amp; .top &amp; "," &amp;
             .right &amp; "," &amp; .bottom &amp; vbCrLf
         End With
      Next i
      CopyMemory tWP, ByVal .lppos, Len(tWP)
      With tWP
         sMsg = sMsg &amp; ".lppos:" &amp; .x &amp; "," &amp; .y &amp; "," &amp; .x + .cx &amp; "," &amp; .y +
          .cy &amp; vbCrLf
      End With
      debugmsg sMsg
   End With
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">Toolbar</a>&#160;.&#160;<a href="article.html">vbAccelerator Toolbar and CoolMenu Control v3.5</a>&#160;.&#160;<a href="vb6_toolbar_complete_source.html">VB6 Toolbar Complete Source</a>&#160;.&#160;cMDIToolbarMenu.cls</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 12 May 2003</p></td><td></td></tr></table>
</body></html>