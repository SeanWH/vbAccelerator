<html lang="en" >
<head>

<title>vbAccelerator - ComCtl32.DLL Animation Control Class</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="This article presents a simple class you can use to load AVIs from files or an
application's resource file for display whilst the application is performing a 
long operation.
" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">AVI Player</a>&#160;.&#160;ComCtl32.DLL Animation Control Class</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="animation_control_class_code.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />Animation Control Class Code</a> (27K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Article:3909</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3909&type=article&title=comctl32_2edll_20animation_20control_20class.html">Link to this page</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">&#160;&#160;VB6</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav"><a href="bugtrak.html">BugTrak</a></p><p class="nav"><a href="bugtrak.html#bugs"><img src="..\..\..\..\..\res\btbug.png" width="16" height="16" alt="Bug" />&#160;Bugs:</a> 0 / 0</p><p class="nav"><a href="bugtrak.html#issues"><img src="..\..\..\..\..\res\btissue.png" width="16" height="16" alt="Issue" />&#160;Issues:</a> 0 / 0</p><p class="nav"><a href="bugtrak.html#questions"><img src="..\..\..\..\..\res\btquestion.png" width="16" height="16" alt="Question" />&#160;Questions:</a> 0 / 1</a></p><p class="nav">Updated:19 November 2003</p>
<br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />11 Feb 2003<br />First Posted</p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>ComCtl32.DLL Animation Control Class</h1><p class="splash">A simple to use class for adding animations to your project</p><img src="animcontrol.png" width="338" height="197" alt="Animate Control Class Sample" /><p /><p>This article presents a simple class you can use to load AVIs from files or an
application's resource file for display whilst the application is performing a 
long operation.
</p><h2>The ComCtl32.DLL Animation Control</h2><p>The animation control provided with ComCtl32.DLL is a simple way of displaying
AVI files asynchronously.  You can see this control in
use whenever you delete or copy large numbers of files from Windows Explorer: a small
popup window shows and displays a copy or delete AVI along with a progress bar.  The
control itself is nice and simple: once created, you tell it to load an AVI and then
it can either automatically start playing the AVI or you can start and stop the AVI
manually and control exactly which frames are displayed.  The AVI is played from a 
separate thread which means it continues to update even if your application is 
busy (note that this is only true when VB is running outside the IDE).</p><p>The control itself isn't actually much of a control: it's transparent to the
mouse and only has two events, which you very rarely ever want to use: notification
of the animation starting and stopping. So the approach taken here is to implement
it as a class instead, and allow you to specify which object (form or control)
you'd like the animation to be drawn on.</p><h2>The <i>cAnimControl</i> Class</h2><p>The class itself turns out to be 12k in size, which is rather smaller than using
the MS controls for the same purpose (the VB5 one is 161k, with VB6 coming in at a 
fairly hefty 633k...).  The class is a little tricker than a control because 
you can't set any properties outside code, but not very much as it only has a 
handful of properties and methods:</p><ul><li><strong>Owner</strong><br />
Gets/sets the object the animation control will be drawn onto.  As soon as this is
specified the control will be created, and any animations specified will be
loaded.</li><li><strong>Transparent</strong><br />
Gets/sets whether the AVI will be displayed transparently.  Transparent in terms
of the Animation Control means setting the background of the AVI to the background
colour of the object it is placed on.  When the AVI is loaded for the first time,
the control evaluates the top-left pixel of the first frame of the AVI.  This colour
is then replaced with the background colour of the background whether an AVI frame
is drawn.</li><li><strong>AutoPlay</strong><br />
Gets/sets whether the AVI will start continuously playing as soon as it has been
loaded.</li><li><strong>Centre</strong><br />
Gets/sets whether the AVI is centred to the Owner control when it is loaded.
Otherwise, the AVI is shown at the top left point in the control, and you can
determine the Width and Height of the AVI (in pixels) using the <i>Width</i> and
<i>Height</i> properties.</li><li><strong>FileName</strong><br />
Specifies the name of an AVI file to load.  Specifying this unloads any AVI
currently open.  If the filename is blank, then the control is hidden.</li><li><strong>ResourceId, ResourceFileName</strong><br />
See the next section for details on loading AVIs from resources.</li></ul><h2>Loading Animations from Resource Files</h2><p>Animations can be loaded from any EXE or DLL provided that they are created with the
resource type "AVI".  Here is a sample Resource File script (.rc file) for 
creating a compiled resource file containing an AVI at resource id 101:</p><pre>
// AVI
101 	AVI 	"printing.avi"
</pre><p>To open the animation from the resource, you first specify the <i>ResourceFileName</i> if
the resource is not in the current application's executable and then specify the animation
resource id to load using the <i>ResourceId</i>.  The class will attempt to load the 
resource as soon as <i>ResourceId</i> has been set.  Note that if you're loading the resource
from the local application (i.e. <i>ResourceFileName</i> is blank) then loading will only
succeed when the application is compiled.</p><h2>If You Really Do Want To Respond to Start, Stop Notifications</h2><p>Although the class doesn't support <i>Start</i> and <i>Stop</i> notifications,
its easy to add code to your project for them if you need to.  Just reference
the <a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing and Timer Assistant</a> and then add
code like this:</p><pre>
Option Explicit

Private Const WM_COMMAND = &amp;H111&amp;
Private Const ACN_START = 1
Private Const ACN_STOP = 2

Private m_cAnim As cAnimControl

Implements ISubClass


Private Sub Form_Load()

   ' Attach to the window handle of the Owner
   ' of the cAnimControl class:
   AttachMessage Me, picAnim.hWnd, WM_COMMAND
   
   ' Create the animation control, and play once:
   Set m_cAnim = New cAnimControl
   m_cAnim.Filename = App.Path &amp; "\download.avi"
   m_cAnim.Owner = picAnim
   
   m_cAnim.StartPlay , , 1

End Sub

Private Property Let ISubClass_MsgResponse(ByVal RHS As EMsgResponse)
   '
End Property

Private Property Get ISubClass_MsgResponse() As EMsgResponse
   ISubClass_MsgResponse = emrPostProcess
End Property

Private Function ISubClass_WindowProc( _
       ByVal hWnd As Long, _
       ByVal iMsg As Long, _
       ByVal wParam As Long, _
       ByVal lParam As Long) As Long

   If (iMsg = WM_COMMAND) Then
      If (lParam = m_cAnim.hWnd) Then
         Dim iCode As Long
         iCode = (wParam And &amp;H7FFF0000) \ &amp;H10000
         Select Case iCode
         Case ACN_START
            Debug.Print "Started..."
         Case ACN_STOP
            Debug.Print "Stopped."
         End Select
      End If
   End If

End Function
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\vbmedia\using_gdi_plus\index.html" ><IMG SRC="..\..\..\..\..\res\gdiplus.png" ALT="A GDI+ Library for VB - read and write PNG, JPG, TIF and GIF files, and manipulate bitmaps quickly" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">AVI Player</a>&#160;.&#160;ComCtl32.DLL Animation Control Class</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 14 July 2003</p></td><td></td></tr></table>
</body></html>
