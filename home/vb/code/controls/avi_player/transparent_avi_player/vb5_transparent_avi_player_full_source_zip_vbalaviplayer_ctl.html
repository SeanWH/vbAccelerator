<html lang="en" >
<head>
<title>vbAccelerator - Contents of code file: vbalAVIPlayer.ctl</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><meta name="AUTHOR" content="Steve McMahon" /><meta name="KEYWORDS" content=".NET, .NET Framework, C#, CSharp, VB, Visual Basic, VB5, VB6, Visual Basic, Active X, Controls, Components" /><meta name="DESCRIPTION" content="vbAccelerator - Contents of code file: vbalAVIPlayer.ctl" /><link rel="stylesheet" href="..\..\..\..\..\res\screen.css" media="SCREEN" /><link rel="stylesheet" href="..\..\..\..\..\res\print.css" media="PRINT" /></head><body>
<table>
<tr class="adbar" bgcolor="#83726a"><td colspan="3">
<!-- TF 468x60 JScript HORIZ NoPop code -->
<script language=javascript><!--
document.write('<scr'+'ipt language=javascript src="http://a.tribalfusion.com/j.ad?site=VBAcceleratorcom&adSpace=ROS&size=468x60&type=horiz&pop=0&requestID='+((new Date()).getTime() % 2147483648) + Math.random()+'"></scr'+'ipt>');
//-->
</script>
<noscript>
   <a href="javascript:window.alert(&quot;http://a.tribalfusion.com/i.click?site=VBAcceleratorcom&adSpace=ROS&size=468x60&requestID=1423477941\nThis link was not retrieved.&quot;)" target=_blank>
   <img src="http://cdn5.tribalfusion.com/media/493786.gif" 
                  width=468 height=60 border=0 alt="Click Here"></a>
</noscript>
<!-- TF 468x60 JScript HORIZ NoPop code -->
</td></tr><tr class="navbar"><td><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">AVI Player</a>&#160;.&#160;<a href="article.html">Transparent AVI Player Control</a>&#160;.&#160;<a href="vb5_transparent_avi_player_full_source.html">VB5 Transparent AVI Player Full Source</a>&#160;.&#160;vbalAVIPlayer.ctl</p></td><td></td></tr><tr class="navbar"><td colspan="3"><hr /></td></tr><tr valign="top"><td class="sidebar"><img src="..\..\..\..\..\res\download.png" width="125" height="21" alt="Downloads" /><p class="nav"><a href="vb5_transparent_avi_player_control.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Transparent AVI Player Control</a> (13K)</p><p class="nav"><a href="vb5_transparent_avi_player_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Transparent AVI Player Demonstration</a> (57K)</p><p class="nav"><a href="vb5_transparent_avi_player_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB5 Transparent AVI Player Full Source</a> (87K)</p><p /><p class="nav"><a href="vb6_transparent_avi_player_control.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Transparent AVI Player Control</a> (13K)</p><p class="nav"><a href="vb6_transparent_avi_player_demonstration.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Transparent AVI Player Demonstration</a> (56K)</p><p class="nav"><a href="vb6_transparent_avi_player_full_source.html"><img src="..\..\..\..\..\res\get.png" width="8" height="8" alt="Download Page" />VB6 Transparent AVI Player Full Source</a> (86K)</p><br /><br /><img src="..\..\..\..\..\res\information.png" width="125" height="21" alt="Information" /><p class="nav">Zip:3936</p><p class="nav">&#160;&#160;<a href="..\..\..\..\..\..\linkto_asp\id=3936&type=zip&title=vb5_20transparent_20avi_20player_20full_20source_2ezip_5fvbalaviplayer.html">Link to code Zip</a></p><p class="nav">Applies To:</p><p class="nav">&#160;&#160;VB5</p><p class="nav">Author:</p><p class="nav">&#160;&#160;<a href="mailto:steve@vbaccelerator.com">Steve McMahon</a></p><br /><br /><img src="..\..\..\..\..\res\bugtrak.png" width="125" height="21" alt="BugTrak System" /><p class="nav">No logged bugs.</p><br /><br /><img src="..\..\..\..\..\res\updates.png" width="125" height="21" alt="Updates" /><p class="nav"><img src="..\..\..\..\..\res\update.png" width="8" height="8" alt="Update" />23 Nov 2003<br /><p class="update">The last version of the control only rendered the AVI 
transparently when a background bitmap was selected.  Corrected so now
the <span class="code">BackColor</span> of the control is displayed 
when no background bitmap is present.</p></p><p class="update"><a href="updates.html">Update History &gt;</a></p><br /><br /><img src="..\..\..\..\..\res\related.png" width="125" height="21" alt="Related Items" /><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\libraries\subclassing\ssubtimer\article.html">Subclassing Without The Crashes</a></p><p class="nav"><img src="..\..\..\..\..\res\rel.png" width="8" height="8" alt="Related Item" /><a href="..\..\..\techniques\finding_which_dll_contains_an_api_call\article.html">Finding Which DLL Contains an API Call</a></p><br /><br /><img src="..\..\..\..\..\res\search.png" width="125" height="21" alt="Search" />
<!-- Search Google -->
<form method="GET" action="http://www.google.com/custom">
<a href="javascript:window.alert(&quot;http://www.google.com/search\nThis link was not retrieved.&quot;)"><img src="..\..\..\..\..\..\..\www_google_com\logos\logo_40wht.gif" alt="Google" /></A><br />
<input type="text" name="q" size="31" maxlength="255" value="" class="search" /><br />
<input type="submit" name="sa" value="Search Google" class="search" />
<input type="hidden" name="cof" value="T:black;LW:330;ALC:990000;L:http://www.vbaccelerator.com/images/accl9.gif;LC:660000;LH:66;BGC:white;AH:left;VLC:999966;S:http://vbaccelerator.com/;GALT:999966;AWFID:67c7759ff27e5395;" />
<input type="hidden" name="domains" value="vbaccelerator.com" /><br />
<p class="nav"><input type="radio" name="sitesearch" value="" />Search WWW<br /></p>
<p class="nav"><input type="radio" name="sitesearch" value="vbaccelerator.com" checked="true" />vbAccelerator<br /></p>
</FORM>
<!-- Search Google -->
<br /><br />

<a href="..\..\..\..\..\the_site\newsite\article.html"><img src="..\..\..\..\..\res\newsite.png" width="125" height="129" alt="The New Site" /></a>
<br /><br />
</td><td width="100%" valign="top"><h1>vbAccelerator - Contents of code file: vbalAVIPlayer.ctl</h1><pre>VERSION 5.00
Begin VB.UserControl vbalAVIPlayer 
   BorderStyle     =   1  'Fixed Single
   ClientHeight    =   3600
   ClientLeft      =   0
   ClientTop       =   0
   ClientWidth     =   4800
   ScaleHeight     =   3600
   ScaleWidth      =   4800
   ToolboxBitmap   =   "vbalAVIPlayer.ctx":0000
End
Attribute VB_Name = "vbalAVIPlayer"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = True
Option Explicit

Private Declare Function SetWindowLong Lib "user32" Alias "SetWindowLongA"
 (ByVal hWnd As Long, ByVal nIndex As Long, ByVal dwNewLong As Long) As Long
Private Declare Function GetWindowLong Lib "user32" Alias "GetWindowLongA"
 (ByVal hWnd As Long, ByVal nIndex As Long) As Long
Private Declare Function SetWindowPos Lib "user32" (ByVal hWnd As Long, ByVal
 hWndInsertAfter As Long, ByVal x As Long, ByVal y As Long, ByVal cx As Long,
 ByVal cy As Long, ByVal wFlags As Long) As Long

' Some styles:
Private Const GWL_STYLE = (-16)
Private Const WS_BORDER = &amp;H800000

Private Const WS_CHILD = &amp;H40000000
Private Const WS_DISABLED = &amp;H8000000
Private Const WS_VISIBLE = &amp;H10000000
Private Const WS_TABSTOP = &amp;H100000
Private Const WS_HSCROLL = &amp;H100000
Private Const GWL_EXSTYLE = (-20)
Private Const WS_EX_TOPMOST = &amp;H8&amp;
Private Const WS_EX_CLIENTEDGE = &amp;H200&amp;
Private Const WS_EX_STATICEDGE = &amp;H20000
Private Const CW_USEDEFAULT = &amp;H80000000

' SetWindowPos
Private Const SWP_FRAMECHANGED = &amp;H20        '  The frame changed: send
 WM_NCCALCSIZE
Private Const SWP_NOACTIVATE = &amp;H10
Private Const SWP_NOMOVE = &amp;H2
Private Const SWP_NOOWNERZORDER = &amp;H200      '  Don't do owner Z ordering
Private Const SWP_NOREDRAW = &amp;H8
Private Const SWP_NOSIZE = &amp;H1
Private Const SWP_NOZORDER = &amp;H4
Private Const SWP_SHOWWINDOW = &amp;H40

Public Enum EAVIPAppearanceConstants
   eavipFlat
   eavip3D
End Enum

Public Enum EAVIPBorderStyleConstants
   eavipNone
   eavipFixedSingle
   eavipThin
End Enum

Private m_eAppearance As EAVIPAppearanceConstants
Private m_eBorder As EAVIPBorderStyleConstants
Private m_hWnd As Long
Private m_bTransparent As Boolean
Private m_oBackColor As OLE_COLOR
Private m_cAV As New cAVICtrl
Private m_bRunTime As Boolean

Public Property Get Appearance() As EAVIPAppearanceConstants
   Appearance = m_eAppearance
End Property
Public Property Let Appearance(ByVal eStyle As EAVIPAppearanceConstants)
   m_eAppearance = eStyle
   pSetBorder
   PropertyChanged "Appearance"
End Property
Public Property Get BorderStyle() As EAVIPBorderStyleConstants
   BorderStyle = m_eBorder
End Property
Public Property Let BorderStyle(ByVal eStyle As EAVIPBorderStyleConstants)
   m_eBorder = eStyle
   pSetBorder
   PropertyChanged "BorderStyle"
End Property
Private Sub pSetBorder()
Dim lS As Long
   If m_eAppearance = eavipFlat Then
      ' Flat border
      UserControl.BorderStyle() = 0
      pSetWinExStyle 0, WS_EX_STATICEDGE Or WS_EX_CLIENTEDGE
      If m_eBorder &gt; eavipNone Then
         pSetStyle WS_BORDER, 0
      Else
         pSetStyle 0, WS_BORDER
      End If
   Else
      ' 3d border
      pSetStyle 0, WS_BORDER
      UserControl.BorderStyle() = 0
      If m_eBorder = eavipFixedSingle Then
         pSetWinExStyle WS_EX_CLIENTEDGE, WS_EX_STATICEDGE
      Else
         If m_eBorder = eavipThin Then
            pSetWinExStyle WS_EX_STATICEDGE, WS_EX_CLIENTEDGE
         Else
            pSetWinExStyle 0, WS_EX_STATICEDGE Or WS_EX_CLIENTEDGE
         End If
      End If
   End If
End Sub

Private Sub pSetStyle(ByVal lStyle As Long, ByVal lStyleNot As Long)
Dim lS As Long
   If Not m_hWnd = 0 Then
      lS = GetWindowLong(m_hWnd, GWL_STYLE)
      lS = lS And Not lStyleNot
      lS = lS Or lStyle
      SetWindowLong m_hWnd, GWL_STYLE, lS
      SetWindowPos m_hWnd, 0, 0, 0, 0, 0, SWP_NOMOVE Or SWP_NOSIZE Or
       SWP_NOOWNERZORDER Or SWP_NOZORDER Or SWP_FRAMECHANGED
   End If
End Sub
Private Sub pSetWinExStyle(ByVal lStyle As Long, ByVal lStyleNot As Long)
Dim lS As Long
   If Not m_hWnd = 0 Then
      lS = GetWindowLong(m_hWnd, GWL_EXSTYLE)
      lS = lS And Not lStyleNot
      lS = lS Or lStyle
      SetWindowLong m_hWnd, GWL_EXSTYLE, lS
      SetWindowPos m_hWnd, 0, 0, 0, 0, 0, SWP_NOMOVE Or SWP_NOSIZE Or
       SWP_NOOWNERZORDER Or SWP_NOZORDER Or SWP_FRAMECHANGED
   End If
End Sub
Public Function Load() As Boolean
   Load = m_cAV.Load
End Function
Public Function AVIPlay() As Boolean
   If m_cAV.IsLoaded Then
      AVIPlay = m_cAV.AVIPlay
   End If
End Function
Public Function AVIStop() As Boolean
   If m_cAV.IsLoaded Then
      If m_cAV.IsPlaying Then
         AVIStop = m_cAV.AVIStop
      End If
   End If
End Function
Public Function AVISeek(ByVal nFrame As Long) As Boolean
   If m_cAV.IsLoaded Then
      AVISeek = m_cAV.AVISeek(nFrame)
   End If
End Function
Public Property Get Playing() As Boolean
   Playing = m_cAV.IsPlaying
End Property
Public Property Let Playing(ByVal bState As Boolean)
   If m_cAV.IsPlaying Then
      If Not bState Then
         m_cAV.AVIStop
      End If
   Else
      If bState Then
         m_cAV.AVIPlay
      End If
   End If
End Property
Public Property Get CurrentFrame() As Boolean
   CurrentFrame = m_cAV.CurrentFrame
End Property
Public Property Get FrameCount() As Boolean
   FrameCount = m_cAV.FrameCount
End Property
Public Property Get FileName() As String
   FileName = m_cAV.FileName
End Property
Public Property Let FileName(ByVal sFileName As String)
   m_cAV.FileName = sFileName
End Property
Public Property Get TransparentColor() As OLE_COLOR
   TransparentColor = m_cAV.TransparentColor
End Property
Public Property Let TransparentColor(ByVal oColor As OLE_COLOR)
   m_cAV.TransparentColor = oColor
   PropertyChanged "TransparentColor"
End Property
Public Property Get Transparent() As Boolean
   Transparent = m_cAV.Transparent
End Property
Public Property Let Transparent(ByVal bState As Boolean)
   m_cAV.Transparent = bState
   PropertyChanged "Transparent"
End Property
Public Property Get Centre() As Boolean
   Centre = m_cAV.Centre
End Property
Public Property Let Centre(ByVal bState As Boolean)
   m_cAV.Centre = bState
   PropertyChanged "Centre"
End Property

Public Property Get BackColor() As OLE_COLOR
   BackColor = m_oBackColor
End Property
Public Property Let BackColor(ByVal oColor As OLE_COLOR)
   m_oBackColor = oColor
   m_cAV.BackColor = m_oBackColor
   UserControl.BackColor = m_oBackColor
   PropertyChanged "BackColor"
End Property

Public Property Get Picture() As StdPicture
   Set Picture = m_cAV.Picture
End Property
Public Property Let Picture(sPic As StdPicture)
   pSetPicture sPic
   PropertyChanged "Picture"
End Property
Public Property Set Picture(sPic As StdPicture)
   pSetPicture sPic
   PropertyChanged "Picture"
End Property
Private Sub pSetPicture(sPic As StdPicture)
   Set m_cAV.Picture = sPic
End Sub

Public Property Get hWnd() As Long
   hWnd = m_hWnd
End Property

Private Sub pInitialise()
   m_hWnd = UserControl.hWnd
   Set m_cAV = New cAVICtrl
   m_bRunTime = UserControl.Ambient.UserMode
   If m_bRunTime Then
      m_cAV.Attach m_hWnd
   End If
End Sub
Private Sub pTerminate()
   Set m_cAV = Nothing
End Sub

Private Sub UserControl_Initialize()
   m_eBorder = eavipFixedSingle
   m_eAppearance = eavip3D
End Sub

Private Sub UserControl_InitProperties()
   pInitialise
End Sub

Private Sub UserControl_ReadProperties(PropBag As PropertyBag)
   pInitialise
   BackColor = PropBag.ReadProperty("BackColor", vbButtonFace)
   BorderStyle = PropBag.ReadProperty("BorderStyle", eavipFixedSingle)
   Appearance = PropBag.ReadProperty("Appearance", eavip3D)
   Picture = PropBag.ReadProperty("Picture", Nothing)
   TransparentColor = PropBag.ReadProperty("TransparentColor", &amp;HFFFF00)
   Transparent = PropBag.ReadProperty("Transparent", False)
   Centre = PropBag.ReadProperty("Centre", False)
   FileName = PropBag.ReadProperty("FileName", "")
End Sub

Private Sub UserControl_Resize()
'
End Sub

Private Sub UserControl_Terminate()
   pTerminate
End Sub

Private Sub UserControl_WriteProperties(PropBag As PropertyBag)
   PropBag.WriteProperty "BackColor", m_oBackColor, vbButtonFace
   PropBag.WriteProperty "BorderStyle", BorderStyle, eavipFixedSingle
   PropBag.WriteProperty "Appearance", Appearance, eavip3D
   PropBag.WriteProperty "Picture", Picture, Nothing
   PropBag.WriteProperty "TransparentColor", TransparentColor, &amp;HFFFF00
   PropBag.WriteProperty "Transparent", Transparent, False
   PropBag.WriteProperty "Centre", Centre, False
   PropBag.WriteProperty "FileName", FileName, ""
End Sub
</pre><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p><p>&#160;</p></td><td class="rightbar" valign="top" bgcolor="#C2BEB1">
<!-- No right bar content currently defined -->
</td></tr><tr class="footer"><td></td>
<td>
<p class="center">

<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_channel ="";
google_ad_type = "text_image";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<A HREF="..\..\..\..\..\index.html" ><IMG SRC="..\..\..\..\..\res\vbaccelad.png" ALT="vbAccelerator - Faster VB Code" WIDTH=468 HEIGHT=60 BORDER=0></A>
</noscript>

</p>
</td>
<td></td>
</tr><tr><td colspan="3"><hr /></td></tr><tr class="footer"><td valign="top"><a href="..\..\..\..\..\index.html"><img width="125" height="25" src="..\..\..\..\..\res\vbaccelerator.png" alt="vbAccelerator Logo" /></a></td><td valign="bottom"><p class="nav"><a href="..\..\..\..\..\index.html">Home</a>&#160;.&#160;<a href="..\..\..\..\index.html">VB</a>&#160;.&#160;<a href="..\..\..\index.html">Code</a>&#160;.&#160;<a href="..\..\index.asp\index.html">Controls</a>&#160;.&#160;<a href="..\index.html">AVI Player</a>&#160;.&#160;<a href="article.html">Transparent AVI Player Control</a>&#160;.&#160;<a href="vb5_transparent_avi_player_full_source.html">VB5 Transparent AVI Player Full Source</a>&#160;.&#160;vbalAVIPlayer.ctl</p><br /><p class="nav"><a href="..\..\..\..\..\the_site\copyright\article.html">Copyright</a> &#169; 2003 Steve McMahon <a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>.  All rights reserved.<br />Last Updated: 24 November 2003</p></td><td></td></tr></table>
</body></html>