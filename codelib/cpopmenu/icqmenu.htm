<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="Author" content="Steve McMahon">
<meta name="KeyWords"
content="VB, VB6, Visual Basic, Visual Basic 5, Visual Basic 6, Dynamic HTML, DHTML, IE4, Internet Explorer, Internet Explorer 4, Active X, Active X Controls, Visual Basic Controls">
<meta name="GENERATOR" content="Notepad">
<title>Using the cNewMenu DLL to Create Start Menu/ICQ Style Pop-up Menus</title>
</head>

<body bgcolor="#FFFFFF" topmargin="0" leftmargin="0" link="#660000" vlink="#999966" LEFTMARGIN="0" TOPMARGIN="0" MARGINHEIGHT="0" MARGINWIDTH="0" background="..\..\images\legacy.html">

<!-- AD:START -->
<table bgcolor="#336699" border="0" cellpadding="0" cellspacing="0" width="100%" >
<tr>
<td width="468">
<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<a href="..\..\home\index.html"><img src="..\..\home\res\vbaccelad.png" width="468" height="60" 
border="0" alt="vbAccelerator - Faster VB and .NET Code" /></a>
</noscript>
</td>
<td>
<a href="..\..\home\index.html"><img src="..\..\home\res\vbaccelnew.png" width="125" height="60" 
border="0" alt="The new vbAccelerator Site - more VB and .NET Code and Controls" /></a>
</td>
</tr>
</table>
<!-- AD:END -->
<a name="sectop"></a>

<table border="0" width="100%" cellspacing="0" cellpadding="0">
<tr bgcolor="#660000">
	<td width="100%" height="25">
	<font color="#FFFFFF" face="verdana,arial,helvetica" size="2"><strong>
	Source Code
	</strong>
	</font>
	</td>
	<td width="96">
	<font color="#FFFFFF" face="verdana,arial,helvetica" size="2"><strong>
	<a title="Installation Instructions and Requirements" href="..\..\install.htm"><img src="..\..\images\install.gif" height="12" width="96" border="0" valign="center"></a>
	</strong>
	</font>
	</td>
	<td width="96">
	<font color="#FFFFFF" face="verdana,arial,helvetica" size="2"><strong>
	<a title="Back to Source Code" href="..\..\overview.htm"><img src="..\..\images\srccode.gif" height="12" width="96" border="0" valign="center"></a>
	</strong>
	</font>
	</td>
</tr>
</table>
<table border="0" width="100%" cellspacing="0" cellpadding="0">
<tr bgcolor="#FFCC00">
	<td valign="bottom" width="32">
	<font color="#666666" face="verdana,arial,helvetica" size="6"><strong>1</strong></font>
	</td>
	<td valign="center">
	<font color="#666666" face="verdana,arial,helvetica" size="4"><strong>VB 5 Custom Controls</strong></font>
	</td>
	<td width="10">&nbsp</td>
</tr>
</table>

<!-- SUPERCEEDED:START -->
<br />
<table border="0" width="100%" cellspacing="0" cellpadding="5">
<tr>
<td width="66" bgcolor="#FFFFFF"><br /></td>
<td width="100%" bgcolor="#EEEEEE">
	<p>
	<font color="#666666" face="verdana,arial,helvetica" size="5">
	<b>&nbsp;NOTE:</b></font>
	<font color="#999999" face="verdana,arial,helvetica" size="2">this code has been superceded by the <a href="..\..\home\vb\code\controls\menus\popupmenu_-_startmenu_icq_like_sample\article.html" target="_top">version at the new site</a>.
	</font>
	<br />
        </p>
</td>
<td width="66" bgcolor="#FFFFFF"><br /></td>
</tr>
</table>
<br />
<!-- SUPERCEDED:END -->


<table border="0" width="100%" cellspacing="0" cellpadding="0">
<tr>
	<td>&nbsp</td>
	<td colspan="3">
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	<br>
	<p><b>Using the cNewMenu DLL to Create Start Menu/ICQ Style Pop-up Menus</b><br>
	<p><img src="..\..\images\icqpmenu.gif" alt="ICQ Style Menu Demonstration" width="328" height="297"></p>
	<p><a href="menuicq.zip"><img src="..\..\images\vbdnload.gif" width="16" height="16" border="0" hspace="4">Download the ICQ Menu demonstration project (68kb)</a></p>
	</font>
	<p> 
	<table>
	<tr>
		<td>&nbsp</td>
		<td colspan="2" bgcolor="#EEEEEE">
		<font color="#000000" face="verdana,arial,helvetica" size="1">
		<b>Before you Begin</b>
		</font>
		</td>
		<td>&nbsp</td>
	</tr>
	<tr>
		<td>&nbsp</td>
		<td valign="top"><img src="..\..\images\bullet.gif" border="0" hspace="2" width="8" height="8"></td>
		<td valign="top">
		<font color="#000000" face="verdana,arial,helvetica" size="1">
		This project requires the <a href="cnewmenu.htm">cNewMenu.DLL component</a>.  Make sure you have loaded and registered this before trying any project.
		</font>
		</td>
		<td>&nbsp</td>
	</tr>
	<tr>
		<td>&nbsp</td>
		<td valign="top"><img src="..\..\images\bullet.gif" border="0" hspace="2" width="8" height="8"></td>
		<td valign="top">
		<font color="#000000" face="verdana,arial,helvetica" size="1">
		This project requires the <a href="..\ssubtmr\ssubtmr.htm">SSubTmr.DLL component</a>.  Make sure you have loaded and registered this before trying any project.
		</font>
		</td>
		<td>&nbsp</td>
	</tr>
	</table>
	</p>
	</font>
	<font color="#000000" face="verdana,arial,helvetica" size="2">

	<p><b>Overview</b><br>
	The cNewMenu ActiveX DLL let's you create an unlimited number of cool-looking pop-up menus
	in your application, but what to do in the unlikely event that even that's not cool enough 
	for you?  The new version gives you this control too.  The <i>OwnerDraw</i> property, which 
	applies to each menu item allows you to intercept measuring and drawing events for the
	menu item, and to either add bits or completely take charge of drawing the items.
	<br><br>
	This sample shows you how to add to the existing menu, in order to create a side bar up
	the left-hand edge of the menu to give a pop-up menu that Start Menu/ICQ look.  Another sample
	(<a href="odpmenu.htm">Owner Draw Pop-up Menus</a>) shows you how to take complete
	control of drawing the menu items to create a line-style and a highlight-colour picker.
	</p>
	<p><b>How it Works</b><br>
	When you set the <i>OwnerDraw</i> property to true for a menu item, the cNewMenu ActiveX DLL 
	will raise <i>MeasureItem</i> and <i>DrawItem</i> events to your code.  If you don't do 
	anything to respond to these methods except set the <i>bDoDefault</i> parameter to True
	during the <i>DrawItem</i> event, the menu will draw using the standard style.<br><br>
	On the other hand, you can freely modify the width and height of the item during the 
	<i>MeasureItem</i> method, and during the <i>DrawItem</i> method you can adjust the 
	rectangle in which the item draws.  In this sample I want to increase the size of menu
	items so they accommodate the side bar, and also ensure they draw after the side bar.
	I use a PictureBox to hold the graphic of the side bar called <i>picSideBar</i>.
	So in response to MeasureItem you do this:<br>
	</p>
	</font>
<p><font color="#000000" face="Lucida Console,Courier New" size="1">
Private Sub m_cMenu_MeasureItem(_<br>
&nbsp;&nbsp;&nbsp;ByVal lMenuIndex As Long, _<br>
&nbsp;&nbsp;&nbsp;lWidth As Long, _<br>
&nbsp;&nbsp;&nbsp;lHeight As Long _<br>
)<br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' When a menu item is owner-draw, it will raise this event to request</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' its size.  lWidth as lHeight will be already filled in with the</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' size of the menu item as it would be if the standard drawing method</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' was used.</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
<br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' Here we check if the item being measured is in the main pop-up menu;</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' if it is we add the width to accommodate the side bar logo:</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;If m_cMenu.hMenu(1) = m_cMenu.hMenu(lMenuIndex) Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' Add the side bar width:</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lWidth = lWidth + picSideBar.Width \ Screen.TwipsPerPixelX + 1<br>
&nbsp;&nbsp;&nbsp;End If<br>
End Sub</font></p>
<font color="#000000" face="verdana,arial,helvetica" size="2">
	<p>
	And in response to DrawItem:
	</p>
<p><font color="#000000" face="Lucida Console,Courier New" size="1">Private Sub m_cMenu_DrawItem( _<br>
&nbsp;&nbsp;&nbsp;ByVal hDC As Long, _<br>
&nbsp;&nbsp;&nbsp;ByVal lMenuIndex As Long, _<br>
&nbsp;&nbsp;&nbsp;lLeft As Long, lTop As Long, _<br>
&nbsp;&nbsp;&nbsp;lRight As Long, lBottom As Long, _<br>
&nbsp;&nbsp;&nbsp;ByVal bSelected As Boolean, ByVal bChecked As Boolean, _<br>
&nbsp;&nbsp;&nbsp;ByVal bDisabled As Boolean, _<br>
&nbsp;&nbsp;&nbsp;bDoDefault As Boolean _<br>
)<br>
&nbsp;&nbsp;&nbsp;Dim lW As Long<br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' The DrawItem event for Owner Draw menu items either allows you</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' to draw the entire item, or just to do some new drawing then</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' let the standard method do its stuff.  This is useful if you</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' want to add a graphic to the left or right of the menu item.</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
<br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' Here we draw the relevant part of the side bar</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' logo to the left of the menu then offset the</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' left position so the rest of the menu draws</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' after it:</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;lW = picSideBar.Width \ Screen.TwipsPerPixelX<br>
&nbsp;&nbsp;&nbsp;BitBlt hDC, lLeft, lTop, lW, lBottom - lTop, _<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;picSideBar.hDC, 0, lTop, vbSrcCopy<br>
&nbsp;&nbsp;&nbsp;lLeft = lLeft + lW + 1<br>
&nbsp;&nbsp;&nbsp;bDoDefault = True<br>
End Sub</font></p>
<font color="#000000" face="verdana,arial,helvetica" size="2">
	<p>
	Note that all the measurements are in pixels.<br><br>
	<b>Drawing The Sidebar Itself</b><br>
	To draw the side bar you just need a method of creating a vertical font and a gradient.
	Both of these are covered in more detail in the class supplied with the article 
	<a href="..\sidelogo\sidelogo.htm">Text	at any angle</a>. You'll see that you can 
	customise the font, the text to be drawn, the icon to be drawn and the start and end colours
	of the gradient using the class.  The only extra thing required to make this work is to 
	determine how tall the side bar will be.  This is done by asking the DLL for the menu
	item height using the <i>MenuItemHeight</i> property of the menu items.
	</p>
</font>
<p><font color="#999999" face="Lucida Console,Courier New" size="1">' Firstly, evaluate the menu item's height in the main menu:</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
Dim lHeight As Long, lT As Long<br>
<br>
For i = 1 To m_cMenu.Count<br>
&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' Check if item is in the main menu:</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;If (m_cMenu.hMenu(i) = m_cMenu.hMenu(1)) Then<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#999999" face="Lucida Console,Courier New" size="1">' Add the item:</font><font color="#000000" face="Lucida Console,Courier New" size="1"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lHeight = lHeight + m_cMenu.MenuItemHeight(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lT = lT + 1<br>
&nbsp;&nbsp;&nbsp;End If<br>
Next i<br>
<br>
</font></p>
<font color="#000000" face="verdana,arial,helvetica" size="2">
	<p>
	<b>Other Stuff</b><br>
	The sample also implements a very simple PictureClip based animated button
	control.  Have fun with it!<br><br>

	</p>
	</font>
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	<br><br><br>
	<p><a href="#sectop"><img src="..\..\images\top.gif" border="0" width="8" height="12" hspace="4" alt="Top"></a>Back to <a href="#sectop">top</a></p>
	<p><a href="..\..\overview.htm"><img src="..\..\images\sc.gif" border="0" width="8" height="12" hspace="4" alt="Source Code - What We're About!"></a>Back to <a href="..\..\overview.htm">Source Code</a></p>
	</font>
	</td>
	<td>&nbsp</td>
</tr>
</table>	

<!-- SUPERCEEDED:START -->
<br />
<table border="0" width="100%" cellspacing="0" cellpadding="5">
<tr>
<td width="66" bgcolor="#FFFFFF"><br /></td>
<td width="100%" bgcolor="#EEEEEE">
	<p>
	<font color="#666666" face="verdana,arial,helvetica" size="5">
	<b>&nbsp;NOTE:</b></font>
	<font color="#999999" face="verdana,arial,helvetica" size="2">this code has been superceded by the <a href="..\..\home\vb\code\controls\menus\popupmenu_-_startmenu_icq_like_sample\article.html" target="_top">version at the new site</a>.
	</font>
	<br />
        </p>
</td>
<td width="66" bgcolor="#FFFFFF"><br /></td>
</tr>
</table>
<br />
<!-- SUPERCEDED:END -->

<img src="..\..\images\bpixel.gif" height="1" width="100%" border="0">

<!-- BODY:END -->

<!-- FOOTER:START -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 13 February 1999
	</font>
	</p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>

