<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="Author" content="Steve McMahon">
<meta name="KeyWords"
content="VB, VB6, Visual Basic, Visual Basic 5, Visual Basic 6, Dynamic HTML, DHTML, IE4, Internet Explorer, Internet Explorer 4, Active X, Active X Controls, Visual Basic Controls">
<meta name="GENERATOR" content="Notepad">
<title>Icons In Menus</title>
</head>

<body bgcolor="#FFFFFF" topmargin="0" leftmargin="0" link="#660000" vlink="#999966" LEFTMARGIN="0" TOPMARGIN="0" MARGINHEIGHT="0" MARGINWIDTH="0" background="..\..\images\legacy.html">

<!-- AD:START -->
<table bgcolor="#336699" border="0" cellpadding="0" cellspacing="0" width="100%" >
<tr>
<td width="468">
<script type="text/javascript"><!--
google_ad_client = "pub-4690375644913255";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<noscript>
<a href="..\..\home\index.html"><img src="..\..\home\res\vbaccelad.png" width="468" height="60" 
border="0" alt="vbAccelerator - Faster VB and .NET Code" /></a>
</noscript>
</td>
<td>
<a href="..\..\home\index.html"><img src="..\..\home\res\vbaccelnew.png" width="125" height="60" 
border="0" alt="The new vbAccelerator Site - more VB and .NET Code and Controls" /></a>
</td>
</tr>
</table>
<!-- AD:END -->
 name="sectop"></a>

<!-- SECTION:START -->
<table border="0" width="100%" cellspacing="0" cellpadding="0">
<tr bgcolor="#660000">
	<td width="100%" height="25">
	<font color="#FFFFFF" face="verdana,arial,helvetica" size="2"><strong>
	Source Code
	</strong>
	</font>
	</td>
	<td width="96">
	<font color="#FFFFFF" face="verdana,arial,helvetica" size="2"><strong>
	<a title="Installation Instructions and Requirements" href="..\..\install.htm"><img src="..\..\images\install.gif" height="12" width="96" border="0" valign="center"></a>
	</strong>
	</font>
	</td>
	<td width="96">
	<font color="#FFFFFF" face="verdana,arial,helvetica" size="2"><strong>
	<a title="Back to Source Code" href="..\..\overview.htm"><img src="..\..\images\srccode.gif" height="12" width="96" border="0" valign="center"></a>
	</strong>
	</font>
	</td>
</tr>
</table>
<!-- SECTION:END -->

<!-- AREA:START -->
<table border="0" width="100%" cellspacing="0" cellpadding="0">
<tr bgcolor="#FFCC00">
	<td valign="bottom" width="32">
	<font color="#666666" face="verdana,arial,helvetica" size="6"><strong>1</strong></font>
	</td>
	<td valign="center">
	<font color="#666666" face="verdana,arial,helvetica" size="4"><strong>VB 5 Custom Controls</strong></font>
	</td>
	<td width="10">&nbsp</td>
</tr>
</table>
<!-- AREA:END -->


<!-- TITLE:START -->
<table border="0" width="100%" cellspacing="0" cellpadding="0">
<tr bgcolor="#EEEEEE">
	<td>
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	&nbsp;<b>Icons In Menus</b>
	</font>
	</td>
	<td>&nbsp;</td>
</tr>
</table>
<!-- TITLE:END -->

<!-- SPLASH:START -->
<table border="0" width="100%" cellspacing="0" cellpadding="0">
<tr>
	<td>&nbsp;</td>
	<td>
	<font color="#660000" face="verdana,arial,helvetica" size="1">
	<p>Convert standard VB Menus to Icon Menus for a smarter look</p>
	</font>	
	</td>
	<td>&nbsp;</td>
</tr>
</table>
<!-- SPLASH:END -->

<!-- SUPERCEEDED:START -->
<br />
<table border="0" width="100%" cellspacing="0" cellpadding="5">
<tr>
<td width="66" bgcolor="#FFFFFF"><br /></td>
<td width="100%" bgcolor="#EEEEEE">
	<p>
	<font color="#666666" face="verdana,arial,helvetica" size="5">
	<b>&nbsp;NOTE:</b></font>
	<font color="#999999" face="verdana,arial,helvetica" size="2">this code has been superceded by the <a href="..\..\home\vb\code\controls\menus\icon_menu_control\article.html" target="top">version at the new site</a>.
	</font>
	<br />
        </p>
</td>
<td width="66" bgcolor="#FFFFFF"><br /></td>
</tr>
</table>
<br />
<!-- SUPERCEDED:END -->


<table border="0" width="100%" cellspacing="0" cellpadding="0">
<tr>
	<td>&nbsp</td>
	<td colspan="3">
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	<br>
	<p><img src="..\..\images\cpopmnum.gif" alt="Icon Menu Control Demonstration" width="214" height="169"></p>
	<img src="..\..\images\update.gif" height="11" width="23" border="0" alt="Updated" hspace="2"><b>Updated!</b><br>
	<i>10 January 1999</i>: New Version 2 - a major upgrade to the control.  <a href="cpmupg.htm">Read about the changes to the 
	control</a>.
	<p><a href="cpopmenu.zip"><img src="..\..\images\vbdnload.gif" width="16" height="16" border="0" hspace="4" alt="VB5 code">Download the cPopMenu control (50kb)</a><br>
	<a href="cpopmnus.zip"><img src="..\..\images\vbdnload.gif" width="16" height="16" border="0" hspace="4" alt="VB5 code">Download the cPopMenu sample application code (82kb)</a><br>
	<a href="cpopmnud.zip"><img src="..\..\images\vbdnload.gif" width="16" height="16" border="0" hspace="4" alt="VB5 code">Download the complete cPopMenu demonstration and control source code (169kb)</a></p>
	</font>
	<p> 
	<table>
	<tr>
		<td width="20">&nbsp</td>
		<td colspan="2" bgcolor="#EEEEEE">
		<font color="#000000" face="verdana,arial,helvetica" size="1">
		<b>Source Code Note</b>
		</font>
		</td>
		<td width="30">&nbsp</td>
	</tr>
	<tr>
		<td width="20">&nbsp</td>
		<td valign="top"><img src="..\..\images\bullet.gif" border="0" hspace="2" width="8" height="8"></td>
		<td>
		<font color="#000000" face="verdana,arial,helvetica" size="1">
		This OCX is a binary compatible component which works with all other samples.  
		If you compile your own copy of this OCX yourself <b>please</b> make sure you change
		the name.  See <a href="..\..\mission.htm" target="vbamain">disclaimer and license</a> for more details.
		</font>
		</td>
		<td>&nbsp</td>
	</tr>
	<tr>
		<td>&nbsp</td>
		<td colspan="2" bgcolor="#EEEEEE">
		<font color="#000000" face="verdana,arial,helvetica" size="1">
		<b>Before you Begin</b>
		</font>
		</td>
		<td>&nbsp</td>
	</tr>
	<tr>
		<td>&nbsp</td>
		<td valign="top"><img src="..\..\images\bullet.gif" border="0" hspace="2" width="8" height="8"></td>
		<td valign="top">
		<font color="#000000" face="verdana,arial,helvetica" size="1">
		These projects require the <a href="..\ssubtmr\ssubtmr.htm">SSubTmr.DLL component</a>.  Make sure you have loaded and registered this before trying any project.
		</font>
		</td>
		<td>&nbsp</td>
	</tr>
	</table>
	</p>
	</font>
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	<p><b>Overview</b><br>
	The cPopMenu control is a really simple way to get icons into a VB project's menus.  It also allows you 
	to create arbitrary new submenus, gives you control over the system menu and has some useful new events
	indicating when menu items are highlighted and exited.
	</P>
	<p><b>Introducing the PopMenu Control</b><br>
	VB is a great language and interface designer, don't get me wrong.  But sometimes you get the feeling
	there just hasn't been enough effort put in.  Two particular examples are the printer object (better than
	it used to be, but still not very good!) and menus.
	</p>
	<p>
	When you first start VB5, you are presented with a wonderful interface: all the menus have icons which
	reflect the toolbar function, and there are neat popup right-click menus everywhere.  So I naturally
	thought we'd get these functions to use ourselves for our own VB applications.  Er... no.
	</p>
	<p>
	Instead we get the same old menu control that's been there since whenever.  You've got to predesign
	your menus at design time, and although you can add new levels to a existing menu, you're stuck if
	you want to add a new submenu.
	</p>
	<p>
	I found that for my application I needed to create a Favorites menu.  The Internet Explorer Favourites list
	seemed to be a good model as it allows you to organise stuff it you want to, or just add it straight in.
	Since you can't add a submenu to an existing menu in VB, however, you just can't do it! (Or, at least, you
	could but you would have to harshly restrict where things can be organised to).
	</p>
	Rather than give up (which maybe I should have, because for various reasons, which were unusally not code related, that application never got
	completed!)  I decided to build a menu control which allows you to create arbitrary numbers of sub-menus
	at run time.  At the same time I added icon support so you get Office/VB style menus for VB.
	</p>
	<p><b>How PopMenu Works</b><br>
	The cPopMenu control is a VB UserControl which is invisible at runtime.  When you call the initialisation
	method (SubClass) the control uses the Win32 API menu functions to determine what menus there are on the
	form and stores their IDs, captions, enabled state and so on in an internal array.  
	At the same time it also converts them to Owner-Draw menu items, so the cPopMenu
	control is notified when the menu items need drawing, and can draw the menu as required. 	
	Finally, the control subclasses the form so it can react to menu items being higlighted, clicked and when a
	popup menu is just about to be drawn.<br><br>
	This means that the control draws over the existing VB menus, but still allows the old menu events to be
	fired in code.  By exposing properties to access the internal array, the control allows icons to be 
	associated with the existing menu items, as well as allowing you store some useful extra information
	against the menu items (Key, HelpText, ItemData etc).
	</p>	
	<p><b>Quick Start - Adding Icon Menu Support to an Existing Application</b><br>
	Adding Icon Menu support to an existing application can be very simple, depending on what VB menu features
	you use.  If you don't use the menu <i>Load</i>,<i>Unload</i>,<i>Caption</i> or <i>Visible</i> methods, you only have to
	add a small amount of code.  I'll cover this case now.<br><br>
	The steps are:
	<ul>
	<li>Add a cPopMenu to your form.  If you don't already have an ImageList, add one with the icons you want.
	You can use either a standard COMCTL32.OCX image list or a <a href="..\comctl\imglist.htm">vbAccelerator
	Image List control/class</a> as the Image List.
	<li>Initialise the cPopMenu control and the icons against the menu items in the Form_Load event as follows:
	</ul>
	</p>
	</font>
	<p>
	<font face="Lucida Console,courier new" size="2">
&nbsp &nbsp        with cPopMenu1<br>
	</font>
	<font face="Lucida Console,courier new" size="2" color="#999999">
&nbsp &nbsp	&nbsp &nbsp	' Associate the image list:<br>
&nbsp &nbsp	&nbsp &nbsp	' NOTE: If you are using a VB ImageList, make sure that it has at<br>
&nbsp &nbsp	&nbsp &nbsp	' least one icon in it before calling this method.<br>
	</font>
	<font face="Lucida Console,courier new" size="2">
&nbsp &nbsp	&nbsp &nbsp        .ImageList = ilsIcons<br>
        <br>
	</font>
	<font face="Lucida Console,courier new" size="2" color="#999999">
&nbsp &nbsp	&nbsp &nbsp        ' Parse through the VB designed menu and sub class the items:<br>
	</font>
	<font face="Lucida Console,courier new" size="2">
&nbsp &nbsp	&nbsp &nbsp        .SubClassMenu Me<br>
	<br>
	</font>
	<font face="Lucida Console,courier new" size="2" color="#999999">
&nbsp &nbsp	&nbsp &nbsp        ' The Key property for a VB menu is set to the menu's name.<br>
&nbsp &nbsp	&nbsp &nbsp        ' In this example I set the icon for the mnuFileOpen menu item:<br>
	</font>
	<font face="Lucida Console,courier new" size="2">
&nbsp &nbsp	&nbsp &nbsp        .ItemIcon("mnuFileOpen") = ilsIcons.ListImages("OPEN").Index-1<br>
	<br>
	</font>
	<font face="Lucida Console,courier new" size="2" color="#999999">
	&nbsp &nbsp	&nbsp &nbsp        ' Repeat for your other menus<br>
	<br>
	</font>
	<font face="Lucida Console,courier new" size="2">
	&nbsp &nbsp End With<br>
	</p>
	</font>
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	And that's it!  Everything else will continue to work as before.  If you use the Caption property,
	there is a minor change you must make to make sure the menu item keeps being owner-drawn.  Instead
	of:
	</p>
	</font>
	<font face="Lucida Console,courier new" size="2">
	<p>
&nbsp &nbsp        mnuFile(0).Caption = "&Open Project..."
	</p>
	</font>
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	Write this:
	</p>
	</font>
	<font face="Lucida Console,courier new" size="2">
	<p>
&nbsp &nbsp        cPopMenu1.Caption("mnuFile(0)") = "&Open Project..."
	</p>
	</font>
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	If you use VB's <i>Load</i>, <i>Unload</i> methods or the <i>Visible</i> property, however, 
	you'll need to modify the code a bit more to use the new Add and Remove	menu features.
	</p>
	<p>
	<b>Adding, Inserting and Deleting Menu items</b><br>
	You can extend existing menus, create as many new sub-menus as you want and modify items in
	the menu using the following methods:
	<ul>
	<li><b>AddItem</b><br>
	This adds a new item to the menu.  You can specify a parent item if you want to create a new submenu.
	<li><b>InsertItem</b><i> New! 10 January 1999</i><br>
	This works in the same way as add item, but allows you to insert an item to the menu.  In combination
	with the <i>RemoveItem</i> method this makes it	much easier to work with menu items.
	<li><b>RemoveItem</b><i> New! 10 January 1999</i><br>
	Removes an item from a menu.
	<li><b>ReplaceItem</b><i> New ! 10 Janury 1999</i><br>
	Similar to <i>AddItem</i>, but instead replaces an existing menu item.  This allows you to change
	multiple properties of the menu item at the same time.
	<li><b>ClearSubMenusOfItem</b><br>
	This clears all the menu items in a submenu.  You can then use the <i>AddItem</i> and <i>InsertItem</i> methods
	to rebuild the list.
	</ul>
	Menu items added or inserted using these methods do not raise events through the standard VB menu events.
	(This is because your menu might be a completely new sub-menu, which has no corresponding VB event to fire through!)
	Instead the <i>ItemClick</i> event of cPopMenu fires, passing the index of the menu in the control.  You should use 
	cPopMenu's <i>ItemData</i>, <i>MenuKey</i> and <i>Caption</i> properties to make it easier to identify which 
	item has actually been clicked.<br><br>
	Menu items deleted using <i>ReplaceItem</i> or <i>ClearSubMenusOfItem</i> are hard-deleted from the control.
	If you ever subsequently want to get these items back again, you need to re-add them.
	</p>
	<p><b>cPopMenu and the VB Menu .Visible Property</b><br>
	Unfortunately, VB implements menus with <i>.Visible</i> set to false by actually deleting the
	menu handle entirely from the menu.  Because the cPopMenu control must use Windows API methods
	to work with the menu, it cannot detect VB menus which are not visible.  Here is an overview
	of what happens with menus that have <i>.Visible = False</i>:<br><br>
	<ul>
	<li>Menus set to be Invisible in the VB Menu designer<br>
	In this case the menu is not created when you the run the VB project.  When you call 
	cPopMenu's <i>SubClassMenu</i> method, it will have 
	no reference to these menu items.  The worst case is when all menu items are set to be invisible
	in the designer - then the cPopMenu will find no menus at all and will return a completely blank
	menu and the <i>.MenuCount</i> property will return 0!  If you are trying to do this, it is likely
	you are trying to create a pop-up menu with the submenu of one or more of the invisible items.  
	In this case you should use the <a href="cnewmenu.htm">Pop-up Menu ActiveX</a> DLL instead - it is
	much better suited to the task!
	<li>Setting <i>.Visible = False</i> at run-time.<br>
	In this case, the cPopMenu control will have a reference to the menu until you set <i>.Visible = False</i>.
	When you do this, VB deletes the menu handle that cPopMenu is refering to.  The control still thinks
	the menu is valid even though it has been removed.  You can continue to set properties for the removed
	menu item but they will have no effect.   When you set <i>.Visible</i> True again, VB creates a completely
	new menu handle for the item which the control does not know about - it still looks for the old menu
	handle.  The new menu will not be owner-drawn and you will not be able to refer to it from the control.
	</ul>
	There is now a work-around in the control for the lack of the <i>.Visible</i> property support in the control, 
	but it still can't really address the problems.  To use this method, whenever you change a menu item's
	<i>.Visible</i> property, you can call cPopMenu's <i>CheckForNewMenuItems</i> event.  This rechecks all
	the menu items and:
	<ul>
	<li>Removes items which have been made invisible in VB
	<li>For each menu item which was previously invisible but has subsequently been made visible, it fires
	a <i>RequestNewMenuItem</i> event.  You must fill in the Icon, Tag, Itemdata and other properties each
	time, because the cPopMenu control cannot keep track of menu items which are added and removed.	
	</ul>
	It is recommended that you avoid using the <i>.Visible</i> property and instead rewrite your code to
	use cPopMenu's	<i>AddItem</i>, <i>InsertItem</i> and <i>RemoveItem</i> properties instead.  These
	properties are much more flexible and allow you to add unlimited menu items at any level in the
	hierarachy.
	<p><b>Recoding for Load and Unload Methods</b><br>	
	The VB <i>Load</i> and <i>Unload</i> methods for menu items will interfere with the operation of the
	cPopMenu control in a similar way to the <i>.Visible</i> property:
	<ul>
	<li><i>Load</i> will successfully add a new menu, but the menu will not be under cPopMenu's
	control and you will not be able to set icons for it.  
	<li><i>Unload</i> will remove the menu from the display
	but the cPopMenu control will still think that exists.  
	</ul>
	Again, you can work around these issues by using the <i>CheckForNewMenuItems</i> method, but it is 
	recommended you recode using the <i>AddItem</i>, <i>InsertItem</i> and <i>RemoveItem</i> properties
	instead.
	</p>
	<p><b>About the Demonstration Project</b><br>
	The demonstration project shows how to exercise all these features, including dynamically building a
	menu from a directory listing (it checks for subdirectories below the project itself).<br><br>
	Further projects demonstrating more advanced techniques with the control are also available:<br>
	<ul>
	<li><a href="cpmmdi.htm">Using the cPopMenu control in an MDI project with multiple child menus</a><br>
	<li><a href="cpmcpic.htm">Using the cPopMenu control to Implement a Colour Picker</a><br>
	</ul>
	</p>
	<p><b>Documentation</b><br>
	Documentation for the cPopMenu control is available in RTF format.  This documentation was
	created with the <a href="..\actvxdoc\article.htm">Active X Documenter</a>, which is also available
	for download.<br><br>
	<a href="cpopmenu.rtf" target="vbamain"><img src="..\..\images\dnlddoc.gif" width="20" height="16" border="0" hspace="4">Click here to download/view the cPopMenu method and event documentation</a>
	<br><br>
	</p>
	</font>
	<font color="#000000" face="verdana,arial,helvetica" size="2">
	<br><br><br>
	<p><a href="#sectop"><img src="..\..\images\top.gif" border="0" width="8" height="12" hspace="4" alt="Top"></a>Back to <a href="#sectop">top</a><br>
	<a href="..\..\overview.htm"><img src="..\..\images\sc.gif" border="0" width="8" height="12" hspace="4" alt="Source Code - What We're About!"></a>Back to <a href="..\..\overview.htm">Source Code</a></p>
	<br><br><br><br>
	</font>
	</td>
	<td>&nbsp</td>
</tr>
</table>	

<!-- BODY:END -->

<!-- SUPERCEEDED:START -->
<br />
<table border="0" width="100%" cellspacing="0" cellpadding="5">
<tr>
<td width="66" bgcolor="#FFFFFF"><br /></td>
<td width="100%" bgcolor="#EEEEEE">
	<p>
	<font color="#666666" face="verdana,arial,helvetica" size="5">
	<b>&nbsp;NOTE:</b></font>
	<font color="#999999" face="verdana,arial,helvetica" size="2">this code has been superceded by the <a href="..\..\home\vb\code\controls\menus\icon_menu_control\article.html" target="_top">version at the new site</a>.
	</font>
	<br />
        </p>
</td>
<td width="66" bgcolor="#FFFFFF"><br /></td>
</tr>
</table>
<br />
<!-- SUPERCEDED:END -->

<!-- FOOTER:START -->
<table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
        <td colspan="2">
        <IMG SRC="..\..\images\grpixel.gif" height="1" width="100%" border="0" ALT="">
        </td>
    </tr>
    <tr>
	<td width="16">&nbsp;</td>
        <td>
	<font size="1" face="Verdana, Arial, Helvetica">
	<p>
	<a href="..\..\mission.htm">About</a>&nbsp;&nbsp;<a 
	href="..\..\contrib.htm">Contribute</a>&nbsp;&nbsp;<a 
	href="mailto:steve@vbaccelerator.com">Send Feedback</a>&nbsp;&nbsp;<a 
	href="..\..\privacy.html">Privacy</a>
	<br><br>
        Copyright &copy; 1998-1999, Steve McMahon (
	<a href="mailto:steve@vbaccelerator.com">steve@vbaccelerator.com</a>). All Rights Reserved.<br>
	Last updated: 10 January 1999</font></p>
        </td>
    </tr>
</table>
<!-- FOOTER:END -->

</body>
</html>
